//>>built
define("davinci/ve/RebuildPage","dojo/_base/declare ./Context ../model/Path davinci/model/Factory dojo/Deferred dojo/promise/all davinci/ve/commands/ChangeThemeCommand".split(" "),function(m,n,k,p,l,q,r){return m(null,{constructor:function(b){dojo.mixin(this,b);this.context=new n},getPageCss:function(){return["app.css"]},getPageJs:function(){return["app.js"]},rebuildSource:function(b,a,c,d){if(!a||!(a.extension&&"html"==a.extension)){var e=new l;e.resolve(b);return e}this.context.model=this.context._srcDocument=
p.getNewFromResource(a);var h=new k(a?a.getPath():"");this.context.model.fileName=h.toString();this.context._srcDocument.setText(b,!0);if(null==this.context._srcDocument.find({elementType:"HTMLElement",tag:"html"},!0))return e=new l,e.resolve(b),e;var f=this.context._srcDocument.find({elementType:"HTMLElement"});b=[];b.push(this.context.loadRequires("html.body",!0,!0,!0));for(a=0;a<f.length;a++){var g=f[a],g=g.getAttribute("data-dojo-type")||g.getAttribute("dojoType")||g.getAttribute("dvwidget");
null!=g&&b.push(this.context.loadRequires(g.replace(/\./g,"/"),!0,!0,!0))}c&&this.changeThemeBase(c,h);d&&d.mobileTheme&&(new r(d,this.context))._dojoxMobileAddTheme(this.context,d.mobileTheme);f=this.getPageCss();c=this.getPageJs();d=this.context._getCurrentBasePath();h=h.getParentPath();for(a=0;a<f.length;a++)g=d.append(f[a]).relativeTo(h).toString(),this.addModeledStyleSheet(g,f[a]);for(a=0;a<c.length;a++)f=d.append(c[a]).relativeTo(h).toString(),this.addJavaScript(f,null,null,null,c[a]);e=new l;
q(b).then(function(){e.resolve(this.context._srcDocument.getText())}.bind(this));return e},addModeledStyleSheet:function(b,a){this.context._srcDocument.find({elementType:"CSSImport"}).some(function(c){if(c.url&&-1<c.url.indexOf(a))return c.setUrl(b),!0})},addJavaScript:function(b,a,c,d,e){!this.context._srcDocument.find({elementType:"HTMLElement",tag:"script"}).some(function(a){var c=a.getAttribute("src");if(c&&-1<c.indexOf(e))return a.setAttribute("src",b),!0})&&b&&(-1<b.indexOf("dojo.js")&&this.context.addHeaderScript(b,
{"data-dojo-config":"parseOnLoad: true"}),this.context.addHeaderScript(b))},changeThemeBase:function(b,a){var c=new k(b.getFile().parent.getPath()),d=function(b){var d=c.append(b).relativeTo(a,!0);this.addModeledStyleSheet(d.toString(),new k(b),!0)}.bind(this);b.files.forEach(d);b.conditionalFiles&&b.conditionalFiles.forEach(d)}})});
//# sourceMappingURL=RebuildPage.js.map