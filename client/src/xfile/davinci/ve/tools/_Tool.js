//>>built
define("davinci/ve/tools/_Tool",["dojo/_base/declare","davinci/ve/widget","davinci/ve/metadata","davinci/ve/utils/GeomUtils"],function(l,m,p,n){return l("davinci.ve.tools._Tool",null,{_getTarget:function(){return this._target},_setTarget:function(a,c){this._targetOverlays||(this._targetOverlays=[]);if(!this._matchesTargetOverlay(a)){for(var f=this._context.getContainerNode(),b;a&&a!=f;)if((b=m.getEnclosingWidget(a))&&!b.getContext())a=b.domNode.parentNode,b=null;else{b&&davinci.ve.metadata.queryDescriptor(b.type,
"enablePointerEvents")?b=null:b&&b.getContainerNode()&&(davinci.ve.metadata.queryDescriptor(b.type,"isControl")||(b=null));break}b?(this._target=b,this._updateTargetOverlays(c),this._insertTargetOverlays()):(this._removeTargetOverlays(),this._target=null)}},_updateTargetOverlays:function(a){this._removeTargetOverlays();if(this._target){var c=this._target.domNode,f=this._getMaxZIndex(c);if(this._targetOverlays){var b=this._target.getHelper();if(b&&b.getTargetOverlays&&(b=b.getTargetOverlays(this._target))&&
0<b.length){dojo.forEach(b,function(a){a=this._getNewTargetOverlay(a,a.x,a.y,a.width,a.height,f);this._targetOverlays.push(a)},this);return}var b=c.offsetLeft,g=c.offsetTop,h=c.offsetWidth,k=c.offsetHeight;if(a){var e,d=n.getBorderBoxPageCoordsCached(c);a.pageX<d.l&&(e=d.l-a.pageX,b-=e,h+=e);a.pageY<d.t&&(e=d.t-a.pageY,g-=e,k+=e);a.pageX>d.l+d.w&&(e=a.pageX-(d.l+d.w),h+=e);a.pageY>d.t+d.h&&(e=a.pageY-(d.t+d.h),k+=e)}a=this._getNewTargetOverlay(c,b,g,h,k,f);this._targetOverlays.push(a)}}},_getMaxZIndex:function(a){var c=
dojo.style(a,"zIndex");dojo.query("*",a).forEach(function(a){a=dojo.style(a,"zIndex");var b=Number(a),g=Number(c);isNaN(b)||(isNaN(g)?c=a:b>g&&(c=a))});return c},_getNewTargetOverlay:function(a,c,f,b,g,h){return this._context.getDojo().create("div",{className:"editFeedback",style:{position:"absolute",opacity:0.1,left:c+"px",top:f+"px",width:b+"px",height:g+"px",zIndex:h}})},_insertTargetOverlays:function(){if(this._targetOverlays&&this._target){var a=this._target.domNode,c=a.parentNode;dojo.forEach(this._targetOverlays,
function(f){c.insertBefore(f,a.nextSibling)},this)}},_removeTargetOverlays:function(){if(this._targetOverlays&&this._target)for(var a=this._targetOverlays.length-1;0<=a;a--)dojo.destroy(this._targetOverlays[a]),this._targetOverlays.pop()},_matchesTargetOverlay:function(a){return dojo.some(this._targetOverlays,function(c){return a==c},this)}})});
//# sourceMappingURL=_Tool.js.map