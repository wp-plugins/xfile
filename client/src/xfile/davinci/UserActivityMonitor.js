//>>built
define("davinci/UserActivityMonitor",["require","dojo/_base/xhr","dojo/i18n!./nls/webContent"],function(d,e,c){return{setUpInActivityMonitor:function(a,b){b.singleUserMode()?this._MaxInactiveInterval=-1:(this._firstPoll=!0,this._MaxInactiveInterval=300,this.keepAlive(),this.addInActivityMonitor(a),b.subscribe("/dojo/io/load",this.lastServerConnection),this.userActivity())},addInActivityMonitor:function(a){return-1===this._MaxInactiveInterval?[]:[dojo.connect(a.documentElement,"keydown",this,"userActivity"),
dojo.connect(a.documentElement,"mousedown",this,"userActivity")]},userActivity:function(a){this.countdown&&this.resetIdle();this._idleTimer&&window.clearTimeout(this._idleTimer);0<this._MaxInactiveInterval&&(a=1E3*this._MaxInactiveInterval,this._idleTimer=window.setTimeout(function(){this.idle()}.bind(this),a))},keepAlive:function(){return e.get({url:"cmd/keepalive",handleAs:"json"}).then(function(a){a.MaxInactiveInterval&&(this._MaxInactiveInterval=a.MaxInactiveInterval,this._firstPoll&&(delete this._firstPoll,
this.userActivity(null)))}.bind(this),function(a){})},lastServerConnection:function(a,b){this._serverPollTimer&&window.clearTimeout(this._serverPollTimer);if(0<this._MaxInactiveInterval){var c=800*this._MaxInactiveInterval;this._serverPollTimer=window.setTimeout(function(){this.keepAlive()}.bind(this),c)}},idle:function(){var a=30,b=this.warnDiv=dojo.create("div",{"class":"idleWarning",innerHTML:dojo.string.substitute(c.idleSessionMessage,{seconds:a})},dojo.byId("davinci_app"),"first");this.countdown=
window.setInterval(function(){0===--a?(window.clearInterval(this.countdown),delete this.countdown,d("davinci/Workbench").logoff().otherwise(function(a){})):b.innerHTML=dojo.string.substitute(c.idleSessionMessage,{seconds:a})}.bind(this),1E3)},resetIdle:function(a){window.clearInterval(this.countdown);delete this.countdown;this.warnDiv.parentNode.removeChild(this.warnDiv);delete this.warnDiv;this.userActivity()}}});
//# sourceMappingURL=UserActivityMonitor.js.map