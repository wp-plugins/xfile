//>>built
define("davinci/de/resource","davinci/de/widgets/NewDijit davinci/Workbench davinci/workbench/Preferences system/resource davinci/de/DijitTemplatedGenerator davinci/library davinci/ui/Dialog davinci/ve/actions/ReplaceAction dojo/promise/all".split(" "),function(u,f,p,l,v,w,x,y,z){var m={WIDGETS_JSON:{version:"1.0",localPath:!0,customWidgetSpec:1,categories:{custom:{name:"Custom widget",description:"Custom widget",widgetClass:"dijit"}},widgets:[]},createDijiFromNewDialog:function(){var a=new u({}),
b=f.getOpenEditor(),c=l.findResource(b.fileName),d=b.model,e=f.getOpenEditor().getContext(),q=e.getSelection();m.validWidget(q)?f.showModal(a,"Dijit Widget...",{height:60,width:250},function(){if(!a.cancel){var b=a.attr("value");m.createDijit(b,d,c,e,q).then(function(){b.replaceSelection&&(new y).run(e,b.group+"."+b.name);window.location.reload(!1)})}return!0}):x.showModal("Invalid Selection.  Please select a single container widget to create a new Widget","Error creating Widget...")},validWidget:function(a){return null==
a||1!=a.length?!1:a[0].acceptsHTMLChildren},_createNameSpace:function(a,b){var c=a.split("."),d=f.getProject();b=b||l.findResource(d);if(1<c.length)for(d=0;d<c.length-1;d++){var e=b.getChildSync(c[d]);b=null!=e?e:b.createResource(c[d],!0)}return b},_createFolder:function(a,b,c){a=a.split("/");var d=f.getProject();b=b||l.findResource(d);if(a.length){for(d=0;d<a.length;d++)if("."!=a[d]){console.error("get child sync : "+a[d]);var e=b._getChild(a[d]);if(null!=e)b=e;else{b.createResource(a[d],!0,!1,c);
return}}null!=b&&c&&c(b)}return b},createDijit:function(a,b,c,d,e){var q=a.name+"."+a.name,l=a.name+"/"+a.name,r=f.getProject();c=p.getPreferences("davinci.ui.ProjectPrefs",r);c.widgetFolder||(c.widgetFolder="WebContent/custom",p.savePreferences("davinci.ui.ProjectPrefs",r,c));m._createFolder(c.widgetFolder,null,function(c){c=m._createNameSpace(q,c);var f=c.getChildSync(a.name+"_widgets.json");null==f&&(f=c.createResource(a.name+"_widgets.json"));var n=dojo.clone(m.WIDGETS_JSON);n.name=a.name;n.longName=
a.name;for(var g={name:a.name,description:a.name,type:l,category:"custom",iconLocal:!0,icon:"app/davinci/img/maqetta.png"},h=0,k=e[0]._srcElement.attributes,p=k.length;h<p;h++){var s=k[h];s.noPersist||(g.properties||(g.properties={}),g.properties[s.name]=s.value)}n.widgets.push(g);var g=[f.setContents(JSON.stringify(n,void 0,"\t"))],h=(new v({})).buildSource(b,l,a.name,!1,d,e),t;for(t in h)switch(t){case "html":k=c.createResource(a.name+".html");g.push(k.setContents(h.html));break;case "js":k=c.createResource(a.name+
".js");g.push(k.setContents(h.js));break;case "metadata":k=c.createResource(a.name+"_oam.json"),g.push(k.setContents(h.metadata)),w.addCustomWidgets(r,f,c.getPath(),n)}return z(g)})}};return m});
//# sourceMappingURL=resource.js.map