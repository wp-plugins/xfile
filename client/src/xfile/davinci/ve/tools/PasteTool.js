//>>built
define("davinci/ve/tools/PasteTool","dojo/_base/declare ./CreateTool ../widget ../metadata ../../commands/CompoundCommand ../commands/AddCommand ../commands/MoveCommand ../commands/StyleCommand dojo/Deferred dojo/promise/all".split(" "),function(t,u,l,v,w,x,y,z,p,q){return t("davinci.ve.tools.PasteTool",u,{constructor:function(e){this.inherited(arguments);this._position_prop=null;var b=e[0];b&&b.properties&&(b=l.parseStyleValues(b.properties.style),this._position_prop=l.retrieveStyleProperty(b,"position",
""))},_create:function(e){var b=e.index,m,g,h=new w,n,r=[],a=new p,s;s=this._data.map(function(k){var f=new p,a=[];if(!this._loadType(k,a))return f.reject(),f;q(a).then(function(){var c=l.parseStyleValues(k.properties&&k.properties.style);if("absolute"==this._position_prop){var a=parseInt(l.retrieveStyleProperty(c,"left","0px")),c=parseInt(l.retrieveStyleProperty(c,"top","0px"));m?g={x:a+m.x,y:c+m.y}:e.position?(g=e.position,m={x:e.position.x-a,y:e.position.y-c}):(g={x:a,y:c},m={x:0,y:0})}dojo.withDoc(this._context.getDocument(),
function(){var a=function(a){void 0!==b&&0<=b&&b++;r.push(a);if(g){var d=this._context.getPreference("absoluteWidgetsZindex");h.add(new z(a,[{position:"absolute"},{"z-index":d}]));a=new y(a,g.x,g.y,n,null,null,n);n||(n=a);h.add(a)}f.resolve()}.bind(this);k.context=this._context;v.getHelper(k.type,"tool").then(function(c){var d;c&&(d=new c(k));if(d&&d.addPasteCreateCommand)c={parent:e.parent||this._context.getContainerNode(),position:g,index:b},d.addPasteCreateCommand(h,c).then(function(b){if(!b)return f.reject(),
f;a(b)});else{d=l.createWidget(k);if(!d)return f.reject(),f;h.add(new x(d,e.parent||this._context.getContainerNode(),b));this.checkAddToCurrentState(h,d);a(d)}}.bind(this))}.bind(this))}.bind(this));return f}.bind(this));q(s).then(function(){h.isEmpty()||(this._context.getCommandStack().execute(h),setTimeout(function(){r.forEach(function(a,b){this._context.select(a,0<b)}.bind(this))}.bind(this),0));a.resolve()}.bind(this));return a},createWithFlowLayout:function(){return"absolute"!=this._position_prop}})});
//# sourceMappingURL=PasteTool.js.map