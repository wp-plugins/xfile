//>>built
define("davinci/actions/SaveAsWidget","dojo/_base/declare ./Action ../Workbench davinci/ui/Dialog ../ui/SaveAsWidgetForm dojo/i18n!../ui/nls/common".split(" "),function(h,k,l,m,n,p){return h("davinci.actions.SaveAsWidget",k,{run:function(a){"davinci.ve.Context"!==a.declaredClass&&(a="function"===typeof a.getContext?a.getContext():l.getOpenEditor().getContext());a=this._generateMetadata(a);this._showDialog(a)},_generateMetadata:function(a){var c={spec:"1.0",require:[],library:{}},d=a.model.find({elementType:"HTMLElement",
tag:"body"},!0);c.content=dojo.trim(d.getText(a).match(/<body[^>]*>([\s\S]*)<\/body>/)[1]);this._getRequires(a.getTopWidgets(),c);return c},_getRequires:function(a,c){function d(a,b,c){dojo.forEach(a,function(a){if(!c.hasOwnProperty(a.type)){c[a.type]=!0;dojo.forEach(a.metadata.require,function(a){this._inRequiresArray(a,b.require)||b.require.push(a)},this);for(var e in a.metadata.library)a.metadata.library.hasOwnProperty(e)&&(b.library[e]||(b.library[e]=a.metadata.library[e]))}d.call(this,a.getChildren(),
b,c)},this)}var b=b||{};d.call(this,a,c,b);if(1<c.require.length){for(var b=c.require.slice(0,1),f=1;f<c.require.length;f++){var g=c.require[f];g.$text&&b[b.length-1].$text?b[b.length-1].$text+="\n"+g.$text:b.push(g)}c.require=b}},_inRequiresArray:function(a,c){var d=a.$text?a.$text.replace(/\s/g," "):"";return dojo.some(c,function(b){return a.type===b.type&&(a.src&&b.src&&a.src===b.src&&(a.$library&&b.$library&&a.$library===b.$library||!a.$library&&!b.$library)||a.$text&&b.$text&&d===b.$text.replace(/\s/g,
" "))})},_showDialog:function(a){var c=new m({title:p.sawdTitle,"class":"dvSaveAsWidgetDialog",execute:dojo.hitch(this,function(a){this._saveMetadata(a.metadata)}),onHide:function(){setTimeout(function(){c.destroyRecursive()},c.duration)}});a=new n({parentId:c.id,metadata:a});c.set("content",a);c.show()},_saveMetadata:function(a){}})});
//# sourceMappingURL=SaveAsWidget.js.map