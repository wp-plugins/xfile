<!DOCTYPE html>
<html>
<head>
    
    <script src="easyXDM.js"></script>
    <script src="./vogue-client.js" type="text/javascript">
    </script>

    <style type="text/css">
        html, body { 
            margin: 0; 
            padding: 0; 
            width: 100% ; 
            height: 100%; 
            background-color:white;
        }
        
    </style>
    
    <link rel="stylesheet" type="text/css" href="./test.css"/>
    <link rel="stylesheet" type="text/css" href="./lessTest.css"/>

    <script type="text/javascript">
        var pixlrEditor = null;
        var xdmSocket = null;
        var editorImage=null;
        var imageUrl=null;
        var editorArgs=null;
        var saveUrl=null;
        var title='';
        
        

        
        function urlDecode (string, overwrite) {
            if (!string || !string.length) {
                return{}
            }
            var obj = {};
            var pairs = string.split("&");
            var pair, name, value;
            for (var i = 0, len = pairs.length; i < len; i++) {
                pair = pairs[i].split("=");
                name = decodeURIComponent(pair[0]);
                value = decodeURIComponent(pair[1]);
                if(value!=null && value==='true'){
                    value=true;
                }else if(value==='false'){
                    value=false;
                }
                if (overwrite !== true) {
                    if (typeof obj[name] == "undefined") {
                        obj[name] = value
                    } else {
                        if (typeof obj[name] == "string") {
                            obj[name] = [obj[name]];
                            obj[name].push(value)
                        } else {
                            obj[name].push(value)
                        }
                    }
                } else {
                    obj[name] = value
                }
            }
            return obj;
        }
        function resize(w,h){
        }
        function img_create(src, alt, title) {
            var img= document.createElement('img');
            img.src= src;
            img.id='theImage';
            img.style.display='none';
            if (alt!=null) img.alt= alt;
            if (title!=null) img.title= title;
            editorImage = img;
            document.getElementsByTagName('body')[0].appendChild(img);
            return img;
        }
        function onEditorReady(){
            /*launchEditor('theImage', imageUrl);*/
        }
        function onFileContentChange(eventData){
            var path = '' + eventData.path;
            path=path.replace('./','/');
            var reloadFn = window['xappOnStyleSheetChanged'];
            if(reloadFn){
                reloadFn(path);
            }else{

            }
        }

        function onMessage(message){
            
            var result  = JSON.parse(message);
            //console.error('on message');
            //console.dir(result);

            if(result && result.command && result.command==='onFileContentChanged')
            {
                onFileContentChange(result);
            }
        }
        function sendMessage(message)
        {
            xdmSocket.postMessage(JSON.stringify(message));
        }
        function init (){
            var inUrl = '' + window.location.href;
            var parameterString = '' ;
            if(inUrl.lastIndexOf('?')){
                parameterString = inUrl.substring(inUrl.lastIndexOf('?')+1,inUrl.length);
                var urlParameters=urlDecode(parameterString);
                var target =urlParameters.xdmTarget;
                target=decodeURIComponent(target);
                xdmSocket = new easyXDM.Socket({
                    remote: "" + target,
                    onMessage:function (message, origin)
                    {
                        onMessage(message);
                    }
                });
            }
        }

        document.onreadystatechange = function () {
            var state = document.readyState;
            if (state == 'interactive') {
            } else if (state == 'complete') {
                init();
            }
            
        }
    </script>
</head>
<body ready='init' style="height: 100%;width: 100%;" id="body">
   
    just some text!
    <div class="lessTest">asdfasdf</div>
    
</body>
</html>













