//>>built
/*

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation
  Mihai Sucan (Mozilla Foundation) - fix for Bug#334583 Bug#348471 Bug#349485 Bug#350595 Bug#360726 Bug#361180 Bug#362835 Bug#362428 Bug#362286 Bug#354270 Bug#361474 Bug#363945 Bug#366312 Bug#370584
*/
define("orion/editor/textView",["orion/editor/textModel","orion/editor/keyBinding","orion/editor/eventTarget","orion/editor/util"],function(J,D,K,l){function H(a,b,c,d){"function"===typeof a.addEventListener?a.addEventListener(b,c,!0===d):a.attachEvent("on"+b,c)}function A(a,b,c){if(c){b.className="";c=b.attributes;for(var d=c.length;0<d--;)(!l.isIE||9<=l.isIE||9>l.isIE&&c[d].specified)&&b.removeAttribute(c[d].name)}if(a){a.styleClass&&(b.className=a.styleClass);if(c=a.style)for(var e in c)c.hasOwnProperty(e)&&
(b.style[e]=c[e]);if(a=a.attributes)for(var f in a)a.hasOwnProperty(f)&&b.setAttribute(f,a[f])}}function E(a){return a instanceof Array?a.slice(0):a}function B(a,b){if(a===b)return!0;if(a&&!b||!a&&b||a&&a.constructor===String||b&&b.constructor===String)return!1;if(a instanceof Array||b instanceof Array){if(!(a instanceof Array&&b instanceof Array)||a.length!==b.length)return!1;for(var c=0;c<a.length;c++)if(!B(a[c],b[c]))return!1;return!0}if(!(a instanceof Object)||!(b instanceof Object))return!1;
for(c in a)if(a.hasOwnProperty(c)&&(!b.hasOwnProperty(c)||!B(a[c],b[c])))return!1;for(c in b)if(!a.hasOwnProperty(c))return!1;return!0}function C(a,b,c){for(var d=0,e=0,f=0,h=a.length;f<h;){-1!==d&&d<=f&&(d=a.indexOf("\r",f));-1!==e&&e<=f&&(e=a.indexOf("\n",f));var g=f,k;if(-1===e&&-1===d){b(a.substring(f));break}-1!==d&&-1!==e?d+1===e?(k=d,f=e+1):(k=d<e?d:e,f=(d<e?d:e)+1):-1!==d?(k=d,f=d+1):(k=e,f=e+1);b(a.substring(g,k));c()}}function I(a){var b,c,d,e,f=a.ownerDocument.defaultView||a.ownerDocument.parentWindow;
f.getComputedStyle?(a=f.getComputedStyle(a,null),b=a.getPropertyValue("padding-left"),c=a.getPropertyValue("padding-top"),d=a.getPropertyValue("padding-right"),e=a.getPropertyValue("padding-bottom")):a.currentStyle&&(b=a.currentStyle.paddingLeft,c=a.currentStyle.paddingTop,d=a.currentStyle.paddingRight,e=a.currentStyle.paddingBottom);return{left:parseInt(b,10)||0,top:parseInt(c,10)||0,right:parseInt(d,10)||0,bottom:parseInt(e,10)||0}}function F(a){var b,c,d,e,f=a._trim;if(!f){var f=I(a),h=a.ownerDocument.defaultView||
a.ownerDocument.parentWindow;h.getComputedStyle?(e=h.getComputedStyle(a,null),b=e.getPropertyValue("border-left-width"),c=e.getPropertyValue("border-top-width"),d=e.getPropertyValue("border-right-width"),e=e.getPropertyValue("border-bottom-width")):a.currentStyle&&(b=a.currentStyle.borderLeftWidth,c=a.currentStyle.borderTopWidth,d=a.currentStyle.borderRightWidth,e=a.currentStyle.borderBottomWidth);b=parseInt(b,10)||0;c=parseInt(c,10)||0;d=parseInt(d,10)||0;e=parseInt(e,10)||0;f.left+=b;f.top+=c;f.right+=
d;f.bottom+=e;a._trim=f}return f}function x(a,b,c){this.start=a;this.end=b;this.caret=c}function y(a){this.left=a.left;this.top=a.top;this.right=a.right;this.bottom=a.bottom}function z(a,b,c){this.view=a;this.lineIndex=b;this._lineDiv=c}function G(a){this._init(a)}x.prototype={clone:function(){return new x(this.start,this.end,this.caret)},collapse:function(){this.caret?this.end=this.start:this.start=this.end},extend:function(a){this.caret?this.start=a:this.end=a;this.start>this.end&&(a=this.start,
this.start=this.end,this.end=a,this.caret=!this.caret)},setCaret:function(a){this.end=this.start=a;this.caret=!1},getCaret:function(){return this.caret?this.start:this.end},toString:function(){return"start\x3d"+this.start+" end\x3d"+this.end+(this.caret?" caret is at start":" caret is at end")},isEmpty:function(){return this.start===this.end},equals:function(a){return this.caret===a.caret&&this.start===a.start&&this.end===a.end}};y.prototype={toString:function(){return"{l\x3d"+this.left+", t\x3d"+
this.top+", r\x3d"+this.right+", b\x3d"+this.bottom+"}"}};z.prototype={create:function(a,b){if(!this._lineDiv){var c=this._lineDiv=this._createLine(a,b,this.lineIndex);c._line=this;return c}},_createLine:function(a,b,c){var d=this.view,e=d._model,f=e.getLine(c),h=e.getLineStart(c),g={type:"LineStyle",textView:d,lineIndex:c,lineText:f,lineStart:h};if(2E3>f.length)d.onLineStyle(g);e=b||l.createElement(a.ownerDocument,"div");if(!b||!B(b.viewStyle,g.style))A(g.style,e,b),b&&(b._trim=null),e.viewStyle=
g.style,e.setAttribute("role","presentation");e.lineIndex=c;c=[];this._createRanges(g.ranges,f,0,f.length,h,{tabOffset:0,ranges:c});f=" ";!d._fullSelection&&9>l.isIE&&(f="\ufeff");l.isWebkit&&(f="\u200c");c.push({text:f,style:d._metrics.largestFontStyle,ignoreChars:1});var k,m,n,p,q,f=d=0,r,s;if(b){if(m=b.modelChangedEvent)0===m.removedLineCount&&0===m.addedLineCount?(s=m.start-h,r=m.addedCharCount-m.removedCharCount):s=-1,b.modelChangedEvent=void 0;m=b.firstChild}for(h=0;h<c.length;h++){k=c[h];p=
k.text;d+=p.length;g=k.style;if(m)if(q=m.firstChild.data,n=m.viewStyle,q===p&&B(g,n)){f+=q.length;m._rectsCache=void 0;k=m=m.nextSibling;continue}else for(;m;){if(-1!==s){n=d;n>=s&&(n-=r);q=(q=m.firstChild.data)?q.length:0;if(f+q>n)break;f+=q}n=m.nextSibling;e.removeChild(m);m=n}k=this._createSpan(e,p,g,k.ignoreChars);m?e.insertBefore(k,m):e.appendChild(k);b&&(b.lineWidth=void 0)}if(b)for(a=k?k.nextSibling:null;a;)n=a.nextSibling,b.removeChild(a),a=n;else a.appendChild(e);return e},_createRanges:function(a,
b,c,d,e,f){if(!(c>=d)){if(a)for(var h=0;h<a.length;h++){var g=a[h];if(!(g.end<=e+c)){var k=Math.max(e+c,g.start)-e;if(k>=d)break;var m=Math.min(e+d,g.end)-e;if(k<m){k=Math.max(c,k);m=Math.min(d,m);for(c<k&&this._createRange(b,c,k,null,f);h+1<a.length&&a[h+1].start-e===m&&B(g.style,a[h+1].style);)g=a[h+1],m=Math.min(e+d,g.end)-e,h++;this._createRange(b,k,m,g.style,f);c=m}}}c<d&&this._createRange(b,c,d,null,f)}},_createRange:function(a,b,c,d,e){if(!(b>=c)){var f=this.view._customTabSize;if(f&&8!==f)for(var h=
a.indexOf("\t",b);-1!==h&&h<c;){b<h&&(b={text:a.substring(b,h),style:d},e.ranges.push(b),e.tabOffset+=b.text.length);b=f-e.tabOffset%f;if(0<b){for(var g="\u00a0",k=1;k<b;k++)g+=" ";b={text:g,style:d,ignoreChars:b-1};e.ranges.push(b);e.tabOffset+=b.text.length}b=h+1;h=a.indexOf("\t",b)}b<c&&(b={text:a.substring(b,c),style:d},e.ranges.push(b),e.tabOffset+=b.text.length)}},_createSpan:function(a,b,c,d){var e=c&&"A"===c.tagName;e&&(a.hasLink=!0);var e=e&&this.view._linksVisible?"a":"span",f=a.ownerDocument;
a=l.createElement(a.ownerDocument,e);a.appendChild(f.createTextNode(b));A(c,a);if("A"===e){var h=this.view,g=this._getWindow();H(a,"click",function(a){return h._handleLinkClick(a?a:g.event)},!1)}a.viewStyle=c;d&&(a.ignoreChars=d);return a},_ensureCreated:function(){return this._lineDiv?this._lineDiv:this._createdDiv=this.create(this.view._clientDiv,null)},getBoundingClientRect:function(a,b){var c=this._ensureCreated(),d=this.view;if(void 0===a)return this._getLineBoundingClientRect(c,!0);var e=d._model,
f=c.ownerDocument,h=this.lineIndex,g=null;if(a<e.getLineEnd(h)){e=e.getLineStart(h);for(h=c.firstChild;h;){var k=h.firstChild,m=k.length;h.ignoreChars&&(m-=h.ignoreChars);if(e+m>a){g=a-e;if(d._isRangeRects)f=f.createRange(),f.setStart(k,g),f.setEnd(k,g+1),g=new y(f.getBoundingClientRect());else if(l.isIE)f=f.body.createTextRange(),f.moveToElementText(h),f.collapse(),f.moveEnd("character",g+1),f.moveStart("character",g),g=new y(f.getBoundingClientRect());else{var n=k.data;h.removeChild(k);h.appendChild(f.createTextNode(n.substring(0,
g)));var p=l.createElement(f,"span");p.appendChild(f.createTextNode(n.substring(g,g+1)));h.appendChild(p);h.appendChild(f.createTextNode(n.substring(g+1)));g=new y(p.getBoundingClientRect());h.innerHTML="";h.appendChild(k);this._createdDiv||(f=d._getSelection(),(e<=f.start&&f.start<e+m||e<=f.end&&f.end<e+m)&&d._updateDOMSelection())}l.isIE&&(f=c.ownerDocument.defaultView||c.ownerDocument.parentWindow,c=f.screen.logicalXDPI/f.screen.deviceXDPI,f=f.screen.logicalYDPI/f.screen.deviceYDPI,g.left*=c,g.right*=
c,g.top*=f,g.bottom*=f);break}e+=m;h=h.nextSibling}}c=this.getBoundingClientRect();g||(d._wrapMode?(d=this.getClientRects(),g=d[d.length-1],g.left=g.right,g.left+=c.left,g.top+=c.top,g.right+=c.left,g.bottom+=c.top):(g=new y(c),g.left=g.right));if(b||void 0===b)g.left-=c.left,g.top-=c.top,g.right-=c.left,g.bottom-=c.top;return g},_getClientRects:function(a,b){var c,d,e,f;if(!a._rectsCache){c=a.getClientRects();d=Array(c.length);for(f=0;f<c.length;f++)e=d[f]=new y(c[f]),e.left-=b.left,e.top-=b.top,
e.right-=b.left,e.bottom-=b.top;a._rectsCache=d}c=a._rectsCache;d=[c.length];for(f=0;f<c.length;f++)d[f]=new y(c[f]);return d},getClientRects:function(a){if(!this.view._wrapMode)return[this.getBoundingClientRect()];for(var b=this._ensureCreated(),c=[],d=b.firstChild,e,f=b.getBoundingClientRect();d;){for(var h=this._getClientRects(d,f),b=0;b<h.length;b++){var g=h[b],k;if(g.top!==g.bottom){var m=g.top+(g.bottom-g.top)/2;for(k=0;k<c.length&&!(e=c[k],e.top<=m&&m<e.bottom);k++);k===c.length?c.push(g):
(g.left<e.left&&(e.left=g.left),g.top<e.top&&(e.top=g.top),g.right>e.right&&(e.right=g.right),g.bottom>e.bottom&&(e.bottom=g.bottom))}}d=d.nextSibling}return void 0!==a?c[a]:c},_getLineBoundingClientRect:function(a,b){var c=new y(a.getBoundingClientRect());if(!this.view._wrapMode){c.right=c.left;for(var d=a.lastChild;d&&d.ignoreChars===d.firstChild.length;)d=d.previousSibling;d&&(d=d.getBoundingClientRect(),c.right=d.right+F(a).right)}b&&(d=F(a),c.left+=d.left,c.right-=d.right);return c},getLineCount:function(){return!this.view._wrapMode?
1:this.getClientRects().length},getLineIndex:function(a){if(!this.view._wrapMode)return 0;var b=this.getClientRects();a=this.getBoundingClientRect(a);a=a.top+(a.bottom-a.top)/2;for(var c=0;c<b.length;c++)if(b[c].top<=a&&a<b[c].bottom)return c;return b.length-1},getLineStart:function(a){if(!this.view._wrapMode||0===a)return this.view._model.getLineStart(a);var b=this.getClientRects();return this.getOffset(b[a].left+1,b[a].top+1)},getOffset:function(a,b){var c=this.view,d=c._model,e=this.lineIndex,
f=d.getLineStart(e),d=d.getLineEnd(e);if(f===d)return f;var h=this._ensureCreated(),e=this.getBoundingClientRect(),g,k;if(c._wrapMode){g=this.getClientRects();b<g[0].top&&(b=g[0].top);for(var m=0;m<g.length&&!(k=g[m],k.top<=b&&b<k.bottom);m++);a<k.left&&(a=k.left);a>k.right&&(a=k.right-1)}else 0>a&&(a=0),a>e.right-e.left&&(a=e.right-e.left);var n=h.ownerDocument,m=n.defaultView||n.parentWindow,p=l.isIE?m.screen.logicalXDPI/m.screen.deviceXDPI:1,q=l.isIE?m.screen.logicalYDPI/m.screen.deviceYDPI:1,
m=f,r=h.firstChild;a:for(;r;){var s=r.firstChild,h=s.length;r.ignoreChars&&(h-=r.ignoreChars);var t,u,v;g=this._getClientRects(r,e);for(var w=0;w<g.length;w++)if(k=g[w],k.left<=a&&a<k.right&&(!c._wrapMode||k.top<=b&&b<k.bottom)){if(l.isIE||c._isRangeRects){for(var n=c._isRangeRects?n.createRange():n.body.createTextRange(),w=h,x=-1;1<w-x;){var y=Math.floor((w+x)/2);k=x+1;g=y===h-1&&r.ignoreChars?s.length:y+1;c._isRangeRects?(n.setStart(s,k),n.setEnd(s,g)):(n.moveToElementText(r),n.move("character",
k),n.moveEnd("character",g-k));g=n.getClientRects();for(var A=!1,z=0;z<g.length;z++)if(k=g[z],t=k.left*p-e.left,v=k.right*p-e.left,u=k.top*q-e.top,k=k.bottom*q-e.top,t<=a&&a<v&&(!c._wrapMode||u<=b&&b<k)){A=!0;break}A?w=y:x=y}m+=w;k=w;g=w===h-1&&r.ignoreChars?s.length:Math.min(w+1,s.length);c._isRangeRects?(n.setStart(s,k),n.setEnd(s,g)):(n.moveToElementText(r),n.move("character",k),n.moveEnd("character",g-k));k=n.getClientRects()[0];t=k.left*p-e.left;v=k.right*p-e.left;a>t+(v-t)/2&&m++}else{k=[];
for(p=0;p<h;p++)k.push("\x3cspan\x3e"),p===h-1?k.push(s.data.substring(p)):k.push(s.data.substring(p,p+1)),k.push("\x3c/span\x3e");r.innerHTML=k.join("");for(p=r.firstChild;p;){k=p.getBoundingClientRect();t=k.left-e.left;v=k.right-e.left;if(t<=a&&a<v){a>t+(v-t)/2&&m++;break}m++;p=p.nextSibling}this._createdDiv||(r.innerHTML="",r.appendChild(s),e=c._getSelection(),(m<=e.start&&e.start<m+h||m<=e.end&&e.end<m+h)&&c._updateDOMSelection())}break a}m+=h;r=r.nextSibling}return Math.min(d,Math.max(f,m))},
getNextOffset:function(a,b,c){return"line"===b?(b=this.view._model,a=b.getLineAtOffset(a),0<c?b.getLineEnd(a):b.getLineStart(a)):"wordend"===b?this._getNextOffset_W3C(a,b,c):l.isIE?this._getNextOffset_IE(a,b,c):this._getNextOffset_W3C(a,b,c)},_getNextOffset_W3C:function(a,b,c){function d(a){return 33<=a&&47>=a||58<=a&&64>=a||91<=a&&94>=a||96===a||123<=a&&126>=a}if("word"===b||"wordend"===b){var e=this.view._model,f=e.getLineAtOffset(a),h=e.getLine(f),g=e.getLineStart(f),f=e.getLineEnd(f),e=h.length;
a-=g;var k,m;if(0<c){if(a===e)return f;k=h.charCodeAt(a);m=d(k);c=!m&&!(32===k||9===k);for(a++;a<e;){k=h.charCodeAt(a);f=d(k);if("wordend"===b){if(!f&&m)break}else if(f&&!m)break;k=!f&&!(32===k||9===k);if("wordend"===b){if(!k&&c)break}else if(k&&!c)break;c=k;m=f;a++}}else{if(0===a)return g;a--;k=h.charCodeAt(a);m=d(k);for(c=!m&&!(32===k||9===k);0<a;){k=h.charCodeAt(a-1);f=d(k);if("wordend"===b){if(f&&!m)break}else if(!f&&m)break;k=!f&&!(32===k||9===k);if("wordend"===b){if(k&&!c)break}else if(!k&&
c)break;c=k;m=f;a--}}return g+a}return a+c},_getNextOffset_IE:function(a,b,c){var d=this._ensureCreated(),e=this.view._model,f=this.lineIndex,h=0,g;g=e.getLineStart(f);var k=d.ownerDocument;if(a===e.getLineEnd(f))h=k.body.createTextRange(),h.moveToElementText(d.lastChild),g=h.text.length,h.moveEnd(b,c),h=a+h.text.length-g;else if(a===g&&0>c)h=g;else for(d=d.firstChild;d;){e=d.firstChild.length;d.ignoreChars&&(e-=d.ignoreChars);if(g+e>a){h=k.body.createTextRange();a===g&&0>c?h.moveToElementText(d.previousSibling):
(h.moveToElementText(d),h.collapse(),h.moveEnd("character",a-g));g=h.text.length;h.moveEnd(b,c);h=a+h.text.length-g;break}g=e+g;d=d.nextSibling}return h},destroy:function(){var a=this._createdDiv;a&&(a.parentNode.removeChild(a),this._createdDiv=null)}};G.prototype={addRuler:function(a,b){a.setView(this);var c=this._rulers;if(void 0!==b){var d,e;for(e=d=0;d<c.length&&e<b;d++)a.getLocation()===c[d].getLocation()&&e++;c.splice(e,0,a);b=e}else c.push(a);this._createRuler(a,b);this._update()},computeSize:function(){var a=
0,b=0,c=this._model,d=this._clientDiv;if(!d)return{width:a,height:b};var e=d.style.width;l.isWebkit&&(d.style.width="0x7fffffffpx");for(var c=c.getLineCount(),f=0;f<c;f++){var h=this._getLine(f),g=h.getBoundingClientRect(),a=Math.max(a,g.right-g.left),b=b+(g.bottom-g.top);h.destroy()}l.isWebkit&&(d.style.width=e);d=this._getViewPadding();a+=d.right+d.left;b+=d.bottom+d.top;return{width:a,height:b}},convert:function(a,b,c){if(this._clientDiv){var d=this._getScroll(),e=this._getViewPadding(),f=this._viewDiv.getBoundingClientRect();
"document"===b&&(void 0!==a.x&&(a.x+=-d.x+f.left+e.left),void 0!==a.y&&(a.y+=-d.y+f.top+e.top));"document"===c&&(void 0!==a.x&&(a.x+=d.x-f.left-e.left),void 0!==a.y&&(a.y+=d.y-f.top-e.top));return a}},destroy:function(){for(var a=0;a<this._rulers.length;a++)this._rulers[a].setView(null);this.rulers=null;this._destroyView();this.onDestroy({type:"Destroy"});this._actions=this._keyBindings=this._doubleClickSelection=this._selection=this._model=this._parent=null},focus:function(){this._clientDiv&&(this._updateDOMSelection(),
l.isOpera&&this._clientDiv.blur(),this._clientDiv.focus(),this._updateDOMSelection())},hasFocus:function(){return this._hasFocus},getActionDescription:function(a){if(a=this._actions[a])return a.actionDescription},getActions:function(a){var b=[],c=this._actions,d;for(d in c)c.hasOwnProperty(d)&&(a||!c[d].defaultHandler)&&b.push(d);return b},getBottomIndex:function(a){return!this._clientDiv?0:this._getBottomIndex(a)},getBottomPixel:function(){return!this._clientDiv?0:this._getScroll().y+this._getClientHeight()},
getCaretOffset:function(){return this._getSelection().getCaret()},getClientArea:function(){if(!this._clientDiv)return{x:0,y:0,width:0,height:0};var a=this._getScroll();return{x:a.x,y:a.y,width:this._getClientWidth(),height:this._getClientHeight()}},getHorizontalPixel:function(){return!this._clientDiv?0:this._getScroll().x},getKeyBindings:function(a){for(var b=[],c=this._keyBindings,d=0;d<c.length;d++)c[d].actionID===a&&b.push(c[d].keyBinding);return b},getLineHeight:function(a){return!this._clientDiv?
0:this._getLineHeight(a)},getLineIndex:function(a){return!this._clientDiv?0:this._getLineIndex(a)},getLinePixel:function(a){return!this._clientDiv?0:this._getLinePixel(a)},getLocationAtOffset:function(a){if(!this._clientDiv)return{x:0,y:0};var b=this._model;a=Math.min(Math.max(0,a),b.getCharCount());var b=b.getLineAtOffset(a),c=this._getLine(b);a=c.getBoundingClientRect(a);c.destroy();c=a.left;b=this._getLinePixel(b)+a.top;return{x:c,y:b}},getOptions:function(){var a;if(0===arguments.length)a=this._defaultOptions();
else if(1===arguments.length){if(a=arguments[0],"string"===typeof a)return E(this["_"+a])}else{a={};for(var b in arguments)arguments.hasOwnProperty(b)&&(a[arguments[b]]=void 0)}for(var c in a)a.hasOwnProperty(c)&&(a[c]=E(this["_"+c]));return a},getModel:function(){return this._model},getOffsetAtLocation:function(a,b){if(!this._clientDiv)return 0;var c=this._getLineIndex(b),d=this._getLine(c),c=d.getOffset(a,b-this._getLinePixel(c));d.destroy();return c},getRulers:function(){return this._rulers.slice(0)},
getSelection:function(){var a=this._getSelection();return{start:a.start,end:a.end}},getText:function(a,b){return this._model.getText(a,b)},getTopIndex:function(a){return!this._clientDiv?0:this._getTopIndex(a)},getTopPixel:function(){return!this._clientDiv?0:this._getScroll().y},invokeAction:function(a,b){if(this._clientDiv){var c=this._actions[a];if(c){if(!b&&c.handler&&c.handler())return;if(c.defaultHandler)return c.defaultHandler()}return!1}},isDestroyed:function(){return!this._clientDiv},onContextMenu:function(a){return this.dispatchEvent(a)},
onDragStart:function(a){return this.dispatchEvent(a)},onDrag:function(a){return this.dispatchEvent(a)},onDragEnd:function(a){return this.dispatchEvent(a)},onDragEnter:function(a){return this.dispatchEvent(a)},onDragOver:function(a){return this.dispatchEvent(a)},onDragLeave:function(a){return this.dispatchEvent(a)},onDrop:function(a){return this.dispatchEvent(a)},onDestroy:function(a){return this.dispatchEvent(a)},onLineStyle:function(a){return this.dispatchEvent(a)},onModelChanged:function(a){return this.dispatchEvent(a)},
onModelChanging:function(a){return this.dispatchEvent(a)},onModify:function(a){return this.dispatchEvent(a)},onMouseDown:function(a){return this.dispatchEvent(a)},onMouseUp:function(a){return this.dispatchEvent(a)},onMouseMove:function(a){return this.dispatchEvent(a)},onMouseOver:function(a){return this.dispatchEvent(a)},onMouseOut:function(a){return this.dispatchEvent(a)},onSelection:function(a){return this.dispatchEvent(a)},onScroll:function(a){return this.dispatchEvent(a)},onVerify:function(a){return this.dispatchEvent(a)},
onFocus:function(a){return this.dispatchEvent(a)},onBlur:function(a){return this.dispatchEvent(a)},redraw:function(){if(!(0<this._redrawCount)){var a=this._model.getLineCount();this.redrawRulers(0,a);this.redrawLines(0,a)}},redrawRulers:function(a,b){if(!(0<this._redrawCount))for(var c=this.getRulers(),d=0;d<c.length;d++)this.redrawLines(a,b,c[d])},redrawLines:function(a,b,c){if(!(0<this._redrawCount)&&(void 0===a&&(a=0),void 0===b&&(b=this._model.getLineCount()),a!==b)){var d=this._clientDiv;if(d){if(c)for(var e=
("left"===c.getLocation()?this._leftDiv:this._rightDiv).firstChild.rows[0].cells,f=0;f<e.length;f++)if(e[f].firstChild._ruler===c){d=e[f].firstChild;break}c?d.rulerChanged=!0:this._lineHeight&&this._resetLineHeight(a,b);if(!c||"page"===c.getOverview())for(d=d.firstChild;d;)e=d.lineIndex,a<=e&&e<b&&(d.lineChanged=!0),d=d.nextSibling;!c&&(!this._wrapMode&&a<=this._maxLineIndex&&this._maxLineIndex<b)&&(this._checkMaxLineIndex=this._maxLineIndex,this._maxLineIndex=-1,this._maxLineWidth=0);this._queueUpdate()}}},
redrawRange:function(a,b){if(!(0<this._redrawCount)){var c=this._model;void 0===a&&(a=0);void 0===b&&(b=c.getCharCount());var d=c.getLineAtOffset(a),c=c.getLineAtOffset(Math.max(a,b-1))+1;this.redrawLines(d,c)}},removeRuler:function(a){for(var b=this._rulers,c=0;c<b.length;c++)if(b[c]===a){b.splice(c,1);a.setView(null);this._destroyRuler(a);this._update();break}},resize:function(){this._clientDiv&&this._handleResize(null)},setAction:function(a,b,c){if(a){var d=this._actions,e=d[a];e||(e=d[a]={});
e.handler=b;e.actionDescription=c}},setKeyBinding:function(a,b){for(var c=this._keyBindings,d=0;d<c.length;d++){var e=c[d];if(e.keyBinding.equals(a)){b?e.actionID=b:e.predefined?e.actionID=null:c.splice(d,1);return}}b&&c.push({keyBinding:a,actionID:b})},setCaretOffset:function(a,b){var c=this._model.getCharCount();a=Math.max(0,Math.min(a,c));c=new x(a,a,!1);this._setSelection(c,void 0===b||b)},setHorizontalPixel:function(a){this._clientDiv&&(a=Math.max(0,a),this._scrollView(a-this._getScroll().x,
0))},setRedraw:function(a){a?0===--this._redrawCount&&this.redraw():this._redrawCount++},setModel:function(a){if(a&&a!==this._model){this._model.removeEventListener("preChanging",this._modelListener.onChanging);this._model.removeEventListener("postChanged",this._modelListener.onChanged);var b=this._model.getLineCount(),c=this._model.getCharCount(),d=a.getLineCount(),e=a.getCharCount(),f={type:"ModelChanging",text:a.getText(),start:0,removedCharCount:c,addedCharCount:e,removedLineCount:b,addedLineCount:d};
this.onModelChanging(f);this._model=a;f={type:"ModelChanged",start:0,removedCharCount:c,addedCharCount:e,removedLineCount:b,addedLineCount:d};this.onModelChanged(f);this._model.addEventListener("preChanging",this._modelListener.onChanging);this._model.addEventListener("postChanged",this._modelListener.onChanged);this._reset();this._update()}},setOptions:function(a){var b=this._defaultOptions(),c;for(c in a)if(a.hasOwnProperty(c)){var d=a[c];if(!B(this["_"+c],d)){var e=b[c]?b[c].update:null;e?e.call(this,
d):this["_"+c]=E(d)}}},setSelection:function(a,b,c){var d=a>b;if(d){var e=a;a=b;b=e}e=this._model.getCharCount();a=Math.max(0,Math.min(a,e));b=Math.max(0,Math.min(b,e));a=new x(a,b,d);this._setSelection(a,void 0===c||c)},setText:function(a,b,c){var d=void 0===b&&void 0===c;void 0===b&&(b=0);void 0===c&&(c=this._model.getCharCount());this._modifyContent({text:a,start:b,end:c,_code:!0},!d);d&&(this._columnX=-1,this._setSelection(new x(0,0,!1),!0),l.isFirefox&&this._fixCaret())},setTopIndex:function(a){this._clientDiv&&
this._scrollView(0,this._getLinePixel(Math.max(0,a))-this._getScroll().y)},setTopPixel:function(a){this._clientDiv&&this._scrollView(0,Math.max(0,a)-this._getScroll().y)},showSelection:function(){return this._showCaret(!0)},update:function(a,b){this._clientDiv&&(a&&this._updateStyle(),void 0===b||b?this._update():this._queueUpdate())},_handleRootMouseDown:function(a){l.isFirefox&&1===a.which&&(this._clientDiv.contentEditable=!1,this._ignoreBlur=(this._overlayDiv||this._clientDiv).draggable=!0);var b=
this._overlayDiv||this._clientDiv;9>l.isIE&&(b=this._viewDiv);for(var c=a.target?a.target:a.srcElement;c;){if(b===c)return;c=c.parentNode}a.preventDefault&&a.preventDefault();a.stopPropagation&&a.stopPropagation();if(!this._isW3CEvents){var d=this;this._getWindow().setTimeout(function(){d._clientDiv.focus()},0)}},_handleRootMouseUp:function(a){l.isFirefox&&1===a.which&&(this._clientDiv.contentEditable=!0,(this._overlayDiv||this._clientDiv).draggable=!1,this._fixCaret(),this._ignoreBlur=!1)},_handleBlur:function(a){if(!this._ignoreBlur){this._hasFocus=
!1;if(9>l.isIE&&!this._getSelection().isEmpty()){a=this._rootDiv;var b=l.createElement(a.ownerDocument,"div");a.appendChild(b);a.removeChild(b)}if(this._selDiv1)if(this._selDiv1.style.background="lightgray",this._selDiv2.style.background="lightgray",this._selDiv3.style.background="lightgray",a=this._getWindow(),b=this._selDiv1.ownerDocument,a.getSelection){b=a.getSelection();for(a=b.anchorNode;a;){if(a===this._clientDiv){0<b.rangeCount&&b.removeAllRanges();break}a=a.parentNode}}else if(b.selection){this._ignoreSelect=
!1;for(a=b.selection.createRange().parentElement();a;){if(a===this._clientDiv){b.selection.empty();break}a=a.parentNode}this._ignoreSelect=!0}if(!this._ignoreFocus)this.onBlur({type:"Blur"})}},_handleContextMenu:function(a){l.isIE&&3===this._lastMouseButton&&this._updateDOMSelection();var b=!1;this.isListening("ContextMenu")&&(b=this._createMouseEvent("ContextMenu",a),b.screenX=a.screenX,b.screenY=a.screenY,this.onContextMenu(b),b=b.defaultPrevented);if(b)return a.preventDefault&&a.preventDefault(),
!1},_handleCopy:function(a){if(!this._ignoreCopy&&this._doCopy(a))return a.preventDefault&&a.preventDefault(),!1},_handleCut:function(a){if(this._doCut(a))return a.preventDefault&&a.preventDefault(),!1},_handleDataModified:function(a){this._startIME()},_handleDblclick:function(a){this._lastMouseTime=a.timeStamp?a.timeStamp:(new Date).getTime();2!==this._clickCount&&(this._clickCount=2,this._handleMouse(a))},_handleDragStart:function(a){if(l.isFirefox){var b=this;this._getWindow().setTimeout(function(){b._clientDiv.contentEditable=
!0;b._clientDiv.draggable=!1;b._ignoreBlur=!1},0)}if(this.isListening("DragStart")&&-1!==this._dragOffset)this._isMouseDown=!1,this.onDragStart(this._createMouseEvent("DragStart",a)),this._dragOffset=-1;else return a.preventDefault&&a.preventDefault(),!1},_handleDrag:function(a){if(this.isListening("Drag"))this.onDrag(this._createMouseEvent("Drag",a))},_handleDragEnd:function(a){this._dropTarget=!1;this._dragOffset=-1;if(this.isListening("DragEnd"))this.onDragEnd(this._createMouseEvent("DragEnd",
a));l.isFirefox&&(this._fixCaret(),"none"===a.dataTransfer.dropEffect&&!a.dataTransfer.mozUserCancelled&&this._fixCaret())},_handleDragEnter:function(a){var b=!0;this._dropTarget=!0;this.isListening("DragEnter")&&(b=!1,this.onDragEnter(this._createMouseEvent("DragEnter",a)));if(l.isWebkit||b)return a.preventDefault&&a.preventDefault(),!1},_handleDragOver:function(a){var b=!0;this.isListening("DragOver")&&(b=!1,this.onDragOver(this._createMouseEvent("DragOver",a)));if(l.isWebkit||b)return b&&(a.dataTransfer.dropEffect=
"none"),a.preventDefault&&a.preventDefault(),!1},_handleDragLeave:function(a){this._dropTarget=!1;if(this.isListening("DragLeave"))this.onDragLeave(this._createMouseEvent("DragLeave",a))},_handleDrop:function(a){this._dropTarget=!1;if(this.isListening("Drop"))this.onDrop(this._createMouseEvent("Drop",a));a.preventDefault&&a.preventDefault();return!1},_handleFocus:function(a){this._hasFocus=!0;l.isIOS&&void 0!==this._lastTouchOffset?(this.setCaretOffset(this._lastTouchOffset,!0),this._lastTouchOffset=
void 0):this._updateDOMSelection();this._selDiv1&&(a=this._highlightRGB,this._selDiv1.style.background=a,this._selDiv2.style.background=a,this._selDiv3.style.background=a);if(!this._ignoreFocus)this.onFocus({type:"Focus"})},_handleKeyDown:function(a){var b=!1;switch(a.keyCode){case 16:case 17:case 18:case 91:b=!0;break;default:this._setLinksVisible(!1)}if(229===a.keyCode){if(this._readonly)return a.preventDefault&&a.preventDefault(),!1;b=!0;l.isSafari&&l.isMac&&a.ctrlKey&&(b=!1);b&&this._startIME()}else b||
this._commitIME();if((l.isMac||l.isLinux)&&4>l.isFirefox||l.isOpera)return this._keyDownEvent=a,!0;if(this._doAction(a))return a.preventDefault?(a.preventDefault(),a.stopPropagation()):(a.cancelBubble=!0,a.returnValue=!1,a.keyCode=0),!1},_handleKeyPress:function(a){if(l.isMac&&l.isWebkit&&(63232<=a.keyCode&&63487>=a.keyCode||13===a.keyCode||8===a.keyCode)||((l.isMac||l.isLinux)&&4>l.isFirefox||l.isOpera)&&this._doAction(this._keyDownEvent))return a.preventDefault&&a.preventDefault(),!1;var b=l.isMac?
a.metaKey:a.ctrlKey;if(void 0!==a.charCode&&b)switch(a.charCode){case 99:case 118:case 120:return!0}b=!1;if(l.isMac){if(a.ctrlKey||a.metaKey)b=!0}else if(l.isFirefox){if(a.ctrlKey||a.altKey)b=!0}else a.ctrlKey^a.altKey&&(b=!0);if(!b&&(b=l.isOpera?a.which:void 0!==a.charCode?a.charCode:a.keyCode,31<b))return this._doContent(String.fromCharCode(b)),a.preventDefault&&a.preventDefault(),!1},_handleKeyUp:function(a){(l.isMac?a.metaKey:a.ctrlKey)||this._setLinksVisible(!1);13===a.keyCode&&this._commitIME()},
_handleLinkClick:function(a){if(!(l.isMac?a.metaKey:a.ctrlKey))return a.preventDefault&&a.preventDefault(),!1},_handleMouse:function(a){var b=this._getWindow(),c=!0,d=b;if(l.isIE||l.isFirefox&&!this._overlayDiv)d=this._clientDiv;if(this._overlayDiv){this._hasFocus&&(this._ignoreFocus=!0);var e=this;b.setTimeout(function(){e.focus();e._ignoreFocus=!1},0)}1===this._clickCount?(c=this._setSelectionTo(a.clientX,a.clientY,a.shiftKey,!l.isOpera&&this._hasFocus&&this.isListening("DragStart")))&&this._setGrab(d):
(this._isW3CEvents&&this._setGrab(d),this._doubleClickSelection=null,this._setSelectionTo(a.clientX,a.clientY,a.shiftKey),this._doubleClickSelection=this._getSelection());return c},_handleMouseDown:function(a){if(this._linksVisible)if("A"!==(a.target||a.srcElement).tagName)this._setLinksVisible(!1);else return;this._commitIME();var b=a.which;b||(4===a.button&&(b=2),2===a.button&&(b=3),1===a.button&&(b=1));var c=2!==b&&a.timeStamp?a.timeStamp:(new Date).getTime(),d=c-this._lastMouseTime,e=Math.abs(this._lastMouseX-
a.clientX),f=Math.abs(this._lastMouseY-a.clientY),h=this._lastMouseButton===b;this._lastMouseX=a.clientX;this._lastMouseY=a.clientY;this._lastMouseTime=c;this._lastMouseButton=b;1===b&&(this._isMouseDown=!0,h&&d<=this._clickTime&&e<=this._clickDist&&f<=this._clickDist?this._clickCount++:this._clickCount=1);if(this.isListening("MouseDown")&&(c=this._createMouseEvent("MouseDown",a),this.onMouseDown(c),c.defaultPrevented)){a.preventDefault();return}if(1===b&&this._handleMouse(a)&&(9<=l.isIE||l.isOpera||
l.isChrome||l.isSafari||l.isFirefox&&!this._overlayDiv))this._hasFocus||this.focus(),a.preventDefault();l.isFirefox&&3===this._lastMouseButton&&this._updateDOMSelection()},_handleMouseOver:function(a){if(this.isListening("MouseOver"))this.onMouseOver(this._createMouseEvent("MouseOver",a))},_handleMouseOut:function(a){if(this.isListening("MouseOut"))this.onMouseOut(this._createMouseEvent("MouseOut",a))},_handleMouseMove:function(a){var b=this._isClientDiv(a);if(this.isListening("MouseMove")&&b)this.onMouseMove(this._createMouseEvent("MouseMove",
a));if(!this._dropTarget){var c=this._linksVisible||this._lastMouseMoveX!==a.clientX||this._lastMouseMoveY!==a.clientY;this._lastMouseMoveX=a.clientX;this._lastMouseMoveY=a.clientY;this._setLinksVisible(c&&!this._isMouseDown&&(l.isMac?a.metaKey:a.ctrlKey));if(!this._isW3CEvents){if(0===a.button)return this._setGrab(null),!0;if(!this._isMouseDown&&1===a.button&&0!==(this._clickCount&1)&&b)return this._clickCount=2,this._handleMouse(a,this._clickCount)}if(this._isMouseDown&&-1===this._dragOffset){b=
a.clientX;a=a.clientY;var d=this._getViewPadding(),e=this._viewDiv.getBoundingClientRect(),f=this._getClientWidth(),h=this._getClientHeight(),c=e.left+d.left,g=e.top+d.top,f=e.left+d.left+f,d=e.top+d.top+h,e=this._model,h=e.getLineAtOffset(this._getSelection().getCaret());a<g&&0!==h?this._doAutoScroll("up",b,a-g):a>d&&h!==e.getLineCount()-1?this._doAutoScroll("down",b,a-d):b<c&&!this._wrapMode?this._doAutoScroll("left",b-c,a):b>f&&!this._wrapMode?this._doAutoScroll("right",b-f,a):(this._endAutoScroll(),
this._setSelectionTo(b,a,!0))}}},_isClientDiv:function(a){var b=this._overlayDiv||this._clientDiv;for(a=a.target?a.target:a.srcElement;a;){if(b===a)return!0;a=a.parentNode}return!1},_createMouseEvent:function(a,b){var c=this.convert({x:b.clientX,y:b.clientY},"page","document");return{type:a,event:b,clickCount:this._clickCount,x:c.x,y:c.y,preventDefault:function(){this.defaultPrevented=!0}}},_handleMouseUp:function(a){var b=a.which?0===a.button:1===a.button;if(this.isListening("MouseUp")&&(this._isClientDiv(a)||
b&&this._isMouseDown))this.onMouseUp(this._createMouseEvent("MouseUp",a));!this._linksVisible&&(b&&this._isMouseDown)&&(-1!==this._dragOffset&&(b=this._getSelection(),b.extend(this._dragOffset),b.collapse(),this._setSelection(b,!0,!0),this._dragOffset=-1),this._isMouseDown=!1,this._endAutoScroll(),this._isW3CEvents&&this._setGrab(null),l.isFirefox&&a.preventDefault())},_handleMouseWheel:function(a){var b=this._getLineHeight(),c=0,d=0;l.isIE||l.isOpera?d=-a.wheelDelta/40*b:l.isFirefox?(b=l.isMac?3*
a.detail:Math.max(-256,Math.min(256,a.detail))*b,a.axis===a.HORIZONTAL_AXIS?c=b:d=b):l.isMac?(d=c=40,0!==a.wheelDeltaX%120&&(c=1),0!==a.wheelDeltaY%120&&(d=1),c=-a.wheelDeltaX/c,-1<c&&0>c&&(c=-1),0<c&&1>c&&(c=1),d=-a.wheelDeltaY/d,-1<d&&0>d&&(d=-1),0<d&&1>d&&(d=1)):(c=-a.wheelDeltaX,d=8*(-a.wheelDeltaY/120)*b);if(l.isSafari){for(b=a.target;b&&void 0===b.lineIndex;)b=b.parentNode;this._mouseWheelLine=b}b=this._getScroll();this._scrollView(c,d);c=this._getScroll();if(b.x!==c.x||b.y!==c.y)return a.preventDefault&&
a.preventDefault(),!1},_handlePaste:function(a){if(!this._ignorePaste&&this._doPaste(a)){if(l.isIE){var b=this;this._ignoreFocus=!0;this._getWindow().setTimeout(function(){b._updateDOMSelection();b._ignoreFocus=!1},0)}a.preventDefault&&a.preventDefault();return!1}},_handleResize:function(a){a=this._parent.clientWidth;var b=this._parent.clientHeight;if(this._parentWidth!==a||this._parentHeight!==b)this._parentWidth!==a&&this._resetLineHeight(),this._parentWidth=a,this._parentHeight=b,9>l.isIE?this._queueUpdate():
this._update()},_handleRulerEvent:function(a){for(var b=a.target?a.target:a.srcElement,c=b.lineIndex;b&&!b._ruler;)void 0===c&&void 0!==b.lineIndex&&(c=b.lineIndex),b=b.parentNode;b=b?b._ruler:null;if(void 0===c&&b&&"document"===b.getOverview()){var c=this._getClientHeight(),d=this._model.getLineCount(),e=this._getViewPadding(),f=this._viewDiv.getBoundingClientRect(),c=Math.floor((a.clientY-f.top-this._metrics.scrollWidth)*d/(c+e.top+e.bottom-2*this._metrics.scrollWidth));0<=c&&c<d||(c=void 0)}if(b)switch(a.type){case "click":if(b.onClick)b.onClick(c,
a);break;case "dblclick":if(b.onDblClick)b.onDblClick(c,a);break;case "mousemove":if(b.onMouseMove)b.onMouseMove(c,a);break;case "mouseover":if(b.onMouseOver)b.onMouseOver(c,a);break;case "mouseout":if(b.onMouseOut)b.onMouseOut(c,a)}},_handleScroll:function(){var a=this._getScroll(),b=this._hScroll,c=this._vScroll;if(b!==a.x||c!==a.y)this._checkOverlayScroll(),this._hScroll=a.x,this._vScroll=a.y,this._commitIME(),this._update(c===a.y),this.onScroll({type:"Scroll",oldValue:{x:b,y:c},newValue:a})},
_handleSelectStart:function(a){if(this._ignoreSelect)return a&&a.preventDefault&&a.preventDefault(),!1},_getModelOffset:function(a,b){if(a){var c;c="DIV"===a.tagName?a:a.parentNode.parentNode;var d=0,e=c.lineIndex;if("DIV"!==a.tagName)for(c=c.firstChild;c;){var f=c.firstChild;if(f===a){c.ignoreChars&&(d-=c.ignoreChars);d+=b;break}c.ignoreChars&&(d-=c.ignoreChars);d+=f.data.length;c=c.nextSibling}return Math.max(0,d)+this._model.getLineStart(e)}},_updateSelectionFromDOM:function(){var a=this._getWindow().getSelection(),
b=this._getModelOffset(a.anchorNode,a.anchorOffset),a=this._getModelOffset(a.focusNode,a.focusOffset);void 0===b||void 0===a||this._setSelection(new x(b,a),!1,!1)},_handleSelectionChange:function(a){if(-1===this._imeOffset)if(l.isAndroid){a=this._getWindow();this._selTimer&&a.clearTimeout(this._selTimer);var b=this;this._selTimer=a.setTimeout(function(){b._clientDiv&&(b._selTimer=null,b._updateSelectionFromDOM())},250)}else this._updateSelectionFromDOM()},_handleTextInput:function(a){this._imeOffset=
-1;if(l.isAndroid){for(var b=this._getWindow().getSelection(),c=b.anchorNode;c&&void 0===c.lineIndex;)c=c.parentNode;if(c){var d=this._model,e=c.lineIndex,f=d.getLine(e),h=f,g=0,d=d.getLineStart(e);0<b.rangeCount&&(b.getRangeAt(0).deleteContents(),e=c.ownerDocument.createTextNode(a.data),b.getRangeAt(0).insertNode(e),g=this._getDOMText(c,e),h=g.text,g=g.offset,e.parentNode.removeChild(e));c.lineRemoved=!0;for(c=0;f.charCodeAt(c)===h.charCodeAt(c)&&c<g;)c++;b=f.length-1;for(e=h.length-f.length;f.charCodeAt(b)===
h.charCodeAt(b+e)&&b+e>=g+a.data.length;)b--;b++;f=h.substring(c,b+e);this._modifyContent({text:f,start:c+d,end:b+d,_ignoreDOMSelection:!0},!0)}}else this._doContent(a.data);a.preventDefault()},_handleTouchStart:function(a){this._commitIME();var b=this._getWindow();this._touchScrollTimer&&(this._vScrollDiv.style.display="none",this._hScrollDiv.style.display="none",b.clearInterval(this._touchScrollTimer),this._touchScrollTimer=null);var c=a.touches;if(1===c.length){var c=c[0],d=c.clientX,e=c.clientY;
this._touchStartX=d;this._touchStartY=e;if(l.isAndroid&&(e<c.pageY-b.pageYOffset||d<c.pageX-b.pageXOffset))d=c.pageX-b.pageXOffset,e=c.pageY-b.pageYOffset;b=this.convert({x:d,y:e},"page","document");this._lastTouchOffset=this.getOffsetAtLocation(b.x,b.y);this._touchStartTime=a.timeStamp;this._touching=!0}},_handleTouchMove:function(a){var b=a.touches;if(1===b.length){b=b[0];this._touchCurrentX=b.clientX;this._touchCurrentY=b.clientY;if(!this._touchScrollTimer&&200>a.timeStamp-this._touchStartTime){this._vScrollDiv.style.display=
"block";this._wrapMode||(this._hScrollDiv.style.display="block");var c=this,d=this._getWindow();this._touchScrollTimer=d.setInterval(function(){var a=0,b=0;if(c._touching)a=c._touchStartX-c._touchCurrentX,b=c._touchStartY-c._touchCurrentY,c._touchSpeedX=a/10,c._touchSpeedY=b/10,c._touchStartX=c._touchCurrentX,c._touchStartY=c._touchCurrentY;else{if(0.1>Math.abs(c._touchSpeedX)&&0.1>Math.abs(c._touchSpeedY)){c._vScrollDiv.style.display="none";c._hScrollDiv.style.display="none";d.clearInterval(c._touchScrollTimer);
c._touchScrollTimer=null;return}a=10*c._touchSpeedX;b=10*c._touchSpeedY;c._touchSpeedX*=0.95;c._touchSpeedY*=0.95}c._scrollView(a,b)},10)}this._touchScrollTimer&&a.preventDefault()}},_handleTouchEnd:function(a){0===a.touches.length&&(this._touching=!1)},_doAction:function(a){for(var b=this._keyBindings,c=0;c<b.length;c++){var d=b[c];if(d.keyBinding.match(a)){if(d.actionID&&(a=this._actions[d.actionID]))if(a.handler){if(!a.handler()){if(a.defaultHandler)return"boolean"===typeof a.defaultHandler();
break}}else if(a.defaultHandler)return"boolean"===typeof a.defaultHandler();return!0}}return!1},_doBackspace:function(a){var b=this._getSelection();if(b.isEmpty()){var c=this._model,d=b.getCaret(),e=c.getLineAtOffset(d),f=c.getLineStart(e);if(d===f)0<e&&b.extend(c.getLineEnd(e-1));else{var h=!1;this._expandTab&&("character"===a.unit&&0===(d-f)%this._tabSize)&&(c=c.getText(f,d),h=!/[^ ]/.test(c));h?b.extend(d-this._tabSize):(e=this._getLine(e),b.extend(e.getNextOffset(d,a.unit,-1)),e.destroy())}}this._modifyContent({text:"",
start:b.start,end:b.end},!0);return!0},_doContent:function(a){var b=this._getSelection();this._modifyContent({text:a,start:b.start,end:b.end,_ignoreDOMSelection:!0},!0)},_doCopy:function(a){var b=this._getSelection();return!b.isEmpty()?(b=this._getBaseText(b.start,b.end),this._setClipboardText(b,a)):!0},_doCursorNext:function(a){if(!a.select&&this._clearSelection("next"))return!0;var b=this._model,c=this._getSelection(),d=c.getCaret(),e=b.getLineAtOffset(d);d===b.getLineEnd(e)?e+1<b.getLineCount()&&
c.extend(b.getLineStart(e+1)):(b=this._getLine(e),c.extend(b.getNextOffset(d,a.unit,1)),b.destroy());a.select||c.collapse();this._setSelection(c,!0);return!0},_doCursorPrevious:function(a){if(!a.select&&this._clearSelection("previous"))return!0;var b=this._model,c=this._getSelection(),d=c.getCaret(),e=b.getLineAtOffset(d);d===b.getLineStart(e)?0<e&&c.extend(b.getLineEnd(e-1)):(b=this._getLine(e),c.extend(b.getNextOffset(d,a.unit,-1)),b.destroy());a.select||c.collapse();this._setSelection(c,!0);return!0},
_doCut:function(a){var b=this._getSelection();return!b.isEmpty()?(b=this._getBaseText(b.start,b.end),this._doContent(""),this._setClipboardText(b,a)):!0},_doDelete:function(a){var b=this._getSelection();if(b.isEmpty()){var c=this._model,d=b.getCaret(),e=c.getLineAtOffset(d);d===c.getLineEnd(e)?e+1<c.getLineCount()&&b.extend(c.getLineStart(e+1)):(c=this._getLine(e),b.extend(c.getNextOffset(d,a.unit,1)),c.destroy())}this._modifyContent({text:"",start:b.start,end:b.end},!0);return!0},_doEnd:function(a){var b=
this._getSelection(),c=this._model;if(a.ctrl)b.extend(c.getCharCount());else{var d=b.getCaret(),e=c.getLineAtOffset(d);if(this._wrapMode){var f=this._getLine(e),d=f.getLineIndex(d),d=d===f.getLineCount()-1?c.getLineEnd(e):f.getLineStart(d+1)-1;f.destroy()}else d=c.getLineEnd(e);b.extend(d)}a.select||b.collapse();this._setSelection(b,!0);return!0},_doEnter:function(a){var b=this._model,c=this._getSelection();this._doContent(b.getLineDelimiter());a&&a.noCursor&&(c.end=c.start,this._setSelection(c));
return!0},_doHome:function(a){var b=this._getSelection(),c=this._model;if(a.ctrl)b.extend(0);else{var d=b.getCaret(),e=c.getLineAtOffset(d);this._wrapMode?(c=this._getLine(e),d=c.getLineIndex(d),d=c.getLineStart(d),c.destroy()):d=c.getLineStart(e);b.extend(d)}a.select||b.collapse();this._setSelection(b,!0);return!0},_doLineDown:function(a){var b=this._model,c=this._getSelection(),d=c.getCaret(),e=b.getLineAtOffset(d),f=this._getLine(e),h=this._columnX,g=1,k=!1;if(-1===h||a.wholeLine||a.select&&l.isIE)h=
a.wholeLine?b.getLineEnd(e+1):d,h=f.getBoundingClientRect(h).left;(d=f.getLineIndex(d))<f.getLineCount()-1?g=f.getClientRects(d+1).top+1:(k=e===b.getLineCount()-1,e++);k?a.select&&(c.extend(b.getCharCount()),this._setSelection(c,!0,!0)):(f.lineIndex!==e&&(f.destroy(),f=this._getLine(e)),c.extend(f.getOffset(h,g)),a.select||c.collapse(),this._setSelection(c,!0,!0));this._columnX=h;f.destroy();return!0},_doLineUp:function(a){var b=this._model,c=this._getSelection(),d=c.getCaret(),e=b.getLineAtOffset(d),
f=this._getLine(e),h=this._columnX,g=!1,k;if(-1===h||a.wholeLine||a.select&&l.isIE)h=a.wholeLine?b.getLineStart(e-1):d,h=f.getBoundingClientRect(h).left;0<(d=f.getLineIndex(d))?k=f.getClientRects(d-1).top+1:(g=0===e,g||(e--,k=this._getLineHeight(e)-1));g?a.select&&(c.extend(0),this._setSelection(c,!0,!0)):(f.lineIndex!==e&&(f.destroy(),f=this._getLine(e)),c.extend(f.getOffset(h,k)),a.select||c.collapse(),this._setSelection(c,!0,!0));this._columnX=h;f.destroy();return!0},_doPageDown:function(a){var b=
this._model,c=this._getSelection(),d=c.getCaret(),e=b.getLineAtOffset(d),f=b.getLineCount(),h=this._getScroll(),g=this._getClientHeight(),k;if(this._lineHeight){b=this._columnX;h=this._getBoundsAtOffset(d);if(-1===b||a.select&&l.isIE)b=h.left;d=this._getLineIndex(h.top+g);k=this._getLine(d);e=this._getLinePixel(d);d=k.getOffset(b,h.top+g-e);g=k.getBoundingClientRect(d);k.destroy();c.extend(d);a.select||c.collapse();this._setSelection(c,!0,!0,g.top+e-h.top);this._columnX=b;return!0}if(e<f-1){var m=
this._getLineHeight(),n=Math.min(f-e-1,Math.floor(g/m)),n=Math.max(1,n),b=this._columnX;if(-1===b||a.select&&l.isIE)k=this._getLine(e),b=k.getBoundingClientRect(d).left,k.destroy();k=this._getLine(e+n);c.extend(k.getOffset(b,0));k.destroy();a.select||c.collapse();a=f*m;d=h.y+n*m;d+g>a&&(d=a-g);this._setSelection(c,!0,!0,d-h.y);this._columnX=b}return!0},_doPageUp:function(a){var b=this._model,c=this._getSelection(),d=c.getCaret(),e=b.getLineAtOffset(d),f=this._getScroll(),h=this._getClientHeight(),
g;if(this._lineHeight){b=this._columnX;f=this._getBoundsAtOffset(d);if(-1===b||a.select&&l.isIE)b=f.left;d=this._getLineIndex(f.bottom-h);g=this._getLine(d);e=this._getLinePixel(d);d=g.getOffset(b,f.bottom-h-e);h=g.getBoundingClientRect(d);g.destroy();c.extend(d);a.select||c.collapse();this._setSelection(c,!0,!0,h.top+e-f.top);this._columnX=b;return!0}if(0<e){var k=this._getLineHeight(),h=Math.max(1,Math.min(e,Math.floor(h/k))),b=this._columnX;if(-1===b||a.select&&l.isIE)g=this._getLine(e),b=g.getBoundingClientRect(d).left,
g.destroy();g=this._getLine(e-h);c.extend(g.getOffset(b,this._getLineHeight(e-h)-1));g.destroy();a.select||c.collapse();a=Math.max(0,f.y-h*k);this._setSelection(c,!0,!0,a-f.y);this._columnX=b}return!0},_doPaste:function(a){var b=this;return null!==this._getClipboardText(a,function(a){a&&(l.isLinux&&2===b._lastMouseButton&&(new Date).getTime()-b._lastMouseTime<=b._clickTime&&b._setSelectionTo(b._lastMouseX,b._lastMouseY),b._doContent(a))})},_doScroll:function(a){var b=a.type,c=this._model,d=c.getLineCount();
a=this._getClientHeight();var e=this._getLineHeight(),d=d*e,f=this._getScroll().y,h;switch(b){case "textStart":h=0;break;case "textEnd":h=d-a;break;case "pageDown":h=f+a;break;case "pageUp":h=f-a;break;case "centerLine":b=this._getSelection(),h=c.getLineAtOffset(b.start),c=(c.getLineAtOffset(b.end)-h+1)*e,h=h*e-a/2+c/2}void 0!==h&&(h=Math.min(Math.max(0,h),d-a),this._scrollView(0,h-f));return!0},_doSelectAll:function(a){a=this._model;var b=this._getSelection();b.setCaret(0);b.extend(a.getCharCount());
this._setSelection(b,!1);return!0},_doTab:function(a){if(this._tabMode&&!this._readonly){a="\t";if(this._expandTab){var b=this._model;a=this._getSelection().getCaret();var c=b.getLineAtOffset(a),b=b.getLineStart(c);a=Array(this._tabSize-(a-b)%this._tabSize+1).join(" ")}this._doContent(a);return!0}},_doShiftTab:function(a){if(this._tabMode&&!this._readonly)return!0},_doTabMode:function(a){this._tabMode=!this._tabMode;return!0},_doWrapMode:function(a){this.setOptions({wrapMode:!this.getOptions("wrapMode")});
return!0},_autoScroll:function(){var a=this._getSelection(),b=this.convert({x:this._autoScrollX,y:this._autoScrollY},"page","document"),c=a.getCaret(),d=this._model.getLineAtOffset(c),e;if("up"===this._autoScrollDir||"down"===this._autoScrollDir)c=this._autoScrollY/this._getLineHeight(),c=0>c?Math.floor(c):Math.ceil(c),e=d,e=Math.max(0,Math.min(this._model.getLineCount()-1,e+c));else if("left"===this._autoScrollDir||"right"===this._autoScrollDir)e=this._getLineIndex(b.y),d=this._getLine(d),b.x+=d.getBoundingClientRect(c,
!1).left,d.destroy();d=this._getLine(e);a.extend(d.getOffset(b.x,b.y-this._getLinePixel(e)));d.destroy();this._setSelection(a,!0)},_autoScrollTimer:function(){this._autoScroll();var a=this;this._autoScrollTimerID=this._getWindow().setTimeout(function(){a._autoScrollTimer()},this._AUTO_SCROLL_RATE)},_calculateLineHeightTimer:function(a){if(this._lineHeight&&!this._calculateLHTimer){var b=this._model.getLineCount(),c=0;if(a){a=0;for(var d=(new Date).getTime(),e=0;c<b&&!(this._lineHeight[c]||(a++,e||
(e=c),this._lineHeight[c]=this._calculateLineHeight(c)),c++,100<(new Date).getTime()-d););this.redrawRulers(0,b);this._queueUpdate()}a=this._getWindow();if(c!==b){var f=this;this._calculateLHTimer=a.setTimeout(function(){f._calculateLHTimer=null;f._calculateLineHeightTimer(!0)},0)}else this._calculateLHTimer&&(a.clearTimeout(this._calculateLHTimer),this._calculateLHTimer=void 0)}},_calculateLineHeight:function(a){a=this._getLine(a);var b=a.getBoundingClientRect();a.destroy();return Math.max(1,Math.ceil(b.bottom-
b.top))},_calculateMetrics:function(){var a=this._clientDiv,b=a.ownerDocument,c=l.createElement(b,"div");c.style.lineHeight="normal";var d={type:"LineStyle",textView:this,"0":0,lineText:this._model.getLine(0),lineStart:0};this.onLineStyle(d);A(d.style,c);c.style.position="fixed";c.style.left="-1000px";var e=l.createElement(b,"span");e.appendChild(b.createTextNode(" "));c.appendChild(e);var f=l.createElement(b,"span");f.style.fontStyle="italic";f.appendChild(b.createTextNode(" "));c.appendChild(f);
var h=l.createElement(b,"span");h.style.fontWeight="bold";h.appendChild(b.createTextNode(" "));c.appendChild(h);d=l.createElement(b,"span");d.style.fontWeight="bold";d.style.fontStyle="italic";d.appendChild(b.createTextNode(" "));c.appendChild(d);a.appendChild(c);var g=c.getBoundingClientRect(),e=e.getBoundingClientRect(),f=f.getBoundingClientRect(),h=h.getBoundingClientRect(),d=d.getBoundingClientRect(),e=e.bottom-e.top,f=f.bottom-f.top,h=h.bottom-h.top,k=d.bottom-d.top,m=0,d=0>=g.bottom-g.top,g=
Math.max(1,g.bottom-g.top);f>e&&(m=1);h>f&&(m=2);k>h&&(m=3);var n;0!==m&&(n={style:{}},0!==(m&1)&&(n.style.fontStyle="italic"),0!==(m&2)&&(n.style.fontWeight="bold"));e=F(c);a.removeChild(c);f=I(this._viewDiv);c=l.createElement(b,"div");c.style.position="fixed";c.style.left="-1000px";c.style.paddingLeft=f.left+"px";c.style.paddingTop=f.top+"px";c.style.paddingRight=f.right+"px";c.style.paddingBottom=f.bottom+"px";c.style.width="100px";c.style.height="100px";h=l.createElement(b,"div");h.style.width=
"100%";h.style.height="100%";c.appendChild(h);a.appendChild(c);b=c.getBoundingClientRect();f=h.getBoundingClientRect();c.style.overflow="hidden";h.style.height="200px";h=c.clientWidth;c.style.overflow="scroll";k=c.clientWidth;a.removeChild(c);f={left:f.left-b.left,top:f.top-b.top,right:b.right-f.right,bottom:b.bottom-f.bottom};return{lineHeight:g,largestFontStyle:n,lineTrim:e,viewPadding:f,scrollWidth:h-k,invalid:d}},_checkOverlayScroll:function(){if(l.isMac){var a=this,b=this._getWindow();this._overlayScrollTimer&&
b.clearTimeout(this._overlayScrollTimer);var c=function(){var d=a._isOverOverlayScroll();d.vertical||d.horizontal?a._overlayScrollTimer=b.setTimeout(c,200):(a._overlayScrollTimer=void 0,a._update())};this._overlayScrollTimer=b.setTimeout(c,200)}},_clearSelection:function(a){var b=this._getSelection();if(b.isEmpty())return!1;"next"===a?b.start=b.end:b.end=b.start;this._setSelection(b,!0);return!0},_commitIME:function(){if(-1!==this._imeOffset){this._scrollDiv.focus();this._clientDiv.focus();var a=
this._model,b=a.getLineAtOffset(this._imeOffset),c=a.getLineStart(b),d=this._getDOMText(this._getLineNode(b)).text,a=a.getLine(b),c=this._imeOffset-c,a=c+d.length-a.length;c!==a&&(d=d.substring(c,a),this._doContent(d));this._imeOffset=-1}},_createActions:function(){var a=D.KeyBinding,b=this._keyBindings=[];b.push({actionID:"lineUp",keyBinding:new a(38),predefined:!0});b.push({actionID:"lineDown",keyBinding:new a(40),predefined:!0});b.push({actionID:"charPrevious",keyBinding:new a(37),predefined:!0});
b.push({actionID:"charNext",keyBinding:new a(39),predefined:!0});l.isMac?(b.push({actionID:"scrollPageUp",keyBinding:new a(33),predefined:!0}),b.push({actionID:"scrollPageDown",keyBinding:new a(34),predefined:!0}),b.push({actionID:"pageUp",keyBinding:new a(33,null,null,!0),predefined:!0}),b.push({actionID:"pageDown",keyBinding:new a(34,null,null,!0),predefined:!0}),b.push({actionID:"lineStart",keyBinding:new a(37,!0),predefined:!0}),b.push({actionID:"lineEnd",keyBinding:new a(39,!0),predefined:!0}),
b.push({actionID:"wordPrevious",keyBinding:new a(37,null,null,!0),predefined:!0}),b.push({actionID:"wordNext",keyBinding:new a(39,null,null,!0),predefined:!0}),b.push({actionID:"scrollTextStart",keyBinding:new a(36),predefined:!0}),b.push({actionID:"scrollTextEnd",keyBinding:new a(35),predefined:!0}),b.push({actionID:"textStart",keyBinding:new a(38,!0),predefined:!0}),b.push({actionID:"textEnd",keyBinding:new a(40,!0),predefined:!0}),b.push({actionID:"scrollPageUp",keyBinding:new a(38,null,null,null,
!0),predefined:!0}),b.push({actionID:"scrollPageDown",keyBinding:new a(40,null,null,null,!0),predefined:!0}),b.push({actionID:"lineStart",keyBinding:new a(37,null,null,null,!0),predefined:!0}),b.push({actionID:"lineEnd",keyBinding:new a(39,null,null,null,!0),predefined:!0}),b.push({actionID:"lineStart",keyBinding:new a(38,null,null,!0),predefined:!0}),b.push({actionID:"lineEnd",keyBinding:new a(40,null,null,!0),predefined:!0})):(b.push({actionID:"pageUp",keyBinding:new a(33),predefined:!0}),b.push({actionID:"pageDown",
keyBinding:new a(34),predefined:!0}),b.push({actionID:"lineStart",keyBinding:new a(36),predefined:!0}),b.push({actionID:"lineEnd",keyBinding:new a(35),predefined:!0}),b.push({actionID:"wordPrevious",keyBinding:new a(37,!0),predefined:!0}),b.push({actionID:"wordNext",keyBinding:new a(39,!0),predefined:!0}),b.push({actionID:"textStart",keyBinding:new a(36,!0),predefined:!0}),b.push({actionID:"textEnd",keyBinding:new a(35,!0),predefined:!0}));l.isFirefox&&l.isLinux&&(b.push({actionID:"lineUp",keyBinding:new a(38,
!0),predefined:!0}),b.push({actionID:"lineDown",keyBinding:new a(40,!0),predefined:!0}));b.push({actionID:"selectLineUp",keyBinding:new a(38,null,!0),predefined:!0});b.push({actionID:"selectLineDown",keyBinding:new a(40,null,!0),predefined:!0});b.push({actionID:"selectCharPrevious",keyBinding:new a(37,null,!0),predefined:!0});b.push({actionID:"selectCharNext",keyBinding:new a(39,null,!0),predefined:!0});b.push({actionID:"selectPageUp",keyBinding:new a(33,null,!0),predefined:!0});b.push({actionID:"selectPageDown",
keyBinding:new a(34,null,!0),predefined:!0});l.isMac?(b.push({actionID:"selectLineStart",keyBinding:new a(37,!0,!0),predefined:!0}),b.push({actionID:"selectLineEnd",keyBinding:new a(39,!0,!0),predefined:!0}),b.push({actionID:"selectWordPrevious",keyBinding:new a(37,null,!0,!0),predefined:!0}),b.push({actionID:"selectWordNext",keyBinding:new a(39,null,!0,!0),predefined:!0}),b.push({actionID:"selectTextStart",keyBinding:new a(36,null,!0),predefined:!0}),b.push({actionID:"selectTextEnd",keyBinding:new a(35,
null,!0),predefined:!0}),b.push({actionID:"selectTextStart",keyBinding:new a(38,!0,!0),predefined:!0}),b.push({actionID:"selectTextEnd",keyBinding:new a(40,!0,!0),predefined:!0}),b.push({actionID:"selectLineStart",keyBinding:new a(37,null,!0,null,!0),predefined:!0}),b.push({actionID:"selectLineEnd",keyBinding:new a(39,null,!0,null,!0),predefined:!0}),b.push({actionID:"selectLineStart",keyBinding:new a(38,null,!0,!0),predefined:!0}),b.push({actionID:"selectLineEnd",keyBinding:new a(40,null,!0,!0),
predefined:!0})):(l.isLinux&&(b.push({actionID:"selectWholeLineUp",keyBinding:new a(38,!0,!0),predefined:!0}),b.push({actionID:"selectWholeLineDown",keyBinding:new a(40,!0,!0),predefined:!0})),b.push({actionID:"selectLineStart",keyBinding:new a(36,null,!0),predefined:!0}),b.push({actionID:"selectLineEnd",keyBinding:new a(35,null,!0),predefined:!0}),b.push({actionID:"selectWordPrevious",keyBinding:new a(37,!0,!0),predefined:!0}),b.push({actionID:"selectWordNext",keyBinding:new a(39,!0,!0),predefined:!0}),
b.push({actionID:"selectTextStart",keyBinding:new a(36,!0,!0),predefined:!0}),b.push({actionID:"selectTextEnd",keyBinding:new a(35,!0,!0),predefined:!0}));b.push({actionID:"undo",keyBinding:new D.KeyBinding("z",!0),predefined:!0});l.isMac?b.push({actionID:"redo",keyBinding:new D.KeyBinding("z",!0,!0),predefined:!0}):b.push({actionID:"redo",keyBinding:new D.KeyBinding("y",!0),predefined:!0});b.push({actionID:"deletePrevious",keyBinding:new a(8),predefined:!0});b.push({actionID:"deletePrevious",keyBinding:new a(8,
null,!0),predefined:!0});b.push({actionID:"deleteNext",keyBinding:new a(46),predefined:!0});b.push({actionID:"deleteWordPrevious",keyBinding:new a(8,!0),predefined:!0});b.push({actionID:"deleteWordPrevious",keyBinding:new a(8,!0,!0),predefined:!0});b.push({actionID:"deleteWordNext",keyBinding:new a(46,!0),predefined:!0});b.push({actionID:"tab",keyBinding:new a(9),predefined:!0});b.push({actionID:"shiftTab",keyBinding:new a(9,null,!0),predefined:!0});b.push({actionID:"enter",keyBinding:new a(13),predefined:!0});
b.push({actionID:"enter",keyBinding:new a(13,null,!0),predefined:!0});b.push({actionID:"selectAll",keyBinding:new a("a",!0),predefined:!0});b.push({actionID:"toggleTabMode",keyBinding:new a("m",!0),predefined:!0});l.isMac&&(b.push({actionID:"deleteNext",keyBinding:new a(46,null,!0),predefined:!0}),b.push({actionID:"deleteWordPrevious",keyBinding:new a(8,null,null,!0),predefined:!0}),b.push({actionID:"deleteWordNext",keyBinding:new a(46,null,null,!0),predefined:!0}));if(!l.isFirefox){var c=l.isMac&&
l.isChrome;b.push({actionID:null,keyBinding:new a("u",!c,!1,!1,c),predefined:!0});b.push({actionID:null,keyBinding:new a("i",!c,!1,!1,c),predefined:!0});b.push({actionID:null,keyBinding:new a("b",!c,!1,!1,c),predefined:!0})}l.isFirefox&&(b.push({actionID:"copy",keyBinding:new a(45,!0),predefined:!0}),b.push({actionID:"paste",keyBinding:new a(45,null,!0),predefined:!0}),b.push({actionID:"cut",keyBinding:new a(46,null,!0),predefined:!0}));l.isMac&&(b.push({actionID:"lineStart",keyBinding:new a("a",
!1,!1,!1,!0),predefined:!0}),b.push({actionID:"lineEnd",keyBinding:new a("e",!1,!1,!1,!0),predefined:!0}),b.push({actionID:"lineUp",keyBinding:new a("p",!1,!1,!1,!0),predefined:!0}),b.push({actionID:"lineDown",keyBinding:new a("n",!1,!1,!1,!0),predefined:!0}),b.push({actionID:"charPrevious",keyBinding:new a("b",!1,!1,!1,!0),predefined:!0}),b.push({actionID:"charNext",keyBinding:new a("f",!1,!1,!1,!0),predefined:!0}),b.push({actionID:"deletePrevious",keyBinding:new a("h",!1,!1,!1,!0),predefined:!0}),
b.push({actionID:"deleteNext",keyBinding:new a("d",!1,!1,!1,!0),predefined:!0}),b.push({actionID:"deleteLineEnd",keyBinding:new a("k",!1,!1,!1,!0),predefined:!0}),l.isFirefox?(b.push({actionID:"scrollPageDown",keyBinding:new a("v",!1,!1,!1,!0),predefined:!0}),b.push({actionID:"deleteLineStart",keyBinding:new a("u",!1,!1,!1,!0),predefined:!0}),b.push({actionID:"deleteWordPrevious",keyBinding:new a("w",!1,!1,!1,!0),predefined:!0})):(b.push({actionID:"pageDown",keyBinding:new a("v",!1,!1,!1,!0),predefined:!0}),
b.push({actionID:"centerLine",keyBinding:new a("l",!1,!1,!1,!0),predefined:!0}),b.push({actionID:"enterNoCursor",keyBinding:new a("o",!1,!1,!1,!0),predefined:!0})));var d=this;this._actions={lineUp:{defaultHandler:function(){return d._doLineUp({select:!1})}},lineDown:{defaultHandler:function(){return d._doLineDown({select:!1})}},lineStart:{defaultHandler:function(){return d._doHome({select:!1,ctrl:!1})}},lineEnd:{defaultHandler:function(){return d._doEnd({select:!1,ctrl:!1})}},charPrevious:{defaultHandler:function(){return d._doCursorPrevious({select:!1,
unit:"character"})}},charNext:{defaultHandler:function(){return d._doCursorNext({select:!1,unit:"character"})}},pageUp:{defaultHandler:function(){return d._doPageUp({select:!1})}},pageDown:{defaultHandler:function(){return d._doPageDown({select:!1})}},scrollPageUp:{defaultHandler:function(){return d._doScroll({type:"pageUp"})}},scrollPageDown:{defaultHandler:function(){return d._doScroll({type:"pageDown"})}},wordPrevious:{defaultHandler:function(){return d._doCursorPrevious({select:!1,unit:"word"})}},
wordNext:{defaultHandler:function(){return d._doCursorNext({select:!1,unit:"word"})}},textStart:{defaultHandler:function(){return d._doHome({select:!1,ctrl:!0})}},textEnd:{defaultHandler:function(){return d._doEnd({select:!1,ctrl:!0})}},scrollTextStart:{defaultHandler:function(){return d._doScroll({type:"textStart"})}},scrollTextEnd:{defaultHandler:function(){return d._doScroll({type:"textEnd"})}},centerLine:{defaultHandler:function(){return d._doScroll({type:"centerLine"})}},selectLineUp:{defaultHandler:function(){return d._doLineUp({select:!0})}},
selectLineDown:{defaultHandler:function(){return d._doLineDown({select:!0})}},selectWholeLineUp:{defaultHandler:function(){return d._doLineUp({select:!0,wholeLine:!0})}},selectWholeLineDown:{defaultHandler:function(){return d._doLineDown({select:!0,wholeLine:!0})}},selectLineStart:{defaultHandler:function(){return d._doHome({select:!0,ctrl:!1})}},selectLineEnd:{defaultHandler:function(){return d._doEnd({select:!0,ctrl:!1})}},selectCharPrevious:{defaultHandler:function(){return d._doCursorPrevious({select:!0,
unit:"character"})}},selectCharNext:{defaultHandler:function(){return d._doCursorNext({select:!0,unit:"character"})}},selectPageUp:{defaultHandler:function(){return d._doPageUp({select:!0})}},selectPageDown:{defaultHandler:function(){return d._doPageDown({select:!0})}},selectWordPrevious:{defaultHandler:function(){return d._doCursorPrevious({select:!0,unit:"word"})}},selectWordNext:{defaultHandler:function(){return d._doCursorNext({select:!0,unit:"word"})}},selectTextStart:{defaultHandler:function(){return d._doHome({select:!0,
ctrl:!0})}},selectTextEnd:{defaultHandler:function(){return d._doEnd({select:!0,ctrl:!0})}},deletePrevious:{defaultHandler:function(){return d._doBackspace({unit:"character"})}},deleteNext:{defaultHandler:function(){return d._doDelete({unit:"character"})}},deleteWordPrevious:{defaultHandler:function(){return d._doBackspace({unit:"word"})}},deleteWordNext:{defaultHandler:function(){return d._doDelete({unit:"word"})}},deleteLineStart:{defaultHandler:function(){return d._doBackspace({unit:"line"})}},
deleteLineEnd:{defaultHandler:function(){return d._doDelete({unit:"line"})}},tab:{defaultHandler:function(){return d._doTab()}},shiftTab:{defaultHandler:function(){return d._doShiftTab()}},enter:{defaultHandler:function(){return d._doEnter()}},enterNoCursor:{defaultHandler:function(){return d._doEnter({noCursor:!0})}},selectAll:{defaultHandler:function(){return d._doSelectAll()}},copy:{defaultHandler:function(){return d._doCopy()}},cut:{defaultHandler:function(){return d._doCut()}},paste:{defaultHandler:function(){return d._doPaste()}},
toggleWrapMode:{defaultHandler:function(){return d._doWrapMode()}},toggleTabMode:{defaultHandler:function(){return d._doTabMode()}}}},_createRuler:function(a,b){if(this._clientDiv){var c="left"===a.getLocation()?this._leftDiv:this._rightDiv;c.style.display="block";var d=l.createElement(c.ownerDocument,"div");d._ruler=a;d.rulerChanged=!0;d.style.position="relative";var c=c.firstChild.rows[0],e=c.cells.length,c=c.insertCell(void 0===b||0>b||b>e?e:b);c.vAlign="top";c.style.verticalAlign="top";c.style.borderWidth=
"0px";c.style.margin="0px";c.style.padding="0px";c.style.outline="none";c.appendChild(d)}},_createView:function(){if(!this._clientDiv){for(var a=this._parent;a.hasChildNodes();)a.removeChild(a.lastChild);var b=a.ownerDocument,c=l.createElement(b,"div");this._rootDiv=c;c.tabIndex=-1;c.style.position="relative";c.style.overflow="hidden";c.style.width="100%";c.style.height="100%";a.style.overflow="hidden";c.setAttribute("role","application");a.appendChild(c);a=l.createElement(b,"div");a.className="textviewLeftRuler";
this._leftDiv=a;a.tabIndex=-1;a.style.overflow="hidden";a.style.MozUserSelect="none";a.style.WebkitUserSelect="none";a.style.position="absolute";a.style.cursor="default";a.style.display="none";a.setAttribute("aria-hidden","true");var d=l.createElement(b,"table");a.appendChild(d);d.cellPadding="0px";d.cellSpacing="0px";d.border="0px";d.style.borderWidth="0px";d.style.margin="0px";d.style.padding="0px";d.style.outline="none";d.style.lineHeight="normal";d=d.insertRow(0);d.style.borderWidth="0px";d.style.margin=
"0px";d.style.padding="0px";d.style.outline="none";d.style.lineHeight="normal";c.appendChild(a);a=l.createElement(b,"div");a.className="textview";this._viewDiv=a;a.tabIndex=-1;a.style.overflow="auto";a.style.position="absolute";a.style.top="0px";a.style.bottom="0px";a.style.borderWidth="0px";a.style.margin="0px";a.style.outline="none";c.appendChild(a);var e=l.createElement(b,"div");e.className="textviewRightRuler";this._rightDiv=e;e.tabIndex=-1;e.style.display="none";e.style.overflow="hidden";e.style.MozUserSelect=
"none";e.style.WebkitUserSelect="none";e.style.position="absolute";e.style.cursor="default";e.style.right="0px";e.setAttribute("aria-hidden","true");d=l.createElement(b,"table");e.appendChild(d);d.cellPadding="0px";d.cellSpacing="0px";d.border="0px";d.style.borderWidth="0px";d.style.margin="0px";d.style.padding="0px";d.style.outline="none";d.style.lineHeight="normal";d=d.insertRow(0);d.style.borderWidth="0px";d.style.margin="0px";d.style.padding="0px";d.style.outline="none";d.style.lineHeight="normal";
c.appendChild(e);this._scrollDiv=d=l.createElement(b,"div");d.style.margin="0px";d.style.borderWidth="0px";d.style.padding="0px";a.appendChild(d);l.isFirefox&&(this._clipboardDiv=a=l.createElement(b,"div"),a.style.position="fixed",a.style.whiteSpace="pre",a.style.left="-1000px",c.appendChild(a));!l.isIE&&!l.isIOS&&(this._clipDiv=a=l.createElement(b,"div"),a.style.position="absolute",a.style.overflow="hidden",a.style.margin="0px",a.style.borderWidth="0px",a.style.padding="0px",c.appendChild(a),this._clipScrollDiv=
d=l.createElement(b,"div"),d.style.position="absolute",d.style.height="1px",d.style.top="-1000px",a.appendChild(d));this._setFullSelection(this._fullSelection,!0);a=l.createElement(b,"div");a.className="textviewContent";this._clientDiv=a;a.style.position="absolute";a.style.borderWidth="0px";a.style.margin="0px";a.style.padding="0px";a.style.outline="none";a.style.zIndex="1";a.style.WebkitUserSelect="text";a.setAttribute("spellcheck","false");if(l.isIOS||l.isAndroid)a.style.WebkitTapHighlightColor=
"transparent";(this._clipDiv||c).appendChild(a);if(l.isIOS||l.isAndroid)this._vScrollDiv=d=l.createElement(b,"div"),d.style.position="absolute",d.style.borderWidth="1px",d.style.borderColor="white",d.style.borderStyle="solid",d.style.borderRadius="4px",d.style.backgroundColor="black",d.style.opacity="0.5",d.style.margin="0px",d.style.padding="0px",d.style.outline="none",d.style.zIndex="3",d.style.width="8px",d.style.display="none",c.appendChild(d),this._hScrollDiv=d=l.createElement(b,"div"),d.style.position=
"absolute",d.style.borderWidth="1px",d.style.borderColor="white",d.style.borderStyle="solid",d.style.borderRadius="4px",d.style.backgroundColor="black",d.style.opacity="0.5",d.style.margin="0px",d.style.padding="0px",d.style.outline="none",d.style.zIndex="3",d.style.height="8px",d.style.display="none",c.appendChild(d);l.isFirefox&&!a.setCapture&&(this._overlayDiv=d=l.createElement(b,"div"),d.style.position=a.style.position,d.style.borderWidth=a.style.borderWidth,d.style.margin=a.style.margin,d.style.padding=
a.style.padding,d.style.cursor="text",d.style.zIndex="2",(this._clipDiv||c).appendChild(d));a.contentEditable="true";a.setAttribute("role","textbox");a.setAttribute("aria-multiline","true");this._setWrapMode(this._wrapMode,!0);this._setReadOnly(this._readonly);this._setThemeClass(this._themeClass,!0);this._setTabSize(this._tabSize,!0);b.getElementById("_textviewStyle")||(c="",l.isWebkit&&0<this._metrics.scrollWidth&&(c+="\n.textviewContainer ::-webkit-scrollbar-corner {background: #eeeeee;}"),l.isFirefox&&
(l.isMac&&this._highlightRGB&&"Highlight"!==this._highlightRGB)&&(c+="\n.textviewContainer ::-moz-selection {background: "+this._highlightRGB+";}"),c&&(a=l.createElement(b,"style"),a.id="_textviewStyle",d=b.getElementsByTagName("head")[0]||b.documentElement,a.appendChild(b.createTextNode(c)),d.insertBefore(a,d.firstChild)));this._hookEvents();b=this._rulers;for(c=0;c<b.length;c++)this._createRuler(b[c]);this._update()}},_defaultOptions:function(){return{parent:{value:void 0,update:null},model:{value:void 0,
update:this.setModel},readonly:{value:!1,update:this._setReadOnly},fullSelection:{value:!0,update:this._setFullSelection},tabMode:{value:!0,update:null},tabSize:{value:8,update:this._setTabSize},expandTab:{value:!1,update:null},wrapMode:{value:!1,update:this._setWrapMode},themeClass:{value:void 0,update:this._setThemeClass}}},_destroyRuler:function(a){var b="left"===a.getLocation()?this._leftDiv:this._rightDiv;if(b){for(var c=b.firstChild.rows[0],d=c.cells,e=0;e<d.length&&d[e].firstChild._ruler!==
a;e++);e!==d.length&&(c.cells[e]._ruler=void 0,c.deleteCell(e),0===d.length&&(b.style.display="none"))}},_destroyView:function(){if(this._clientDiv){this._setGrab(null);this._unhookEvents();var a=this._getWindow();this._autoScrollTimerID&&(a.clearTimeout(this._autoScrollTimerID),this._autoScrollTimerID=null);this._updateTimer&&(a.clearTimeout(this._updateTimer),this._updateTimer=null);a=this._rootDiv;a.parentNode.removeChild(a);this._hScrollDiv=this._vScrollDiv=this._rightDiv=this._leftDiv=this._overlayDiv=
this._clientDiv=this._clipScrollDiv=this._clipDiv=this._viewDiv=this._scrollDiv=this._rootDiv=this._clipboardDiv=this._selDiv3=this._selDiv2=this._selDiv1=null}},_doAutoScroll:function(a,b,c){this._autoScrollDir=a;this._autoScrollX=b;this._autoScrollY=c;this._autoScrollTimerID||this._autoScrollTimer()},_endAutoScroll:function(){this._autoScrollTimerID&&this._getWindow().clearTimeout(this._autoScrollTimerID);this._autoScrollTimerID=this._autoScrollDir=void 0},_fixCaret:function(){var a=this._clientDiv;
if(a){var b=this._hasFocus;this._ignoreFocus=!0;b&&a.blur();a.contentEditable=!1;a.contentEditable=!0;b&&a.focus();this._ignoreFocus=!1}},_getBaseText:function(a,b){var c=this._model;c.getBaseModel&&(a=c.mapOffset(a),b=c.mapOffset(b),c=c.getBaseModel());return c.getText(a,b)},_getBottomIndex:function(a){var b=this._bottomChild;if(a&&this._getClientHeight()>this._getLineHeight()){a=b.getBoundingClientRect();var c=this._clientDiv.getBoundingClientRect();a.bottom>c.bottom&&(b=this._getLinePrevious(b)||
b)}return b.lineIndex},_getBoundsAtOffset:function(a){var b=this._getLine(this._model.getLineAtOffset(a));a=b.getBoundingClientRect(a);var c=this._getLinePixel(b.lineIndex);a.top+=c;a.bottom+=c;b.destroy();return a},_getClientHeight:function(){var a=this._getViewPadding();return Math.max(0,this._viewDiv.clientHeight-a.top-a.bottom)},_getClientWidth:function(){var a=this._getViewPadding();return Math.max(0,this._viewDiv.clientWidth-a.left-a.right)},_getClipboardText:function(a,b){var c=this._model.getLineDelimiter(),
d,e,f=this._getWindow();if(f.clipboardData)return d=[],e=f.clipboardData.getData("Text"),C(e,function(a){d.push(a)},function(){d.push(c)}),e=d.join(""),b&&b(e),e;if(l.isFirefox){this._ignoreFocus=!0;var h=this._clipboardDiv;h.innerHTML="\x3cpre contenteditable\x3d''\x3e\x3c/pre\x3e";h.firstChild.focus();var g=this,k=function(){var a=g._getTextFromElement(h);h.innerHTML="";d=[];C(a,function(a){d.push(a)},function(){d.push(c)});return d.join("")},m=!1;this._ignorePaste=!0;if(!l.isLinux||2!==this._lastMouseButton)try{m=
h.ownerDocument.execCommand("paste",!1,null)}catch(n){m=1<h.childNodes.length||h.firstChild&&0<h.firstChild.childNodes.length}this._ignorePaste=!1;if(!m){if(a)return f.setTimeout(function(){g.focus();(e=k())&&b&&b(e);g._ignoreFocus=!1},0),null;this.focus();this._ignoreFocus=!1;return""}this.focus();this._ignoreFocus=!1;(e=k())&&b&&b(e);return e}return a&&a.clipboardData?(d=[],e=a.clipboardData.getData("text/plain"),C(e,function(a){d.push(a)},function(){d.push(c)}),(e=d.join(""))&&b&&b(e),e):""},_getDOMText:function(a,
b){for(var c=a.firstChild,d="",e=0;c;){var f;if(c.ignoreChars){f=c.lastChild;for(var h=0,g=[],k=-1;f;){for(var m=f.data,l=m.length-1;0<=l;l--){var p=m.substring(l,l+1);h<c.ignoreChars&&(" "===p||"\u200c"===p||"\ufeff"===p)?h++:g.push("\u00a0"===p?"\t":p)}b===f&&(k=g.length);f=f.previousSibling}g=g.reverse().join("");-1!==k&&(e=d.length+g.length-k);d+=g}else for(f=c.firstChild;f;)b===f&&(e=d.length),d+=f.data,f=f.nextSibling;c=c.nextSibling}return{text:d,offset:e}},_getTextFromElement:function(a){var b=
a.ownerDocument,c=b.defaultView;if(!c.getSelection)return a.innerText||a.textContent;b=b.createRange();b.selectNode(a);a=c.getSelection();var c=[],d;for(d=0;d<a.rangeCount;d++)c.push(a.getRangeAt(d));this._ignoreSelect=!0;a.removeAllRanges();a.addRange(b);b=a.toString();a.removeAllRanges();for(d=0;d<c.length;d++)a.addRange(c[d]);this._ignoreSelect=!1;return b},_getViewPadding:function(){return this._metrics.viewPadding},_getLine:function(a){var b=this._getLineNode(a);return b&&!b.lineChanged&&!b.lineRemoved?
b._line:new z(this,a)},_getLineHeight:function(a,b){if(void 0!==a&&this._lineHeight){var c=this._lineHeight[a];if(c)return c;if(b||void 0===b)return this._lineHeight[a]=this._calculateLineHeight(a)}return this._metrics.lineHeight},_getLineNode:function(a){for(var b=this._clientDiv.firstChild;b;){if(a===b.lineIndex)return b;b=b.nextSibling}},_getLineNext:function(a){for(a=a?a.nextSibling:this._clientDiv.firstChild;a&&-1===a.lineIndex;)a=a.nextSibling;return a},_getLinePrevious:function(a){for(a=a?
a.previousSibling:this._clientDiv.lastChild;a&&-1===a.lineIndex;)a=a.previousSibling;return a},_getLinePixel:function(a){a=Math.min(Math.max(0,a),this._model.getLineCount());if(this._lineHeight){var b=this._getTopIndex(),c=-this._topIndexY+this._getScroll().y;if(a>b)for(;b<a;b++)c+=this._getLineHeight(b);else for(b-=1;b>=a;b--)c-=this._getLineHeight(b);return c}return this._getLineHeight()*a},_getLineIndex:function(a){var b,c=0,d=this._model.getLineCount();if(this._lineHeight){var c=this._getTopIndex(),
e=-this._topIndexY+this._getScroll().y;if(a!==e)if(a<e)for(;a<e&&0<c;)a+=this._getLineHeight(--c);else for(b=this._getLineHeight(c);a-b>=e&&c<d-1;)a-=b,b=this._getLineHeight(++c)}else b=this._getLineHeight(),c=Math.floor(a/b);return Math.max(0,Math.min(d-1,c))},_getScroll:function(){var a=this._viewDiv;return{x:a.scrollLeft,y:a.scrollTop}},_getSelection:function(){return this._selection.clone()},_getTopIndex:function(a){var b=this._topChild;if(a&&this._getClientHeight()>this._getLineHeight()){a=b.getBoundingClientRect();
var c=this._getViewPadding(),d=this._viewDiv.getBoundingClientRect();a.top<d.top+c.top&&(b=this._getLineNext(b)||b)}return b.lineIndex},_hookEvents:function(){var a=this;this._modelListener={onChanging:function(b){a._onModelChanging(b)},onChanged:function(b){a._onModelChanged(b)}};this._model.addEventListener("preChanging",this._modelListener.onChanging);this._model.addEventListener("postChanged",this._modelListener.onChanged);var b=this._handlers=[],c=this._clientDiv,d=this._viewDiv,e=this._rootDiv,
f=this._overlayDiv||c,h=c.ownerDocument,g=this._getWindow(),k=l.isIE?h:g;b.push({target:g,type:"resize",handler:function(b){return a._handleResize(b?b:g.event)}});b.push({target:c,type:"blur",handler:function(b){return a._handleBlur(b?b:g.event)}});b.push({target:c,type:"focus",handler:function(b){return a._handleFocus(b?b:g.event)}});b.push({target:d,type:"focus",handler:function(a){c.focus()}});b.push({target:d,type:"scroll",handler:function(b){return a._handleScroll(b?b:g.event)}});b.push({target:c,
type:"textInput",handler:function(b){return a._handleTextInput(b?b:g.event)}});b.push({target:c,type:"keydown",handler:function(b){return a._handleKeyDown(b?b:g.event)}});b.push({target:c,type:"keypress",handler:function(b){return a._handleKeyPress(b?b:g.event)}});b.push({target:c,type:"keyup",handler:function(b){return a._handleKeyUp(b?b:g.event)}});b.push({target:c,type:"contextmenu",handler:function(b){return a._handleContextMenu(b?b:g.event)}});b.push({target:c,type:"copy",handler:function(b){return a._handleCopy(b?
b:g.event)}});b.push({target:c,type:"cut",handler:function(b){return a._handleCut(b?b:g.event)}});b.push({target:c,type:"paste",handler:function(b){return a._handlePaste(b?b:g.event)}});if(l.isIOS||l.isAndroid)b.push({target:h,type:"selectionchange",handler:function(b){return a._handleSelectionChange(b?b:g.event)}}),b.push({target:c,type:"touchstart",handler:function(b){return a._handleTouchStart(b?b:g.event)}}),b.push({target:c,type:"touchmove",handler:function(b){return a._handleTouchMove(b?b:g.event)}}),
b.push({target:c,type:"touchend",handler:function(b){return a._handleTouchEnd(b?b:g.event)}});else{b.push({target:c,type:"selectstart",handler:function(b){return a._handleSelectStart(b?b:g.event)}});b.push({target:c,type:"mousedown",handler:function(b){return a._handleMouseDown(b?b:g.event)}});b.push({target:c,type:"mouseover",handler:function(b){return a._handleMouseOver(b?b:g.event)}});b.push({target:c,type:"mouseout",handler:function(b){return a._handleMouseOut(b?b:g.event)}});b.push({target:k,
type:"mouseup",handler:function(b){return a._handleMouseUp(b?b:g.event)}});b.push({target:k,type:"mousemove",handler:function(b){return a._handleMouseMove(b?b:g.event)}});b.push({target:e,type:"mousedown",handler:function(b){return a._handleRootMouseDown(b?b:g.event)}});b.push({target:e,type:"mouseup",handler:function(b){return a._handleRootMouseUp(b?b:g.event)}});b.push({target:f,type:"dragstart",handler:function(b){return a._handleDragStart(b?b:g.event)}});b.push({target:f,type:"drag",handler:function(b){return a._handleDrag(b?
b:g.event)}});b.push({target:f,type:"dragend",handler:function(b){return a._handleDragEnd(b?b:g.event)}});b.push({target:f,type:"dragenter",handler:function(b){return a._handleDragEnter(b?b:g.event)}});b.push({target:f,type:"dragover",handler:function(b){return a._handleDragOver(b?b:g.event)}});b.push({target:f,type:"dragleave",handler:function(b){return a._handleDragLeave(b?b:g.event)}});b.push({target:f,type:"drop",handler:function(b){return a._handleDrop(b?b:g.event)}});b.push({target:this._clientDiv,
type:l.isFirefox?"DOMMouseScroll":"mousewheel",handler:function(b){return a._handleMouseWheel(b?b:g.event)}});if(l.isFirefox&&(!l.isWindows||15<=l.isFirefox))(d=g.MutationObserver||g.MozMutationObserver)?(this._mutationObserver=new d(function(b){a._handleDataModified(b)}),this._mutationObserver.observe(c,{subtree:!0,characterData:!0})):b.push({target:this._clientDiv,type:"DOMCharacterDataModified",handler:function(b){return a._handleDataModified(b?b:g.event)}});this._overlayDiv&&(b.push({target:this._overlayDiv,
type:"mousedown",handler:function(b){return a._handleMouseDown(b?b:g.event)}}),b.push({target:this._overlayDiv,type:"mouseover",handler:function(b){return a._handleMouseOver(b?b:g.event)}}),b.push({target:this._overlayDiv,type:"mouseout",handler:function(b){return a._handleMouseOut(b?b:g.event)}}),b.push({target:this._overlayDiv,type:"contextmenu",handler:function(b){return a._handleContextMenu(b?b:g.event)}}));this._isW3CEvents||b.push({target:this._clientDiv,type:"dblclick",handler:function(b){return a._handleDblclick(b?
b:g.event)}})}d=this._leftDiv;e=this._rightDiv;l.isIE&&b.push({target:d,type:"selectstart",handler:function(){return!1}});b.push({target:d,type:l.isFirefox?"DOMMouseScroll":"mousewheel",handler:function(b){return a._handleMouseWheel(b?b:g.event)}});b.push({target:d,type:"click",handler:function(b){a._handleRulerEvent(b?b:g.event)}});b.push({target:d,type:"dblclick",handler:function(b){a._handleRulerEvent(b?b:g.event)}});b.push({target:d,type:"mousemove",handler:function(b){a._handleRulerEvent(b?b:
g.event)}});b.push({target:d,type:"mouseover",handler:function(b){a._handleRulerEvent(b?b:g.event)}});b.push({target:d,type:"mouseout",handler:function(b){a._handleRulerEvent(b?b:g.event)}});l.isIE&&b.push({target:e,type:"selectstart",handler:function(){return!1}});b.push({target:e,type:l.isFirefox?"DOMMouseScroll":"mousewheel",handler:function(b){return a._handleMouseWheel(b?b:g.event)}});b.push({target:e,type:"click",handler:function(b){a._handleRulerEvent(b?b:g.event)}});b.push({target:e,type:"dblclick",
handler:function(b){a._handleRulerEvent(b?b:g.event)}});b.push({target:e,type:"mousemove",handler:function(b){a._handleRulerEvent(b?b:g.event)}});b.push({target:e,type:"mouseover",handler:function(b){a._handleRulerEvent(b?b:g.event)}});b.push({target:e,type:"mouseout",handler:function(b){a._handleRulerEvent(b?b:g.event)}});for(d=0;d<b.length;d++)e=b[d],H(e.target,e.type,e.handler,e.capture)},_getWindow:function(){return this._parent.ownerDocument.defaultView||this._parent.ownerDocument.parentWindow},
_init:function(a){var b=a.parent;"string"===typeof b&&(b=(a.document||document).getElementById(b));if(!b)throw"no parent";a.parent=b;a.model=a.model||new J.TextModel;var c=this._defaultOptions(),d;for(d in c)c.hasOwnProperty(d)&&(this["_"+d]=void 0!==a[d]?a[d]:c[d].value);this._rulers=[];this._selection=new x(0,0,!1);this._linksVisible=!1;this._maxLineWidth=this._redrawCount=0;this._maxLineIndex=-1;this._ignoreSelect=!0;this._hasFocus=this._ignoreFocus=!1;this._dragOffset=this._columnX=-1;this._isRangeRects=
(!l.isIE||9<=l.isIE)&&"function"===typeof b.ownerDocument.createRange().getBoundingClientRect;this._isW3CEvents=b.addEventListener;this._autoScrollTimerID=this._autoScrollY=this._autoScrollX=null;this._AUTO_SCROLL_RATE=50;this._mouseUpClosure=this._moseMoveClosure=this._grabControl=null;this._clickCount=this._lastMouseTime=this._lastMouseY=this._lastMouseX=0;this._clickTime=250;this._clickDist=5;this._isMouseDown=!1;this._doubleClickSelection=null;this._vScroll=this._hScroll=0;this._imeOffset=-1;
this._createActions();this._createView()},_isOverOverlayScroll:function(){if(!l.isMac)return{};var a=this._viewDiv.getBoundingClientRect(),b=this._lastMouseMoveX,c=this._lastMouseMoveY;return{vertical:a.top<=c&&c<a.bottom&&a.right-15<=b&&b<a.right,horizontal:a.bottom-15<=c&&c<a.bottom&&a.left<=b&&b<a.right}},_modifyContent:function(a,b){if(!this._readonly||a._code)if(a.type="Verify",this.onVerify(a),!(null===a.text||void 0===a.text)){var c=this._model;try{a._ignoreDOMSelection&&(this._ignoreDOMSelection=
!0),c.setText(a.text,a.start,a.end)}finally{a._ignoreDOMSelection&&(this._ignoreDOMSelection=!1)}b&&(c=this._getSelection(),c.setCaret(a.start+a.text.length),this._setSelection(c,!0));this.onModify({type:"Modify"})}},_onModelChanged:function(a){a.type="ModelChanged";this.onModelChanged(a);a.type="Changed";var b=a.start,c=a.addedCharCount,d=a.removedCharCount,e=a.addedLineCount,f=a.removedLineCount,h=this._getSelection();h.end>b&&(h.end>b&&h.start<b+d?h.setCaret(b+c):(h.start+=c-d,h.end+=c-d),this._setSelection(h,
!1,!1));b=this._model.getLineAtOffset(b);for(c=this._getLineNext();c;)d=c.lineIndex,b<=d&&d<=b+f&&(b===d&&!c.modelChangedEvent&&!c.lineRemoved?(c.modelChangedEvent=a,c.lineChanged=!0):(c.lineRemoved=!0,c.lineChanged=!1,c.modelChangedEvent=null)),d>b+f&&(c.lineIndex=d+e-f,c._line.lineIndex=c.lineIndex),c=this._getLineNext(c);!this._wrapMode&&(b<=this._maxLineIndex&&this._maxLineIndex<=b+f)&&(this._checkMaxLineIndex=this._maxLineIndex,this._maxLineIndex=-1,this._maxLineWidth=0);this._update()},_onModelChanging:function(a){a.type=
"ModelChanging";this.onModelChanging(a);a.type="Changing"},_queueUpdate:function(){if(!this._updateTimer&&!this._ignoreQueueUpdate){var a=this;this._updateTimer=this._getWindow().setTimeout(function(){a._updateTimer=null;a._update()},0)}},_resetLineHeight:function(a,b){if(this._wrapMode){if(void 0!==a&&void 0!==b)for(var c=a;c<b;c++)this._lineHeight[c]=void 0;else this._lineHeight=Array(this._model.getLineCount());this._calculateLineHeightTimer()}else this._lineHeight=null},_resetLineWidth:function(){var a=
this._clientDiv;if(a)for(a=a.firstChild;a;)a.lineWidth=void 0,a=a.nextSibling},_reset:function(){this._maxLineIndex=-1;this._maxLineWidth=0;this._columnX=-1;this._bottomChild=this._topChild=null;this._topIndexY=0;this._resetLineHeight();this._setSelection(new x(0,0,!1),!1,!1);this._viewDiv&&(this._viewDiv.scrollLeft=0,this._viewDiv.scrollTop=0);var a=this._clientDiv;if(a){for(var b=a.firstChild;b;)b.lineRemoved=!0,b=b.nextSibling;l.isFirefox&&(this._ignoreFocus=!1,(b=this._hasFocus)&&a.blur(),a.contentEditable=
!1,a.contentEditable=!0,b&&a.focus(),this._ignoreFocus=!1)}},_scrollView:function(a,b){this._ensureCaretVisible=!1;var c=this._viewDiv;a&&(c.scrollLeft+=a);b&&(c.scrollTop+=b)},_setClipboardText:function(a,b){var c,d=this._parent.ownerDocument,e=this._getWindow();if(e.clipboardData)return c=[],C(a,function(a){c.push(a)},function(){c.push(l.platformDelimiter)}),e.clipboardData.setData("Text",c.join(""));if(b&&b.clipboardData&&(c=[],C(a,function(a){c.push(a)},function(){c.push(l.platformDelimiter)}),
b.clipboardData.setData("text/plain",c.join(""))))return!0;var f=l.createElement(d,"pre");f.style.position="fixed";f.style.left="-1000px";C(a,function(a){f.appendChild(d.createTextNode(a))},function(){f.appendChild(l.createElement(d,"br"))});f.appendChild(d.createTextNode(" "));this._clientDiv.appendChild(f);var h=d.createRange();h.setStart(f.firstChild,0);h.setEndBefore(f.lastChild);var g=e.getSelection();0<g.rangeCount&&g.removeAllRanges();g.addRange(h);var k=this,h=function(){f&&f.parentNode===
k._clientDiv&&k._clientDiv.removeChild(f);k._updateDOMSelection()},g=!1;this._ignoreCopy=!0;try{g=d.execCommand("copy",!1,null)}catch(m){}this._ignoreCopy=!1;if(!g&&b)return e.setTimeout(h,0),!1;h();return!0},_setDOMSelection:function(a,b,c,d){for(var e,f,h,g,k=0,m=a.firstChild,n,p,q=this._model.getLine(a.lineIndex).length;m;){n=m.firstChild;p=n.length;m.ignoreChars&&(p-=m.ignoreChars);if(k+p>b||k+p>=q){e=n;f=b-k;m.ignoreChars&&(0<p&&f===p)&&(f+=m.ignoreChars);break}k+=p;m=m.nextSibling}for(var k=
0,m=c.firstChild,r=this._model.getLine(c.lineIndex).length;m;){n=m.firstChild;p=n.length;m.ignoreChars&&(p-=m.ignoreChars);if(p+k>d||k+p>=r){h=n;g=d-k;m.ignoreChars&&(0<p&&g===p)&&(g+=m.ignoreChars);break}k+=p;m=m.nextSibling}this._setDOMFullSelection(a,b,q,c,d,r);this._hasFocus&&(b=this._getWindow(),a=this._parent.ownerDocument,b.getSelection?(b=b.getSelection(),b.anchorNode===e&&b.anchorOffset===f&&b.focusNode===h&&b.focusOffset===g||b.anchorNode===h&&b.anchorOffset===g&&b.focusNode===e&&b.focusOffset===
f||(a=a.createRange(),a.setStart(e,f),a.setEnd(h,g),this._ignoreSelect=!1,0<b.rangeCount&&b.removeAllRanges(),b.addRange(a),this._ignoreSelect=!0)):a.selection&&(b=a.body,a=l.createElement(a,"div"),b.appendChild(a),b.removeChild(a),a=b.createTextRange(),a.moveToElementText(e.parentNode),a.moveStart("character",f),e=b.createTextRange(),e.moveToElementText(h.parentNode),e.moveStart("character",g),a.setEndPoint("EndToStart",e),this._ignoreSelect=!1,a.select(),this._ignoreSelect=!0))},_setDOMFullSelection:function(a,
b,c,d,e,f){if(this._selDiv1&&(c=this._selDiv1,c.style.width="0px",c.style.height="0px",c=this._selDiv2,c.style.width="0px",c.style.height="0px",c=this._selDiv3,c.style.width="0px",c.style.height="0px",!(a===d&&b===e))){var h=this._model,g=this._getViewPadding(),k=this._clientDiv.getBoundingClientRect(),l=this._viewDiv.getBoundingClientRect();c=l.left+g.left;f=k.right;var g=l.top+g.top,n=k.bottom,l=k=0;this._clipDiv?(l=this._clipDiv.getBoundingClientRect(),k=l.left-this._clipDiv.scrollLeft):(l=this._rootDiv.getBoundingClientRect(),
k=l.left);l=l.top;this._ignoreDOMSelection=!0;a=(new z(this,a.lineIndex,a)).getBoundingClientRect(h.getLineStart(a.lineIndex)+b,!1);var p=a.left;e=(new z(this,d.lineIndex,d)).getBoundingClientRect(h.getLineStart(d.lineIndex)+e,!1);b=e.left;this._ignoreDOMSelection=!1;var h=this._selDiv1,p=Math.min(f,Math.max(c,p)),q=Math.min(n,Math.max(g,a.top)),r=f;d=Math.min(n,Math.max(g,a.bottom));h.style.left=p-k+"px";h.style.top=q-l+"px";h.style.width=Math.max(0,r-p)+"px";h.style.height=Math.max(0,d-q)+"px";
a.top===e.top?(r=Math.min(b,f),h.style.width=Math.max(0,r-p)+"px"):(a=Math.min(n,Math.max(g,e.top)),b=Math.min(f,Math.max(c,b)),g=Math.min(n,Math.max(g,e.bottom)),n=this._selDiv3,n.style.left=c-k+"px",n.style.top=a-l+"px",n.style.width=Math.max(0,b-c)+"px",n.style.height=Math.max(0,g-a)+"px",0<a-d&&(g=this._selDiv2,g.style.left=c-k+"px",g.style.top=d-l+"px",g.style.width=Math.max(0,f-c)+"px",g.style.height=Math.max(0,a-d)+"px"))}},_setGrab:function(a){a!==this._grabControl&&(a?(a.setCapture&&a.setCapture(),
this._grabControl=a):(this._grabControl.releaseCapture&&this._grabControl.releaseCapture(),this._grabControl=null))},_setLinksVisible:function(a){if(this._linksVisible!==a){this._linksVisible=a;l.isIE&&a&&(this._hadFocus=this._hasFocus);var b=this._clientDiv;b.contentEditable=!a;this._hadFocus&&!a&&b.focus();this._overlayDiv&&(this._overlayDiv.style.zIndex=a?"-1":"1");for(a=this._getLineNext();a;){if(a.hasLink)for(b=a.firstChild;b;){var c=b.nextSibling,d=b.viewStyle;d&&"A"===d.tagName&&a.replaceChild(a._line._createSpan(a,
b.firstChild.data,d),b);b=c}a=this._getLineNext(a)}}},_setSelection:function(a,b,c,d){if(a){this._columnX=-1;void 0===c&&(c=!0);var e=this._selection;this._selection=a;b&&this._showCaret(!1,d);c&&this._updateDOMSelection();if(!e.equals(a))this.onSelection({type:"Selection",oldValue:{start:e.start,end:e.end},newValue:{start:a.start,end:a.end}})}},_setSelectionTo:function(a,b,c,d){var e=this._model,f=this._getSelection();b=this.convert({x:a,y:b},"page","document");a=this._getLineIndex(b.y);if(1===this._clickCount){e=
this._getLine(a);a=e.getOffset(b.x,b.y-this._getLinePixel(a));e.destroy();if(d&&!c&&f.start<=a&&a<f.end)return this._dragOffset=a,!1;f.extend(a);c||f.collapse()}else 0===(this._clickCount&1)?(e=this._getLine(a),a=e.getOffset(b.x,b.y-this._getLinePixel(a)),this._doubleClickSelection?a>=this._doubleClickSelection.start?(c=this._doubleClickSelection.start,d=e.getNextOffset(a,"wordend",1)):(c=e.getNextOffset(a,"word",-1),d=this._doubleClickSelection.end):(c=e.getNextOffset(a,"word",-1),d=e.getNextOffset(c,
"wordend",1)),e.destroy()):this._doubleClickSelection?(d=e.getLineAtOffset(this._doubleClickSelection.start),a>=d?(c=e.getLineStart(d),d=e.getLineEnd(a)):(c=e.getLineStart(a),d=e.getLineEnd(d))):(c=e.getLineStart(a),d=e.getLineEnd(a)),f.setCaret(c),f.extend(d);this._setSelection(f,!0,!0);return!0},_setFullSelection:function(a,b){this._fullSelection=a;l.isWebkit&&(this._fullSelection=!0);var c=this._clipDiv||this._rootDiv;if(c)if(this._fullSelection){if(!this._selDiv1&&this._fullSelection&&!l.isIOS){var d=
c.ownerDocument;this._highlightRGB=l.isWebkit?"transparent":"Highlight";var e=l.createElement(d,"div");this._selDiv1=e;e.style.position="absolute";e.style.borderWidth="0px";e.style.margin="0px";e.style.padding="0px";e.style.outline="none";e.style.background=this._highlightRGB;e.style.width="0px";e.style.height="0px";e.style.zIndex="0";c.appendChild(e);var f=l.createElement(d,"div");this._selDiv2=f;f.style.position="absolute";f.style.borderWidth="0px";f.style.margin="0px";f.style.padding="0px";f.style.outline=
"none";f.style.background=this._highlightRGB;f.style.width="0px";f.style.height="0px";f.style.zIndex="0";c.appendChild(f);this._selDiv3=d=l.createElement(d,"div");d.style.position="absolute";d.style.borderWidth="0px";d.style.margin="0px";d.style.padding="0px";d.style.outline="none";d.style.background=this._highlightRGB;d.style.width="0px";d.style.height="0px";d.style.zIndex="0";c.appendChild(d);if(l.isFirefox&&l.isMac){c=this._getWindow().getComputedStyle(d,null).getPropertyValue("background-color");
switch(c){case "rgb(119, 141, 168)":c="rgb(199, 208, 218)";break;case "rgb(127, 127, 127)":c="rgb(198, 198, 198)";break;case "rgb(255, 193, 31)":c="rgb(250, 236, 115)";break;case "rgb(243, 70, 72)":c="rgb(255, 176, 139)";break;case "rgb(255, 138, 34)":c="rgb(255, 209, 129)";break;case "rgb(102, 197, 71)":c="rgb(194, 249, 144)";break;case "rgb(140, 78, 184)":c="rgb(232, 184, 255)";break;default:c="rgb(180, 213, 255)"}this._highlightRGB=c;e.style.background=c;f.style.background=c;d.style.background=
c}b||this._updateDOMSelection()}}else this._selDiv1&&(c.removeChild(this._selDiv1),this._selDiv1=null),this._selDiv2&&(c.removeChild(this._selDiv2),this._selDiv2=null),this._selDiv3&&(c.removeChild(this._selDiv3),this._selDiv3=null)},_setReadOnly:function(a){this._readonly=a;this._clientDiv.setAttribute("aria-readonly",a?"true":"false")},_setTabSize:function(a,b){this._tabSize=a;this._customTabSize=void 0;var c=this._clientDiv;l.isOpera?c&&(c.style.OTabSize=this._tabSize+""):537.1<=l.isWebkit?c&&
(c.style.tabSize=this._tabSize+""):4<=l.isFirefox?c&&(c.style.MozTabSize=this._tabSize+""):8!==this._tabSize&&(this._customTabSize=this._tabSize);b||(this.redrawLines(),this._resetLineWidth())},_setThemeClass:function(a,b){this._themeClass=a;var c="textviewContainer";this._themeClass&&(c+=" "+this._themeClass);this._rootDiv.className=c;this._updateStyle(b)},_setWrapMode:function(a,b){this._wrapMode=a;var c=this._clientDiv,d=this._viewDiv;a?(c.style.whiteSpace="pre-wrap",c.style.wordWrap="break-word",
d.style.overflowX="hidden",d.style.overflowY="scroll"):(c.style.whiteSpace="pre",c.style.wordWrap="normal",d.style.overflowX="auto",d.style.overflowY="auto");b||(this.redraw(),this._resetLineWidth());this._resetLineHeight()},_showCaret:function(a,b){if(this._clientDiv){var c=this._model,d=this._getSelection(),e=this._getScroll(),f=d.getCaret(),h=d.start,g=d.end,k=c.getLineAtOffset(g),l=Math.max(Math.max(h,c.getLineStart(k)),g-1),c=this._getClientWidth(),k=this._getClientHeight(),n=c/4,p=this._getBoundsAtOffset(f===
h?h:l),q=p.left,r=p.right,s=p.top,t=p.bottom;a&&!d.isEmpty()&&(p=this._getBoundsAtOffset(f===g?h:l),p.top===s?f===h?r=q+Math.min(p.right-q,c):q=r-Math.min(r-p.left,c):f===h?t=s+Math.min(p.bottom-s,k):s=t-Math.min(t-p.top,k));d=0;q<e.x&&(d=Math.min(q-e.x,-n));r>e.x+c&&(d=Math.max(r-e.x-c,n));f=0;s<e.y?f=s-e.y:t>e.y+k&&(f=t-e.y-k);b&&(0<b?0<f&&(f=Math.max(f,b)):0>f&&(f=Math.min(f,b)));return 0!==d||0!==f?(this._scrollView(d,f),k!==this._getClientHeight()||c!==this._getClientWidth()?this._showCaret():
this._ensureCaretVisible=!0,!0):!1}},_startIME:function(){if(-1===this._imeOffset){var a=this._getSelection();a.isEmpty()||this._modifyContent({text:"",start:a.start,end:a.end},!0);this._imeOffset=a.start}},_unhookEvents:function(){this._model.removeEventListener("preChanging",this._modelListener.onChanging);this._model.removeEventListener("postChanged",this._modelListener.onChanged);this._modelListener=null;for(var a=0;a<this._handlers.length;a++){var b=this._handlers[a],c=b.target,d=b.type,b=b.handler;
"function"===typeof c.removeEventListener?c.removeEventListener(d,b,!1):c.detachEvent("on"+d,b)}this._handlers=null;this._mutationObserver&&(this._mutationObserver.disconnect(),this._mutationObserver=null)},_updateDOMSelection:function(){if(!this._ignoreDOMSelection&&this._clientDiv){var a=this._getSelection(),b=this._model,c=b.getLineAtOffset(a.start),d=b.getLineAtOffset(a.end),e=this._getLineNext();if(e){var f=this._getLinePrevious(),h;c<e.lineIndex?(h=e,c=0):c>f.lineIndex?(h=f,c=0):(h=this._getLineNode(c),
c=a.start-b.getLineStart(c));d<e.lineIndex?a=0:d>f.lineIndex?(e=f,a=0):(e=this._getLineNode(d),a=a.end-b.getLineStart(d));this._setDOMSelection(h,c,e,a)}}},_update:function(a){if(!(0<this._redrawCount)){this._updateTimer&&(this._getWindow().clearTimeout(this._updateTimer),this._updateTimer=null,a=!1);var b=this._clientDiv;if(b){this._metrics.invalid&&(this._ignoreQueueUpdate=!0,this._updateStyle(),this._ignoreQueueUpdate=!1);var c=this._model,d=this._getScroll(),e=this._getViewPadding(),f=c.getLineCount(),
h=this._getLineHeight(),g=this._getClientWidth();this._wrapMode&&(b.style.width=g+"px");var k,m,n,p,q=0,r=0;if(this._lineHeight){for(;r<f;){n=this._getLineHeight(r);if(q+n>d.y)break;q+=n;r++}k=r;m=Math.max(0,k-1);n=c=d.y-q;0<k&&(c+=this._getLineHeight(k-1))}else p=Math.max(0,d.y)/h,k=Math.floor(p),m=Math.max(0,k-1),c=Math.round((p-m)*h),n=Math.round((p-k)*h);this._topIndexY=n;p=this._parent;var s=p.clientWidth,t=p.clientHeight;p=this._getClientHeight();if(a){m=0;this._leftDiv&&(k=this._leftDiv.getBoundingClientRect(),
m=k.right-k.left);k=g;for(this._wrapMode||(k=Math.max(this._maxLineWidth,k));r<f;)n=this._getLineHeight(r,!1),q+=n,r++;f=q}else{for(var g=this._viewDiv,d=Math.min(k+Math.floor((p+n)/h),f-1),u=Math.min(d+1,f-1),h=b.firstChild;h;){n=h.lineIndex;var v=h.nextSibling;if(!(m<=n&&n<=u)||h.lineRemoved||-1===h.lineIndex)this._mouseWheelLine===h?(h.style.display="none",h.lineIndex=-1):b.removeChild(h);h=v}var h=this._getLineNext(),v=g.ownerDocument,w=v.createDocumentFragment();for(n=m;n<=u;n++)!h||h.lineIndex>
n?(new z(this,n)).create(w,null):(w.firstChild&&(b.insertBefore(w,h),w=v.createDocumentFragment()),h&&h.lineChanged&&(h=(new z(this,n)).create(w,h),h.lineChanged=!1),h=this._getLineNext(h));w.firstChild&&b.insertBefore(w,h);l.isWebkit&&!this._wrapMode&&(b.style.width="0x7fffffffpx");h=this._getLineNext();n=p+c;for(v=!1;h;)m=h.lineWidth,void 0===m&&(u=h._line.getBoundingClientRect(),m=h.lineWidth=Math.ceil(u.right-u.left),this._lineHeight&&(this._lineHeight[h.lineIndex]=Math.ceil(u.bottom-u.top))),
this._lineHeight&&!v&&(n-=this._lineHeight[h.lineIndex],0>n&&(d=h.lineIndex,v=!0)),this._wrapMode||(m>=this._maxLineWidth&&(this._maxLineWidth=m,this._maxLineIndex=h.lineIndex),this._checkMaxLineIndex===h.lineIndex&&(this._checkMaxLineIndex=-1)),h.lineIndex===k&&(this._topChild=h),h.lineIndex===d&&(this._bottomChild=h),h=this._getLineNext(h);-1!==this._checkMaxLineIndex&&(n=this._checkMaxLineIndex,this._checkMaxLineIndex=-1,0<=n&&n<f&&(h=new z(this,n),u=h.getBoundingClientRect(),m=u.right-u.left,
m>=this._maxLineWidth&&(this._maxLineWidth=m,this._maxLineIndex=n),h.destroy()));for(;r<f;)n=this._getLineHeight(r,r<=d),q+=n,r++;f=q;this._updateRuler(this._leftDiv,k,d);this._updateRuler(this._rightDiv,k,d);m=0;this._leftDiv&&(k=this._leftDiv.getBoundingClientRect(),m=k.right-k.left);d=0;this._rightDiv&&(d=this._rightDiv.getBoundingClientRect(),d=d.right-d.left);g.style.left=m+"px";g.style.right=d+"px";d=this._scrollDiv;d.style.height=f+"px";q=g=this._getClientWidth();this._wrapMode||(q=Math.max(this._maxLineWidth,
q));k=q;if((!l.isIE||9<=l.isIE)&&this._maxLineWidth>g)q+=e.right+e.left;d.style.width=q+"px";this._clipScrollDiv&&(this._clipScrollDiv.style.width=q+"px");d=this._getScroll();q=p+e.top+e.bottom;this._updateRulerSize(this._leftDiv,q);this._updateRulerSize(this._rightDiv,q)}this._vScrollDiv&&(q=p-8,r=Math.max(15,Math.ceil(Math.min(1,q/(f+e.top+e.bottom))*q)),this._vScrollDiv.style.left=m+g-8+"px",this._vScrollDiv.style.top=Math.floor(Math.max(0,d.y*q/f))+"px",this._vScrollDiv.style.height=r+"px");!this._wrapMode&&
this._hScrollDiv&&(q=g-8,r=Math.max(15,Math.ceil(Math.min(1,q/(this._maxLineWidth+e.left+e.right))*q)),this._hScrollDiv.style.left=m+Math.floor(Math.max(0,Math.floor(d.x*q/this._maxLineWidth)))+"px",this._hScrollDiv.style.top=p-9+"px",this._hScrollDiv.style.width=r+"px");u=d.x;n=this._clipDiv;q=this._overlayDiv;n?(n.scrollLeft=u,r=m+e.left,h=e.top,a=g,m=p,u=0,v=-c,0===d.x&&(r-=e.left,a+=e.left,u=e.left),d.x+g===k&&(a+=e.right),0===d.y&&(h-=e.top,m+=e.top,v+=e.top),d.y+p===f&&(m+=e.bottom),n.style.left=
r+"px",n.style.top=h+"px",e=this._isOverOverlayScroll(),n.style.right=s-a-r+(this._overlayScrollTimer&&e.vertical?15:0)+"px",n.style.bottom=t-m-h+(this._overlayScrollTimer&&e.horizontal?15:0)+"px",b.style.left=u+"px",b.style.top=v+"px",b.style.width=k+"px",b.style.height=p+c+"px",q&&(q.style.left=b.style.left,q.style.top=b.style.top,q.style.width=b.style.width,q.style.height=b.style.height)):(r=u,h=c,s=u+g,t=c+p,0===r&&(r-=e.left),0===h&&(h-=e.top),s===k&&(s+=e.right),d.y+p===f&&(t+=e.bottom),b.style.clip=
"rect("+h+"px,"+s+"px,"+t+"px,"+r+"px)",b.style.left=-u+m+e.left+"px",b.style.width=(l.isWebkit?k:g+u)+"px",a||(b.style.top=-c+e.top+"px",b.style.height=p+c+"px"),q&&(q.style.clip=b.style.clip,q.style.left=b.style.left,q.style.width=b.style.width,a||(q.style.top=b.style.top,q.style.height=b.style.height)));this._updateDOMSelection();b=this._ensureCaretVisible;this._ensureCaretVisible=!1;p!==this._getClientHeight()&&(this._update(),b&&this._showCaret())}}},_updateRulerSize:function(a,b){if(a){for(var c=
this._topIndexY,d=this._getLineHeight(),e=a.firstChild.rows[0].cells,f=0;f<e.length;f++){var h=e[f].firstChild,g=d;"page"===h._ruler.getOverview()&&(g+=c);h.style.top=-g+"px";h.style.height=b+g+"px"}a.style.height=b+"px"}},_updateRuler:function(a,b,c){if(a){a=a.firstChild.rows[0].cells;for(var d=this._parent.ownerDocument,e=this._getLineHeight(),f=this._getViewPadding(),h=0;h<a.length;h++){var g=a[h].firstChild,k=g._ruler;g.rulerChanged&&A(k.getRulerStyle(),g);var m,n=g.firstChild;n?(m=n,n=n.nextSibling):
(m=l.createElement(d,"div"),m.style.visibility="hidden",g.appendChild(m));var p,q;if(g.rulerChanged&&m){p=-1;if(q=k.getWidestAnnotation())A(q.style,m),q.html&&(m.innerHTML=q.html);m.lineIndex=p;m.style.height=e+f.top+"px"}var r,s;if("page"===k.getOverview()){for(k=k.getAnnotations(b,c+1);n;)p=n.lineIndex,q=n.nextSibling,(!(b<=p&&p<=c)||n.lineChanged)&&g.removeChild(n),n=q;n=g.firstChild.nextSibling;s=d.createDocumentFragment();for(p=b;p<=c;p++)if(!n||n.lineIndex>p){r=l.createElement(d,"div");if(q=
k[p])A(q.style,r),q.html&&(r.innerHTML=q.html),r.annotation=q;r.lineIndex=p;r.style.height=this._getLineHeight(p)+"px";s.appendChild(r)}else s.firstChild&&(g.insertBefore(s,n),s=d.createDocumentFragment()),n&&(n=n.nextSibling);s.firstChild&&g.insertBefore(s,n)}else{q=this._getClientHeight();p=this._model.getLineCount();n=q+f.top+f.bottom-2*this._metrics.scrollWidth;m=e*p<n?e:n/p;if(g.rulerChanged){for(q=g.childNodes.length;1<q;)g.removeChild(g.lastChild),q--;k=k.getAnnotations(0,p);s=d.createDocumentFragment();
for(var t in k)p=t>>>0,0>p||(r=l.createElement(d,"div"),q=k[t],A(q.style,r),r.style.position="absolute",r.style.top=this._metrics.scrollWidth+e+Math.floor(p*m)+"px",q.html&&(r.innerHTML=q.html),r.annotation=q,r.lineIndex=p,s.appendChild(r));g.appendChild(s)}else if(g._oldTrackHeight!==n)for(r=g.firstChild?g.firstChild.nextSibling:null;r;)r.style.top=this._metrics.scrollWidth+e+Math.floor(r.lineIndex*m)+"px",r=r.nextSibling;g._oldTrackHeight=n}g.rulerChanged=!1}}},_updateStyle:function(a){!a&&l.isIE&&
(this._rootDiv.style.lineHeight="normal");var b=this._metrics=this._calculateMetrics();this._rootDiv.style.lineHeight=l.isIE?b.lineHeight-(b.lineTrim.top+b.lineTrim.bottom)+"px":"normal";a||(this.redraw(),this._resetLineWidth())}};K.EventTarget.addMixin(G.prototype);return{TextView:G}});
//# sourceMappingURL=textView.js.map