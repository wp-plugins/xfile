//>>built
define("davinci/ve/input/SmartInput","dojo/_base/declare dojo/dom-geometry davinci/ve/commands/ModifyRichTextCommand dijit/layout/ContentPane dijit/form/SimpleTextarea dijit/form/TextBox dojox/html/entities dojox/html/ellipsis dojox/layout/ResizeHandle dojo/i18n!davinci/ve/nls/ve dojo/i18n!dijit/nls/common".split(" "),function(n,p,q,r,s,t,k,u,v,l,m){return n("davinci.ve.input.SmartInput",null,{property:null,_X_MOVE_RANGE:10,_Y_MOVE_RANGE:10,_POINTER_TOP_OFFSET:-13,multiLine:"false",displayOnCreate:"true",
_connection:[],getHelpText:function(){return this.helpText?this.helpText:this.isHtmlSupported()?l.smartInputHelp1:l.smartInputHelp2},isHtmlSupported:function(){this.supportsHTML||("html"==this._widget.type.match("^html")?this.supportsHTML="true":this.supportsHTML="false");return"boolean"===typeof this.supportsHTML?this.supportsHTML:"true"===this.supportsHTML},parse:function(a){return a},parseItems:function(a){this.trim&&(a=dojo.trim(a));return a.match(/[^\\][\r\n]/)?this.parseItemsInRows(a):this.parseItemsInColumns(a)},
parseItemsInRows:function(a){a=this.splitRows(a);for(var b=a.length,d=0;d<b;d++){var c=a[d],c=this.parseItem(c);a[d]=c}return a},parseItemsInColumns:function(a){a=this.splitColumns(a);for(var b=a.length,d=0;d<b;d++){var c=a[d],c=this.parseItem(c);a[d]=c}return a},parseGrid:function(a){a=this.splitRows(a);for(var b=a.length,d=0;d<b;d++){var c=this.parseItemsInColumns(a[d]);a[d]=c}return a},parseItem:function(a){var b=null,d=a,c=a.match(/^([-~!>|(*)[+\]]*) ?(.*)$/);c&&(b=c[1],d=c[2]);var c=0,e=!1,f=
!1;if(b)for(var g=0;g<b.length;g++)switch(b[g]){case "-":case "~":case "!":e=!0;break;case "\x3e":c++;break;case "*":case "+":f=!0}return{original:a,specialChars:b,text:d,indent:c,disabled:e,selected:f}},splitRows:function(a){var b=[],d,c="",e=!1;for(d=0;d<a.length;d++){var f=a.charAt(d);switch(f){case "\\":e&&(c+=f);e=!e;break;case "r":e?(c+="\r",e=!1):c+=f;break;case "n":e?(c+="\n",e=!1):c+=f;break;case "\r":case "\n":e?(c+=f,e=!1):(this.trim&&(c=dojo.trim(c)),b.push(c),c="");break;default:c+=f,
e=!1}}c&&(this.trim&&(c=dojo.trim(c)),b.push(c));return b},splitColumns:function(a){var b=[],d,c="",e=!1;for(d=0;d<a.length;d++){var f=a.charAt(d);switch(f){case "\\":e&&(c+=f);e=!e;break;case "r":e?(c+="\r",e=!1):c+=f;break;case "n":e?(c+="\n",e=!1):c+=f;break;case ",":e?(c+=f,e=!1):(this.trim&&(c=dojo.trim(c)),b.push(c),c="");break;default:c+=f,e=!1}}c&&(this.trim&&(c=dojo.trim(c)),b.push(c));return b},serializeItems:function(a){return"columns"==this.format?this.serializeColumns(a):this.serializeRows(a)},
serializeColumns:function(a){for(var b=0;b<a.length;b++){var d=a[b],d=d.replace(/\\/g,"\\\\");a[b]=d.replace(/,/g,"\\,")}return a.join(", ")},serializeRows:function(a){for(var b=0;b<a.length;b++){var d=a[b],d=d.replace(/\\/g,"\\\\");a[b]=d.replace(/\n/g,"\\\n")}return a.join("\n")},inlineEditActive:function(){return!(!this._inline||!("none"!=this._inline.style.display&&this._inline.eb))},show:function(a){this._widget=davinci.ve.widget.byId(a);this._inline||this._createInline();a=dojo.hitch(this,function(a){this._inline.style.display=
"block";this.setFormat(a);a=k.decode(a,[["\x26","amp"],['"',"quot"],["\x3c","lt"],["\x3e","gt"]]);this._inline.eb.set("value",String(a));this.updateFormats();this.help(!1);dijit.selectInputText(this._inline.eb.textbox);this.updateSimStyle();this._inline.eb.textbox.focus()});var b=this._node(this._widget),d=this.property,c="maq_innerText"===d?"innerHTML":d,e;d&&(b?e=dojo.attr(b,c):"innerHTML"===c||"textContent"==c?(e=this._widget._srcElement.getElementText(this._context),e=e.replace(/\s+/g," ")):e=
this._widget.attr(d));this.serialize?this.serialize(b||this._widget,a,e):d&&a(e)},_createInline:function(){if(this.multiLine&&"false"!=this.multiLine){this._loading(115,200);var a=this._getTemplate()}else this._loading(85,200),a=this._getTemplate();this._inline.set("content",a);this._inline.eb=dijit.byId("davinciIleb");this._connection.push(dojo.connect(this._inline.eb,"onMouseDown",this,"stopEvent"));this._connection.push(dojo.connect(this._inline.eb,"onKeyDown",this,"stopEvent_Intercept_Enter"));
this._connection.push(dojo.connect(this._inline.eb,"onKeyUp",this,"handleEvent"));"true"==this.multiLine&&(this._connection.push(dojo.connect(this._inline.eb,"onBlur",this,"onBlur")),this._connectSimDiv());a=this._widget._srcElement.getElementText(this._context);this._inline.eb.setValue(a);this._loadingDiv.style.backgroundImage="none";this._inline._setStyleAttr({display:"block"});this._connectHelpDiv();this._connectResizeHandle();window.setTimeout(function(){this._inline&&(this._inline.eb&&this._inline.eb.textbox)&&
this._inline.eb.textbox.focus();this._connection.push(dojo.connect(this._inline,"onBlur",this,"onOk"))}.bind(this),500);this.resize(null)},_connectHelpDiv:function(){var a=dojo.byId("davinci.ve.input.SmartInput_img_help");this._connection.push(dojo.connect(a,"onclick",this,"toggleHelp"));this._connection.push(dojo.connect(dijit.byId("davinci.ve.input.SmartInput_ok"),"_onSubmit",this,"onOk"));this._connection.push(dojo.connect(dijit.byId("davinci.ve.input.SmartInput_cancel"),"onClick",this,"onCancel"))},
_findSmartInputContainer:function(a){return document.body},_loading:function(a,b){var d=this._widget._edit_context.frameNode,c=d.ownerDocument,e=c.createElement("div"),f=this._findSmartInputContainer(d);if(f){f.appendChild(e);this._loadingDiv=e;dojo.addClass(e,"smartInputLoading");e=c.createElement("div");e.id="ieb";dojo.addClass(e,"inlineEdit dijitTooltipContainer");c=c.createElement("div");c.id="iebPointer";this._inline=e;f.appendChild(e);f.appendChild(c);var g=new dojo.dnd.Moveable("ieb");this._connection.push(dojo.connect(g,
"onMoveStart",this,"onMoveStart"));this._connection.push(dojo.connect(g,"onMoveStop",this,"onMoveStop"));this._inline=new r({},e);e=dijit.byId("editorsStackContainer").domNode;e=p.position(e);this._loadingDiv.style.position="absolute";this._loadingDiv.style.left=e.x+"px";this._loadingDiv.style.top=e.y+"px";this._loadingDiv.style.width=e.w+"px";this._loadingDiv.style.height=e.h+"px";var e=this._widget.getMarginBox(),g=dojo.position(d),h=dojo.position(f),d=g.x-h.x+f.scrollLeft-1,g=g.y-h.y+f.scrollTop-
1,k=f.clientWidth,h=26,l=0;e.y+a+26<f.clientHeight?(h=e.y+26,dojo.addClass(c,"inlineEditConnectorBelow")):0<e.y-a?(h=e.y-a,l=a+12):h=26;f="0";e.x+b+20<k?f=e.x:e.x+b>k&&(f=e.x-b+e.w,0>f&&(f=0));f+=d;h+=g;this._inline._setStyleAttr({display:"block",top:h+"px",left:f+"px",padding:"1px",overflow:"hidden",backgroundImage:"none"});this._startTop=h;this._startLeft=f;dojo.style(c,"left",e.x+20+d+"px");dojo.style(c,"top",h+l+this._POINTER_TOP_OFFSET+"px")}},handleEvent:function(a){switch(a.keyCode){case 13:var b=
this.multiLine;if(!b||"false"==b||13==this._lastKeyCode||a.ctrlKey)this.onOk();else if(a.which==dojo.keys.ENTER&&a.ctrlKey)this.onOk();break;case 27:this.onCancel();break;default:this.updateFormats()}this._lastKeyCode=a.keyCode;this.updateSimStyle()},onOk:function(a){this.hide()},onCancel:function(a){this.hide(!0)},onMoveStart:function(a){dojo.style("iebPointer","display","none")},onMoveStop:function(a){var b=dojo.style("ieb","left");a=dojo.style("ieb","top");b=this._startLeft-b;a-=this._startTop;
a<this._Y_MOVE_RANGE&&a>-this._Y_MOVE_RANGE?(dojo.style("iebPointer","display",""),dojo.style("iebPointer","top",this._startTop+this._POINTER_TOP_OFFSET+a+"px"),b<this._X_MOVE_RANGE&&b>-this._X_MOVE_RANGE?dojo.style("iebPointer","display",""):dojo.style("iebPointer","display","none")):dojo.style("iebPointer","display","none")},stopEvent:function(a){a.stopPropagation();this.updateSimStyle()},stopEvent_Intercept_Enter:function(a){this.stopEvent(a);13==a.keyCode&&!this.multiLine&&a.preventDefault()},
_node:function(){var a,b=this.path,d=this.selector;if(b||d)a=this._widget.domNode,b&&(a=dojo.getObject(b,!1,this._widget)),d&&(a=dojo.query(d,a)[0]);return a},updateWidget:function(a){if(!this._widget._destroyed){this.parse&&(a=this.parse(a));var b=this._node(this._widget),d=this._widget.getContext(),c=this.property,e="maq_innerText"===c?"innerHTML":c;if(this.update){if(a=this.update(b||this._widget,a,c))this._widget=a;d.select(this._widget,null,!1)}else if(c){if(b)dojo.attr(b,e,a);else{b={};a&&"string"==
typeof a&&(a=a.replace(/\n/g,""));var f=null;"textContent"==c?f=a:b[c]=a;"innerHTML"===e?(b.richText=b[c],delete b[c],a=new q(this._widget,b,null,d)):a=new davinci.ve.commands.ModifyCommand(this._widget,b,f,d);this._widget._edit_context.getCommandStack().execute(a);this._widget=a.newWidget;this._widget._edit_context._focuses[0]._selectedWidget=this._widget}d.select(this._widget,null,!1)}}},hide:function(a){if(this._inline){for(var b;connection=this._connection.pop();)connection&&dojo.disconnect(connection);
var d=this._findSmartInputContainer(this._widget._edit_context.frameNode);if(d&&(this._loadingDiv&&d.removeChild(this._loadingDiv),"none"!=this._inline.style.display&&this._inline.eb)){this._value=b=this._inline.eb.get("value");this._format=this.getFormat();this._inline.style.display="none";this._inline.eb&&(this._inline.eb.destroyRecursive(),delete this._inline.eb);this._inline.destroyRecursive();delete this._inline;var c=d.ownerDocument.getElementById("iebPointer");d.removeChild(c);null!=b&&!a&&
(!this.disableEncode&&"text"===this._format&&(b=k.encode(b)),this.updateWidget(b));this._widget.getContext().getDocument().defaultView.focus()}}},getFormat:function(){var a=dijit.byId("davinci.ve.input.SmartInput_radio_html"),b="text";a&&a.checked&&(b="html");return b},containsHtmlMarkUp:function(a){return 0<dojo.create("div",{innerHTML:a}).children.length},toggleHelp:function(){var a=dojo.byId("davinci.ve.input.SmartInput_img_help");dojo.hasClass(a,"inlineEditHelpSelected")?this.help(!1):this.help(!0);
dojo.toggleClass(a,"inlineEditHelpSelected")},setFormat:function(a){var b=dijit.byId("davinci.ve.input.SmartInput_radio_html"),d=dijit.byId("davinci.ve.input.SmartInput_radio_text");a=dojo.create("div",{innerHTML:a}).children.length?"html":"text";"html"===a?(b.set("checked",!0),d.set("checked",!1)):(b.set("checked",!1),d.set("checked",!0));this._format=a},help:function(a){var b=dojo.byId("davinci.ve.input.SmartInput_div_help");dojo.byId("davinci.ve.input.SmartInput_radio_div");a?dojo.style(b,"display",
""):dojo.style(b,"display","none")},updateFormats:function(){var a=this._inline.eb.get("value"),b=!0;this.containsHtmlMarkUp(a)&&(b=!1);this._widget.getContext().getDojo();var d=dojo.byId("davinci.ve.input.SmartInput_radio_text_width_div"),a=k.encode(a);d.innerHTML='\x3cdiv class\x3d"dojoxEllipsis"\x3e'+dojo.replace("Plain text ({0})",[a])+"\x3c/div\x3e";a=dojo.byId("davinci.ve.input.SmartInput_radio_html_width_div");a.innerHTML='\x3cdiv id\x3d"davinci.ve.input.SmartInput_radio_html_div" class\x3d"dojoxEllipsis"\x3e'+
l.htmlMarkup+"\x3c/div\x3e";var c=dijit.byId("davinci.ve.input.SmartInput_radio_html"),e=dijit.byId("davinci.ve.input.SmartInput_radio_text"),f=dojo.byId("davinci.ve.input.SmartInput_table");c.setDisabled(b);e.setDisabled(b);b?(dojo.addClass(d,"inlineEditDisabled"),dojo.addClass(a,"inlineEditDisabled"),c.set("checked",!1),e.set("checked",!0)):(dojo.removeClass(d,"inlineEditDisabled"),dojo.removeClass(a,"inlineEditDisabled"));!b&&this.isHtmlSupported()?(dojo.style(e.domNode,"display",""),dojo.style(c.domNode,
"display",""),dojo.style(a,"display",""),dojo.style(d,"display",""),dojo.style(f,"display","")):(dojo.style(e.domNode,"display","none"),dojo.style(c.domNode,"display","none"),dojo.style(a,"display","none"),dojo.style(d,"display","none"),dojo.style(f,"display","none"))},resize:function(a){a=dojo.byId("iedResizeDiv");var b=dijit.byId("davinciIleb"),d=a.clientWidth-5,c=a.clientHeight-6,e=a.clientWidth-10,d=a.clientWidth-8,c=a.clientHeight-20,e=a.clientWidth-9,f=dojo.byId("smartInputSim");dojo.style(f,
"width",d+10+"px");this.updateSimStyle();b&&(b._setStyleAttr({width:d+"px",height:c+"px",maxHeight:c+"px"}),b._setStyleAttr({width:a.clientWidth+"px"}));b=dojo.byId("davinci.ve.input.SmartInput_radio_div");dojo.style(b,"width",e+2+"px");b=dojo.byId("davinci.ve.input.SmartInput_radio_text_width_div");dojo.style(b,"width",a.clientWidth-50+"px");b=dojo.byId("davinci.ve.input.SmartInput_radio_html_width_div");dojo.style(b,"width",a.clientWidth-50+"px")},onBlur:function(a){this.updateSimStyle(a)},updateSimStyle:function(a){var b=
dijit.byId("davinciIleb");if(a=dojo.byId("smartInputSim"))b=dojo.style(b.domNode),dojo.style(a,"borderColor",b.borderTopColor),dojo.style(a,"backgroundColor",b.backgroundColor)},_getTemplate:function(){var a='\x3cdiv id\x3d"iedResizeDiv" class\x3d"iedResizeDiv" \x3e\x3ctextarea  dojoType\x3d"dijit.form.SimpleTextarea" name\x3d"davinciIleb" trim\x3d"true" id\x3d"davinciIleb" class\x3d"smartInputTextArea" \x3e\x3c/textarea\x3e\x3cdiv id\x3d"smartInputSim" class\x3d"smartInputSim" \x3e\x3c/div\x3e\x3cdiv id\x3d"iedResizeHandle" dojoType\x3d"dojox.layout.ResizeHandle" targetId\x3d"iedResizeDiv" constrainMin\x3d"true" maxWidth\x3d"200" maxHeight\x3d"600" minWidth\x3d"200" minHeight\x3d"55"  activeResize\x3d"true" intermediateChanges\x3d"true" \x3e\x3c/div\x3e\x3c/div\x3e';
"true"===this.multiLine&&(a='\x3cdiv id\x3d"iedResizeDiv" class\x3d"iedResizeDiv" \x3e\x3ctextarea  dojoType\x3d"dijit.form.SimpleTextarea" name\x3d"davinciIleb" trim\x3d"true" id\x3d"davinciIleb" class\x3d"smartInputTextAreaMulti" \x3e\x3c/textarea\x3e\x3cdiv id\x3d"smartInputSim" class\x3d"smartInputSim" \x3e\x3c/div\x3e\x3cdiv id\x3d"iedResizeHandle" dojoType\x3d"dojox.layout.ResizeHandle" targetId\x3d"iedResizeDiv" constrainMin\x3d"true" maxWidth\x3d"200" maxHeight\x3d"600" minWidth\x3d"200" minHeight\x3d"80"  activeResize\x3d"true" intermediateChanges\x3d"true" \x3e\x3c/div\x3e\x3c/div\x3e');
return""+a+'\x3cdiv  id\x3d"davinci.ve.input.SmartInput_div"  class\x3d"davinciVeInputSmartInputDiv" \x3e\x3cdiv id\x3d"davinci.ve.input.SmartInput_radio_div" class\x3d"smartInputRadioDiv" \x3e\x3ctable id\x3d"davinci.ve.input.SmartInput_table"\x3e \x3ctbody\x3e\x3ctr\x3e \x3ctd class\x3d"smartInputTd1" \x3e \x3cinput id\x3d"davinci.ve.input.SmartInput_radio_text" showlabel\x3d"true" type\x3d"radio" dojoType\x3d"dijit.form.RadioButton" disabled\x3d"false" readOnly\x3d"false" intermediateChanges\x3d"false" checked\x3d"true"\x3e \x3c/input\x3e \x3c/td\x3e \x3ctd class\x3d"smartInputTd2" \x3e\x3cdiv id\x3d"davinci.ve.input.SmartInput_radio_text_width_div" class\x3d"smartInputRadioTextDiv"\x3e\x3c/div\x3e\x3c/td\x3e \x3c/tr\x3e\x3ctr\x3e \x3ctd class\x3d"smartInputTd1"\x3e \x3cinput id\x3d"davinci.ve.input.SmartInput_radio_html" showlabel\x3d"true" type\x3d"radio" dojoType\x3d"dijit.form.RadioButton"\x3e \x3c/input\x3e  \x3c/td\x3e \x3ctd class\x3d"smartInputTd2"\x3e\x3cdiv id\x3d"davinci.ve.input.SmartInput_radio_html_width_div" class\x3d"smartInputRadioTextDiv"\x3e\x3c/div\x3e\x3c/td\x3e \x3c/tr\x3e \x3c/tbody\x3e\x3c/table\x3e \x3cdiv class\x3d"smartInputHelpDiv" \x3e \x3cspan id\x3d"davinci.ve.input.SmartInput_img_help"  title\x3d"Help" class\x3d"inlineEditHelp" \x3e \x3c/span\x3e\x3cspan class\x3d"smartInputSpacerSpan" \x3e\x3cbutton id\x3d"davinci.ve.input.SmartInput_ok"  dojoType\x3d"dijit.form.Button" type\x3d"submit" class\x3d"inlineEditHelpOk" \x3e'+
m.buttonOk+'\x3c/button\x3e \x3cbutton id\x3ddavinci.ve.input.SmartInput_cancel dojoType\x3d"dijit.form.Button" class\x3d"inlineEditHelpCancel"\x3e '+m.buttonCancel+'\x3c/button\x3e  \x3c/span\x3e   \x3c/div\x3e \x3cdiv id\x3d"davinci.ve.input.SmartInput_div_help" style\x3d"display:none;" class\x3d"smartInputHelpTextDiv" \x3e \x3cdiv dojoType\x3d"dijit.layout.ContentPane" class\x3d"smartInputHelpTextDivContentPane "style\x3d"padding:0;" \x3e'+this.getHelpText()+'\x3c/div\x3e \x3cdiv style\x3d"text-align: left; padding:0; height:2px;" \x3e\x3c/div\x3e \x3c/div\x3e \x3c/div\x3e\x3c/div\x3e '},
_connectResizeHandle:function(){var a=dijit.byId("iedResizeHandle");this._connection.push(dojo.connect(a,"onResize",this,"resize"))},_connectSimDiv:function(){this._connection.push(dojo.connect(this._inline.eb,"onFocus",this,"updateSimStyle"));this._connection.push(dojo.connect(this._inline.eb,"onMouseOver",this,"updateSimStyle"));this._connection.push(dojo.connect(this._inline.eb,"onMouseOut",this,"updateSimStyle"));this._connection.push(dojo.connect(dojo.byId(" davinci.ve.input.SmartInput_div"),
"onclick",this,"updateSimStyle"))}})});
//# sourceMappingURL=SmartInput.js.map