//>>built
define("davinci/ui/widgets/OutlineTree","dojo/_base/declare dojo/_base/connect dojo/topic dojo/_base/array dojo/touch dojo/mouse dojo/dnd/Manager dijit/Tree ../../Workbench ../../ve/utils/GeomUtils ./_ToggleTreeNode".split(" "),function(h,f,g,e,k,l,m,n,p,q,r){return h(n,{postCreate:function(){this._handles=[];this.toggledItems={};this.inherited(arguments);this._handles.push(f.connect(this.dndController,"userSelect",this,"_userSelect"));var a=this.dndController.onMouseDown;this.dndController.onMouseDown=
function(b){if(-1==(" "+(b.srcElement||b.target).className+" ").indexOf(" dojoDndContainerOver ")&&!dojo.hasClass(b.target,"dvOutlineToggleNode"))return a.call(this.dndController,b)}.bind(this);this._connect("widgetChanged","_widgetChanged");this.connect(this.domNode,k.press,"_onMouseDown");g.subscribe("/davinci/ve/context/mouseup",this._contextMouseUp.bind(this))},_createTreeNode:function(a){return new r(a)},selectNode:function(a){a=a.map(function(a){return this._createPath(this.model._getWidget(a))},
this);this.set("paths",a)},deselectAll:function(){dojo.forEach(this.selectedItems,dojo.hitch(this,function(a){a=this.model._getWidget(a);a=this.getNodesByItem(a);0<a.length&&a[0].setSelected(!1)}))},toggleNode:function(a,b){var c=this.model._getWidget(a);(c=this.getNodesByItem(c))&&(0<c.length&&c[0])&&c[0]._setToggleAttr(b)},_userSelect:function(){var a=this.selectedItems.map(this.model._getWidget),b=this.context.getSelection();dojo.forEach(b,dojo.hitch(this,function(b){-1==a.indexOf(b)&&this.context.deselect(b)}));
dojo.forEach(a,dojo.hitch(this,function(a){if(-1==b.indexOf(a)&&"myapp"!=a.id){var d=q.getMarginBoxPageCoords(a.domNode);this.context.getGlobal().scroll(d.l,d.t);this.context.select(a,!0)}}))},_widgetChanged:function(a,b){a===this.context.WIDGET_REPARENTED&&this.selectNode(this.context.getSelection())},_createPath:function(a){for(var b=[];a&&"myapp"!=a.id;)b.splice(0,0,a.id),a=a.getParent?a.getParent():null;b.splice(0,0,"myapp");return b},_onItemDelete:function(a){var b=this.model.getIdentity(a),
b=this._itemNodesMap[b],c=this.dndController.getSelectedTreeNodes(),d=[];e.forEach(b,function(a){e.forEach(c,function(b){-1==b.getTreePath().indexOf(a)&&d.push(a.item)},this)},this);this.set("selectedItems",d);e.forEach(b,function(a){e.forEach(a.getDescendants(),function(a){a=a.getIdentity(a.item);delete this._itemNodesMap[a]},this)},this);this.inherited(arguments)},_onMouseDown:function(a){if(!l.isLeft(a)){var b=dijit.getEnclosingWidget(a.target);b&&b.item&&(a.preventDefault(),this.selectNode([b.item]),
this._userSelect())}},_onDblClick:function(a,b){this.inherited(arguments);var c=p.getOpenEditor().getContext();c&&c.select(this.model._getWidget(a.item),null,!0)},_connect:function(a,b){this._handles.push(f.connect(this.context,a,this,b))},destroy:function(){this._handles.forEach(f.disconnect)},_contextMouseUp:function(a){this.dndController.isDragging&&(g.publish("/dnd/cancel"),m.manager().stopDrag())}})});
//# sourceMappingURL=OutlineTree.js.map