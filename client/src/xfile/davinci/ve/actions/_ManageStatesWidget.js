//>>built
require({cache:{"url:davinci/ve/actions/templates/ManageStates.html":"\x3cdiv\x3e\n\t\x3cdiv class\x3d\"dijitDialogPaneContentArea\"\x3e\n\t\t\x3cdiv class\x3d\"addStateDialogOptions\"\x3e\n\t\t\t\x3cdiv class\x3d'manageStatesStatesListDiv'\x3e\n\t\t\t\t\x3c!-- Filled in by JavaScript --\x3e\n\t\t\t\x3c/div\x3e\n\t\t\t\x3cdiv class\x3d'manageStatesCheckAcceleratorsDiv'\x3e\n\t\t\t\t${veNls.manageStatesCheckLabel}\n\t\t\t\t\x3ca href\x3d'' class\x3d'manageStatesCheckCurrentStateOnly'\x3e${veNls.manageStatesCheckCurrentStateOnly}\x3c/a\x3e\n\t\t\t\t/\n\t\t\t\t\x3ca href\x3d'' class\x3d'manageStatesCheckAll'\x3e${veNls.manageStatesCheckAll}\x3c/a\x3e\n\t\t\t\t/\n\t\t\t\t\x3ca href\x3d'' class\x3d'manageStatesUncheckAll'\x3e${veNls.manageStatesUncheckAll}\x3c/a\x3e\n\t\t\t\t/\n\t\t\t\t\x3ca href\x3d'' class\x3d'manageStatesCheckBackgroundOnly'\x3e${veNls.manageStatesCheckBackgroundOnly}\x3c/a\x3e\n\t\t\t\x3c/div\x3e\n\t\t\t\n\t\t\x3c/div\x3e\t\n\t\x3c/div\x3e\n\t\x3cdiv class\x3d\"dijitDialogPaneActionBar\"\x3e\n\t\t\x3cbutton dojoType\x3d'dijit.form.Button' dojoAttachPoint\x3d\"okButton\" dojoAttachEvent\x3d'onClick:onOk' label\x3d'${veNls.createLabel}' class\x3d\"maqPrimaryButton\" type\x3d\"submit\"\x3e\x3c/button\x3e\n\t\t\x3cbutton dojoType\x3d'dijit.form.Button' dojoAttachEvent\x3d'onClick:onCancel' label\x3d'${commonNls.buttonCancel}' class\x3d\"maqSecondaryButton\"\x3e\x3c/button\x3e\n\t\x3c/div\x3e\n\x3c/div\x3e\n"}});
define("davinci/ve/actions/_ManageStatesWidget","dojo/_base/declare dojo/dom-construct dojo/on dojo/dom-style dojo/dom-class dojo/_base/event dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin davinci/Runtime davinci/Workbench davinci/workbench/Preferences davinci/ve/States davinci/commands/CompoundCommand davinci/ve/commands/StyleCommand davinci/actions/Action dojo/i18n!davinci/ve/nls/ve dojo/i18n!dijit/nls/common dojo/text!./templates/ManageStates.html dijit/form/Button".split(" "),
function(r,g,m,z,e,p,s,t,u,h,A,B,l,v,w,C,q,x,y,D){return r("davinci.ve.actions._ManageStatesWidget",[s,t,u],{templateString:y,widgetsInTemplate:!0,anyCheckBoxChanges:!1,_states:[],_stateContainers:[],_checkBoxes:[],_overrideDisplayValue:[],_notes:[],_handlers:[],veNls:q,commonNls:x,constructor:function(){this.handlers=[]},postCreate:function(){if(this._getContext()){var b=this.domNode.querySelector(".manageStatesStatesListDiv");if(b){var a=this._getAllStatesInDoc();this._states=a.states;this._stateContainers=
a.stateContainers;if(a=this.domNode.querySelector(".manageStatesCheckAcceleratorsTable"))a.style.width="100%";if(a=this.domNode.querySelector(".manageStatesCheckCurrentStateOnlyCell"))a.style.textAlign="left";if(a=this.domNode.querySelector(".manageStatesCheckAllCell"))a.style.textAlign="center";if(a=this.domNode.querySelector(".manageStatesUncheckAllCell"))a.style.textAlign="right";for(var k,b=g.create("table",{"class":"manageStatesStatesListTable",style:"width:100%",border:0,cellspacing:0,cellpadding:3},
b),c=0;c<this._states.length;c++)a=g.create("tr",{},b),k=g.create("td",{"class":"manageStatesCheckboxCell"},a),this._checkBoxes[c]=g.create("div",{id:"manageStatesCheckBox_"+c,"class":"manageStatesCheckbox"},k),this._handlers.push(m(this._checkBoxes[c],"click",function(d,b){var a=this._checkBoxes[d];this.anyCheckBoxChanges=!0;e.remove(a,"manageStatesCheckboxNoneVisible");e.remove(a,"manageStatesCheckboxAllVisible");e.remove(a,"manageStatesCheckboxAllVisibleBackgroundAll");e.remove(a,"manageStatesCheckboxAllVisibleBackgroundSome");
e.remove(a,"manageStatesCheckboxSomeVisible");1==a._checkValue?(a._checkValue=0,e.add(a,"manageStatesCheckboxNoneVisible"),this._overrideDisplayValue[d]="none"):(a._checkValue=1,e.add(a,"manageStatesCheckboxAllVisible"),this._overrideDisplayValue[d]="");this.updateDialog()}.bind(this,c))),this._overrideDisplayValue[c]=null,k=this._states[c],g.create("td",{"class":"manageStatesStateNameCell",innerHTML:"Normal"==k?"Background":k},a),k=g.create("td",{"class":"manageStatesNotesCell"},a),this._notes[c]=
g.create("span",{"class":"manageStatesNotesSpan"},k)}(b=this.domNode.querySelector(".manageStatesCheckCurrentStateOnly"))&&this._handlers.push(m(b,"click",function(a){p.stop(a);this._acceleratorClicked("current")}.bind(this)));(b=this.domNode.querySelector(".manageStatesCheckAll"))&&this._handlers.push(m(b,"click",function(a){p.stop(a);this._acceleratorClicked("all")}.bind(this)));(b=this.domNode.querySelector(".manageStatesUncheckAll"))&&this._handlers.push(m(b,"click",function(a){p.stop(a);this._acceleratorClicked("none")}.bind(this)));
(b=this.domNode.querySelector(".manageStatesCheckBackgroundOnly"))&&this._handlers.push(m(b,"click",function(a){p.stop(a);this._acceleratorClicked("background")}.bind(this)));this.anyCheckBoxChanges=!1;setTimeout(function(){this.okButton.focus()}.bind(this),500)}},_acceleratorClicked:function(b){var a=this._getContext();if(a&&(a=l.getFocus(a.rootNode))&&a.stateContainerNode){for(var k=l.getState(a.stateContainerNode),c=0;c<this._states.length;c++){var d=this._states[c];if("undefined"==d||d==l.NORMAL)d=
void 0;var f=this._checkBoxes[c];e.remove(f,"manageStatesCheckboxNoneVisible");e.remove(f,"manageStatesCheckboxAllVisible");e.remove(f,"manageStatesCheckboxAllVisibleBackgroundAll");e.remove(f,"manageStatesCheckboxAllVisibleBackgroundSome");e.remove(f,"manageStatesCheckboxSomeVisible");"current"==b?d==k&&a.stateContainerNode==this._stateContainers[c]?(f._checkValue=1,e.add(f,"manageStatesCheckboxAllVisible"),this._overrideDisplayValue[c]=""):(f._checkValue=0,e.add(f,"manageStatesCheckboxNoneVisible"),
this._overrideDisplayValue[c]="none"):"all"==b?(f._checkValue=1,e.add(f,"manageStatesCheckboxAllVisible"),this._overrideDisplayValue[c]=""):"none"==b?(f._checkValue=0,e.add(f,"manageStatesCheckboxNoneVisible"),this._overrideDisplayValue[c]="none"):"background"==b&&(f._checkValue=1,e.add(f,"manageStatesCheckboxAllVisible"),this._overrideDisplayValue[c]=0==c?"":"$MAQ_DELETE_PROPERTY$")}this.anyCheckBoxChanges=!0;this.updateDialog()}},_isValid:function(){return!0},_onKeyPress:function(b){b.keyCode!=
dojo.keys.ENTER&&(this._isValid()?this.okButton.set("disabled",!1):this.okButton.set("disabled",!0))},_getAllStatesInDoc:function(){var b;if(h.currentEditor&&h.currentEditor.currentEditor&&h.currentEditor.currentEditor.context){b=h.currentEditor.currentEditor.context;var a=[],e=[];if(b=l.getAllStateContainers(b.rootNode))for(var c=0;c<b.length;c++)for(var d=l.getStates(b[c]),f=0;f<d.length;f++)a.push(d[f]),e.push(b[c]);return{states:a,stateContainers:e}}console.error("_ManageStatesWidget.js (from "+
this._calledBy+" - cannot determine context.")},_getContext:function(){var b;h.currentEditor&&h.currentEditor.currentEditor&&h.currentEditor.currentEditor.context?b=h.currentEditor.currentEditor.context:console.error("_ManageStatesWidget.js (from "+this._calledBy+" - cannot determine context.");return b},_getAllEffectedWidgets:function(){var b=this._getContext();if(!b)return[];var a=l.getFocus(b.rootNode);if(a&&a.stateContainerNode)return b.getSelection().slice(0)},updateDialog:function(){var b=this._getContext();
if(b){var a=l.getFocus(b.rootNode);if(a&&a.stateContainerNode)for(var a=this._getAllEffectedWidgets(),k=this._overrideDisplayValue[0],c=0;c<this._states.length;c++){var d=this._states[c];if(d==l.NORMAL||"undefined"==d)d=void 0;for(var f=0,h=0,n=0;n<a.length;n++){var g=a[n],m={undefined:k};m[void 0===d?"undefined":d]=this._overrideDisplayValue[c];g=l.getEffectiveDisplayValue(b,g,d,m);0!=g.effectiveDisplayValue.indexOf("none")&&(f++,!d&&"undefined"==g.effectiveState?h++:d&&g.effectiveState==d&&h++)}d=
this._checkBoxes[c];n=this._notes[c];e.remove(d,"manageStatesCheckboxNoneVisible");e.remove(d,"manageStatesCheckboxAllVisible");e.remove(d,"manageStatesCheckboxAllVisibleBackgroundAll");e.remove(d,"manageStatesCheckboxAllVisibleBackgroundSome");e.remove(d,"manageStatesCheckboxSomeVisible");n.innerHTML="";0==f?(d._checkValue=0,e.add(d,"manageStatesCheckboxNoneVisible")):f==a.length?(d._checkValue=1,h==a.length?e.add(d,"manageStatesCheckboxAllVisible"):0<h?(e.add(d,"manageStatesCheckboxAllVisibleBackgroundSome"),
n.innerHTML=q.manageStatesSomeVisibleFromBackground):(e.add(d,"manageStatesCheckboxAllVisibleBackgroundAll"),n.innerHTML=q.manageStatesAllVisibleFromBackground)):(d._checkValue=2,e.add(d,"manageStatesCheckboxSomeVisible"),n.innerHTML=q.manageStatesSomeVisibleSomeHidden)}}},onOk:function(){if(this.anyCheckBoxChanges){var b=this._getContext();if(b){for(var a,e=this._getAllEffectedWidgets(),c=0;c<this._states.length;c++){var d=this._states[c];if(d==l.NORMAL||"undefined"==d)d=void 0;var f=this._checkBoxes[c]._checkValue;
if(0===f||1===f)for(var g=0;g<e.length;g++){var h=e[g];a||(a=new v);a.add(new w(h,[{display:this._overrideDisplayValue[c]?this._overrideDisplayValue[c]:1==f?"":"none"}],d))}}a&&b.getCommandStack().execute(a)}}},onCancel:function(){this.onClose()},destroy:function(){this.inherited(arguments);for(var b=0;b<this._handlers.length;b++)this._handlers[b].remove();this._handlers=[]}})});
//# sourceMappingURL=_ManageStatesWidget.js.map