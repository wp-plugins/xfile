//>>built
define("davinci/html/CSSFile","dojo/_base/declare dojo/_base/lang davinci/html/CSSElement davinci/html/CSSRule davinci/html/CSSSelector system/resource davinci/Workbench".split(" "),function(m,n,p,q,l,r,s){return m("davinci.html.CSSFile",p,{constructor:function(a){this.elementType="CSSFile";n.mixin(this,a);this.options||(this.options={xmode:"style",css:!0,expandShorthand:!1});a=null;this.url&&this.loader?a=this.loader(this.url):this.url&&"app.css"===this.url&&this.setText("BODY {background-color: red!important;}");
a&&this.setText(a)},save:function(a){return r.findResourceAsync(this.url).then(function(b){return b.setContents(this.getText(),a)}.bind(this))},close:function(){this.visit({visit:function(a){"CSSImport"==a.elementType&&a.close()}});require(["dojo/_base/connect"],function(a){a.publish("davinci/model/closeModel",[this])})},addRule:function(a){var b=new q;b.setText(a);this.addChild(b);this.setDirty(!0);return b},setText:function(a){var b=this.children;this.children=[];this.errors=require("davinci/html/CSSParser").parse(a,
this).errors;0<this.errors.length&&this.errors[this.errors.length-1].isException&&(this.children=b);this.includeImports&&this.children.forEach(function(a){"CSSImport"==a.elementType&&a.load()});this.onChange()},getText:function(a){a=a||{};a.indent=0;return this.children.map(function(b){return b.getText(a)}).join("")},getCSSFile:function(){return this},getID:function(){return this.fileName},getMatchingRules:function(a,b,d){a=this._convertNode(a);b=b||[];d=d||[];for(var c=0;c<this.children.length;c++){var f=
this.children[c];if("CSSRule"==f.elementType){var k=f.matches(a);if(k){for(var g=!1,e=0;e<d.length;e++)if(k>=d[e]){b.splice(e,0,f);d.splice(e,0,k);g=!0;break}g||(b.splice(0,0,f),d.splice(0,0,k))}}else"CSSImport"==f.elementType&&f.cssFile&&f.cssFile.getMatchingRules(a,b,d)}return b},getRule:function(a){var b;if(!a)return[];a=l.parseSelectors(a);for(var d=0;d<this.children.length;d++){var c=this.children[d];if("CSSRule"==c.elementType){if(c.matchesSelectors(a)){b=c;break}}else"CSSImport"==c.elementType&&
c.cssFile&&(b=c.cssFile.getRule(a)||b)}return b},getRules:function(a){a=l.parseSelectors(a);for(var b=[],d=0;d<this.children.length;d++){var c=this.children[d];"CSSRule"==c.elementType?c.matchesSelectors(a)&&b.push(c):"CSSImport"==c.elementType&&c.cssFile&&(b=b.concat(c.cssFile.getRules(a)))}return b},getStyleValue:function(a,b){var d=[],c=[];b=this._convertNode(b);this.getMatchingRules(b,d,c);"string"==typeof a&&(a=[a]);return a.map(function(a){for(var b=0,g,e,h=0;h<d.length;h++)if((e=d[h].getProperty(a))&&
c[h]>b)g=e,b=c[h];return g})}})});
//# sourceMappingURL=CSSFile.js.map