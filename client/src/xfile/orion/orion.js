//>>built
/*

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation 

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2011 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation 

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation
  Mihai Sucan (Mozilla Foundation) - fix for Bug#334583 Bug#348471 Bug#349485 Bug#350595 Bug#360726 Bug#361180 Bug#362835 Bug#362428 Bug#362286 Bug#354270 Bug#361474 Bug#363945 Bug#366312 Bug#370584

 Copyright (c) 2009, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2011 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation
*/
require({cache:{"orion/editor/textMateStyler":function(){define("orion/editor/textMateStyler",["orion/editor/regex"],function(p){function u(d,a,c){c=a.textView._parent.ownerDocument;var e=a._stylesheet=a.util.createElement(c,"style");e.appendChild(c.createTextNode(a._styleSheet(d,"",a.util)));(c.getElementsByTagName("head")[0]||c.documentElement).appendChild(e);a.textView.update(!0)}function t(d,a){var c,e=this;d.getPreferences("/settings",2).then(function(d){if(void 0!==d.get("JavaScript Editor")&&
(c=JSON.parse(d.get("JavaScript Editor"))))e._stylesheet&&(e._stylesheet.parentNode.removeChild(e._stylesheet),e._stylesheet=null),e._update(c,e,a)})}function d(d,a){for(var c=[],e=0;e<d.length;e++)c[d[e].element]=d[e].value;e=[];e.push("");var f=c.fontFamily,f="sans serif"===f?'"Menlo", "Consolas", "Vera Mono", "monospace"':"monospace";e.push(a+" .textviewContainer {");e.push("\background-color:"+c.background+";");e.push("\tfont-family: "+f+";");e.push("\tfont-size: "+c.fontSize+";");e.push("\tmin-width: 50px;");
e.push("\tmin-height: 50px;");e.push("\tcolor: "+c.text+";");e.push("}");e.push(a+" {");e.push("\tfont-family: "+f+";");e.push("\tfont-size: "+c.fontSize+";");e.push("\tcolor: "+c.text+";");e.push("}");e.push(a+" .textview {");e.push("\tbackground-color: "+c.background+";");e.push("}");e.push(a+".ruler.annotations{");e.push("\tbackground-color: white;");e.push("}");e.push(a+" .ruler {");e.push("\tbackground-color: "+c.annotationRuler+";");e.push("}");e.push(a+" .rulerLines {");e.push("\tcolor: "+
c.lineNumber+";");e.push("\tbackground-color: "+c.annotationRuler+";");e.push("}");e.push(a+" .rulerLines.even {");e.push("\tcolor: "+c.lineNumber+";");e.push("\tbackground-color: "+c.annotationRuler+";");e.push("}");e.push(a+" .rulerLines.odd {");e.push("\tcolor: "+c.lineNumber+";");e.push("\tbackground-color: "+c.annotationRuler+";");e.push("}");e.push(a+" .annotationLine.currentLine {");e.push("\tbackground-color: "+c.currentLine+";");e.push("}");e.push(a+" .entity-name-tag {");e.push("color: "+
c.keyword+";");e.push("}");return e.join("\n")}function m(d){var a;if(d instanceof Array){a=Array(d.length);for(var c=0;c<d.length;c++)a[c]=m(d[c])}else for(c in a={},d)if(Object.prototype.hasOwnProperty.call(d,c)){var e=d[c];a[c]="object"===typeof e&&null!==e?m(e):e}return a}function l(r,a,c,e,f){this.initialize(r,e);this.grammar=m(a);this.externalGrammars=c?m(c):[];this._styles={};this._tree=null;this._allGrammars={};this.preprocess(this.grammar);this._updateStylesheet=t;this._update=u;this._styleSheet=
d;this.util=f}var q,s={unsupported:[{regex:/\(\?[ims\-]:/,func:function(d){return"option on/off for subexp"}},{regex:/\(\?<([=!])/,func:function(d){return"\x3d"===d[1]?"lookbehind":"negative lookbehind"}},{regex:/\(\?>/,func:function(d){return"atomic group"}}],toRegExp:function(d){function a(a,c){throw Error('Unsupported regex feature "'+a+'": "'+c[0]+'" at index: '+c.index+" in "+c.input);}var c="",e;d=s.processGlobalFlag("x",d,function(a){for(var c="",b=!1,g=a.length,n=0;n<g;){var v=a.charAt(n);
if(!b&&"#"===v)for(;n<g&&"\r"!==v&&"\n"!==v;)v=a.charAt(++n);else if(!b&&/\s/.test(v))for(;n<g&&/\s/.test(v);)v=a.charAt(++n);else"\\"===v?(c+=v,/\s/.test(a.charAt(n+1))||(c+=a.charAt(n+1),n+=1)):("["===v?b=!0:"]"===v&&(b=!1),c+=v),n+=1}return c});d=s.processGlobalFlag("i",d,function(a){c+="i";return a});for(e=0;e<this.unsupported.length;e++){var f;(f=this.unsupported[e].regex.exec(d))&&a(this.unsupported[e].func(f),f)}return RegExp(d,c)},processGlobalFlag:function(d,a,c){var e="(?"+d+")";d="(?"+
d+":";if(a.substring(0,e.length)===e)return c(a.substring(e.length));if(a.substring(0,d.length)===d){for(var e=0,f=a.length,h=-1,k=0;k<f&&-1===h;k++)switch(a.charAt(k)){case "\\":k++;break;case "(":e++;break;case ")":e--,0===e&&(h=k)}e=h;if(e<a.length-1)throw Error("Only a "+d+") group that encloses the entire regex is supported in: "+a);return c(a.substring(d.length,e))}return a},hasBackReference:function(d){return/\\\d+/.test(d.source)},getSubstitutedRegex:function(d,a,c){c="undefined"===typeof c?
!0:!1;d=d.source.split(/(\\\d+)/g);for(var e=[],f=0;f<d.length;f++){var h=d[f],k=/\\(\d+)/.exec(h);k?(h=a[k[1]]||"",e.push(c?p.escape(h):h)):e.push(h)}return RegExp(e.join(""))},groupify:function(d,a){for(var c=d.source,e=c.length,f=[],h=0,k=[],b=1,g=1,n=[],v={},y={},x=0;x<e;x++){var A=f[f.length-1],B=c.charAt(x);switch(B){case "(":4===A&&(f.pop(),n.push(")"),k[k.length-1].end=x);var D=x+2<e?c.charAt(x+1)+""+c.charAt(x+2):null;if("?:"===D||"?\x3d"===D||"?!"===D){var w;"?:"===D?w=1:(w=3,h++);f.push(w);
k.push({start:x,end:-1,type:w});n.push(B);n.push(D);x+=D.length}else f.push(2),k.push({start:x,end:-1,type:2,oldNum:b,num:g}),n.push(B),0===h&&(y[g]=null),v[b]=g,b++,g++;break;case ")":A=f.pop();3===A&&h--;k[k.length-1].end=x;n.push(B);break;case "*":case "+":case "?":case "}":var m=B,l=c.charAt(x-1),D=x-1;if("}"===B){for(w=x-1;"{"!==c.charAt(w)&&0<=w;w--);l=c.charAt(w-1);D=w-1;m=c.substring(w,x+1)}w=k[k.length-1];if(")"===l&&(2===w.type||4===w.type)){n.splice(w.start,0,"(");n.push(m);n.push(")");
B={start:w.start,end:n.length-1,type:4,num:w.num};for(l=0;l<k.length;l++)if(A=k[l],(2===A.type||4===A.type)&&A.start>=w.start&&A.end<=D)A.start+=1,A.end+=1,A.num+=1,2===A.type&&(v[A.oldNum]=A.num);k.push(B);g++;break}default:"|"!==B&&(2!==A&&4!==A)&&0===h&&(f.push(4),k.push({start:x,end:-1,type:4,num:g}),n.push("("),y[g]=null,g++),n.push(B),"\\"===B&&(B=c.charAt(x+1),n.push(B),x+=1)}}for(;f.length;)f.pop(),n.push(")");c=RegExp(n.join(""));e={};a=a||v;for(var q in a)a.hasOwnProperty(q)&&(e[q]="\\"+
a[q]);c=this.getSubstitutedRegex(c,e,!1);return[c,v,y]},complexCaptures:function(d){if(!d)return!1;for(var a in d)if(d.hasOwnProperty(a)&&"0"!==a)return!0;return!1}};l.prototype={initialize:function(d,a,c){this.textView=d;this.textView.stylerOptions=this;var e=this;this.textView&&a&&a.startup().then(function(a){q=a.preferences;e.preferences=q;e._updateStylesheet(q,c);e.storageKey=q.listenForChangedSettings(e._listener.onStorage)});this._listener={onModelChanged:function(a){e.onModelChanged(a)},onDestroy:function(a){e.onDestroy(a)},
onLineStyle:function(a){e.onLineStyle(a)},onStorage:function(a){e.onStorage(a)}};d.addEventListener("ModelChanged",this._listener.onModelChanged);d.addEventListener("Destroy",this._listener.onDestroy);d.addEventListener("LineStyle",this._listener.onLineStyle);d.redrawLines()},onDestroy:function(d){this.destroy()},onStorage:function(d){d.key===this.storageKey&&this._updateStylesheet(this.preferences)},destroy:function(){this.textView&&(this.textView.removeEventListener("ModelChanged",this._listener.onModelChanged),
this.textView.removeEventListener("Destroy",this._listener.onDestroy),this.textView.removeEventListener("LineStyle",this._listener.onLineStyle),this.textView=null);this._listener=this._tree=this._styles=this.grammar=null},preprocess:function(d){for(d=[d];0!==d.length;){var a=d.pop();if(!a._resolvedRule||!a._typedRule)if(a._resolvedRule=this._resolve(a),a._typedRule=this._createTypedRule(a),this.addStyles(a.name),this.addStyles(a.contentName),this.addStylesForCaptures(a.captures),this.addStylesForCaptures(a.beginCaptures),
this.addStylesForCaptures(a.endCaptures),a._resolvedRule!==a&&d.push(a._resolvedRule),a.patterns)for(var c=0;c<a.patterns.length;c++)d.push(a.patterns[c])}},addStyles:function(d){if(d&&!this._styles[d]){this._styles[d]=[];for(var a=d.split("."),c=0;c<a.length;c++)this._styles[d].push(a.slice(0,c+1).join("-"))}},addStylesForCaptures:function(d){for(var a in d)d.hasOwnProperty(a)&&this.addStyles(d[a].name)},ContainerRule:function(){function d(a){this.rule=a;this.subrules=a.patterns}d.prototype.valueOf=
function(){return"aa"};return d}(),BeginEndRule:function(){function d(a){this.rule=a;this.beginRegex=s.toRegExp(a.begin);this.endRegex=s.toRegExp(a.end);this.subrules=a.patterns||[];this.endRegexHasBackRef=s.hasBackReference(this.endRegex);var c=s.complexCaptures(a.captures);a=s.complexCaptures(a.beginCaptures)||s.complexCaptures(a.endCaptures);if(this.isComplex=c||a)c=s.groupify(this.beginRegex),this.beginRegex=c[0],this.beginOld2New=c[1],this.beginConsuming=c[2],c=s.groupify(this.endRegex,this.beginOld2New),
this.endRegex=c[0],this.endOld2New=c[1],this.endConsuming=c[2]}d.prototype.valueOf=function(){return this.beginRegex};return d}(),MatchRule:function(){function d(a){this.rule=a;this.matchRegex=s.toRegExp(a.match);if(this.isComplex=s.complexCaptures(a.captures))a=s.groupify(this.matchRegex),this.matchRegex=a[0],this.matchOld2New=a[1],this.matchConsuming=a[2]}d.prototype.valueOf=function(){return this.matchRegex};return d}(),_createTypedRule:function(d){return d.match?new this.MatchRule(d):d.begin?
new this.BeginEndRule(d):new this.ContainerRule(d)},_resolve:function(d){var a=d;if(d.include){if(d.begin||d.end||d.match)throw Error('Unexpected regex pattern in "include" rule '+d.include);d=d.include;if("#"===d.charAt(0)){if(a=this.grammar.repository&&this.grammar.repository[d.substring(1)],!a)throw Error("Couldn't find included rule "+d+" in grammar repository");}else if("$self"===d)a=this.grammar;else{if("$base"===d)throw Error('Include "$base" is not supported');a=this._allGrammars[d];if(!a)for(var c=
0;c<this.externalGrammars.length;c++){var e=this.externalGrammars[c];if(e.scopeName===d){this.preprocess(e);a=this._allGrammars[d]=e;break}}}}return a},ContainerNode:function(){function d(a,c){this.parent=a;this.rule=c;this.children=[];this.end=this.start=null}d.prototype.addChild=function(a){this.children.push(a)};d.prototype.valueOf=function(){var a=this.rule;return"ContainerNode { "+(a.include||"")+" "+(a.name||"")+(a.comment||"")+"}"};return d}(),BeginEndNode:function(){function d(a,c,e){this.parent=
a;this.rule=c;this.children=[];this.setStart(e);this.endMatch=this.end=null;this.endRegexSubstituted=c.endRegexHasBackRef?s.getSubstitutedRegex(c.endRegex,e):null}d.prototype.addChild=function(a){this.children.push(a)};d.prototype.getIndexInParent=function(a){return this.parent?this.parent.children.indexOf(this):-1};d.prototype.setStart=function(a){this.start=a.index;this.beginMatch=a};d.prototype.setEnd=function(a){a&&"object"===typeof a?(this.endMatch=a,this.end=a.index+a[0].length):(this.endMatch=
null,this.end=a)};d.prototype.shiftStart=function(a){this.start+=a;this.beginMatch.index+=a};d.prototype.shiftEnd=function(a){this.end+=a;this.endMatch&&(this.endMatch.index+=a)};d.prototype.valueOf=function(){return"{"+this.rule.beginRegex+" range\x3d"+this.start+".."+this.end+"}"};return d}(),push:function(d,a){if(a)for(var c=a.length;0<c;)d.push(a[--c])},exec:function(d,a,c){if(a=d.exec(a))a.index+=c;d.lastIndex=0;return a},afterMatch:function(d){return d.index+d[0].length},getEndMatch:function(d,
a,c){if(d instanceof this.BeginEndNode){var e=d.rule;d=d.endRegexSubstituted||e.endRegex;return!d?null:this.exec(d,a,c)}return null},initialParse:function(){this.textView.getModel().getCharCount();this._tree=new this.ContainerNode(null,this.grammar._typedRule);this.parse(this._tree,!1,0)},onModelChanged:function(d){var a=d.addedCharCount,c=d.removedCharCount;d=d.start;if(this._tree){var e=this.textView.getModel(),f=e.getCharCount(),e=e.getLineEnd(e.getLineAtOffset(d)-1),h=this.getFirstDamaged(e,e),
e=-1===e?0:e,a=h?this.parse(h,!0,e,d,a,c):f;this.textView.redrawRange(e,a)}else this.initialParse()},getFirstDamaged:function(d,a){if(0>d)return this._tree;for(var c=[this._tree],e=null;c.length;){var f=c.pop();if(!f.parent||this.isDamaged(f,d,a)){f instanceof this.BeginEndNode&&(e=f);for(var h=0;h<f.children.length;h++)c.push(f.children[h])}}return e||this._tree},isDamaged:function(d,a,c){return d.start<=c&&d.end>a},parse:function(d,a,c,e,f,h){var k=this.textView.getModel(),b=k.getLineStart(k.getLineCount()-
1),g=k.getCharCount(),n=this.getInitialExpected(d,c),v=-1;a&&(d.repaired=!0,d.endNeedsUpdate=!0,v=(v=d.children[d.children.length-1])?k.getLineEnd(k.getLineAtOffset(v.end+(f-h))):-1,e=k.getLineEnd(k.getLineAtOffset(e+h)),v=Math.max(v,e));v=-1===v?g:v;e=n;for(var y=d,x=!1,A=c,B=-1;y&&(!a||A<v);){var D=this.getNextMatch(k,y,A);D||(A=A>=b?g:k.getLineStart(k.getLineAtOffset(A)+1));var w=D&&D.match,m=D&&D.rule,l=D&&D.isEnd;if(D&&D.isSub)A=this.afterMatch(w),m instanceof this.BeginEndRule&&(x=!0,a&&m===
e.rule&&y===e.parent?(y=e,y.setStart(w),y.repaired=!0,y.endNeedsUpdate=!0,e=this.getNextExpected(e,"begin")):(a&&(this.prune(y,e),a=!1),w=new this.BeginEndNode(y,m,w),y.addChild(w),y=w));else if(l||A===g)y instanceof this.BeginEndNode&&(w?(x=!0,B=Math.max(B,y.end),y.setEnd(w),A=this.afterMatch(w),a&&y===e&&y.parent===e.parent?(y.repaired=!0,delete y.endNeedsUpdate,e=this.getNextExpected(e,"end")):a&&(this.prune(y,e),a=!1)):(y.setEnd(g),delete y.endNeedsUpdate)),y=y.parent;a&&(A>=v&&!x)&&(this.prune(d,
n),a=!1)}this.removeUnrepairedChildren(d,a,c);this.cleanup(a,d,c,v,g,f,h);return a?Math.max(B,A):A},removeUnrepairedChildren:function(d,a,c){if(a){a=d.children;for(var e=-1,f=0;f<a.length;f++){var h=a[f];if(!h.repaired&&this.isDamaged(h,c,Number.MAX_VALUE)){e=f;break}}-1!==e&&(d.children.length=e)}},cleanup:function(d,a,c,e,f,h,k){if(d){d=h-k;f=this.getIntersecting(e-d+1,f);a=this.getIntersecting(c,e);for(c=0;c<f.length;c++)e=f[c],!e.repaired&&e instanceof this.BeginEndNode&&(e.shiftEnd(d),e.shiftStart(d));
for(c=0;c<a.length;c++)e=a[c],e.repaired&&e.endNeedsUpdate&&e.shiftEnd(d),delete e.endNeedsUpdate,delete e.repaired}else{a=this.getIntersecting(c,e);for(c=0;c<a.length;c++)delete a[c].repaired}},getNextMatch:function(d,a,c,e){var f=d.getLineAtOffset(c),f=d.getLineEnd(f),h=d.getText(c,f),k=[],b=[];d=[];f=[];for(this.push(k,a.rule.subrules);k.length;){var g=k.length?k.pop():null,g=g&&g._resolvedRule._typedRule;if(g instanceof this.ContainerRule&&-1===b.indexOf(g))b.push(g),this.push(k,g.subrules);else if(!g||
!e||g.matchRegex){var n=g&&this.exec(g.matchRegex||g.beginRegex,h,c);n&&(d.push(n),f.push(g))}}k=Number.MAX_VALUE;b=-1;for(g=0;g<d.length;g++)n=d[g],n.index<k&&(k=n.index,b=g);if(!e&&(c=this.getEndMatch(a,h,c)))if(e=a.rule.applyEndPatternLast,-1===b||c.index<k||!e&&c.index===k)return{isEnd:!0,rule:a.rule,match:c};return-1===b?null:{isSub:!0,rule:f[b],match:d[b]}},getInitialExpected:function(d,a){var c,e;if(d===this._tree)for(c=0;c<d.children.length;c++){if(e=d.children[c],e.start>=a)return e}else if(d instanceof
this.BeginEndNode&&d.endMatch){var f=d.endMatch.index;for(c=0;c<d.children.length&&!(e=d.children[c],e.start>=a);c++);if(e&&e.start<f)return e}return d},getNextExpected:function(d,a){if("begin"===a){var c=d.children[0];return c?c:d}if("end"===a&&(c=d.parent)){var e=c.children[c.children.indexOf(d)+1];return e?e:c}return null},prune:function(d,a){a.parent===d?d.children.length=a.getIndexInParent():d instanceof this.BeginEndNode&&(d.endMatch=null,d.end=null);d.parent&&(d.parent.children.length=d.getIndexInParent()+
1)},onLineStyle:function(d){this._tree||this.initialParse();var a=d.lineStart,c=this.textView.getModel(),e=c.getLineEnd(d.lineIndex),f=c.getLineEnd(c.getLineAtOffset(a)-1),f=this.getFirstDamaged(f,f),a=this.getLineScope(c,f,a,e);d.ranges=this.toStyleRanges(a);d.ranges.sort(function(a,c){return a.start-c.start})},getLineScope:function(d,a,c,e){for(var f=c,h=this.getInitialExpected(a,c),k=[],b=[];a&&f<e;){var g=this.getNextMatch(d,a,f);if(!g)break;var n=g&&g.match,v=g&&g.rule,y=g&&g.isSub,g=g&&g.isEnd;
n.index!==f&&b.push({start:f,end:n.index,node:a});y?(f=this.afterMatch(n),v instanceof this.BeginEndRule?(this.addBeginScope(k,n,v),a=h,h=this.getNextExpected(h,"begin")):this.addMatchScope(k,n,v)):g&&(f=this.afterMatch(n),this.addEndScope(k,n,v),h=this.getNextExpected(h,"end"),a=a.parent)}f<e&&b.push({start:f,end:e,node:a});d=this.getInheritedLineScope(b,c,e);return k.concat(d)},getInheritedLineScope:function(d,a,c){a=[];for(c=0;c<d.length;c++)for(var e=d[c],f=e.node;f;){var h=f.rule.rule,k=h.name;
if(h=h.contentName||k){this.addScopeRange(a,e.start,e.end,h);break}f=f.parent}return a},addBeginScope:function(d,a,c){var e=c.rule;this.addCapturesScope(d,a,e.beginCaptures||e.captures,c.isComplex,c.beginOld2New,c.beginConsuming)},addEndScope:function(d,a,c){var e=c.rule;this.addCapturesScope(d,a,e.endCaptures||e.captures,c.isComplex,c.endOld2New,c.endConsuming)},addMatchScope:function(d,a,c){var e=c.rule,f=e.name;(e=e.captures)?this.addCapturesScope(d,a,e,c.isComplex,c.matchOld2New,c.matchConsuming):
this.addScope(d,a,f)},addScope:function(d,a,c){c&&d.push({start:a.index,end:this.afterMatch(a),scope:c})},addScopeRange:function(d,a,c,e){e&&d.push({start:a,end:c,scope:e})},addCapturesScope:function(d,a,c,e,f,h){if(c)if(e){e={1:0};for(var k=0,b=1;void 0!==a[b];b++)void 0!==h[b]&&(k+=a[b].length),void 0!==a[b+1]&&(e[b+1]=k);h=a.index;for(k=1;c[k];k++){var b=c[k].name,g=f[k],n=h+e[g];"undefined"!==typeof a[g]&&this.addScopeRange(d,n,n+a[g].length,b)}}else this.addScope(d,a,c[0]&&c[0].name)},getIntersecting:function(d,
a){for(var c=[],e=this._tree?[this._tree]:[];e.length;){var f=e.pop(),h=!1;f instanceof this.ContainerNode?h=!0:this.isDamaged(f,d,a)&&(h=!0,c.push(f));if(h)for(var h=f.children.length,k=0;k<h;k++)e.push(f.children[k])}return c.reverse()},toStyleRanges:function(d){for(var a=[],c=0;c<d.length;c++){var e=d[c],f=this._styles[e.scope];if(!f)throw Error("styles not found for "+e.scope);f=f.join(" ");a.push({start:e.start,end:e.end,style:{styleClass:f}})}return a}};return{RegexUtil:s,TextMateStyler:l}})},
"orion/editor/regex":function(){define("orion/editor/regex",[],function(){return{escape:function(p){return p.replace(/([\\$\^*\/+?\.\(\)|{}\[\]])/g,"\\$\x26")},parse:function(p){return(p=/^\s*\/(.+)\/([gim]{0,3})\s*$/.exec(p))?{pattern:p[1],flags:p[2]}:null}}})},"orion/editor/cssContentAssist":function(){define("orion/editor/cssContentAssist",[],function(){function p(){}var u="alignment-adjust alignment-baseline animation animation-delay animation-direction animation-duration animation-iteration-count animation-name animation-play-state animation-timing-function appearance azimuth backface-visibility background background-attachment background-clip background-color background-image background-origin background-position background-repeat background-size baseline-shift binding bleed bookmark-label bookmark-level bookmark-state bookmark-target border border-bottom border-bottom-color border-bottom-left-radius border-bottom-right-radius border-bottom-style border-bottom-width border-collapse border-color border-image border-image-outset border-image-repeat border-image-slice border-image-source border-image-width border-left border-left-color border-left-style border-left-width border-radius border-right border-right-color border-right-style border-right-width border-spacing border-style border-top border-top-color border-top-left-radius border-top-right-radius border-top-style border-top-width border-width bottom box-align box-decoration-break box-direction box-flex box-flex-group box-lines box-ordinal-group box-orient box-pack box-shadow box-sizing break-after break-before break-inside caption-side clear clip color color-profile column-count column-fill column-gap column-rule column-rule-color column-rule-style column-rule-width column-span column-width columns content counter-increment counter-reset crop cue cue-after cue-before cursor direction display dominant-baseline drop-initial-after-adjust drop-initial-after-align drop-initial-before-adjust drop-initial-before-align drop-initial-size drop-initial-value elevation empty-cells fit fit-position flex-align flex-flow flex-inline-pack flex-order flex-pack float float-offset font font-family font-size font-size-adjust font-stretch font-style font-variant font-weight grid-columns grid-rows hanging-punctuation height hyphenate-after hyphenate-before hyphenate-character hyphenate-lines hyphenate-resource hyphens icon image-orientation image-rendering image-resolution inline-box-align left letter-spacing line-height line-stacking line-stacking-ruby line-stacking-shift line-stacking-strategy list-style list-style-image list-style-position list-style-type margin margin-bottom margin-left margin-right margin-top mark mark-after mark-before marker-offset marks marquee-direction marquee-loop marquee-play-count marquee-speed marquee-style max-height max-width min-height min-width move-to nav-down nav-index nav-left nav-right nav-up opacity orphans outline outline-color outline-offset outline-style outline-width overflow overflow-style overflow-x overflow-y padding padding-bottom padding-left padding-right padding-top page page-break-after page-break-before page-break-inside page-policy pause pause-after pause-before perspective perspective-origin phonemes pitch pitch-range play-during position presentation-level punctuation-trim quotes rendering-intent resize rest rest-after rest-before richness right rotation rotation-point ruby-align ruby-overhang ruby-position ruby-span size speak speak-header speak-numeral speak-punctuation speech-rate stress string-set table-layout target target-name target-new target-position text-align text-align-last text-decoration text-emphasis text-height text-indent text-justify text-outline text-shadow text-transform text-wrap top transform transform-origin transform-style transition transition-delay transition-duration transition-property transition-timing-function unicode-bidi vertical-align visibility voice-balance voice-duration voice-family voice-pitch voice-pitch-range voice-rate voice-stress voice-volume volume white-space white-space-collapse widows width word-break word-spacing word-wrap z-index".split(" ");
p.prototype={computeProposals:function(t,d,m){for(m=d;m&&/[A-Za-z\-]/.test(t.charAt(m-1));)m--;t=m?t.substring(m,d):"";d=[];for(m=0;m<u.length;m++){var l=u[m];0===l.indexOf(t)&&d.push({proposal:l.substring(t.length),description:l})}return d}};return{CssContentAssistProvider:p}})},"orion/editor/editorFeatures":function(){define("orion/editor/editorFeatures","i18n!orion/editor/nls/messages orion/editor/undoStack orion/editor/keyBinding orion/editor/rulers orion/editor/annotations orion/editor/tooltip orion/editor/textDND orion/editor/regex orion/editor/util".split(" "),
function(p,u,t,d,m,l,q,s,r){function a(){}function c(){}function e(){}function f(){}function h(){}function k(b,g,a){this.editor=b;this.textView=b.getTextView();this.undoStack=g;this._incrementalFindActive=!1;this._incrementalFindSuccess=!0;this._incrementalFindIgnoreSelection=!1;this._incrementalFindPrefix="";this._searcher=a;this._lastEditLocation=null;this.init()}function b(b,g,a,c){this.editor=b;this.textView=b.getTextView();this.undoStack=g;this.contentAssist=a;this.linkedMode=c;this.contentAssist&&
this.contentAssist.addEventListener("ProposalApplied",this.contentAssistProposalApplied.bind(this));this.init()}function g(b){this.editor=b;this.textView=b.getTextView();this.linkedModeActive=!1;this.linkedModePositions=[];this.linkedModeEscapePosition=this.linkedModeCurrentPositionIndex=0;this.linkedModeListener={onVerify:function(b){for(var g=!1,n=0,a=0;a<this.linkedModePositions.length;++a){var c=this.linkedModePositions[a];g?c.offset+=n:b.start>=c.offset&&b.end<=c.offset+c.length&&(g=c.length,
c.length=b.start-c.offset+b.text.length+(c.offset+c.length-b.end),n=c.length-g,g=!0)}g?this.linkedModeEscapePosition+=n:this.cancel()}.bind(this)}}a.prototype={createUndoStack:function(b){b=b.getTextView();var g=new u.UndoStack(b,200);b.setAction("undo",function(){g.undo();return!0},{name:p.undo});b.setAction("redo",function(){g.redo();return!0},{name:p.redo});return g}};c.prototype={createLineNumberRuler:function(b){return new d.LineNumberRuler(b,"left",{styleClass:"ruler lines"},{styleClass:"rulerLines odd"},
{styleClass:"rulerLines even"})}};e.prototype={createFoldingRuler:function(b){return new d.FoldingRuler(b,"left",{styleClass:"ruler folding"})}};f.prototype={createAnnotationModel:function(b){return new m.AnnotationModel(b)},createAnnotationStyler:function(b,g){return new m.AnnotationStyler(b,g)},createAnnotationRulers:function(b){var g=new d.AnnotationRuler(b,"left",{styleClass:"ruler annotations"});b=new d.OverviewRuler(b,"right",{styleClass:"ruler overview"});return{annotationRuler:g,overviewRuler:b}}};
h.prototype={createTextDND:function(b,g){return new q.TextDND(b.getTextView(),g)}};k.prototype={init:function(){var b=this;this._incrementalFindListener={onVerify:function(g){var a=b.editor,c=a.getModel(),d=a.mapOffset(g.start),e=a.mapOffset(g.end),d=c.getText(d,e),c=b._incrementalFindPrefix;if((c=c.match(RegExp("^"+s.escape(d),"i")))&&0<c.length)c=b._incrementalFindPrefix+=g.text,b.editor.reportStatus(r.formatMessage(p.incrementalFind,c)),d=a.getSelection().start,(d=a.getModel().find({string:c,start:d,
caseInsensitive:c.toLowerCase()===c}).next())?(b._incrementalFindSuccess=!0,b._incrementalFindIgnoreSelection=!0,a.moveSelection(d.start,d.end),b._incrementalFindIgnoreSelection=!1):(a.reportStatus(r.formatMessage(p.incrementalFindNotFound,c),"error"),b._incrementalFindSuccess=!1),g.text=null},onSelection:function(){b._incrementalFindIgnoreSelection||b.toggleIncrementalFind()}};this._lastEditListener={onModelChanged:function(g){b.editor.isDirty()&&(b._lastEditLocation=g.start+g.addedCharCount)}};
this.textView.addEventListener("ModelChanged",this._lastEditListener.onModelChanged);this.textView.setKeyBinding(new t.KeyBinding("k",!0),"findNext");this.textView.setAction("findNext",function(){if(this._searcher){var b=this.textView.getSelection();b.start<b.end?this._searcher.findNext(!0,this.textView.getText(b.start,b.end)):this._searcher.findNext(!0);return!0}return!1}.bind(this),{name:p.findNext});this.textView.setKeyBinding(new t.KeyBinding("k",!0,!0),"findPrevious");this.textView.setAction("findPrevious",
function(){if(this._searcher){var b=this.textView.getSelection();b.start<b.end?this._searcher.findNext(!1,this.textView.getText(b.start,b.end)):this._searcher.findNext(!1);return!0}return!1}.bind(this),{name:p.findPrevious});this.textView.setKeyBinding(new t.KeyBinding("j",!0),"incrementalFind");this.textView.setAction("incrementalFind",function(){if(this._searcher&&this._searcher.visible())return!0;var b=this.editor;if(this._incrementalFindActive){var g=this._incrementalFindPrefix;if(0!==g.length){var n;
n=0;this._incrementalFindSuccess&&(n=b.getSelection().start+1);(n=b.getModel().find({string:g,start:n,caseInsensitive:g.toLowerCase()===g}).next())?(this._incrementalFindIgnoreSelection=this._incrementalFindSuccess=!0,b.moveSelection(n.start,n.end),this._incrementalFindIgnoreSelection=!1,b.reportStatus(r.formatMessage(p.incrementalFind,g))):(b.reportStatus(r.formatMessage(p.incrementalFindNotFound,g),"error"),this._incrementalFindSuccess=!1)}}else b.setCaretOffset(b.getCaretOffset()),this.toggleIncrementalFind();
return!0}.bind(this),{name:p.incrementalFindKey});this.textView.setAction("deletePrevious",function(){if(this._incrementalFindActive){var b=this.editor,g=this._incrementalFindPrefix,g=this._incrementalFindPrefix=g.substring(0,g.length-1);if(0===g.length)return this._incrementalFindIgnoreSelection=this._incrementalFindSuccess=!0,b.setCaretOffset(b.getSelection().start),this._incrementalFindIgnoreSelection=!1,this.toggleIncrementalFind(),!0;b.reportStatus(r.formatMessage(p.incrementalFind,g));var n=
b.getModel().find({string:g,start:b.getCaretOffset()-g.length-1,reverse:!0,caseInsensitive:g.toLowerCase()===g}).next();n?(this._incrementalFindIgnoreSelection=this._incrementalFindSuccess=!0,b.moveSelection(n.start,n.end),this._incrementalFindIgnoreSelection=!1):b.reportStatus(r.formatMessage(p.incrementalFindNotFound,g),"error");return!0}return!1}.bind(this));this.textView.setAction("tab",function(){if(this.textView.getOptions("readonly"))return!1;if(this.textView.getOptions("tabMode")){var b=this.editor,
g=b.getModel(),n=b.getSelection(),a=g.getLineAtOffset(n.start),c=g.getLineAtOffset(n.end>n.start?n.end-1:n.end);if(a!==c){var d=[];d.push("");for(var e=a;e<=c;e++)d.push(g.getLine(e,!0));var e=g.getLineStart(a),g=g.getLineEnd(c,!0),f=this.textView.getOptions("tabSize","expandTab"),f=f.expandTab?Array(f.tabSize+1).join(" "):"\t";b.setText(d.join(f),e,g);b.setSelection(e===n.start?n.start:n.start+f.length,n.end+(c-a+1)*f.length);return!0}b=b.getKeyModes();for(n=0;n<b.length;n++)if(b[n].isActive())return b[n].tab();
return!1}}.bind(this));this.textView.setAction("shiftTab",function(){if(this.textView.getOptions("readonly"))return!1;if(this.textView.getOptions("tabMode")){for(var b=this.editor,g=b.getModel(),n=b.getSelection(),a=g.getLineAtOffset(n.start),c=g.getLineAtOffset(n.end>n.start?n.end-1:n.end),d=this.textView.getOptions("tabSize"),e=Array(d+1).join(" "),f=[],h=0,k=0,m=a;m<=c;m++){var l=g.getLine(m,!0);if(g.getLineStart(m)!==g.getLineEnd(m))if(0===l.indexOf("\t"))l=l.substring(1),h++;else if(0===l.indexOf(e))l=
l.substring(d),h+=d;else return!0;m===a&&(k=h);f.push(l)}a=g.getLineStart(a);d=g.getLineEnd(c,!0);g=g.getLineStart(c);b.setText(f.join(""),a,d);f=a===n.start?n.start:n.start-k;n=Math.max(f,n.end-h+(n.end===g+1&&n.start!==n.end?1:0));b.setSelection(f,n);return!0}}.bind(this),{name:p.unindentLines});this.textView.setKeyBinding(new t.KeyBinding(38,!1,!1,!0),"moveLinesUp");this.textView.setAction("moveLinesUp",function(){if(this.textView.getOptions("readonly"))return!1;var b=this.editor,g=b.getModel(),
n=b.getSelection(),a=g.getLineAtOffset(n.start);if(0===a)return!0;var c=g.getLineAtOffset(n.end>n.start?n.end-1:n.end),d=g.getLineCount(),n=g.getLineStart(a-1),e=g.getLineStart(a),f=g.getLineEnd(c,!0),h=g.getText(e,f),k=0;c===d-1&&(c=g.getLineEnd(a-1),a=g.getLineEnd(a-1,!0),h+=g.getText(c,a),e=c,k=a-c);this.startUndo();b.setText("",e,f);b.setText(h,n,n);b.setSelection(n,n+h.length-k);this.endUndo();return!0}.bind(this),{name:p.moveLinesUp});this.textView.setKeyBinding(new t.KeyBinding(40,!1,!1,!0),
"moveLinesDown");this.textView.setAction("moveLinesDown",function(){if(this.textView.getOptions("readonly"))return!1;var b=this.editor,g=b.getModel(),n=b.getSelection(),a=g.getLineAtOffset(n.start),c=g.getLineAtOffset(n.end>n.start?n.end-1:n.end),d=g.getLineCount();if(c===d-1)return!0;var a=g.getLineStart(a),n=g.getLineEnd(c,!0),e=g.getLineEnd(c+1,!0)-(n-a),f=0;c!==d-2?g=g.getText(a,n):(c=g.getLineEnd(c),g=g.getText(c,n)+g.getText(a,c),f+=n-c);this.startUndo();b.setText("",a,n);b.setText(g,e,e);b.setSelection(e+
f,e+f+g.length);this.endUndo();return!0}.bind(this),{name:p.moveLinesDown});this.textView.setKeyBinding(new t.KeyBinding(38,!0,!1,!0),"copyLinesUp");this.textView.setAction("copyLinesUp",function(){if(this.textView.getOptions("readonly"))return!1;var b=this.editor,g=b.getModel(),n=b.getSelection(),a=g.getLineAtOffset(n.start),n=g.getLineAtOffset(n.end>n.start?n.end-1:n.end),a=g.getLineStart(a),c=g.getLineEnd(n,!0),d=g.getLineCount(),e="",c=g.getText(a,c);n===d-1&&(c+=e=g.getLineDelimiter());b.setText(c,
a,a);b.setSelection(a,a+c.length-e.length);return!0}.bind(this),{name:p.copyLinesUp});this.textView.setKeyBinding(new t.KeyBinding(40,!0,!1,!0),"copyLinesDown");this.textView.setAction("copyLinesDown",function(){if(this.textView.getOptions("readonly"))return!1;var b=this.editor,g=b.getModel(),n=b.getSelection(),a=g.getLineAtOffset(n.start),n=g.getLineAtOffset(n.end>n.start?n.end-1:n.end),c=g.getLineStart(a),a=g.getLineEnd(n,!0),d=g.getLineCount(),e="",c=g.getText(c,a);n===d-1&&(c=(e=g.getLineDelimiter())+
c);b.setText(c,a,a);b.setSelection(a+e.length,a+c.length);return!0}.bind(this),{name:p.copyLinesDown});this.textView.setKeyBinding(new t.KeyBinding("d",!0,!1,!1),"deleteLines");this.textView.setAction("deleteLines",function(){if(this.textView.getOptions("readonly"))return!1;var b=this.editor,g=b.getSelection(),n=b.getModel(),a=n.getLineAtOffset(g.start),g=n.getLineAtOffset(g.end>g.start?g.end-1:g.end),a=n.getLineStart(a),n=n.getLineEnd(g,!0);b.setText("",a,n);return!0}.bind(this),{name:p.deleteLines});
this.textView.setKeyBinding(new t.KeyBinding("l",!0),"gotoLine");this.textView.setAction("gotoLine",function(){var b=this.editor,g=b.getModel().getLineAtOffset(b.getCaretOffset());if(g=prompt(p.gotoLinePrompty,g+1))g=parseInt(g,10),b.onGotoLine(g-1,0);return!0}.bind(this),{name:p.gotoLine});this.textView.setKeyBinding(new t.KeyBinding(190,!0),"nextAnnotation");this.textView.setAction("nextAnnotation",function(){var b=this.editor,g=b.getAnnotationModel();if(!g)return!0;for(var n=b.getModel(),a=b.getCaretOffset(),
g=g.getAnnotations(a,n.getCharCount());g.hasNext();){var c=g.next();if(!(c.start<=a)&&!(c.type!==m.AnnotationType.ANNOTATION_ERROR&&c.type!==m.AnnotationType.ANNOTATION_WARNING&&c.type!==m.AnnotationType.ANNOTATION_TASK&&c.type!==m.AnnotationType.ANNOTATION_BOOKMARK)){var d=l.Tooltip.getTooltip(this.textView);if(!d){b.moveSelection(c.start);break}var e=n.getLineAtOffset(c.start),f=this.textView;b.moveSelection(c.start,c.start,function(){setTimeout(function(){d.setTarget({getTooltipInfo:function(){var b=
f.convert({x:f.getLocationAtOffset(c.start).x,y:f.getLocationAtOffset(n.getLineStart(e)).y},"document","page");return{contents:[c],x:b.x,y:b.y+Math.floor(1.33*f.getLineHeight(e))}}},0)},0)});break}}return!0}.bind(this),{name:p.nextAnnotation});this.textView.setKeyBinding(new t.KeyBinding(188,!0),"previousAnnotation");this.textView.setAction("previousAnnotation",function(){var b=this.editor,g=b.getAnnotationModel();if(!g)return!0;for(var n=b.getModel(),a=b.getCaretOffset(),g=g.getAnnotations(0,a),
c=null;g.hasNext();){var d=g.next();d.start>=a||d.type!==m.AnnotationType.ANNOTATION_ERROR&&d.type!==m.AnnotationType.ANNOTATION_WARNING&&d.type!==m.AnnotationType.ANNOTATION_TASK&&d.type!==m.AnnotationType.ANNOTATION_BOOKMARK||(c=d)}if(c){var e=n.getLineAtOffset(c.start),f=l.Tooltip.getTooltip(this.textView);if(!f)return b.moveSelection(c.start),!0;var h=this.textView;b.moveSelection(c.start,c.start,function(){setTimeout(function(){f.setTarget({getTooltipInfo:function(){var b=h.convert({x:h.getLocationAtOffset(c.start).x,
y:h.getLocationAtOffset(n.getLineStart(e)).y},"document","page");return{contents:[c],x:b.x,y:b.y+Math.floor(1.33*h.getLineHeight(e))}}},0)},0)})}return!0}.bind(this),{name:p.prevAnnotation});this.textView.setKeyBinding(new t.KeyBinding("e",!0,!1,!0,!1),"expand");this.textView.setAction("expand",function(){var b=this.editor,g=b.getAnnotationModel();if(!g)return!0;var n=b.getModel(),b=b.getCaretOffset(),a=n.getLineAtOffset(b),b=n.getLineStart(a),a=n.getLineEnd(a,!0);n.getBaseModel&&(b=n.mapOffset(b),
a=n.mapOffset(a),n.getBaseModel());for(var c,n=g.getAnnotations(b,a);!c&&n.hasNext();)b=n.next(),b.type===m.AnnotationType.ANNOTATION_FOLDING&&(b.expanded||(c=b));c&&!c.expanded&&(c.expand(),g.modifyAnnotation(c));return!0}.bind(this),{name:p.expand});this.textView.setKeyBinding(new t.KeyBinding("c",!0,!1,!0,!1),"collapse");this.textView.setAction("collapse",function(){var b=this.editor,g=b.getAnnotationModel();if(!g)return!0;var n=b.getModel(),a=b.getCaretOffset(),c=n.getLineAtOffset(a),a=n.getLineStart(c),
c=n.getLineEnd(c,!0);n.getBaseModel&&(a=n.mapOffset(a),c=n.mapOffset(c),n.getBaseModel());for(var d,n=g.getAnnotations(a,c);!d&&n.hasNext();)a=n.next(),a.type===m.AnnotationType.ANNOTATION_FOLDING&&(d=a);d&&d.expanded&&(b.setCaretOffset(d.start),d.collapse(),g.modifyAnnotation(d));return!0}.bind(this),{name:p.collapse});this.textView.setKeyBinding(new t.KeyBinding("e",!0,!0,!0,!1),"expandAll");this.textView.setAction("expandAll",function(){var b=this.editor,g=b.getAnnotationModel();if(!g)return!0;
var b=b.getModel(),n=g.getAnnotations(0,b.getCharCount());for(this.textView.setRedraw(!1);n.hasNext();)b=n.next(),b.type===m.AnnotationType.ANNOTATION_FOLDING&&!b.expanded&&(b.expand(),g.modifyAnnotation(b));this.textView.setRedraw(!0);return!0}.bind(this),{name:p.expandAll});this.textView.setKeyBinding(new t.KeyBinding("c",!0,!0,!0,!1),"collapseAll");this.textView.setAction("collapseAll",function(){var b=this.editor,g=b.getAnnotationModel();if(!g)return!0;var b=b.getModel(),n=g.getAnnotations(0,
b.getCharCount());for(this.textView.setRedraw(!1);n.hasNext();)b=n.next(),b.type===m.AnnotationType.ANNOTATION_FOLDING&&b.expanded&&(b.collapse(),g.modifyAnnotation(b));this.textView.setRedraw(!0);return!0}.bind(this),{name:p.collapseAll});this.textView.setKeyBinding(new t.KeyBinding("q",!r.isMac,!1,!1,r.isMac),"lastEdit");this.textView.setAction("lastEdit",function(){"number"===typeof this._lastEditLocation&&this.editor.showSelection(this._lastEditLocation);return!0}.bind(this),{name:p.lastEdit})},
toggleIncrementalFind:function(){(this._incrementalFindActive=!this._incrementalFindActive)?(this.editor.reportStatus(r.formatMessage(p.incrementalFind,this._incrementalFindPrefix)),this.textView.addEventListener("Verify",this._incrementalFindListener.onVerify),this.textView.addEventListener("Selection",this._incrementalFindListener.onSelection)):(this._incrementalFindPrefix="",this.editor.reportStatus(""),this.textView.removeEventListener("Verify",this._incrementalFindListener.onVerify),this.textView.removeEventListener("Selection",
this._incrementalFindListener.onSelection),this.textView.setCaretOffset(this.textView.getCaretOffset()))},startUndo:function(){this.undoStack&&this.undoStack.startCompoundChange()},endUndo:function(){this.undoStack&&this.undoStack.endCompoundChange()},cancel:function(){this.toggleIncrementalFind()},isActive:function(){return this._incrementalFindActive},isStatusActive:function(){return this._incrementalFindActive},lineUp:function(){if(this._incrementalFindActive){var b=this._incrementalFindPrefix;
if(0===b.length)return!1;var g=this.editor,a=g.getModel(),a=this._incrementalFindSuccess?g.getCaretOffset()-b.length-1:a.getCharCount()-1;(a=g.getModel().find({string:b,start:a,reverse:!0,caseInsensitive:b.toLowerCase()===b}).next())?(this._incrementalFindIgnoreSelection=this._incrementalFindSuccess=!0,g.moveSelection(a.start,a.end),this._incrementalFindIgnoreSelection=!1,g.reportStatus(r.formatMessage(p.incrementalFind,b))):(g.reportStatus(r.formatMessage(p.incrementalFindNotFound,b),"error"),this._incrementalFindSuccess=
!1);return!0}return!1},lineDown:function(){if(this._incrementalFindActive){var b=this._incrementalFindPrefix;if(0===b.length)return!1;var g=this.editor,a=0;this._incrementalFindSuccess&&(a=g.getSelection().start+1);(a=g.getModel().find({string:b,start:a,caseInsensitive:b.toLowerCase()===b}).next())?(this._incrementalFindIgnoreSelection=this._incrementalFindSuccess=!0,g.moveSelection(a.start,a.end),this._incrementalFindIgnoreSelection=!1,g.reportStatus(r.formatMessage(p.incrementalFind,b))):(g.reportStatus(r.formatMessage(p.incrementalFindNotFound,
b),"error"),this._incrementalFindSuccess=!1);return!0}return!1},enter:function(){return!1}};b.prototype={startUndo:function(){this.undoStack&&this.undoStack.startCompoundChange()},endUndo:function(){this.undoStack&&this.undoStack.endCompoundChange()},init:function(){function b(g,n,a){var c=g.getLineAtOffset(n),d=g.getLineAtOffset(a),e,f,h,k,m,l;for(e=c;0<=e&&!(f=g.getLine(e),h=e===c?n-g.getLineStart(c):f.length,k=f.lastIndexOf("/*",h),f=f.lastIndexOf("*/",h),f>k);e--)if(-1!==k){m=g.getLineStart(e)+
k;break}for(e=d;e<g.getLineCount()&&!(f=g.getLine(e),h=e===d?a-g.getLineStart(d):0,k=f.indexOf("/*",h),f=f.indexOf("*/",h),-1!==k&&k<f);e++)if(-1!==f){l=g.getLineStart(e)+f;break}return{commentStart:m,commentEnd:l}}this.textView.setAction("lineStart",function(){for(var b=this.editor,g=b.getModel(),n=b.getCaretOffset(),a=g.getLineAtOffset(n),c=g.getLineStart(a),g=g.getLine(a),a=0;a<g.length;a++){var d=g.charCodeAt(a);if(!(32===d||9===d))break}a+=c;return n!==a?(b.setSelection(a,a),!0):!1}.bind(this));
this.textView.setKeyBinding(new t.KeyBinding(191,!0),"toggleLineComment");this.textView.setAction("toggleLineComment",function(){if(this.textView.getOptions("readonly"))return!1;for(var b=this.editor,g=b.getModel(),n=b.getSelection(),a=g.getLineAtOffset(n.start),c=g.getLineAtOffset(n.end>n.start?n.end-1:n.end),d=!0,e=[],f,h,k=a;k<=c;k++)if(f=g.getLine(k,!0),e.push(f),!d||-1===(h=f.indexOf("//")))d=!1;else if(0!==h){var m;for(m=0;m<h&&!(d=f.charCodeAt(m),!(32===d||9===d));m++);d=m===h}k=g.getLineStart(a);
m=g.getLineEnd(c,!0);if(d){for(d=0;d<e.length;d++)f=e[d],h=f.indexOf("//"),e[d]=f.substring(0,h)+f.substring(h+2);e=e.join("");f=g.getLineStart(c);g=k===n.start?n.start:n.start-2;n=n.end-2*(c-a+1)+(n.end===f+1?2:0)}else e.splice(0,0,""),e=e.join("//"),g=k===n.start?n.start:n.start+2,n=n.end+2*(c-a+1);b.setText(e,k,m);b.setSelection(g,n);return!0}.bind(this),{name:p.toggleLineComment});this.textView.setKeyBinding(new t.KeyBinding(191,!0,!r.isMac,!1,r.isMac),"addBlockComment");this.textView.setAction("addBlockComment",
function(){if(this.textView.getOptions("readonly"))return!1;var g=this.editor,a=g.getModel(),c=g.getSelection(),d=RegExp("/\\*|\\*/","g"),e=b(a,c.start,c.end);if(void 0!==e.commentStart&&void 0!==e.commentEnd)return!0;a=a.getText(c.start,c.end);if(0===a.length)return!0;e=a.length;a=a.replace(d,"");d=a.length;g.setText("/*"+a+"*/",c.start,c.end);g.setSelection(c.start+2,c.end+2+(d-e));return!0}.bind(this),{name:p.addBlockComment});this.textView.setKeyBinding(new t.KeyBinding(220,!0,!r.isMac,!1,r.isMac),
"removeBlockComment");this.textView.setAction("removeBlockComment",function(){if(this.textView.getOptions("readonly"))return!1;var g=this.editor,a=g.getModel(),c=g.getSelection(),d=a.getText(c.start,c.end),e,f,h;for(h=0;h<d.length;h++)if("/*"===d.substring(h,h+2)){e=c.start+h;break}for(;h<d.length;h++)if("*/"===d.substring(h,h+2)){f=c.start+h;break}if(void 0!==e&&void 0!==f)g.setText(a.getText(e+2,f),e,f+2),g.setSelection(e,f);else{d=b(a,c.start,c.end);if(void 0===d.commentStart||void 0===d.commentEnd)return!0;
a=a.getText(d.commentStart+2,d.commentEnd);g.setText(a,d.commentStart,d.commentEnd+2);g.setSelection(c.start-2,c.end-2)}return!0}.bind(this),{name:p.removeBlockComment})},contentAssistProposalApplied:function(b){b=b.data.proposal;if(b.positions&&this.linkedMode){for(var g=[],a=0;a<b.positions.length;++a)g[a]={positions:[{offset:b.positions[a].offset,length:b.positions[a].length}]};this.linkedMode.enterLinkedMode({groups:g,escapePosition:b.escapePosition})}else b.escapePosition&&this.textView.setCaretOffset(b.escapePosition);
return!0},cancel:function(){return!1},isActive:function(){return!0},isStatusActive:function(){return!1},lineUp:function(){return!1},lineDown:function(){return!1},enter:function(){if(this.textView.getOptions("readonly"))return!1;var b=this.editor,g=b.getSelection();if(g.start===g.end){for(var a=b.getModel(),c=a.getLineAtOffset(g.start),d=a.getLine(c,!0),e=a.getLineStart(c),c=0,e=g.start-e,f;c<e&&(32===(f=d.charCodeAt(c))||9===f);)c++;if(0<c){for(var h=d.substring(0,c),c=e;c<d.length&&(32===(f=d.charCodeAt(c++))||
9===f);)g.end++;b.setText(a.getLineDelimiter()+h,g.start,g.end);return!0}}return!1},tab:function(){return!1}};g.prototype={enterLinkedMode:function(b){if(!this.linkedModeActive){this.linkedModeActive=!0;this.linkedModePositions=[];for(var g=0;g<b.groups.length;++g){var a=b.groups[g];this.linkedModePositions[g]={offset:a.positions[0].offset,length:a.positions[0].length}}this.linkedModeEscapePosition=b.escapePosition;this.linkedModeCurrentPositionIndex=0;this.selectTextForLinkedModePosition(this.linkedModePositions[this.linkedModeCurrentPositionIndex]);
this.textView.addEventListener("Verify",this.linkedModeListener.onVerify);this.textView.setKeyBinding(new t.KeyBinding(9),"nextLinkedModePosition");this.textView.setAction("nextLinkedModePosition",function(){this.linkedModeCurrentPositionIndex=++this.linkedModeCurrentPositionIndex%this.linkedModePositions.length;this.selectTextForLinkedModePosition(this.linkedModePositions[this.linkedModeCurrentPositionIndex]);return!0}.bind(this));this.textView.setKeyBinding(new t.KeyBinding(9,!1,!0),"previousLinkedModePosition");
this.textView.setAction("previousLinkedModePosition",function(){this.linkedModeCurrentPositionIndex=0<this.linkedModeCurrentPositionIndex?this.linkedModeCurrentPositionIndex-1:this.linkedModePositions.length-1;this.selectTextForLinkedModePosition(this.linkedModePositions[this.linkedModeCurrentPositionIndex]);return!0}.bind(this));this.editor.reportStatus(p.linkedModeEntered,null,!0)}},isActive:function(){return this.linkedModeActive},isStatusActive:function(){return this.linkedModeActive},enter:function(){this.cancel();
return!0},cancel:function(b){this.linkedModeActive&&(this.linkedModeActive=!1,this.textView.removeEventListener("Verify",this.linkedModeListener.onVerify),this.textView.setKeyBinding(new t.KeyBinding(9),"tab"),this.textView.setKeyBinding(new t.KeyBinding(9,!1,!0),"shiftTab"),b||this.textView.setCaretOffset(this.linkedModeEscapePosition,!1),this.editor.reportStatus(p.linkedModeExited,null,!0))},lineUp:function(){this.cancel(!0);return!1},lineDown:function(){this.cancel(!0);return!1},selectTextForLinkedModePosition:function(b){this.textView.setSelection(b.offset,
b.offset+b.length)}};return{UndoFactory:a,LineNumberRulerFactory:c,FoldingRulerFactory:e,AnnotationFactory:f,TextDNDFactory:h,TextActions:k,SourceCodeActions:b,LinkedMode:g}})},"orion/editor/jsContentAssist":function(){define("orion/editor/jsContentAssist",[],function(){function p(a,c){return c.substring(a.length)}function u(a,c,d,b,g){for(var n,v,e,x,A=0;A<a.length;A++)if(x=a[A].name,0===x.indexOf(d))if(v=a[A].args,!v||0===v.length)n=x+(a[A].field?"":"()"),v=n+" - "+c,g.push({proposal:p(d,n),description:v});
else{n=x+"(";e=[];x=b+x.length+1-d.length;for(var B=0;B<v.length;B++)e.push({offset:x,length:v[B].length}),x+=v[B].length+2,n+=v[B],B<v.length-1&&(n+=", ");n+=")";v=n+" - "+c;x--;g.push({proposal:p(d,n),description:v,positions:e,escapePosition:x})}}function t(a,c,d){var b=d-a.length,g=[],n="";for(d-=1;0<d;){var v=c.charAt(d--);if("\n"===v||"\r"===v)break;n=/\s/.test(v)?v.concat(n):""}c=n;0==="if".indexOf(a)&&(n="if - if statement",d=[{offset:b+4,length:9}],v=b+c.length+18,g.push({proposal:p(a,"if (condition) {\n"+
c+"\t\n"+c+"}"),description:n,positions:d,escapePosition:v}),n="if - if else statement",d=[{offset:b+4,length:9}],v=b+c.length+18,g.push({proposal:p(a,"if (condition) {\n"+c+"\t\n"+c+"} else {\n"+c+"\t\n"+c+"}"),description:n,positions:d,escapePosition:v}));0==="for".indexOf(a)&&(n="for - iterate over array",d=[{offset:b+9,length:1},{offset:b+20,length:5}],v=b+c.length+42,g.push({proposal:p(a,"for (var i \x3d 0; i \x3c array.length; i++) {\n"+c+"\t\n"+c+"}"),description:n,positions:d,escapePosition:v}),
n="for..in - iterate over properties of an object",d=[{offset:b+9,length:8},{offset:b+21,length:6}],v=b+2*c.length+73,g.push({proposal:p(a,"for (var property in object) {\n"+c+"\tif (object.hasOwnProperty(property)) {\n"+c+"\t\t\n"+c+"\t}\n"+c+"}"),description:n,positions:d,escapePosition:v}));0==="while".indexOf(a)&&(n="while - while loop with condition",d=[{offset:b+7,length:9}],v=b+c.length+21,g.push({proposal:p(a,"while (condition) {\n"+c+"\t\n"+c+"}"),description:n,positions:d,escapePosition:v}));
0==="do".indexOf(a)&&(n="do - do while loop with condition",d=[{offset:b+16,length:9}],v=b+c.length+6,g.push({proposal:p(a,"do {\n"+c+"\t\n"+c+"} while (condition);"),description:n,positions:d,escapePosition:v}));0==="switch".indexOf(a)&&(n="switch - switch case statement",d=[{offset:b+8,length:10},{offset:b+28,length:6}],v=b+2*c.length+38,g.push({proposal:p(a,"switch (expression) {\n"+c+"\tcase value1:\n"+c+"\t\t\n"+c+"\t\tbreak;\n"+c+"\tdefault:\n"+c+"}"),description:n,positions:d,escapePosition:v}));
0==="try".indexOf(a)&&(n="try - try..catch statement",v=b+c.length+7,g.push({proposal:p(a,"try {\n"+c+"\t\n"+c+"} catch (err) {\n"+c+"}"),description:n,escapePosition:v}),n="try - try..catch statement with finally block",v=b+c.length+7,g.push({proposal:p(a,"try {\n"+c+"\t\n"+c+"} catch (err) {\n"+c+"} finally {\n"+c+"}"),description:n,escapePosition:v}));return g}function d(a,c,d){c="break case catch continue debugger default delete do else finally for function if in instanceof new return switch this throw try typeof var void while with".split(" ");
d=[];for(var b=0;b<c.length;b++)0===c[b].indexOf(a)&&d.push({proposal:p(a,c[b]),description:c[b]});return d}function m(a,c){var d=a.charAt(c);switch(d){case "/":if("/"===a.charAt(c+1)){if(c=a.indexOf("\n",c)+2,1===c)return a.length}else if("*"===a.charAt(c+1)){if(c=a.indexOf("*/",c+2)+2,1===c)return a.length}else{var b=a.indexOf("\n",c);0>b&&(b=a.length);for(d=a.indexOf("/",c+1);0<d&&d<b&&"\\"===a.charAt(d-1);)d=a.indexOf("/",d+1);c=0<d&&b>d?d:b;c++}break;case '"':case "'":b=a.indexOf("\n",c);0>b&&
(b=a.length);for(var g=a.indexOf(d,c+1);0<g&&g<b&&"\\"===a.charAt(g-1);)g=a.indexOf(d,g+1);c=0<g&&b>g?g:b;c++}return c}function l(a,c){for(var d=c,b=0;d<a.length;){d=m(a,d);switch(a.charAt(d)){case "{":b++;break;case "}":if(0===--b)return d}d++}return d}function q(a,c){var d=a.substring(0,c),b=d.lastIndexOf("function");return 0<=b?(d=d.indexOf("{",b),d=l(a,d),d<c?q(a,b):a.substring(b,d)):null}function s(a,c,d){var b=[],g,n=q(c,d);d=0;if(n){d=c.indexOf(n);g=n.indexOf("(");var v=n.indexOf(")");if(0<=
g&&0<=v){v=n.substring(g+1,v).split(",");for(g=0;g<v.length;g++){var e=v[g].trim();0===e.indexOf(a)&&b.push({proposal:p(a,e),description:e})}}g=n.indexOf("{");0<g&&(n=n.substring(g+1))}else n=c;g=n;n=[];for(v=0;(v=m(g,v))<g.length;)e=g.substring(v),e.match(/^var\s/)?(e=g.indexOf(";",v),0>e&&(e=g.length),(v=g.substring(v+3,e).match(/[\w]+/))&&n.push(v[0]),v=e+1):e.match(/^function[\s(]/)?v=l(g,v):(e=g.substring(v).match(/^\w[\w\s\()]+/))?v+=e[0].length:v++;for(g=0;g<n.length;g++)0===n[g].indexOf(a)&&
b.push({proposal:p(a,n[g]),description:n[g]});0<d&&(b=b.concat(s(a,c,d)));return b}function r(a,c,d){c=c.substring(0,d);var b;b="";for(var g=0;g<c.length;)g=m(c,g),b+=c.charAt(g++);return s(a,b,d-(c.length-b.length))}function a(){}var c=[{name:"toString"},{name:"toLocaleString"},{name:"valueOf"},{name:"hasOwnProperty",args:["property"]},{name:"isPrototypeOf",args:["object"]},{name:"propertyIsEnumerable",args:["property"]}],e=[{name:"charAt",args:["index"]},{name:"charCodeAt",args:["index"]},{name:"concat",
args:["array"]},{name:"indexOf",args:["searchString","[position]"]},{name:"lastIndexOf",args:["searchString","[position]"]},{name:"length",field:!0},{name:"localeCompare",args:["object"]},{name:"match",args:["regexp"]},{name:"replace",args:["searchValue","replaceValue"]},{name:"search",args:["regexp"]},{name:"slice",args:["start","end"]},{name:"split",args:["separator","[limit]"]},{name:"substring",args:["start","[end]"]},{name:"toLowerCase"},{name:"toLocaleLowerCase"},{name:"toUpperCase"},{name:"toLocaleUpperCase"},
{name:"trim"}];a.prototype={computeProposals:function(a,h,k){k=k.prefix;var b=[];if(0<h&&"."===a.charAt(h-k.length-1)){for(var b=[],g=h-1;0<g;){var n=a.charAt(g);if("\n"===n||"\r"===n)break;g--}a=a.substring(g+1,h-k.length);"String"===(1<a.length&&('"'===a.charAt(a.length-2)||"'"===a.charAt(a.length-2))?"String":null)&&u(e,"String",k,h,b);u(c,"Object",k,h,b);return b}b=b.concat(r(k,a,h-k.length));b=b.concat(t(k,a,h));return b=b.concat(d(k,a,h))}};return{JavaScriptContentAssistProvider:a}})},"orion/editor/textDND":function(){define("orion/editor/textDND",
[],function(){function p(p,t){this._view=p;this._undoStack=t;this._dragSelection=null;this._dropOffset=-1;this._dropText=null;var d=this;this._listener={onDragStart:function(m){d._onDragStart(m)},onDragEnd:function(m){d._onDragEnd(m)},onDragEnter:function(m){d._onDragEnter(m)},onDragOver:function(m){d._onDragOver(m)},onDrop:function(m){d._onDrop(m)},onDestroy:function(m){d._onDestroy(m)}};p.addEventListener("DragStart",this._listener.onDragStart);p.addEventListener("DragEnd",this._listener.onDragEnd);
p.addEventListener("DragEnter",this._listener.onDragEnter);p.addEventListener("DragOver",this._listener.onDragOver);p.addEventListener("Drop",this._listener.onDrop);p.addEventListener("Destroy",this._listener.onDestroy)}p.prototype={destroy:function(){var p=this._view;p&&(p.removeEventListener("DragStart",this._listener.onDragStart),p.removeEventListener("DragEnd",this._listener.onDragEnd),p.removeEventListener("DragEnter",this._listener.onDragEnter),p.removeEventListener("DragOver",this._listener.onDragOver),
p.removeEventListener("Drop",this._listener.onDrop),p.removeEventListener("Destroy",this._listener.onDestroy),this._view=null)},_onDestroy:function(p){this.destroy()},_onDragStart:function(p){var t=this._view,d=t.getSelection(),t=t.getModel();t.getBaseModel&&(d.start=t.mapOffset(d.start),d.end=t.mapOffset(d.end),t=t.getBaseModel());if(t=t.getText(d.start,d.end))this._dragSelection=d,p.event.dataTransfer.effectAllowed="copyMove",p.event.dataTransfer.setData("Text",t)},_onDragEnd:function(p){var t=
this._view;if(this._dragSelection){this._undoStack&&this._undoStack.startCompoundChange();(p="move"===p.event.dataTransfer.dropEffect)&&t.setText("",this._dragSelection.start,this._dragSelection.end);if(this._dropText){var d=this._dropText,m=this._dropOffset;p&&(m>=this._dragSelection.end?m-=this._dragSelection.end-this._dragSelection.start:m>=this._dragSelection.start&&(m=this._dragSelection.start));t.setText(d,m,m);t.setSelection(m,m+d.length);this._dropText=null;this._dropOffset=-1}this._undoStack&&
this._undoStack.endCompoundChange()}this._dragSelection=null},_onDragEnter:function(p){this._onDragOver(p)},_onDragOver:function(p){var t=p.event.dataTransfer.types;if(t){var d=!this._view.getOptions("readonly");d&&(d=t.contains?t.contains("text/plain"):-1!==t.indexOf("text/plain"));d||(p.event.dataTransfer.dropEffect="none")}},_onDrop:function(p){var t=this._view,d=p.event.dataTransfer.getData("Text");d&&(p=t.getOffsetAtLocation(p.x,p.y),this._dragSelection?(this._dropOffset=p,this._dropText=d):
(t.setText(d,p,p),t.setSelection(p,p+d.length)))}};return{TextDND:p}})},"orion/editor/htmlGrammar":function(){define("orion/editor/htmlGrammar",[],function(){return{HtmlGrammar:function(){return{scopeName:"source.html",uuid:"3B5C76FB-EBB5-D930-F40C-047D082CE99B",patterns:[{begin:"\x3c!(doctype|DOCTYPE)",end:"\x3e",contentName:"entity.name.tag.doctype.html",beginCaptures:{"0":{name:"entity.name.tag.doctype.html"}},endCaptures:{"0":{name:"entity.name.tag.doctype.html"}}},{begin:"\x3c!--",end:"--\x3e",
beginCaptures:{"0":{name:"punctuation.definition.comment.html"}},endCaptures:{"0":{name:"punctuation.definition.comment.html"}},patterns:[{match:"--",name:"invalid.illegal.badcomment.html"}],contentName:"comment.block.html"},{match:"\x3c[A-Za-z0-9_\\-:]+(?\x3d ?)",name:"entity.name.tag.html"},{include:"#attrName"},{include:"#qString"},{include:"#qqString"},{include:"#entity"},{match:"\x3c/[A-Za-z0-9_\\-:]+\x3e",name:"entity.name.tag.html"},{match:"\x3e",name:"entity.name.tag.html"}],repository:{attrName:{match:"[A-Za-z\\-:]+(?\x3d\\s*\x3d\\s*['\"])",
name:"entity.other.attribute.name.html"},qqString:{match:'(")[^"]+(")',name:"token.string"},qString:{match:"(')[^']+(')",name:"token.string"},entity:{match:"\x26[A-Za-z0-9]+;",name:"constant.character.entity.html"}}}}}})},"orion/editor/projectionTextModel":function(){define("orion/editor/projectionTextModel",["orion/editor/textModel","orion/editor/eventTarget"],function(p,u){function t(d){this._model=d;this._projections=[]}t.prototype={addProjection:function(d){if(d){var m=this._model,l=this._projections;
d._lineIndex=m.getLineAtOffset(d.start);d._lineCount=m.getLineAtOffset(d.end)-d._lineIndex;var q=d.text;q||(q="");d._model="string"===typeof q?new p.TextModel(q,m.getLineDelimiter()):q;var m=this.mapOffset(d.start,!0),q=d.end-d.start,s=d._lineCount,r=d._model.getCharCount(),a=d._model.getLineCount()-1,c={type:"Changing",text:d._model.getText(),start:m,removedCharCount:q,addedCharCount:r,removedLineCount:s,addedLineCount:a};this.onChanging(c);c=this._binarySearch(l,d.start);l.splice(c,0,d);this.onChanged({type:"Changed",
start:m,removedCharCount:q,addedCharCount:r,removedLineCount:s,addedLineCount:a})}},getProjections:function(){return this._projections.slice(0)},getBaseModel:function(){return this._model},mapOffset:function(d,m){var l=this._projections,q=0,s,r;if(m){for(s=0;s<l.length;s++){r=l[s];if(r.start>d)break;if(r.end>d)return-1;q+=r._model.getCharCount()-(r.end-r.start)}return d+q}for(s=0;s<l.length;s++){r=l[s];if(r.start>d-q)break;var a=r._model.getCharCount();if(r.start+a>d-q)return-1;q+=a-(r.end-r.start)}return d-
q},removeProjection:function(d){var m,l=0;for(m=0;m<this._projections.length;m++){var q=this._projections[m];if(q===d){d=q;break}l+=q._model.getCharCount()-(q.end-q.start)}if(m<this._projections.length){var q=this._model,l=d.start+l,s=d.end-d.start,r=d._lineCount,a=d._model.getCharCount(),c=d._model.getLineCount()-1;d={type:"Changing",text:q.getText(d.start,d.end),start:l,removedCharCount:a,addedCharCount:s,removedLineCount:c,addedLineCount:r};this.onChanging(d);this._projections.splice(m,1);this.onChanged({type:"Changed",
start:l,removedCharCount:a,addedCharCount:s,removedLineCount:c,addedLineCount:r})}},_binarySearch:function(d,m){for(var l=d.length,q=-1,s;1<l-q;)s=Math.floor((l+q)/2),m<=d[s].start?l=s:q=s;return l},getCharCount:function(){for(var d=this._model.getCharCount(),m=this._projections,l=0;l<m.length;l++)var q=m[l],d=d+(q._model.getCharCount()-(q.end-q.start));return d},getLine:function(d,m){if(0>d)return null;var l=this._model,q=this._projections,s=0,r=[],a=0,c,e,f;for(c=0;c<q.length;c++){f=q[c];if(f._lineIndex>=
d-s)break;e=f._model.getLineCount()-1;if(f._lineIndex+e>=d-s){a=d-(f._lineIndex+s);if(a<e)return f._model.getLine(a,m);r.push(f._model.getLine(e))}a=f.end;s+=e-f._lineCount}for(a=Math.max(a,l.getLineStart(d-s));c<q.length;c++){f=q[c];if(f._lineIndex>d-s)break;r.push(l.getText(a,f.start));e=f._model.getLineCount()-1;if(f._lineIndex+e>d-s)return r.push(f._model.getLine(0,m)),r.join("");r.push(f._model.getText());a=f.end;s+=e-f._lineCount}q=l.getLineEnd(d-s,m);a<q&&r.push(l.getText(a,q));return r.join("")},
getLineAtOffset:function(d){for(var m=this._model,l=this._projections,q=0,s=0,r=0;r<l.length;r++){var a=l[r];if(a.start>d-q)break;var c=a._model.getCharCount();if(a.start+c>d-q){l=d-(a.start+q);s+=a._model.getLineAtOffset(l);q+=l;break}s+=a._model.getLineCount()-1-a._lineCount;q+=c-(a.end-a.start)}return m.getLineAtOffset(d-q)+s},getLineCount:function(){for(var d=this._projections,m=this._model.getLineCount(),l=0;l<d.length;l++)var q=d[l],m=m+(q._model.getLineCount()-1-q._lineCount);return m},getLineDelimiter:function(){return this._model.getLineDelimiter()},
getLineEnd:function(d,m){if(0>d)return-1;for(var l=this._model,q=this._projections,s=0,r=0,a=0;a<q.length;a++){var c=q[a];if(c._lineIndex>d-s)break;var e=c._model.getLineCount()-1;if(c._lineIndex+e>d-s)return c._model.getLineEnd(d-(c._lineIndex+s),m)+c.start+r;r+=c._model.getCharCount()-(c.end-c.start);s+=e-c._lineCount}return l.getLineEnd(d-s,m)+r},getLineStart:function(d){if(0>d)return-1;for(var m=this._model,l=this._projections,q=0,s=0,r=0;r<l.length;r++){var a=l[r];if(a._lineIndex>=d-q)break;
var c=a._model.getLineCount()-1;if(a._lineIndex+c>=d-q)return a._model.getLineStart(d-(a._lineIndex+q))+a.start+s;s+=a._model.getCharCount()-(a.end-a.start);q+=c-a._lineCount}return m.getLineStart(d-q)+s},getText:function(d,m){void 0===d&&(d=0);var l=this._model,q=this._projections,s=0,r=[],a,c,e;for(a=0;a<q.length;a++){c=q[a];if(c.start>d-s)break;e=c._model.getCharCount();if(c.start+e>d-s){if(void 0!==m&&c.start+e>m-s)return c._model.getText(d-(c.start+s),m-(c.start+s));r.push(c._model.getText(d-
(c.start+s)));d=c.end+s+e-(c.end-c.start)}s+=e-(c.end-c.start)}var f=d-s;if(void 0!==m){for(;a<q.length;a++){c=q[a];if(c.start>m-s)break;r.push(l.getText(f,c.start));e=c._model.getCharCount();if(c.start+e>m-s)return r.push(c._model.getText(0,m-(c.start+s))),r.join("");r.push(c._model.getText());f=c.end;s+=e-(c.end-c.start)}r.push(l.getText(f,m-s))}else{for(;a<q.length;a++)c=q[a],r.push(l.getText(f,c.start)),r.push(c._model.getText()),f=c.end;r.push(l.getText(f))}return r.join("")},_onChanging:function(d,
m,l,q,s,r){for(var a=this._model,c=this._projections,e,f=0,h,k=m+l;e<c.length;e++){l=c[e];if(l.start>m)break;f+=l._model.getCharCount()-(l.end-l.start)}m+=f;for(var b=e;e<c.length;e++){l=c[e];if(l.start>k)break;f+=l._model.getCharCount()-(l.end-l.start);h+=l._model.getLineCount()-1-l._lineCount}l=k+f;f=e;this.onChanging(m,l-m,q,s+h,r);c.splice(c,f-b);for(d=d.length-(l-m);e<c.length;e++)l=c[e],l.start+=d,l.end+=d,l._lineIndex=a.getLineAtOffset(l.start)},onChanging:function(d){return this.dispatchEvent(d)},
onChanged:function(d){return this.dispatchEvent(d)},setLineDelimiter:function(d){this._model.setLineDelimiter(d)},setText:function(d,m,l){void 0===d&&(d="");void 0===m&&(m=0);var q=m,s=l,r=this._model,a=this._projections,c=0,e=0,f,h,k,b,g,n=0;for(f=0;f<a.length;f++){h=a[f];if(h.start>m-c)break;k=h._model.getCharCount();if(h.start+k>m-c){if(void 0!==l&&h.start+k>l-c){h._model.setText(d,m-(h.start+c),l-(h.start+c));return}n=h._model.getLineCount()-1-h._model.getLineAtOffset(m-(h.start+c));b={projection:h,
start:m-(h.start+c)};m=h.end+c+k-(h.end-h.start)}e+=h._model.getLineCount()-1-h._lineCount;c+=k-(h.end-h.start)}m-=c;var v=f,n=r.getLineAtOffset(m)+e-n;if(void 0!==l)for(;f<a.length;f++){h=a[f];if(h.start>l-c)break;k=h._model.getCharCount();if(h.start+k>l-c){e+=h._model.getLineAtOffset(l-(h.start+c));k=l-(h.start+c);l=h.end+c;g={projection:h,end:k};break}e+=h._model.getLineCount()-1-h._lineCount;c+=k-(h.end-h.start)}else{for(;f<a.length;f++)h=a[f],e+=h._model.getLineCount()-1-h._lineCount,c+=h._model.getCharCount()-
(h.end-h.start);l=s=r.getCharCount()+c}l-=c;h=r.getLineAtOffset(l)+e;for(var s=s-q,e=h-n,n=d.length,y=k=h=c=0;;){-1!==h&&h<=y&&(h=d.indexOf("\r",y));-1!==k&&k<=y&&(k=d.indexOf("\n",y));if(-1===k&&-1===h)break;y=-1!==h&&-1!==k?h+1===k?k+1:(h<k?h:k)+1:-1!==h?h+1:k+1;c++}this.onChanging({type:"Changing",text:d,start:q,removedCharCount:s,addedCharCount:n,removedLineCount:e,addedLineCount:c});r.setText(d,m,l);b&&(h=b.projection,h._model.setText("",b.start));g&&(h=g.projection,h._model.setText("",0,g.end),
h.start=h.end,h._lineCount=0);a.splice(v,f-v);for(d=d.length-(l-m);f<a.length;f++)h=a[f],h.start+=d,h.end+=d,h._lineIndex=r.getLineAtOffset(h.start);this.onChanged({type:"Changed",start:q,removedCharCount:s,addedCharCount:n,removedLineCount:e,addedLineCount:c})}};u.EventTarget.addMixin(t.prototype);return{ProjectionTextModel:t}})},"orion/editor/rulers":function(){define("orion/editor/rulers",["i18n!orion/editor/nls/messages","orion/editor/annotations","orion/editor/tooltip","orion/editor/util"],function(p,
u,t,d){function m(a,c,d,f){this._location=c||"left";this._overview=d||"page";this._rulerStyle=f;this._view=null;var h=this;this._listener={onTextModelChanged:function(a){h._onTextModelChanged(a)},onAnnotationModelChanged:function(a){h._onAnnotationModelChanged(a)}};this.setAnnotationModel(a)}function l(a,c,d,f,h){m.call(this,a,c,"page",d);this._oddStyle=f||{style:{backgroundColor:"white"}};this._evenStyle=h||{style:{backgroundColor:"white"}};this._numOfDigits=0}function q(a,c,d){m.call(this,a,c,"page",
d)}function s(a,c,d){m.call(this,a,c,"document",d)}function r(a,c,d){q.call(this,a,c,d)}m.prototype={getAnnotations:function(a,c){var d=this._annotationModel;if(!d)return[];var f=this._view.getModel(),h=f.getLineStart(a),k=f.getLineEnd(c-1),b=f;f.getBaseModel&&(b=f.getBaseModel(),h=f.mapOffset(h),k=f.mapOffset(k));for(var g=[],d=this.getAnnotationsByType(d,h,k),h=0;h<d.length;h++)for(var k=d[h],n=b.getLineAtOffset(k.start),v=b.getLineAtOffset(Math.max(k.start,k.end-1)),y=n;y<=v;y++){var x=y;if(f!==
b){x=b.getLineStart(y);x=f.mapOffset(x,!0);if(-1===x)continue;x=f.getLineAtOffset(x)}if(a<=x&&x<c){var A=this._mergeAnnotation(g[x],k,y-n,v-n+1);A&&(g[x]=A)}}if(!this._multiAnnotation&&this._multiAnnotationOverlay)for(var B in g)g[B]._multiple&&(g[B].html+=this._multiAnnotationOverlay.html);return g},getAnnotationModel:function(){return this._annotationModel},getLocation:function(){return this._location},getOverview:function(){return this._overview},getRulerStyle:function(){return this._rulerStyle},
getView:function(){return this._view},getWidestAnnotation:function(){return null},setAnnotationModel:function(a){this._annotationModel&&this._annotationModel.removEventListener("Changed",this._listener.onAnnotationModelChanged);(this._annotationModel=a)&&this._annotationModel.addEventListener("Changed",this._listener.onAnnotationModelChanged)},setMultiAnnotation:function(a){this._multiAnnotation=a},setMultiAnnotationOverlay:function(a){this._multiAnnotationOverlay=a},setView:function(a){this._onTextModelChanged&&
this._view&&this._view.removeEventListener("ModelChanged",this._listener.onTextModelChanged);this._view=a;this._onTextModelChanged&&this._view&&this._view.addEventListener("ModelChanged",this._listener.onTextModelChanged)},onClick:function(a,c){},onDblClick:function(a,c){},onMouseMove:function(a,c){var d=t.Tooltip.getTooltip(this._view);if(d&&!(d.isVisible()&&this._tooltipLineIndex===a)){this._tooltipLineIndex=a;var f=this;d.setTarget({y:c.clientY,getTooltipInfo:function(){return f._getTooltipInfo(f._tooltipLineIndex,
this.y)}})}},onMouseOver:function(a,c){this.onMouseMove(a,c)},onMouseOut:function(a,c){var d=t.Tooltip.getTooltip(this._view);d&&d.setTarget(null)},_getTooltipInfo:function(a,c){if(void 0!==a){var d=this._view,f=d.getModel(),h=this._annotationModel,k=[];if(h){var k=f.getLineStart(a),b=f.getLineEnd(a);f.getBaseModel&&(k=f.mapOffset(k),b=f.mapOffset(b));k=this.getAnnotationsByType(h,k,b)}h=this._getTooltipContents(a,k);if(!h)return null;h={contents:h,anchor:this.getLocation()};k=d.getClientArea();"document"===
this.getOverview()?k.y=d.convert({y:c},"view","document").y:k.y=d.getLocationAtOffset(f.getLineStart(a)).y;d.convert(k,"document","page");h.x=k.x;h.y=k.y;"right"===h.anchor&&(h.x+=k.width);return h}},_getTooltipContents:function(a,c){return c},_onAnnotationModelChanged:function(a){function c(b){for(var g=0;g<b.length;g++)if(h.isAnnotationTypeVisible(b[g].type)){var n=b[g].start,a=b[g].end;f.getBaseModel&&(n=f.mapOffset(n,!0),a=f.mapOffset(a,!0));-1!==n&&-1!==a&&d.redrawLines(f.getLineAtOffset(n),
f.getLineAtOffset(Math.max(n,a-1))+1,h)}}var d=this._view;if(d){var f=d.getModel(),h=this,k=f.getLineCount();a.textModelChangedEvent?(a=a.textModelChangedEvent.start,f.getBaseModel&&(a=f.mapOffset(a,!0)),a=f.getLineAtOffset(a),d.redrawLines(a,k,h)):(c(a.added),c(a.removed),c(a.changed))}},_mergeAnnotation:function(a,c,d,f){a||(a={});0===d&&(a.html&&c.html?(c.html!==a.html&&(!a._multiple&&this._multiAnnotation)&&(a.html=this._multiAnnotation.html),a._multiple=!0):a.html=c.html);a.style=this._mergeStyle(a.style,
c.style);return a},_mergeStyle:function(a,c){if(c){a||(a={});a.styleClass=a.styleClass&&c.styleClass&&a.styleClass!==c.styleClass?a.styleClass+(" "+c.styleClass):c.styleClass;var d;if(c.style)for(d in a.style||(a.style={}),c.style)a.style[d]||(a.style[d]=c.style[d]);if(c.attributes)for(d in a.attributes||(a.attributes={}),c.attributes)a.attributes[d]||(a.attributes[d]=c.attributes[d])}return a}};u.AnnotationTypeList.addMixin(m.prototype);l.prototype=new m;l.prototype.getAnnotations=function(a,c){for(var d=
m.prototype.getAnnotations.call(this,a,c),f=this._view.getModel(),h=a;h<c;h++){var k=h&1?this._oddStyle:this._evenStyle,b=h;f.getBaseModel&&(b=f.getLineStart(b),b=f.getBaseModel().getLineAtOffset(f.mapOffset(b)));d[h]||(d[h]={});d[h].html=b+1+"";d[h].style||(d[h].style=k)}return d};l.prototype.getWidestAnnotation=function(){var a=this._view.getModel().getLineCount();return this.getAnnotations(a-1,a)[a-1]};l.prototype._onTextModelChanged=function(a){var c=a.start;a=this._view.getModel();var d=((a.getBaseModel?
a.getBaseModel().getLineCount():a.getLineCount())+"").length;this._numOfDigits!==d&&(this._numOfDigits=d,c=a.getLineAtOffset(c),this._view.redrawLines(c,a.getLineCount(),this))};q.prototype=new m;s.prototype=new m;s.prototype.getRulerStyle=function(){var a={style:{lineHeight:"1px",fontSize:"1px"}};return a=this._mergeStyle(a,this._rulerStyle)};s.prototype.onClick=function(a,c){void 0!==a&&this._view.setTopIndex(a)};s.prototype._getTooltipContents=function(a,c){if(0===c.length){var e=this._view.getModel(),
f=a;e.getBaseModel&&(f=e.getLineStart(f),f=e.getBaseModel().getLineAtOffset(e.mapOffset(f)));return d.formatMessage(p.line,f+1)}return m.prototype._getTooltipContents.call(this,a,c)};s.prototype._mergeAnnotation=function(a,c,d,f){if(0===d)return a||(a={html:"\x26nbsp;",style:{style:{height:3*f+"px"}}},a.style=this._mergeStyle(a.style,c.overviewStyle)),a};r.prototype=new q;r.prototype.onClick=function(a,c){if(void 0!==a){var d=this._annotationModel;if(d){var f=this._view.getModel(),h=f.getLineStart(a),
k=f.getLineEnd(a,!0);f.getBaseModel&&(h=f.mapOffset(h),k=f.mapOffset(k),f=f.getBaseModel());for(var b,d=d.getAnnotations(h,k);!b&&d.hasNext();)k=d.next(),this.isAnnotationTypeVisible(k.type)&&(b=k);b&&f.getLineAtOffset(b.start)===f.getLineAtOffset(h)&&((f=t.Tooltip.getTooltip(this._view))&&f.setTarget(null),b.expanded?b.collapse():b.expand(),this._annotationModel.modifyAnnotation(b))}}};r.prototype._getTooltipContents=function(a,c){return 1===c.length&&c[0].expanded?null:q.prototype._getTooltipContents.call(this,
a,c)};r.prototype._onAnnotationModelChanged=function(a){function c(b){for(k=0;k<b.length;k++)if(h.isAnnotationTypeVisible(b[k].type)){var a=b[k].start;f.getBaseModel&&(a=f.mapOffset(a,!0));-1!==a&&(g=Math.min(g,f.getLineAtOffset(a)))}}if(a.textModelChangedEvent)q.prototype._onAnnotationModelChanged.call(this,a);else{var d=this._view;if(d){var f=d.getModel(),h=this,k,b=f.getLineCount(),g=b;c(a.added);c(a.removed);c(a.changed);a=d.getRulers();for(k=0;k<a.length;k++)d.redrawLines(g,b,a[k])}}};return{Ruler:m,
AnnotationRuler:q,LineNumberRuler:l,OverviewRuler:s,FoldingRuler:r}})},"orion/editor/keyBinding":function(){define("orion/editor/keyBinding",["orion/editor/util"],function(p){function u(p,d,m,l,q){this.keyCode="string"===typeof p?p.toUpperCase().charCodeAt(0):p;this.mod1=void 0!==d&&null!==d?d:!1;this.mod2=void 0!==m&&null!==m?m:!1;this.mod3=void 0!==l&&null!==l?l:!1;this.mod4=void 0!==q&&null!==q?q:!1}u.prototype={match:function(t){return this.keyCode===t.keyCode?this.mod1!==(p.isMac?t.metaKey:t.ctrlKey)||
this.mod2!==t.shiftKey||this.mod3!==t.altKey||p.isMac&&this.mod4!==t.ctrlKey?!1:!0:!1},equals:function(p){return!p||this.keyCode!==p.keyCode||this.mod1!==p.mod1||this.mod2!==p.mod2||this.mod3!==p.mod3||this.mod4!==p.mod4?!1:!0}};return{KeyBinding:u}})},"orion/Deferred":function(){(function(p,u){"function"===typeof define&&define.amd?define(u):"object"===typeof exports?module.exports=u():(p.orion=p.orion||{},p.orion.Deferred=u())})(this,function(){function p(){for(var a;a=q.shift()||s.shift();)a();
r=!1}function u(a,c){(c?s:q).push(a);r||(r=!0,c?setTimeout(p,0):p())}function t(a){return function(){a.apply(null,arguments)}}function d(){}function m(){var a=Error("Cancel");a.name="Cancel";return a}function l(){function a(){for(var a;a=f.shift();){var b=a.deferred,g="resolved"===e?"resolve":"reject";if("function"===typeof a[g])try{var n=a[g](c);n&&"function"===typeof n.then?(b.cancel=n.cancel||d,n.then(t(b.resolve),t(b.reject),b.progress)):b.resolve(n)}catch(v){b.reject(v)}else b[g](c)}}var c,e,
f=[],h=this;this.reject=function(d,b){e||(e="rejected",c=d,f.length&&u(a));return h.promise};this.resolve=function(d,b){e||(e="resolved",c=d,f.length&&u(a));return h.promise};this.progress=function(a,b){e||f.forEach(function(b){b.progress&&b.progress(a)});return h.promise};this.cancel=function(){e||h.reject(m())};this.then=function(c,b,g){c={resolve:c,reject:b,progress:g,deferred:new l};var n=c.deferred,d=this.cancel.bind(this),y=function(){u(function(){(n.cancel===y?d:n.cancel)()},!0)};n.cancel=
y;b=n.promise;b.cancel=function(){n.cancel()};f.push(c);e&&u(a,!0);return b};this.promise={then:this.then,cancel:this.cancel}}var q=[],s=[],r=!1;l.all=function(a,c){function d(n,a){b||(k[n]=a,0===--h&&g.resolve(k))}function f(n,a){if(!b){if(c)try{d(n,c(a));return}catch(y){a=y}g.reject(a)}}var h=a.length,k=[],b=!1,g=new l;g.then(null,function(){b=!0;a.forEach(function(b){b.cancel&&b.cancel()})});0===h?g.resolve(k):a.forEach(function(b,g){b.then(d.bind(null,g),f.bind(null,g))});return g.promise};l.when=
function(a,c,d,f){var h;a&&"function"===typeof a.then||(h=new l,h.resolve(a),a=h.promise);return a.then(c,d,f)};return l})},"orion/editor/undoStack":function(){define("orion/editor/undoStack",[],function(){function p(d,m,l){this.offset=d;this.text=m;this.previousText=l}function u(){this.changes=[]}function t(d,m){this.view=d;this.size=void 0!==m?m:100;this.reset();var l=d.getModel();l.getBaseModel&&(l=l.getBaseModel());this.model=l;var q=this;this._listener={onChanging:function(d){q._onChanging(d)},
onDestroy:function(d){q._onDestroy(d)}};l.addEventListener("Changing",this._listener.onChanging);d.addEventListener("Destroy",this._listener.onDestroy)}p.prototype={undo:function(d,m){this._doUndoRedo(this.offset,this.previousText,this.text,d,m)},redo:function(d,m){this._doUndoRedo(this.offset,this.text,this.previousText,d,m)},_doUndoRedo:function(d,m,l,q,s){var r=q.getModel();if(r.mapOffset&&q.annotationModel){var a=r.mapOffset(d,!0);if(0>a)for(var c=q.annotationModel.getAnnotations(d,d+1);c.hasNext();){var e=
c.next();if("orion.annotation.folding"===e.type){e.expand();a=r.mapOffset(d,!0);break}}if(0>a)return;d=a}q.setText(m,d,d+l.length);s&&q.setSelection(d,d+m.length)}};u.prototype={add:function(d){this.changes.push(d)},end:function(d){this.endSelection=d.getSelection();this.endCaret=d.getCaretOffset()},undo:function(d,m){for(var l=this.changes.length-1;0<=l;l--)this.changes[l].undo(d,!1);if(m){var l=this.startSelection.start,q=this.startSelection.end;d.setSelection(this.startCaret?l:q,this.startCaret?
q:l)}},redo:function(d,m){for(var l=0;l<this.changes.length;l++)this.changes[l].redo(d,!1);if(m){var l=this.endSelection.start,q=this.endSelection.end;d.setSelection(this.endCaret?l:q,this.endCaret?q:l)}},start:function(d){this.startSelection=d.getSelection();this.startCaret=d.getCaretOffset()}};t.prototype={add:function(d){this.compoundChange?this.compoundChange.add(d):(this.stack.splice(this.index,this.stack.length-this.index,d),this.index++,this.stack.length>this.size&&(this.stack.shift(),this.index--,
this.cleanIndex--))},markClean:function(){this.endCompoundChange();this._commitUndo();this.cleanIndex=this.index},isClean:function(){return this.cleanIndex===this.getSize().undo},canUndo:function(){return 0<this.getSize().undo},canRedo:function(){return 0<this.getSize().redo},endCompoundChange:function(){this.compoundChange&&this.compoundChange.end(this.view);this.compoundChange=void 0},getSize:function(){var d=this.index,m=this.stack.length;void 0!==this._undoStart&&d++;return{undo:d,redo:m-d}},
undo:function(){this._commitUndo();if(0>=this.index)return!1;var d=this.stack[--this.index];this._ignoreUndo=!0;d.undo(this.view,!0);this._ignoreUndo=!1;return!0},redo:function(){this._commitUndo();if(this.index>=this.stack.length)return!1;var d=this.stack[this.index++];this._ignoreUndo=!0;d.redo(this.view,!0);this._ignoreUndo=!1;return!0},reset:function(){this.index=this.cleanIndex=0;this.stack=[];this._undoStart=void 0;this._undoText="";this._undoType=0;this._ignoreUndo=!1;this._compoundChange=
void 0},startCompoundChange:function(){this._commitUndo();var d=new u;this.add(d);this.compoundChange=d;this.compoundChange.start(this.view)},_commitUndo:function(){void 0!==this._undoStart&&(-1===this._undoType?this.add(new p(this._undoStart,"",this._undoText)):this.add(new p(this._undoStart,this._undoText,"")),this._undoStart=void 0,this._undoText="",this._undoType=0)},_onDestroy:function(d){this.model.removeEventListener("Changing",this._listener.onChanging);this.view.removeEventListener("Destroy",
this._listener.onDestroy)},_onChanging:function(d){var m=d.text,l=d.start,q=d.removedCharCount;d=d.addedCharCount;if(!this._ignoreUndo){void 0!==this._undoStart&&!(1===d&&0===q&&1===this._undoType&&l===this._undoStart+this._undoText.length||0===d&&1===q&&-1===this._undoType&&(l+1===this._undoStart||l===this._undoStart))&&this._commitUndo();if(!this.compoundChange){if(1===d&&0===q){void 0===this._undoStart&&(this._undoStart=l);this._undoText+=m;this._undoType=1;return}if(0===d&&1===q){m=0<this._undoText.length&&
this._undoStart===l;this._undoStart=l;this._undoType=-1;this._undoText=m?this._undoText+this.model.getText(l,l+q):this.model.getText(l,l+q)+this._undoText;return}}this.add(new p(l,m,this.model.getText(l,l+q)))}}};return{UndoStack:t}})},"orion/main":function(){define(["dojo/_base/kernel"],function(p){return p.orion})},"orion/editor/util":function(){define(function(){var p=navigator.userAgent,u=parseFloat(p.split("MSIE")[1])||void 0,t=parseFloat(p.split("Firefox/")[1]||p.split("Minefield/")[1])||void 0,
d=-1!==p.indexOf("Opera"),m=parseFloat(p.split("Chrome/")[1])||void 0,l=-1!==p.indexOf("Safari")&&!m,q=parseFloat(p.split("WebKit/")[1])||void 0,s=-1!==p.indexOf("Android"),r=-1!==p.indexOf("iPad"),p=-1!==p.indexOf("iPhone"),a=r||p,c=-1!==navigator.platform.indexOf("Mac"),e=-1!==navigator.platform.indexOf("Win"),f=-1!==navigator.platform.indexOf("Linux");return{formatMessage:function(a){var c=arguments;return a.replace(/\$\{([^\}]+)\}/g,function(b,g){return c[(g<<0)+1]})},createElement:function(a,
c){return a.createElementNS?a.createElementNS("http://www.w3.org/1999/xhtml",c):a.createElement(c)},isIE:u,isFirefox:t,isOpera:d,isChrome:m,isSafari:l,isWebkit:q,isAndroid:s,isIPad:r,isIPhone:p,isIOS:a,isMac:c,isWindows:e,isLinux:f,platformDelimiter:e?"\r\n":"\n"}})},"orion/editor/eventTarget":function(){define("orion/editor/eventTarget",[],function(){function p(){}p.addMixin=function(u){var t=p.prototype,d;for(d in t)t.hasOwnProperty(d)&&(u[d]=t[d])};p.prototype={addEventListener:function(p,t,d){this._eventTypes||
(this._eventTypes={});var m=this._eventTypes[p];m||(m=this._eventTypes[p]={level:0,listeners:[]});m.listeners.push({listener:t,useCapture:d})},dispatchEvent:function(p){var t=p.type;this._dispatchEvent("pre"+t,p);this._dispatchEvent(t,p);this._dispatchEvent("post"+t,p)},_dispatchEvent:function(p,t){var d=this._eventTypes?this._eventTypes[p]:null;if(d){var m=d.listeners;try{if(d.level++,m)for(var l=0,q=m.length;l<q;l++)if(m[l]){var s=m[l].listener;"function"===typeof s?s.call(this,t):s.handleEvent&&
"function"===typeof s.handleEvent&&s.handleEvent(t)}}finally{if(d.level--,d.compact&&0===d.level){for(l=m.length-1;0<=l;l--)m[l]||m.splice(l,1);0===m.length&&delete this._eventTypes[p];d.compact=!1}}}},isListening:function(p){return!this._eventTypes?!1:void 0!==this._eventTypes[p]},removeEventListener:function(p,t,d){if(this._eventTypes){var m=this._eventTypes[p];if(m){for(var l=m.listeners,q=0,s=l.length;q<s;q++){var r=l[q];if(r&&r.listener===t&&r.useCapture===d){0!==m.level?(l[q]=null,m.compact=
!0):l.splice(q,1);break}}0===l.length&&delete this._eventTypes[p]}}}};return{EventTarget:p}})},"orion/editor/textView":function(){define("orion/editor/textView",["orion/editor/textModel","orion/editor/keyBinding","orion/editor/eventTarget","orion/editor/util"],function(p,u,t,d){function m(b,g,n,a){"function"===typeof b.addEventListener?b.addEventListener(g,n,!0===a):b.attachEvent("on"+g,n)}function l(b,g,n){if(n){g.className="";n=g.attributes;for(var a=n.length;0<a--;)(!d.isIE||9<=d.isIE||9>d.isIE&&
n[a].specified)&&g.removeAttribute(n[a].name)}if(b){b.styleClass&&(g.className=b.styleClass);if(n=b.style)for(var c in n)n.hasOwnProperty(c)&&(g.style[c]=n[c]);if(b=b.attributes)for(var e in b)b.hasOwnProperty(e)&&g.setAttribute(e,b[e])}}function q(b){return b instanceof Array?b.slice(0):b}function s(b,g){if(b===g)return!0;if(b&&!g||!b&&g||b&&b.constructor===String||g&&g.constructor===String)return!1;if(b instanceof Array||g instanceof Array){if(!(b instanceof Array&&g instanceof Array)||b.length!==
g.length)return!1;for(var n=0;n<b.length;n++)if(!s(b[n],g[n]))return!1;return!0}if(!(b instanceof Object)||!(g instanceof Object))return!1;for(n in b)if(b.hasOwnProperty(n)&&(!g.hasOwnProperty(n)||!s(b[n],g[n])))return!1;for(n in g)if(!b.hasOwnProperty(n))return!1;return!0}function r(b,g,n){for(var a=0,c=0,d=0,e=b.length;d<e;){-1!==a&&a<=d&&(a=b.indexOf("\r",d));-1!==c&&c<=d&&(c=b.indexOf("\n",d));var f=d,h;if(-1===c&&-1===a){g(b.substring(d));break}-1!==a&&-1!==c?a+1===c?(h=a,d=c+1):(h=a<c?a:c,d=
(a<c?a:c)+1):-1!==a?(h=a,d=a+1):(h=c,d=c+1);g(b.substring(f,h));n()}}function a(b){var g,n,a,c,d=b.ownerDocument.defaultView||b.ownerDocument.parentWindow;d.getComputedStyle?(b=d.getComputedStyle(b,null),g=b.getPropertyValue("padding-left"),n=b.getPropertyValue("padding-top"),a=b.getPropertyValue("padding-right"),c=b.getPropertyValue("padding-bottom")):b.currentStyle&&(g=b.currentStyle.paddingLeft,n=b.currentStyle.paddingTop,a=b.currentStyle.paddingRight,c=b.currentStyle.paddingBottom);return{left:parseInt(g,
10)||0,top:parseInt(n,10)||0,right:parseInt(a,10)||0,bottom:parseInt(c,10)||0}}function c(b){var g,n,c,d,e=b._trim;if(!e){var e=a(b),f=b.ownerDocument.defaultView||b.ownerDocument.parentWindow;f.getComputedStyle?(d=f.getComputedStyle(b,null),g=d.getPropertyValue("border-left-width"),n=d.getPropertyValue("border-top-width"),c=d.getPropertyValue("border-right-width"),d=d.getPropertyValue("border-bottom-width")):b.currentStyle&&(g=b.currentStyle.borderLeftWidth,n=b.currentStyle.borderTopWidth,c=b.currentStyle.borderRightWidth,
d=b.currentStyle.borderBottomWidth);g=parseInt(g,10)||0;n=parseInt(n,10)||0;c=parseInt(c,10)||0;d=parseInt(d,10)||0;e.left+=g;e.top+=n;e.right+=c;e.bottom+=d;b._trim=e}return e}function e(b,g,n){this.start=b;this.end=g;this.caret=n}function f(b){this.left=b.left;this.top=b.top;this.right=b.right;this.bottom=b.bottom}function h(b,g,n){this.view=b;this.lineIndex=g;this._lineDiv=n}function k(b){this._init(b)}e.prototype={clone:function(){return new e(this.start,this.end,this.caret)},collapse:function(){this.caret?
this.end=this.start:this.start=this.end},extend:function(b){this.caret?this.start=b:this.end=b;this.start>this.end&&(b=this.start,this.start=this.end,this.end=b,this.caret=!this.caret)},setCaret:function(b){this.end=this.start=b;this.caret=!1},getCaret:function(){return this.caret?this.start:this.end},toString:function(){return"start\x3d"+this.start+" end\x3d"+this.end+(this.caret?" caret is at start":" caret is at end")},isEmpty:function(){return this.start===this.end},equals:function(b){return this.caret===
b.caret&&this.start===b.start&&this.end===b.end}};f.prototype={toString:function(){return"{l\x3d"+this.left+", t\x3d"+this.top+", r\x3d"+this.right+", b\x3d"+this.bottom+"}"}};h.prototype={create:function(b,g){if(!this._lineDiv){var n=this._lineDiv=this._createLine(b,g,this.lineIndex);n._line=this;return n}},_createLine:function(b,g,n){var a=this.view,c=a._model,e=c.getLine(n),f=c.getLineStart(n),h={type:"LineStyle",textView:a,lineIndex:n,lineText:e,lineStart:f};if(2E3>e.length)a.onLineStyle(h);c=
g||d.createElement(b.ownerDocument,"div");if(!g||!s(g.viewStyle,h.style))l(h.style,c,g),g&&(g._trim=null),c.viewStyle=h.style,c.setAttribute("role","presentation");c.lineIndex=n;n=[];this._createRanges(h.ranges,e,0,e.length,f,{tabOffset:0,ranges:n});e=" ";!a._fullSelection&&9>d.isIE&&(e="\ufeff");d.isWebkit&&(e="\u200c");n.push({text:e,style:a._metrics.largestFontStyle,ignoreChars:1});var k,w,m,q,r,e=a=0,p,t;if(g){if(w=g.modelChangedEvent)0===w.removedLineCount&&0===w.addedLineCount?(t=w.start-f,
p=w.addedCharCount-w.removedCharCount):t=-1,g.modelChangedEvent=void 0;w=g.firstChild}for(f=0;f<n.length;f++){k=n[f];q=k.text;a+=q.length;h=k.style;if(w)if(r=w.firstChild.data,m=w.viewStyle,r===q&&s(h,m)){e+=r.length;w._rectsCache=void 0;k=w=w.nextSibling;continue}else for(;w;){if(-1!==t){m=a;m>=t&&(m-=p);r=(r=w.firstChild.data)?r.length:0;if(e+r>m)break;e+=r}m=w.nextSibling;c.removeChild(w);w=m}k=this._createSpan(c,q,h,k.ignoreChars);w?c.insertBefore(k,w):c.appendChild(k);g&&(g.lineWidth=void 0)}if(g)for(b=
k?k.nextSibling:null;b;)m=b.nextSibling,g.removeChild(b),b=m;else b.appendChild(c);return c},_createRanges:function(b,g,n,a,c,d){if(!(n>=a)){if(b)for(var e=0;e<b.length;e++){var f=b[e];if(!(f.end<=c+n)){var h=Math.max(c+n,f.start)-c;if(h>=a)break;var k=Math.min(c+a,f.end)-c;if(h<k){h=Math.max(n,h);k=Math.min(a,k);for(n<h&&this._createRange(g,n,h,null,d);e+1<b.length&&b[e+1].start-c===k&&s(f.style,b[e+1].style);)f=b[e+1],k=Math.min(c+a,f.end)-c,e++;this._createRange(g,h,k,f.style,d);n=k}}}n<a&&this._createRange(g,
n,a,null,d)}},_createRange:function(b,g,n,a,c){if(!(g>=n)){var d=this.view._customTabSize;if(d&&8!==d)for(var e=b.indexOf("\t",g);-1!==e&&e<n;){g<e&&(g={text:b.substring(g,e),style:a},c.ranges.push(g),c.tabOffset+=g.text.length);g=d-c.tabOffset%d;if(0<g){for(var f="\u00a0",h=1;h<g;h++)f+=" ";g={text:f,style:a,ignoreChars:g-1};c.ranges.push(g);c.tabOffset+=g.text.length}g=e+1;e=b.indexOf("\t",g)}g<n&&(g={text:b.substring(g,n),style:a},c.ranges.push(g),c.tabOffset+=g.text.length)}},_createSpan:function(b,
g,n,a){var c=n&&"A"===n.tagName;c&&(b.hasLink=!0);var c=c&&this.view._linksVisible?"a":"span",e=b.ownerDocument;b=d.createElement(b.ownerDocument,c);b.appendChild(e.createTextNode(g));l(n,b);if("A"===c){var f=this.view,h=this._getWindow();m(b,"click",function(b){return f._handleLinkClick(b?b:h.event)},!1)}b.viewStyle=n;a&&(b.ignoreChars=a);return b},_ensureCreated:function(){return this._lineDiv?this._lineDiv:this._createdDiv=this.create(this.view._clientDiv,null)},getBoundingClientRect:function(b,
g){var n=this._ensureCreated(),a=this.view;if(void 0===b)return this._getLineBoundingClientRect(n,!0);var c=a._model,e=n.ownerDocument,h=this.lineIndex,k=null;if(b<c.getLineEnd(h)){c=c.getLineStart(h);for(h=n.firstChild;h;){var m=h.firstChild,w=m.length;h.ignoreChars&&(w-=h.ignoreChars);if(c+w>b){k=b-c;if(a._isRangeRects)e=e.createRange(),e.setStart(m,k),e.setEnd(m,k+1),k=new f(e.getBoundingClientRect());else if(d.isIE)e=e.body.createTextRange(),e.moveToElementText(h),e.collapse(),e.moveEnd("character",
k+1),e.moveStart("character",k),k=new f(e.getBoundingClientRect());else{var l=m.data;h.removeChild(m);h.appendChild(e.createTextNode(l.substring(0,k)));var q=d.createElement(e,"span");q.appendChild(e.createTextNode(l.substring(k,k+1)));h.appendChild(q);h.appendChild(e.createTextNode(l.substring(k+1)));k=new f(q.getBoundingClientRect());h.innerHTML="";h.appendChild(m);this._createdDiv||(e=a._getSelection(),(c<=e.start&&e.start<c+w||c<=e.end&&e.end<c+w)&&a._updateDOMSelection())}d.isIE&&(e=n.ownerDocument.defaultView||
n.ownerDocument.parentWindow,n=e.screen.logicalXDPI/e.screen.deviceXDPI,e=e.screen.logicalYDPI/e.screen.deviceYDPI,k.left*=n,k.right*=n,k.top*=e,k.bottom*=e);break}c+=w;h=h.nextSibling}}n=this.getBoundingClientRect();k||(a._wrapMode?(a=this.getClientRects(),k=a[a.length-1],k.left=k.right,k.left+=n.left,k.top+=n.top,k.right+=n.left,k.bottom+=n.top):(k=new f(n),k.left=k.right));if(g||void 0===g)k.left-=n.left,k.top-=n.top,k.right-=n.left,k.bottom-=n.top;return k},_getClientRects:function(b,g){var n,
a,c,d;if(!b._rectsCache){n=b.getClientRects();a=Array(n.length);for(d=0;d<n.length;d++)c=a[d]=new f(n[d]),c.left-=g.left,c.top-=g.top,c.right-=g.left,c.bottom-=g.top;b._rectsCache=a}n=b._rectsCache;a=[n.length];for(d=0;d<n.length;d++)a[d]=new f(n[d]);return a},getClientRects:function(b){if(!this.view._wrapMode)return[this.getBoundingClientRect()];for(var g=this._ensureCreated(),n=[],a=g.firstChild,c,d=g.getBoundingClientRect();a;){for(var e=this._getClientRects(a,d),g=0;g<e.length;g++){var f=e[g],
h;if(f.top!==f.bottom){var k=f.top+(f.bottom-f.top)/2;for(h=0;h<n.length&&!(c=n[h],c.top<=k&&k<c.bottom);h++);h===n.length?n.push(f):(f.left<c.left&&(c.left=f.left),f.top<c.top&&(c.top=f.top),f.right>c.right&&(c.right=f.right),f.bottom>c.bottom&&(c.bottom=f.bottom))}}a=a.nextSibling}return void 0!==b?n[b]:n},_getLineBoundingClientRect:function(b,g){var n=new f(b.getBoundingClientRect());if(!this.view._wrapMode){n.right=n.left;for(var a=b.lastChild;a&&a.ignoreChars===a.firstChild.length;)a=a.previousSibling;
a&&(a=a.getBoundingClientRect(),n.right=a.right+c(b).right)}g&&(a=c(b),n.left+=a.left,n.right-=a.right);return n},getLineCount:function(){return!this.view._wrapMode?1:this.getClientRects().length},getLineIndex:function(b){if(!this.view._wrapMode)return 0;var g=this.getClientRects();b=this.getBoundingClientRect(b);b=b.top+(b.bottom-b.top)/2;for(var a=0;a<g.length;a++)if(g[a].top<=b&&b<g[a].bottom)return a;return g.length-1},getLineStart:function(b){if(!this.view._wrapMode||0===b)return this.view._model.getLineStart(b);
var g=this.getClientRects();return this.getOffset(g[b].left+1,g[b].top+1)},getOffset:function(b,g){var a=this.view,c=a._model,e=this.lineIndex,f=c.getLineStart(e),c=c.getLineEnd(e);if(f===c)return f;var h=this._ensureCreated(),e=this.getBoundingClientRect(),k,m;if(a._wrapMode){k=this.getClientRects();g<k[0].top&&(g=k[0].top);for(var w=0;w<k.length&&!(m=k[w],m.top<=g&&g<m.bottom);w++);b<m.left&&(b=m.left);b>m.right&&(b=m.right-1)}else 0>b&&(b=0),b>e.right-e.left&&(b=e.right-e.left);var l=h.ownerDocument,
w=l.defaultView||l.parentWindow,q=d.isIE?w.screen.logicalXDPI/w.screen.deviceXDPI:1,r=d.isIE?w.screen.logicalYDPI/w.screen.deviceYDPI:1,w=f,s=h.firstChild;a:for(;s;){var p=s.firstChild,h=p.length;s.ignoreChars&&(h-=s.ignoreChars);var t,u,F;k=this._getClientRects(s,e);for(var G=0;G<k.length;G++)if(m=k[G],m.left<=b&&b<m.right&&(!a._wrapMode||m.top<=g&&g<m.bottom)){if(d.isIE||a._isRangeRects){for(var l=a._isRangeRects?l.createRange():l.body.createTextRange(),G=h,J=-1;1<G-J;){var K=Math.floor((G+J)/2);
m=J+1;k=K===h-1&&s.ignoreChars?p.length:K+1;a._isRangeRects?(l.setStart(p,m),l.setEnd(p,k)):(l.moveToElementText(s),l.move("character",m),l.moveEnd("character",k-m));k=l.getClientRects();for(var M=!1,L=0;L<k.length;L++)if(m=k[L],t=m.left*q-e.left,F=m.right*q-e.left,u=m.top*r-e.top,m=m.bottom*r-e.top,t<=b&&b<F&&(!a._wrapMode||u<=g&&g<m)){M=!0;break}M?G=K:J=K}w+=G;m=G;k=G===h-1&&s.ignoreChars?p.length:Math.min(G+1,p.length);a._isRangeRects?(l.setStart(p,m),l.setEnd(p,k)):(l.moveToElementText(s),l.move("character",
m),l.moveEnd("character",k-m));m=l.getClientRects()[0];t=m.left*q-e.left;F=m.right*q-e.left;b>t+(F-t)/2&&w++}else{m=[];for(q=0;q<h;q++)m.push("\x3cspan\x3e"),q===h-1?m.push(p.data.substring(q)):m.push(p.data.substring(q,q+1)),m.push("\x3c/span\x3e");s.innerHTML=m.join("");for(q=s.firstChild;q;){m=q.getBoundingClientRect();t=m.left-e.left;F=m.right-e.left;if(t<=b&&b<F){b>t+(F-t)/2&&w++;break}w++;q=q.nextSibling}this._createdDiv||(s.innerHTML="",s.appendChild(p),e=a._getSelection(),(w<=e.start&&e.start<
w+h||w<=e.end&&e.end<w+h)&&a._updateDOMSelection())}break a}w+=h;s=s.nextSibling}return Math.min(c,Math.max(f,w))},getNextOffset:function(b,g,a){return"line"===g?(g=this.view._model,b=g.getLineAtOffset(b),0<a?g.getLineEnd(b):g.getLineStart(b)):"wordend"===g?this._getNextOffset_W3C(b,g,a):d.isIE?this._getNextOffset_IE(b,g,a):this._getNextOffset_W3C(b,g,a)},_getNextOffset_W3C:function(b,g,a){function c(b){return 33<=b&&47>=b||58<=b&&64>=b||91<=b&&94>=b||96===b||123<=b&&126>=b}if("word"===g||"wordend"===
g){var d=this.view._model,e=d.getLineAtOffset(b),f=d.getLine(e),h=d.getLineStart(e),e=d.getLineEnd(e),d=f.length;b-=h;var k,m;if(0<a){if(b===d)return e;k=f.charCodeAt(b);m=c(k);a=!m&&!(32===k||9===k);for(b++;b<d;){k=f.charCodeAt(b);e=c(k);if("wordend"===g){if(!e&&m)break}else if(e&&!m)break;k=!e&&!(32===k||9===k);if("wordend"===g){if(!k&&a)break}else if(k&&!a)break;a=k;m=e;b++}}else{if(0===b)return h;b--;k=f.charCodeAt(b);m=c(k);for(a=!m&&!(32===k||9===k);0<b;){k=f.charCodeAt(b-1);e=c(k);if("wordend"===
g){if(e&&!m)break}else if(!e&&m)break;k=!e&&!(32===k||9===k);if("wordend"===g){if(k&&!a)break}else if(!k&&a)break;a=k;m=e;b--}}return h+b}return b+a},_getNextOffset_IE:function(b,g,a){var c=this._ensureCreated(),d=this.view._model,e=this.lineIndex,f=0,h;h=d.getLineStart(e);var k=c.ownerDocument;if(b===d.getLineEnd(e))f=k.body.createTextRange(),f.moveToElementText(c.lastChild),h=f.text.length,f.moveEnd(g,a),f=b+f.text.length-h;else if(b===h&&0>a)f=h;else for(c=c.firstChild;c;){d=c.firstChild.length;
c.ignoreChars&&(d-=c.ignoreChars);if(h+d>b){f=k.body.createTextRange();b===h&&0>a?f.moveToElementText(c.previousSibling):(f.moveToElementText(c),f.collapse(),f.moveEnd("character",b-h));h=f.text.length;f.moveEnd(g,a);f=b+f.text.length-h;break}h=d+h;c=c.nextSibling}return f},destroy:function(){var b=this._createdDiv;b&&(b.parentNode.removeChild(b),this._createdDiv=null)}};k.prototype={addRuler:function(b,g){b.setView(this);var a=this._rulers;if(void 0!==g){var c,d;for(d=c=0;c<a.length&&d<g;c++)b.getLocation()===
a[c].getLocation()&&d++;a.splice(d,0,b);g=d}else a.push(b);this._createRuler(b,g);this._update()},computeSize:function(){var b=0,g=0,a=this._model,c=this._clientDiv;if(!c)return{width:b,height:g};var e=c.style.width;d.isWebkit&&(c.style.width="0x7fffffffpx");for(var a=a.getLineCount(),f=0;f<a;f++){var h=this._getLine(f),k=h.getBoundingClientRect(),b=Math.max(b,k.right-k.left),g=g+(k.bottom-k.top);h.destroy()}d.isWebkit&&(c.style.width=e);c=this._getViewPadding();b+=c.right+c.left;g+=c.bottom+c.top;
return{width:b,height:g}},convert:function(b,g,a){if(this._clientDiv){var c=this._getScroll(),d=this._getViewPadding(),e=this._viewDiv.getBoundingClientRect();"document"===g&&(void 0!==b.x&&(b.x+=-c.x+e.left+d.left),void 0!==b.y&&(b.y+=-c.y+e.top+d.top));"document"===a&&(void 0!==b.x&&(b.x+=c.x-e.left-d.left),void 0!==b.y&&(b.y+=c.y-e.top-d.top));return b}},destroy:function(){for(var b=0;b<this._rulers.length;b++)this._rulers[b].setView(null);this.rulers=null;this._destroyView();this.onDestroy({type:"Destroy"});
this._actions=this._keyBindings=this._doubleClickSelection=this._selection=this._model=this._parent=null},focus:function(){this._clientDiv&&(this._updateDOMSelection(),d.isOpera&&this._clientDiv.blur(),this._clientDiv.focus(),this._updateDOMSelection())},hasFocus:function(){return this._hasFocus},getActionDescription:function(b){if(b=this._actions[b])return b.actionDescription},getActions:function(b){var g=[],a=this._actions,c;for(c in a)a.hasOwnProperty(c)&&(b||!a[c].defaultHandler)&&g.push(c);return g},
getBottomIndex:function(b){return!this._clientDiv?0:this._getBottomIndex(b)},getBottomPixel:function(){return!this._clientDiv?0:this._getScroll().y+this._getClientHeight()},getCaretOffset:function(){return this._getSelection().getCaret()},getClientArea:function(){if(!this._clientDiv)return{x:0,y:0,width:0,height:0};var b=this._getScroll();return{x:b.x,y:b.y,width:this._getClientWidth(),height:this._getClientHeight()}},getHorizontalPixel:function(){return!this._clientDiv?0:this._getScroll().x},getKeyBindings:function(b){for(var g=
[],a=this._keyBindings,c=0;c<a.length;c++)a[c].actionID===b&&g.push(a[c].keyBinding);return g},getLineHeight:function(b){return!this._clientDiv?0:this._getLineHeight(b)},getLineIndex:function(b){return!this._clientDiv?0:this._getLineIndex(b)},getLinePixel:function(b){return!this._clientDiv?0:this._getLinePixel(b)},getLocationAtOffset:function(b){if(!this._clientDiv)return{x:0,y:0};var g=this._model;b=Math.min(Math.max(0,b),g.getCharCount());var g=g.getLineAtOffset(b),a=this._getLine(g);b=a.getBoundingClientRect(b);
a.destroy();a=b.left;g=this._getLinePixel(g)+b.top;return{x:a,y:g}},getOptions:function(){var b;if(0===arguments.length)b=this._defaultOptions();else if(1===arguments.length){if(b=arguments[0],"string"===typeof b)return q(this["_"+b])}else{b={};for(var g in arguments)arguments.hasOwnProperty(g)&&(b[arguments[g]]=void 0)}for(var a in b)b.hasOwnProperty(a)&&(b[a]=q(this["_"+a]));return b},getModel:function(){return this._model},getOffsetAtLocation:function(b,g){if(!this._clientDiv)return 0;var a=this._getLineIndex(g),
c=this._getLine(a),a=c.getOffset(b,g-this._getLinePixel(a));c.destroy();return a},getRulers:function(){return this._rulers.slice(0)},getSelection:function(){var b=this._getSelection();return{start:b.start,end:b.end}},getText:function(b,g){return this._model.getText(b,g)},getTopIndex:function(b){return!this._clientDiv?0:this._getTopIndex(b)},getTopPixel:function(){return!this._clientDiv?0:this._getScroll().y},invokeAction:function(b,g){if(this._clientDiv){var a=this._actions[b];if(a){if(!g&&a.handler&&
a.handler())return;if(a.defaultHandler)return a.defaultHandler()}return!1}},isDestroyed:function(){return!this._clientDiv},onContextMenu:function(b){return this.dispatchEvent(b)},onDragStart:function(b){return this.dispatchEvent(b)},onDrag:function(b){return this.dispatchEvent(b)},onDragEnd:function(b){return this.dispatchEvent(b)},onDragEnter:function(b){return this.dispatchEvent(b)},onDragOver:function(b){return this.dispatchEvent(b)},onDragLeave:function(b){return this.dispatchEvent(b)},onDrop:function(b){return this.dispatchEvent(b)},
onDestroy:function(b){return this.dispatchEvent(b)},onLineStyle:function(b){return this.dispatchEvent(b)},onModelChanged:function(b){return this.dispatchEvent(b)},onModelChanging:function(b){return this.dispatchEvent(b)},onModify:function(b){return this.dispatchEvent(b)},onMouseDown:function(b){return this.dispatchEvent(b)},onMouseUp:function(b){return this.dispatchEvent(b)},onMouseMove:function(b){return this.dispatchEvent(b)},onMouseOver:function(b){return this.dispatchEvent(b)},onMouseOut:function(b){return this.dispatchEvent(b)},
onSelection:function(b){return this.dispatchEvent(b)},onScroll:function(b){return this.dispatchEvent(b)},onVerify:function(b){return this.dispatchEvent(b)},onFocus:function(b){return this.dispatchEvent(b)},onBlur:function(b){return this.dispatchEvent(b)},redraw:function(){if(!(0<this._redrawCount)){var b=this._model.getLineCount();this.redrawRulers(0,b);this.redrawLines(0,b)}},redrawRulers:function(b,g){if(!(0<this._redrawCount))for(var a=this.getRulers(),c=0;c<a.length;c++)this.redrawLines(b,g,a[c])},
redrawLines:function(b,g,a){if(!(0<this._redrawCount)&&(void 0===b&&(b=0),void 0===g&&(g=this._model.getLineCount()),b!==g)){var c=this._clientDiv;if(c){if(a)for(var d=("left"===a.getLocation()?this._leftDiv:this._rightDiv).firstChild.rows[0].cells,e=0;e<d.length;e++)if(d[e].firstChild._ruler===a){c=d[e].firstChild;break}a?c.rulerChanged=!0:this._lineHeight&&this._resetLineHeight(b,g);if(!a||"page"===a.getOverview())for(c=c.firstChild;c;)d=c.lineIndex,b<=d&&d<g&&(c.lineChanged=!0),c=c.nextSibling;
!a&&(!this._wrapMode&&b<=this._maxLineIndex&&this._maxLineIndex<g)&&(this._checkMaxLineIndex=this._maxLineIndex,this._maxLineIndex=-1,this._maxLineWidth=0);this._queueUpdate()}}},redrawRange:function(b,g){if(!(0<this._redrawCount)){var a=this._model;void 0===b&&(b=0);void 0===g&&(g=a.getCharCount());var c=a.getLineAtOffset(b),a=a.getLineAtOffset(Math.max(b,g-1))+1;this.redrawLines(c,a)}},removeRuler:function(b){for(var g=this._rulers,a=0;a<g.length;a++)if(g[a]===b){g.splice(a,1);b.setView(null);this._destroyRuler(b);
this._update();break}},resize:function(){this._clientDiv&&this._handleResize(null)},setAction:function(b,g,a){if(b){var c=this._actions,d=c[b];d||(d=c[b]={});d.handler=g;d.actionDescription=a}},setKeyBinding:function(b,g){for(var a=this._keyBindings,c=0;c<a.length;c++){var d=a[c];if(d.keyBinding.equals(b)){g?d.actionID=g:d.predefined?d.actionID=null:a.splice(c,1);return}}g&&a.push({keyBinding:b,actionID:g})},setCaretOffset:function(b,g){var a=this._model.getCharCount();b=Math.max(0,Math.min(b,a));
a=new e(b,b,!1);this._setSelection(a,void 0===g||g)},setHorizontalPixel:function(b){this._clientDiv&&(b=Math.max(0,b),this._scrollView(b-this._getScroll().x,0))},setRedraw:function(b){b?0===--this._redrawCount&&this.redraw():this._redrawCount++},setModel:function(b){if(b&&b!==this._model){this._model.removeEventListener("preChanging",this._modelListener.onChanging);this._model.removeEventListener("postChanged",this._modelListener.onChanged);var g=this._model.getLineCount(),a=this._model.getCharCount(),
c=b.getLineCount(),d=b.getCharCount(),e={type:"ModelChanging",text:b.getText(),start:0,removedCharCount:a,addedCharCount:d,removedLineCount:g,addedLineCount:c};this.onModelChanging(e);this._model=b;e={type:"ModelChanged",start:0,removedCharCount:a,addedCharCount:d,removedLineCount:g,addedLineCount:c};this.onModelChanged(e);this._model.addEventListener("preChanging",this._modelListener.onChanging);this._model.addEventListener("postChanged",this._modelListener.onChanged);this._reset();this._update()}},
setOptions:function(b){var g=this._defaultOptions(),a;for(a in b)if(b.hasOwnProperty(a)){var c=b[a];if(!s(this["_"+a],c)){var d=g[a]?g[a].update:null;d?d.call(this,c):this["_"+a]=q(c)}}},setSelection:function(b,g,a){var c=b>g;if(c){var d=b;b=g;g=d}d=this._model.getCharCount();b=Math.max(0,Math.min(b,d));g=Math.max(0,Math.min(g,d));b=new e(b,g,c);this._setSelection(b,void 0===a||a)},setText:function(b,g,a){var c=void 0===g&&void 0===a;void 0===g&&(g=0);void 0===a&&(a=this._model.getCharCount());this._modifyContent({text:b,
start:g,end:a,_code:!0},!c);c&&(this._columnX=-1,this._setSelection(new e(0,0,!1),!0),d.isFirefox&&this._fixCaret())},setTopIndex:function(b){this._clientDiv&&this._scrollView(0,this._getLinePixel(Math.max(0,b))-this._getScroll().y)},setTopPixel:function(b){this._clientDiv&&this._scrollView(0,Math.max(0,b)-this._getScroll().y)},showSelection:function(){return this._showCaret(!0)},update:function(b,g){this._clientDiv&&(b&&this._updateStyle(),void 0===g||g?this._update():this._queueUpdate())},_handleRootMouseDown:function(b){d.isFirefox&&
1===b.which&&(this._clientDiv.contentEditable=!1,this._ignoreBlur=(this._overlayDiv||this._clientDiv).draggable=!0);var g=this._overlayDiv||this._clientDiv;9>d.isIE&&(g=this._viewDiv);for(var a=b.target?b.target:b.srcElement;a;){if(g===a)return;a=a.parentNode}b.preventDefault&&b.preventDefault();b.stopPropagation&&b.stopPropagation();if(!this._isW3CEvents){var c=this;this._getWindow().setTimeout(function(){c._clientDiv.focus()},0)}},_handleRootMouseUp:function(b){d.isFirefox&&1===b.which&&(this._clientDiv.contentEditable=
!0,(this._overlayDiv||this._clientDiv).draggable=!1,this._fixCaret(),this._ignoreBlur=!1)},_handleBlur:function(b){if(!this._ignoreBlur){this._hasFocus=!1;if(9>d.isIE&&!this._getSelection().isEmpty()){b=this._rootDiv;var g=d.createElement(b.ownerDocument,"div");b.appendChild(g);b.removeChild(g)}if(this._selDiv1)if(this._selDiv1.style.background="lightgray",this._selDiv2.style.background="lightgray",this._selDiv3.style.background="lightgray",b=this._getWindow(),g=this._selDiv1.ownerDocument,b.getSelection){g=
b.getSelection();for(b=g.anchorNode;b;){if(b===this._clientDiv){0<g.rangeCount&&g.removeAllRanges();break}b=b.parentNode}}else if(g.selection){this._ignoreSelect=!1;for(b=g.selection.createRange().parentElement();b;){if(b===this._clientDiv){g.selection.empty();break}b=b.parentNode}this._ignoreSelect=!0}if(!this._ignoreFocus)this.onBlur({type:"Blur"})}},_handleContextMenu:function(b){d.isIE&&3===this._lastMouseButton&&this._updateDOMSelection();var g=!1;this.isListening("ContextMenu")&&(g=this._createMouseEvent("ContextMenu",
b),g.screenX=b.screenX,g.screenY=b.screenY,this.onContextMenu(g),g=g.defaultPrevented);if(g)return b.preventDefault&&b.preventDefault(),!1},_handleCopy:function(b){if(!this._ignoreCopy&&this._doCopy(b))return b.preventDefault&&b.preventDefault(),!1},_handleCut:function(b){if(this._doCut(b))return b.preventDefault&&b.preventDefault(),!1},_handleDataModified:function(b){this._startIME()},_handleDblclick:function(b){this._lastMouseTime=b.timeStamp?b.timeStamp:(new Date).getTime();2!==this._clickCount&&
(this._clickCount=2,this._handleMouse(b))},_handleDragStart:function(b){if(d.isFirefox){var g=this;this._getWindow().setTimeout(function(){g._clientDiv.contentEditable=!0;g._clientDiv.draggable=!1;g._ignoreBlur=!1},0)}if(this.isListening("DragStart")&&-1!==this._dragOffset)this._isMouseDown=!1,this.onDragStart(this._createMouseEvent("DragStart",b)),this._dragOffset=-1;else return b.preventDefault&&b.preventDefault(),!1},_handleDrag:function(b){if(this.isListening("Drag"))this.onDrag(this._createMouseEvent("Drag",
b))},_handleDragEnd:function(b){this._dropTarget=!1;this._dragOffset=-1;if(this.isListening("DragEnd"))this.onDragEnd(this._createMouseEvent("DragEnd",b));d.isFirefox&&(this._fixCaret(),"none"===b.dataTransfer.dropEffect&&!b.dataTransfer.mozUserCancelled&&this._fixCaret())},_handleDragEnter:function(b){var g=!0;this._dropTarget=!0;this.isListening("DragEnter")&&(g=!1,this.onDragEnter(this._createMouseEvent("DragEnter",b)));if(d.isWebkit||g)return b.preventDefault&&b.preventDefault(),!1},_handleDragOver:function(b){var g=
!0;this.isListening("DragOver")&&(g=!1,this.onDragOver(this._createMouseEvent("DragOver",b)));if(d.isWebkit||g)return g&&(b.dataTransfer.dropEffect="none"),b.preventDefault&&b.preventDefault(),!1},_handleDragLeave:function(b){this._dropTarget=!1;if(this.isListening("DragLeave"))this.onDragLeave(this._createMouseEvent("DragLeave",b))},_handleDrop:function(b){this._dropTarget=!1;if(this.isListening("Drop"))this.onDrop(this._createMouseEvent("Drop",b));b.preventDefault&&b.preventDefault();return!1},
_handleFocus:function(b){this._hasFocus=!0;d.isIOS&&void 0!==this._lastTouchOffset?(this.setCaretOffset(this._lastTouchOffset,!0),this._lastTouchOffset=void 0):this._updateDOMSelection();this._selDiv1&&(b=this._highlightRGB,this._selDiv1.style.background=b,this._selDiv2.style.background=b,this._selDiv3.style.background=b);if(!this._ignoreFocus)this.onFocus({type:"Focus"})},_handleKeyDown:function(b){var g=!1;switch(b.keyCode){case 16:case 17:case 18:case 91:g=!0;break;default:this._setLinksVisible(!1)}if(229===
b.keyCode){if(this._readonly)return b.preventDefault&&b.preventDefault(),!1;g=!0;d.isSafari&&d.isMac&&b.ctrlKey&&(g=!1);g&&this._startIME()}else g||this._commitIME();if((d.isMac||d.isLinux)&&4>d.isFirefox||d.isOpera)return this._keyDownEvent=b,!0;if(this._doAction(b))return b.preventDefault?(b.preventDefault(),b.stopPropagation()):(b.cancelBubble=!0,b.returnValue=!1,b.keyCode=0),!1},_handleKeyPress:function(b){if(d.isMac&&d.isWebkit&&(63232<=b.keyCode&&63487>=b.keyCode||13===b.keyCode||8===b.keyCode)||
((d.isMac||d.isLinux)&&4>d.isFirefox||d.isOpera)&&this._doAction(this._keyDownEvent))return b.preventDefault&&b.preventDefault(),!1;var g=d.isMac?b.metaKey:b.ctrlKey;if(void 0!==b.charCode&&g)switch(b.charCode){case 99:case 118:case 120:return!0}g=!1;if(d.isMac){if(b.ctrlKey||b.metaKey)g=!0}else if(d.isFirefox){if(b.ctrlKey||b.altKey)g=!0}else b.ctrlKey^b.altKey&&(g=!0);if(!g&&(g=d.isOpera?b.which:void 0!==b.charCode?b.charCode:b.keyCode,31<g))return this._doContent(String.fromCharCode(g)),b.preventDefault&&
b.preventDefault(),!1},_handleKeyUp:function(b){(d.isMac?b.metaKey:b.ctrlKey)||this._setLinksVisible(!1);13===b.keyCode&&this._commitIME()},_handleLinkClick:function(b){if(!(d.isMac?b.metaKey:b.ctrlKey))return b.preventDefault&&b.preventDefault(),!1},_handleMouse:function(b){var g=this._getWindow(),a=!0,c=g;if(d.isIE||d.isFirefox&&!this._overlayDiv)c=this._clientDiv;if(this._overlayDiv){this._hasFocus&&(this._ignoreFocus=!0);var e=this;g.setTimeout(function(){e.focus();e._ignoreFocus=!1},0)}1===this._clickCount?
(a=this._setSelectionTo(b.clientX,b.clientY,b.shiftKey,!d.isOpera&&this._hasFocus&&this.isListening("DragStart")))&&this._setGrab(c):(this._isW3CEvents&&this._setGrab(c),this._doubleClickSelection=null,this._setSelectionTo(b.clientX,b.clientY,b.shiftKey),this._doubleClickSelection=this._getSelection());return a},_handleMouseDown:function(b){if(this._linksVisible)if("A"!==(b.target||b.srcElement).tagName)this._setLinksVisible(!1);else return;this._commitIME();var g=b.which;g||(4===b.button&&(g=2),
2===b.button&&(g=3),1===b.button&&(g=1));var a=2!==g&&b.timeStamp?b.timeStamp:(new Date).getTime(),c=a-this._lastMouseTime,e=Math.abs(this._lastMouseX-b.clientX),f=Math.abs(this._lastMouseY-b.clientY),h=this._lastMouseButton===g;this._lastMouseX=b.clientX;this._lastMouseY=b.clientY;this._lastMouseTime=a;this._lastMouseButton=g;1===g&&(this._isMouseDown=!0,h&&c<=this._clickTime&&e<=this._clickDist&&f<=this._clickDist?this._clickCount++:this._clickCount=1);if(this.isListening("MouseDown")&&(a=this._createMouseEvent("MouseDown",
b),this.onMouseDown(a),a.defaultPrevented)){b.preventDefault();return}if(1===g&&this._handleMouse(b)&&(9<=d.isIE||d.isOpera||d.isChrome||d.isSafari||d.isFirefox&&!this._overlayDiv))this._hasFocus||this.focus(),b.preventDefault();d.isFirefox&&3===this._lastMouseButton&&this._updateDOMSelection()},_handleMouseOver:function(b){if(this.isListening("MouseOver"))this.onMouseOver(this._createMouseEvent("MouseOver",b))},_handleMouseOut:function(b){if(this.isListening("MouseOut"))this.onMouseOut(this._createMouseEvent("MouseOut",
b))},_handleMouseMove:function(b){var g=this._isClientDiv(b);if(this.isListening("MouseMove")&&g)this.onMouseMove(this._createMouseEvent("MouseMove",b));if(!this._dropTarget){var a=this._linksVisible||this._lastMouseMoveX!==b.clientX||this._lastMouseMoveY!==b.clientY;this._lastMouseMoveX=b.clientX;this._lastMouseMoveY=b.clientY;this._setLinksVisible(a&&!this._isMouseDown&&(d.isMac?b.metaKey:b.ctrlKey));if(!this._isW3CEvents){if(0===b.button)return this._setGrab(null),!0;if(!this._isMouseDown&&1===
b.button&&0!==(this._clickCount&1)&&g)return this._clickCount=2,this._handleMouse(b,this._clickCount)}if(this._isMouseDown&&-1===this._dragOffset){g=b.clientX;b=b.clientY;var c=this._getViewPadding(),e=this._viewDiv.getBoundingClientRect(),f=this._getClientWidth(),h=this._getClientHeight(),a=e.left+c.left,k=e.top+c.top,f=e.left+c.left+f,c=e.top+c.top+h,e=this._model,h=e.getLineAtOffset(this._getSelection().getCaret());b<k&&0!==h?this._doAutoScroll("up",g,b-k):b>c&&h!==e.getLineCount()-1?this._doAutoScroll("down",
g,b-c):g<a&&!this._wrapMode?this._doAutoScroll("left",g-a,b):g>f&&!this._wrapMode?this._doAutoScroll("right",g-f,b):(this._endAutoScroll(),this._setSelectionTo(g,b,!0))}}},_isClientDiv:function(b){var g=this._overlayDiv||this._clientDiv;for(b=b.target?b.target:b.srcElement;b;){if(g===b)return!0;b=b.parentNode}return!1},_createMouseEvent:function(b,g){var a=this.convert({x:g.clientX,y:g.clientY},"page","document");return{type:b,event:g,clickCount:this._clickCount,x:a.x,y:a.y,preventDefault:function(){this.defaultPrevented=
!0}}},_handleMouseUp:function(b){var g=b.which?0===b.button:1===b.button;if(this.isListening("MouseUp")&&(this._isClientDiv(b)||g&&this._isMouseDown))this.onMouseUp(this._createMouseEvent("MouseUp",b));!this._linksVisible&&(g&&this._isMouseDown)&&(-1!==this._dragOffset&&(g=this._getSelection(),g.extend(this._dragOffset),g.collapse(),this._setSelection(g,!0,!0),this._dragOffset=-1),this._isMouseDown=!1,this._endAutoScroll(),this._isW3CEvents&&this._setGrab(null),d.isFirefox&&b.preventDefault())},_handleMouseWheel:function(b){var g=
this._getLineHeight(),a=0,c=0;d.isIE||d.isOpera?c=-b.wheelDelta/40*g:d.isFirefox?(g=d.isMac?3*b.detail:Math.max(-256,Math.min(256,b.detail))*g,b.axis===b.HORIZONTAL_AXIS?a=g:c=g):d.isMac?(c=a=40,0!==b.wheelDeltaX%120&&(a=1),0!==b.wheelDeltaY%120&&(c=1),a=-b.wheelDeltaX/a,-1<a&&0>a&&(a=-1),0<a&&1>a&&(a=1),c=-b.wheelDeltaY/c,-1<c&&0>c&&(c=-1),0<c&&1>c&&(c=1)):(a=-b.wheelDeltaX,c=8*(-b.wheelDeltaY/120)*g);if(d.isSafari){for(g=b.target;g&&void 0===g.lineIndex;)g=g.parentNode;this._mouseWheelLine=g}g=
this._getScroll();this._scrollView(a,c);a=this._getScroll();if(g.x!==a.x||g.y!==a.y)return b.preventDefault&&b.preventDefault(),!1},_handlePaste:function(b){if(!this._ignorePaste&&this._doPaste(b)){if(d.isIE){var g=this;this._ignoreFocus=!0;this._getWindow().setTimeout(function(){g._updateDOMSelection();g._ignoreFocus=!1},0)}b.preventDefault&&b.preventDefault();return!1}},_handleResize:function(b){b=this._parent.clientWidth;var g=this._parent.clientHeight;if(this._parentWidth!==b||this._parentHeight!==
g)this._parentWidth!==b&&this._resetLineHeight(),this._parentWidth=b,this._parentHeight=g,9>d.isIE?this._queueUpdate():this._update()},_handleRulerEvent:function(b){for(var g=b.target?b.target:b.srcElement,a=g.lineIndex;g&&!g._ruler;)void 0===a&&void 0!==g.lineIndex&&(a=g.lineIndex),g=g.parentNode;g=g?g._ruler:null;if(void 0===a&&g&&"document"===g.getOverview()){var a=this._getClientHeight(),c=this._model.getLineCount(),d=this._getViewPadding(),e=this._viewDiv.getBoundingClientRect(),a=Math.floor((b.clientY-
e.top-this._metrics.scrollWidth)*c/(a+d.top+d.bottom-2*this._metrics.scrollWidth));0<=a&&a<c||(a=void 0)}if(g)switch(b.type){case "click":if(g.onClick)g.onClick(a,b);break;case "dblclick":if(g.onDblClick)g.onDblClick(a,b);break;case "mousemove":if(g.onMouseMove)g.onMouseMove(a,b);break;case "mouseover":if(g.onMouseOver)g.onMouseOver(a,b);break;case "mouseout":if(g.onMouseOut)g.onMouseOut(a,b)}},_handleScroll:function(){var b=this._getScroll(),g=this._hScroll,a=this._vScroll;if(g!==b.x||a!==b.y)this._checkOverlayScroll(),
this._hScroll=b.x,this._vScroll=b.y,this._commitIME(),this._update(a===b.y),this.onScroll({type:"Scroll",oldValue:{x:g,y:a},newValue:b})},_handleSelectStart:function(b){if(this._ignoreSelect)return b&&b.preventDefault&&b.preventDefault(),!1},_getModelOffset:function(b,g){if(b){var a;a="DIV"===b.tagName?b:b.parentNode.parentNode;var c=0,d=a.lineIndex;if("DIV"!==b.tagName)for(a=a.firstChild;a;){var e=a.firstChild;if(e===b){a.ignoreChars&&(c-=a.ignoreChars);c+=g;break}a.ignoreChars&&(c-=a.ignoreChars);
c+=e.data.length;a=a.nextSibling}return Math.max(0,c)+this._model.getLineStart(d)}},_updateSelectionFromDOM:function(){var b=this._getWindow().getSelection(),g=this._getModelOffset(b.anchorNode,b.anchorOffset),b=this._getModelOffset(b.focusNode,b.focusOffset);void 0===g||void 0===b||this._setSelection(new e(g,b),!1,!1)},_handleSelectionChange:function(b){if(-1===this._imeOffset)if(d.isAndroid){b=this._getWindow();this._selTimer&&b.clearTimeout(this._selTimer);var g=this;this._selTimer=b.setTimeout(function(){g._clientDiv&&
(g._selTimer=null,g._updateSelectionFromDOM())},250)}else this._updateSelectionFromDOM()},_handleTextInput:function(b){this._imeOffset=-1;if(d.isAndroid){for(var g=this._getWindow().getSelection(),a=g.anchorNode;a&&void 0===a.lineIndex;)a=a.parentNode;if(a){var c=this._model,e=a.lineIndex,f=c.getLine(e),h=f,k=0,c=c.getLineStart(e);0<g.rangeCount&&(g.getRangeAt(0).deleteContents(),e=a.ownerDocument.createTextNode(b.data),g.getRangeAt(0).insertNode(e),k=this._getDOMText(a,e),h=k.text,k=k.offset,e.parentNode.removeChild(e));
a.lineRemoved=!0;for(a=0;f.charCodeAt(a)===h.charCodeAt(a)&&a<k;)a++;g=f.length-1;for(e=h.length-f.length;f.charCodeAt(g)===h.charCodeAt(g+e)&&g+e>=k+b.data.length;)g--;g++;f=h.substring(a,g+e);this._modifyContent({text:f,start:a+c,end:g+c,_ignoreDOMSelection:!0},!0)}}else this._doContent(b.data);b.preventDefault()},_handleTouchStart:function(b){this._commitIME();var g=this._getWindow();this._touchScrollTimer&&(this._vScrollDiv.style.display="none",this._hScrollDiv.style.display="none",g.clearInterval(this._touchScrollTimer),
this._touchScrollTimer=null);var a=b.touches;if(1===a.length){var a=a[0],c=a.clientX,e=a.clientY;this._touchStartX=c;this._touchStartY=e;if(d.isAndroid&&(e<a.pageY-g.pageYOffset||c<a.pageX-g.pageXOffset))c=a.pageX-g.pageXOffset,e=a.pageY-g.pageYOffset;g=this.convert({x:c,y:e},"page","document");this._lastTouchOffset=this.getOffsetAtLocation(g.x,g.y);this._touchStartTime=b.timeStamp;this._touching=!0}},_handleTouchMove:function(b){var g=b.touches;if(1===g.length){g=g[0];this._touchCurrentX=g.clientX;
this._touchCurrentY=g.clientY;if(!this._touchScrollTimer&&200>b.timeStamp-this._touchStartTime){this._vScrollDiv.style.display="block";this._wrapMode||(this._hScrollDiv.style.display="block");var a=this,c=this._getWindow();this._touchScrollTimer=c.setInterval(function(){var b=0,g=0;if(a._touching)b=a._touchStartX-a._touchCurrentX,g=a._touchStartY-a._touchCurrentY,a._touchSpeedX=b/10,a._touchSpeedY=g/10,a._touchStartX=a._touchCurrentX,a._touchStartY=a._touchCurrentY;else{if(0.1>Math.abs(a._touchSpeedX)&&
0.1>Math.abs(a._touchSpeedY)){a._vScrollDiv.style.display="none";a._hScrollDiv.style.display="none";c.clearInterval(a._touchScrollTimer);a._touchScrollTimer=null;return}b=10*a._touchSpeedX;g=10*a._touchSpeedY;a._touchSpeedX*=0.95;a._touchSpeedY*=0.95}a._scrollView(b,g)},10)}this._touchScrollTimer&&b.preventDefault()}},_handleTouchEnd:function(b){0===b.touches.length&&(this._touching=!1)},_doAction:function(b){for(var a=this._keyBindings,c=0;c<a.length;c++){var d=a[c];if(d.keyBinding.match(b)){if(d.actionID&&
(b=this._actions[d.actionID]))if(b.handler){if(!b.handler()){if(b.defaultHandler)return"boolean"===typeof b.defaultHandler();break}}else if(b.defaultHandler)return"boolean"===typeof b.defaultHandler();return!0}}return!1},_doBackspace:function(b){var a=this._getSelection();if(a.isEmpty()){var c=this._model,d=a.getCaret(),e=c.getLineAtOffset(d),f=c.getLineStart(e);if(d===f)0<e&&a.extend(c.getLineEnd(e-1));else{var h=!1;this._expandTab&&("character"===b.unit&&0===(d-f)%this._tabSize)&&(c=c.getText(f,
d),h=!/[^ ]/.test(c));h?a.extend(d-this._tabSize):(e=this._getLine(e),a.extend(e.getNextOffset(d,b.unit,-1)),e.destroy())}}this._modifyContent({text:"",start:a.start,end:a.end},!0);return!0},_doContent:function(b){var a=this._getSelection();this._modifyContent({text:b,start:a.start,end:a.end,_ignoreDOMSelection:!0},!0)},_doCopy:function(b){var a=this._getSelection();return!a.isEmpty()?(a=this._getBaseText(a.start,a.end),this._setClipboardText(a,b)):!0},_doCursorNext:function(b){if(!b.select&&this._clearSelection("next"))return!0;
var a=this._model,c=this._getSelection(),d=c.getCaret(),e=a.getLineAtOffset(d);d===a.getLineEnd(e)?e+1<a.getLineCount()&&c.extend(a.getLineStart(e+1)):(a=this._getLine(e),c.extend(a.getNextOffset(d,b.unit,1)),a.destroy());b.select||c.collapse();this._setSelection(c,!0);return!0},_doCursorPrevious:function(b){if(!b.select&&this._clearSelection("previous"))return!0;var a=this._model,c=this._getSelection(),d=c.getCaret(),e=a.getLineAtOffset(d);d===a.getLineStart(e)?0<e&&c.extend(a.getLineEnd(e-1)):(a=
this._getLine(e),c.extend(a.getNextOffset(d,b.unit,-1)),a.destroy());b.select||c.collapse();this._setSelection(c,!0);return!0},_doCut:function(b){var a=this._getSelection();return!a.isEmpty()?(a=this._getBaseText(a.start,a.end),this._doContent(""),this._setClipboardText(a,b)):!0},_doDelete:function(b){var a=this._getSelection();if(a.isEmpty()){var c=this._model,d=a.getCaret(),e=c.getLineAtOffset(d);d===c.getLineEnd(e)?e+1<c.getLineCount()&&a.extend(c.getLineStart(e+1)):(c=this._getLine(e),a.extend(c.getNextOffset(d,
b.unit,1)),c.destroy())}this._modifyContent({text:"",start:a.start,end:a.end},!0);return!0},_doEnd:function(b){var a=this._getSelection(),c=this._model;if(b.ctrl)a.extend(c.getCharCount());else{var d=a.getCaret(),e=c.getLineAtOffset(d);if(this._wrapMode){var f=this._getLine(e),d=f.getLineIndex(d),d=d===f.getLineCount()-1?c.getLineEnd(e):f.getLineStart(d+1)-1;f.destroy()}else d=c.getLineEnd(e);a.extend(d)}b.select||a.collapse();this._setSelection(a,!0);return!0},_doEnter:function(b){var a=this._model,
c=this._getSelection();this._doContent(a.getLineDelimiter());b&&b.noCursor&&(c.end=c.start,this._setSelection(c));return!0},_doHome:function(b){var a=this._getSelection(),c=this._model;if(b.ctrl)a.extend(0);else{var d=a.getCaret(),e=c.getLineAtOffset(d);this._wrapMode?(c=this._getLine(e),d=c.getLineIndex(d),d=c.getLineStart(d),c.destroy()):d=c.getLineStart(e);a.extend(d)}b.select||a.collapse();this._setSelection(a,!0);return!0},_doLineDown:function(b){var a=this._model,c=this._getSelection(),e=c.getCaret(),
f=a.getLineAtOffset(e),h=this._getLine(f),k=this._columnX,m=1,l=!1;if(-1===k||b.wholeLine||b.select&&d.isIE)k=b.wholeLine?a.getLineEnd(f+1):e,k=h.getBoundingClientRect(k).left;(e=h.getLineIndex(e))<h.getLineCount()-1?m=h.getClientRects(e+1).top+1:(l=f===a.getLineCount()-1,f++);l?b.select&&(c.extend(a.getCharCount()),this._setSelection(c,!0,!0)):(h.lineIndex!==f&&(h.destroy(),h=this._getLine(f)),c.extend(h.getOffset(k,m)),b.select||c.collapse(),this._setSelection(c,!0,!0));this._columnX=k;h.destroy();
return!0},_doLineUp:function(b){var a=this._model,c=this._getSelection(),e=c.getCaret(),f=a.getLineAtOffset(e),h=this._getLine(f),k=this._columnX,m=!1,l;if(-1===k||b.wholeLine||b.select&&d.isIE)k=b.wholeLine?a.getLineStart(f-1):e,k=h.getBoundingClientRect(k).left;0<(e=h.getLineIndex(e))?l=h.getClientRects(e-1).top+1:(m=0===f,m||(f--,l=this._getLineHeight(f)-1));m?b.select&&(c.extend(0),this._setSelection(c,!0,!0)):(h.lineIndex!==f&&(h.destroy(),h=this._getLine(f)),c.extend(h.getOffset(k,l)),b.select||
c.collapse(),this._setSelection(c,!0,!0));this._columnX=k;h.destroy();return!0},_doPageDown:function(b){var a=this._model,c=this._getSelection(),e=c.getCaret(),f=a.getLineAtOffset(e),h=a.getLineCount(),k=this._getScroll(),m=this._getClientHeight(),l;if(this._lineHeight){a=this._columnX;k=this._getBoundsAtOffset(e);if(-1===a||b.select&&d.isIE)a=k.left;e=this._getLineIndex(k.top+m);l=this._getLine(e);f=this._getLinePixel(e);e=l.getOffset(a,k.top+m-f);m=l.getBoundingClientRect(e);l.destroy();c.extend(e);
b.select||c.collapse();this._setSelection(c,!0,!0,m.top+f-k.top);this._columnX=a;return!0}if(f<h-1){var w=this._getLineHeight(),q=Math.min(h-f-1,Math.floor(m/w)),q=Math.max(1,q),a=this._columnX;if(-1===a||b.select&&d.isIE)l=this._getLine(f),a=l.getBoundingClientRect(e).left,l.destroy();l=this._getLine(f+q);c.extend(l.getOffset(a,0));l.destroy();b.select||c.collapse();b=h*w;e=k.y+q*w;e+m>b&&(e=b-m);this._setSelection(c,!0,!0,e-k.y);this._columnX=a}return!0},_doPageUp:function(b){var a=this._model,
c=this._getSelection(),e=c.getCaret(),f=a.getLineAtOffset(e),h=this._getScroll(),k=this._getClientHeight(),m;if(this._lineHeight){a=this._columnX;h=this._getBoundsAtOffset(e);if(-1===a||b.select&&d.isIE)a=h.left;e=this._getLineIndex(h.bottom-k);m=this._getLine(e);f=this._getLinePixel(e);e=m.getOffset(a,h.bottom-k-f);k=m.getBoundingClientRect(e);m.destroy();c.extend(e);b.select||c.collapse();this._setSelection(c,!0,!0,k.top+f-h.top);this._columnX=a;return!0}if(0<f){var l=this._getLineHeight(),k=Math.max(1,
Math.min(f,Math.floor(k/l))),a=this._columnX;if(-1===a||b.select&&d.isIE)m=this._getLine(f),a=m.getBoundingClientRect(e).left,m.destroy();m=this._getLine(f-k);c.extend(m.getOffset(a,this._getLineHeight(f-k)-1));m.destroy();b.select||c.collapse();b=Math.max(0,h.y-k*l);this._setSelection(c,!0,!0,b-h.y);this._columnX=a}return!0},_doPaste:function(b){var a=this;return null!==this._getClipboardText(b,function(b){b&&(d.isLinux&&2===a._lastMouseButton&&(new Date).getTime()-a._lastMouseTime<=a._clickTime&&
a._setSelectionTo(a._lastMouseX,a._lastMouseY),a._doContent(b))})},_doScroll:function(b){var a=b.type,c=this._model,d=c.getLineCount();b=this._getClientHeight();var e=this._getLineHeight(),d=d*e,f=this._getScroll().y,h;switch(a){case "textStart":h=0;break;case "textEnd":h=d-b;break;case "pageDown":h=f+b;break;case "pageUp":h=f-b;break;case "centerLine":a=this._getSelection(),h=c.getLineAtOffset(a.start),c=(c.getLineAtOffset(a.end)-h+1)*e,h=h*e-b/2+c/2}void 0!==h&&(h=Math.min(Math.max(0,h),d-b),this._scrollView(0,
h-f));return!0},_doSelectAll:function(b){b=this._model;var a=this._getSelection();a.setCaret(0);a.extend(b.getCharCount());this._setSelection(a,!1);return!0},_doTab:function(b){if(this._tabMode&&!this._readonly){b="\t";if(this._expandTab){var a=this._model;b=this._getSelection().getCaret();var c=a.getLineAtOffset(b),a=a.getLineStart(c);b=Array(this._tabSize-(b-a)%this._tabSize+1).join(" ")}this._doContent(b);return!0}},_doShiftTab:function(b){if(this._tabMode&&!this._readonly)return!0},_doTabMode:function(b){this._tabMode=
!this._tabMode;return!0},_doWrapMode:function(b){this.setOptions({wrapMode:!this.getOptions("wrapMode")});return!0},_autoScroll:function(){var b=this._getSelection(),a=this.convert({x:this._autoScrollX,y:this._autoScrollY},"page","document"),c=b.getCaret(),d=this._model.getLineAtOffset(c),e;if("up"===this._autoScrollDir||"down"===this._autoScrollDir)c=this._autoScrollY/this._getLineHeight(),c=0>c?Math.floor(c):Math.ceil(c),e=d,e=Math.max(0,Math.min(this._model.getLineCount()-1,e+c));else if("left"===
this._autoScrollDir||"right"===this._autoScrollDir)e=this._getLineIndex(a.y),d=this._getLine(d),a.x+=d.getBoundingClientRect(c,!1).left,d.destroy();d=this._getLine(e);b.extend(d.getOffset(a.x,a.y-this._getLinePixel(e)));d.destroy();this._setSelection(b,!0)},_autoScrollTimer:function(){this._autoScroll();var b=this;this._autoScrollTimerID=this._getWindow().setTimeout(function(){b._autoScrollTimer()},this._AUTO_SCROLL_RATE)},_calculateLineHeightTimer:function(b){if(this._lineHeight&&!this._calculateLHTimer){var a=
this._model.getLineCount(),c=0;if(b){b=0;for(var d=(new Date).getTime(),e=0;c<a&&!(this._lineHeight[c]||(b++,e||(e=c),this._lineHeight[c]=this._calculateLineHeight(c)),c++,100<(new Date).getTime()-d););this.redrawRulers(0,a);this._queueUpdate()}b=this._getWindow();if(c!==a){var f=this;this._calculateLHTimer=b.setTimeout(function(){f._calculateLHTimer=null;f._calculateLineHeightTimer(!0)},0)}else this._calculateLHTimer&&(b.clearTimeout(this._calculateLHTimer),this._calculateLHTimer=void 0)}},_calculateLineHeight:function(b){b=
this._getLine(b);var a=b.getBoundingClientRect();b.destroy();return Math.max(1,Math.ceil(a.bottom-a.top))},_calculateMetrics:function(){var b=this._clientDiv,g=b.ownerDocument,e=d.createElement(g,"div");e.style.lineHeight="normal";var f={type:"LineStyle",textView:this,"0":0,lineText:this._model.getLine(0),lineStart:0};this.onLineStyle(f);l(f.style,e);e.style.position="fixed";e.style.left="-1000px";var h=d.createElement(g,"span");h.appendChild(g.createTextNode(" "));e.appendChild(h);var k=d.createElement(g,
"span");k.style.fontStyle="italic";k.appendChild(g.createTextNode(" "));e.appendChild(k);var m=d.createElement(g,"span");m.style.fontWeight="bold";m.appendChild(g.createTextNode(" "));e.appendChild(m);f=d.createElement(g,"span");f.style.fontWeight="bold";f.style.fontStyle="italic";f.appendChild(g.createTextNode(" "));e.appendChild(f);b.appendChild(e);var q=e.getBoundingClientRect(),h=h.getBoundingClientRect(),k=k.getBoundingClientRect(),m=m.getBoundingClientRect(),f=f.getBoundingClientRect(),h=h.bottom-
h.top,k=k.bottom-k.top,m=m.bottom-m.top,s=f.bottom-f.top,w=0,f=0>=q.bottom-q.top,q=Math.max(1,q.bottom-q.top);k>h&&(w=1);m>k&&(w=2);s>m&&(w=3);var r;0!==w&&(r={style:{}},0!==(w&1)&&(r.style.fontStyle="italic"),0!==(w&2)&&(r.style.fontWeight="bold"));h=c(e);b.removeChild(e);k=a(this._viewDiv);e=d.createElement(g,"div");e.style.position="fixed";e.style.left="-1000px";e.style.paddingLeft=k.left+"px";e.style.paddingTop=k.top+"px";e.style.paddingRight=k.right+"px";e.style.paddingBottom=k.bottom+"px";e.style.width=
"100px";e.style.height="100px";m=d.createElement(g,"div");m.style.width="100%";m.style.height="100%";e.appendChild(m);b.appendChild(e);g=e.getBoundingClientRect();k=m.getBoundingClientRect();e.style.overflow="hidden";m.style.height="200px";m=e.clientWidth;e.style.overflow="scroll";s=e.clientWidth;b.removeChild(e);k={left:k.left-g.left,top:k.top-g.top,right:g.right-k.right,bottom:g.bottom-k.bottom};return{lineHeight:q,largestFontStyle:r,lineTrim:h,viewPadding:k,scrollWidth:m-s,invalid:f}},_checkOverlayScroll:function(){if(d.isMac){var b=
this,a=this._getWindow();this._overlayScrollTimer&&a.clearTimeout(this._overlayScrollTimer);var c=function(){var d=b._isOverOverlayScroll();d.vertical||d.horizontal?b._overlayScrollTimer=a.setTimeout(c,200):(b._overlayScrollTimer=void 0,b._update())};this._overlayScrollTimer=a.setTimeout(c,200)}},_clearSelection:function(b){var a=this._getSelection();if(a.isEmpty())return!1;"next"===b?a.start=a.end:a.end=a.start;this._setSelection(a,!0);return!0},_commitIME:function(){if(-1!==this._imeOffset){this._scrollDiv.focus();
this._clientDiv.focus();var b=this._model,a=b.getLineAtOffset(this._imeOffset),c=b.getLineStart(a),d=this._getDOMText(this._getLineNode(a)).text,b=b.getLine(a),c=this._imeOffset-c,b=c+d.length-b.length;c!==b&&(d=d.substring(c,b),this._doContent(d));this._imeOffset=-1}},_createActions:function(){var b=u.KeyBinding,a=this._keyBindings=[];a.push({actionID:"lineUp",keyBinding:new b(38),predefined:!0});a.push({actionID:"lineDown",keyBinding:new b(40),predefined:!0});a.push({actionID:"charPrevious",keyBinding:new b(37),
predefined:!0});a.push({actionID:"charNext",keyBinding:new b(39),predefined:!0});d.isMac?(a.push({actionID:"scrollPageUp",keyBinding:new b(33),predefined:!0}),a.push({actionID:"scrollPageDown",keyBinding:new b(34),predefined:!0}),a.push({actionID:"pageUp",keyBinding:new b(33,null,null,!0),predefined:!0}),a.push({actionID:"pageDown",keyBinding:new b(34,null,null,!0),predefined:!0}),a.push({actionID:"lineStart",keyBinding:new b(37,!0),predefined:!0}),a.push({actionID:"lineEnd",keyBinding:new b(39,!0),
predefined:!0}),a.push({actionID:"wordPrevious",keyBinding:new b(37,null,null,!0),predefined:!0}),a.push({actionID:"wordNext",keyBinding:new b(39,null,null,!0),predefined:!0}),a.push({actionID:"scrollTextStart",keyBinding:new b(36),predefined:!0}),a.push({actionID:"scrollTextEnd",keyBinding:new b(35),predefined:!0}),a.push({actionID:"textStart",keyBinding:new b(38,!0),predefined:!0}),a.push({actionID:"textEnd",keyBinding:new b(40,!0),predefined:!0}),a.push({actionID:"scrollPageUp",keyBinding:new b(38,
null,null,null,!0),predefined:!0}),a.push({actionID:"scrollPageDown",keyBinding:new b(40,null,null,null,!0),predefined:!0}),a.push({actionID:"lineStart",keyBinding:new b(37,null,null,null,!0),predefined:!0}),a.push({actionID:"lineEnd",keyBinding:new b(39,null,null,null,!0),predefined:!0}),a.push({actionID:"lineStart",keyBinding:new b(38,null,null,!0),predefined:!0}),a.push({actionID:"lineEnd",keyBinding:new b(40,null,null,!0),predefined:!0})):(a.push({actionID:"pageUp",keyBinding:new b(33),predefined:!0}),
a.push({actionID:"pageDown",keyBinding:new b(34),predefined:!0}),a.push({actionID:"lineStart",keyBinding:new b(36),predefined:!0}),a.push({actionID:"lineEnd",keyBinding:new b(35),predefined:!0}),a.push({actionID:"wordPrevious",keyBinding:new b(37,!0),predefined:!0}),a.push({actionID:"wordNext",keyBinding:new b(39,!0),predefined:!0}),a.push({actionID:"textStart",keyBinding:new b(36,!0),predefined:!0}),a.push({actionID:"textEnd",keyBinding:new b(35,!0),predefined:!0}));d.isFirefox&&d.isLinux&&(a.push({actionID:"lineUp",
keyBinding:new b(38,!0),predefined:!0}),a.push({actionID:"lineDown",keyBinding:new b(40,!0),predefined:!0}));a.push({actionID:"selectLineUp",keyBinding:new b(38,null,!0),predefined:!0});a.push({actionID:"selectLineDown",keyBinding:new b(40,null,!0),predefined:!0});a.push({actionID:"selectCharPrevious",keyBinding:new b(37,null,!0),predefined:!0});a.push({actionID:"selectCharNext",keyBinding:new b(39,null,!0),predefined:!0});a.push({actionID:"selectPageUp",keyBinding:new b(33,null,!0),predefined:!0});
a.push({actionID:"selectPageDown",keyBinding:new b(34,null,!0),predefined:!0});d.isMac?(a.push({actionID:"selectLineStart",keyBinding:new b(37,!0,!0),predefined:!0}),a.push({actionID:"selectLineEnd",keyBinding:new b(39,!0,!0),predefined:!0}),a.push({actionID:"selectWordPrevious",keyBinding:new b(37,null,!0,!0),predefined:!0}),a.push({actionID:"selectWordNext",keyBinding:new b(39,null,!0,!0),predefined:!0}),a.push({actionID:"selectTextStart",keyBinding:new b(36,null,!0),predefined:!0}),a.push({actionID:"selectTextEnd",
keyBinding:new b(35,null,!0),predefined:!0}),a.push({actionID:"selectTextStart",keyBinding:new b(38,!0,!0),predefined:!0}),a.push({actionID:"selectTextEnd",keyBinding:new b(40,!0,!0),predefined:!0}),a.push({actionID:"selectLineStart",keyBinding:new b(37,null,!0,null,!0),predefined:!0}),a.push({actionID:"selectLineEnd",keyBinding:new b(39,null,!0,null,!0),predefined:!0}),a.push({actionID:"selectLineStart",keyBinding:new b(38,null,!0,!0),predefined:!0}),a.push({actionID:"selectLineEnd",keyBinding:new b(40,
null,!0,!0),predefined:!0})):(d.isLinux&&(a.push({actionID:"selectWholeLineUp",keyBinding:new b(38,!0,!0),predefined:!0}),a.push({actionID:"selectWholeLineDown",keyBinding:new b(40,!0,!0),predefined:!0})),a.push({actionID:"selectLineStart",keyBinding:new b(36,null,!0),predefined:!0}),a.push({actionID:"selectLineEnd",keyBinding:new b(35,null,!0),predefined:!0}),a.push({actionID:"selectWordPrevious",keyBinding:new b(37,!0,!0),predefined:!0}),a.push({actionID:"selectWordNext",keyBinding:new b(39,!0,
!0),predefined:!0}),a.push({actionID:"selectTextStart",keyBinding:new b(36,!0,!0),predefined:!0}),a.push({actionID:"selectTextEnd",keyBinding:new b(35,!0,!0),predefined:!0}));a.push({actionID:"undo",keyBinding:new u.KeyBinding("z",!0),predefined:!0});d.isMac?a.push({actionID:"redo",keyBinding:new u.KeyBinding("z",!0,!0),predefined:!0}):a.push({actionID:"redo",keyBinding:new u.KeyBinding("y",!0),predefined:!0});a.push({actionID:"deletePrevious",keyBinding:new b(8),predefined:!0});a.push({actionID:"deletePrevious",
keyBinding:new b(8,null,!0),predefined:!0});a.push({actionID:"deleteNext",keyBinding:new b(46),predefined:!0});a.push({actionID:"deleteWordPrevious",keyBinding:new b(8,!0),predefined:!0});a.push({actionID:"deleteWordPrevious",keyBinding:new b(8,!0,!0),predefined:!0});a.push({actionID:"deleteWordNext",keyBinding:new b(46,!0),predefined:!0});a.push({actionID:"tab",keyBinding:new b(9),predefined:!0});a.push({actionID:"shiftTab",keyBinding:new b(9,null,!0),predefined:!0});a.push({actionID:"enter",keyBinding:new b(13),
predefined:!0});a.push({actionID:"enter",keyBinding:new b(13,null,!0),predefined:!0});a.push({actionID:"selectAll",keyBinding:new b("a",!0),predefined:!0});a.push({actionID:"toggleTabMode",keyBinding:new b("m",!0),predefined:!0});d.isMac&&(a.push({actionID:"deleteNext",keyBinding:new b(46,null,!0),predefined:!0}),a.push({actionID:"deleteWordPrevious",keyBinding:new b(8,null,null,!0),predefined:!0}),a.push({actionID:"deleteWordNext",keyBinding:new b(46,null,null,!0),predefined:!0}));if(!d.isFirefox){var c=
d.isMac&&d.isChrome;a.push({actionID:null,keyBinding:new b("u",!c,!1,!1,c),predefined:!0});a.push({actionID:null,keyBinding:new b("i",!c,!1,!1,c),predefined:!0});a.push({actionID:null,keyBinding:new b("b",!c,!1,!1,c),predefined:!0})}d.isFirefox&&(a.push({actionID:"copy",keyBinding:new b(45,!0),predefined:!0}),a.push({actionID:"paste",keyBinding:new b(45,null,!0),predefined:!0}),a.push({actionID:"cut",keyBinding:new b(46,null,!0),predefined:!0}));d.isMac&&(a.push({actionID:"lineStart",keyBinding:new b("a",
!1,!1,!1,!0),predefined:!0}),a.push({actionID:"lineEnd",keyBinding:new b("e",!1,!1,!1,!0),predefined:!0}),a.push({actionID:"lineUp",keyBinding:new b("p",!1,!1,!1,!0),predefined:!0}),a.push({actionID:"lineDown",keyBinding:new b("n",!1,!1,!1,!0),predefined:!0}),a.push({actionID:"charPrevious",keyBinding:new b("b",!1,!1,!1,!0),predefined:!0}),a.push({actionID:"charNext",keyBinding:new b("f",!1,!1,!1,!0),predefined:!0}),a.push({actionID:"deletePrevious",keyBinding:new b("h",!1,!1,!1,!0),predefined:!0}),
a.push({actionID:"deleteNext",keyBinding:new b("d",!1,!1,!1,!0),predefined:!0}),a.push({actionID:"deleteLineEnd",keyBinding:new b("k",!1,!1,!1,!0),predefined:!0}),d.isFirefox?(a.push({actionID:"scrollPageDown",keyBinding:new b("v",!1,!1,!1,!0),predefined:!0}),a.push({actionID:"deleteLineStart",keyBinding:new b("u",!1,!1,!1,!0),predefined:!0}),a.push({actionID:"deleteWordPrevious",keyBinding:new b("w",!1,!1,!1,!0),predefined:!0})):(a.push({actionID:"pageDown",keyBinding:new b("v",!1,!1,!1,!0),predefined:!0}),
a.push({actionID:"centerLine",keyBinding:new b("l",!1,!1,!1,!0),predefined:!0}),a.push({actionID:"enterNoCursor",keyBinding:new b("o",!1,!1,!1,!0),predefined:!0})));var e=this;this._actions={lineUp:{defaultHandler:function(){return e._doLineUp({select:!1})}},lineDown:{defaultHandler:function(){return e._doLineDown({select:!1})}},lineStart:{defaultHandler:function(){return e._doHome({select:!1,ctrl:!1})}},lineEnd:{defaultHandler:function(){return e._doEnd({select:!1,ctrl:!1})}},charPrevious:{defaultHandler:function(){return e._doCursorPrevious({select:!1,
unit:"character"})}},charNext:{defaultHandler:function(){return e._doCursorNext({select:!1,unit:"character"})}},pageUp:{defaultHandler:function(){return e._doPageUp({select:!1})}},pageDown:{defaultHandler:function(){return e._doPageDown({select:!1})}},scrollPageUp:{defaultHandler:function(){return e._doScroll({type:"pageUp"})}},scrollPageDown:{defaultHandler:function(){return e._doScroll({type:"pageDown"})}},wordPrevious:{defaultHandler:function(){return e._doCursorPrevious({select:!1,unit:"word"})}},
wordNext:{defaultHandler:function(){return e._doCursorNext({select:!1,unit:"word"})}},textStart:{defaultHandler:function(){return e._doHome({select:!1,ctrl:!0})}},textEnd:{defaultHandler:function(){return e._doEnd({select:!1,ctrl:!0})}},scrollTextStart:{defaultHandler:function(){return e._doScroll({type:"textStart"})}},scrollTextEnd:{defaultHandler:function(){return e._doScroll({type:"textEnd"})}},centerLine:{defaultHandler:function(){return e._doScroll({type:"centerLine"})}},selectLineUp:{defaultHandler:function(){return e._doLineUp({select:!0})}},
selectLineDown:{defaultHandler:function(){return e._doLineDown({select:!0})}},selectWholeLineUp:{defaultHandler:function(){return e._doLineUp({select:!0,wholeLine:!0})}},selectWholeLineDown:{defaultHandler:function(){return e._doLineDown({select:!0,wholeLine:!0})}},selectLineStart:{defaultHandler:function(){return e._doHome({select:!0,ctrl:!1})}},selectLineEnd:{defaultHandler:function(){return e._doEnd({select:!0,ctrl:!1})}},selectCharPrevious:{defaultHandler:function(){return e._doCursorPrevious({select:!0,
unit:"character"})}},selectCharNext:{defaultHandler:function(){return e._doCursorNext({select:!0,unit:"character"})}},selectPageUp:{defaultHandler:function(){return e._doPageUp({select:!0})}},selectPageDown:{defaultHandler:function(){return e._doPageDown({select:!0})}},selectWordPrevious:{defaultHandler:function(){return e._doCursorPrevious({select:!0,unit:"word"})}},selectWordNext:{defaultHandler:function(){return e._doCursorNext({select:!0,unit:"word"})}},selectTextStart:{defaultHandler:function(){return e._doHome({select:!0,
ctrl:!0})}},selectTextEnd:{defaultHandler:function(){return e._doEnd({select:!0,ctrl:!0})}},deletePrevious:{defaultHandler:function(){return e._doBackspace({unit:"character"})}},deleteNext:{defaultHandler:function(){return e._doDelete({unit:"character"})}},deleteWordPrevious:{defaultHandler:function(){return e._doBackspace({unit:"word"})}},deleteWordNext:{defaultHandler:function(){return e._doDelete({unit:"word"})}},deleteLineStart:{defaultHandler:function(){return e._doBackspace({unit:"line"})}},
deleteLineEnd:{defaultHandler:function(){return e._doDelete({unit:"line"})}},tab:{defaultHandler:function(){return e._doTab()}},shiftTab:{defaultHandler:function(){return e._doShiftTab()}},enter:{defaultHandler:function(){return e._doEnter()}},enterNoCursor:{defaultHandler:function(){return e._doEnter({noCursor:!0})}},selectAll:{defaultHandler:function(){return e._doSelectAll()}},copy:{defaultHandler:function(){return e._doCopy()}},cut:{defaultHandler:function(){return e._doCut()}},paste:{defaultHandler:function(){return e._doPaste()}},
toggleWrapMode:{defaultHandler:function(){return e._doWrapMode()}},toggleTabMode:{defaultHandler:function(){return e._doTabMode()}}}},_createRuler:function(b,a){if(this._clientDiv){var c="left"===b.getLocation()?this._leftDiv:this._rightDiv;c.style.display="block";var e=d.createElement(c.ownerDocument,"div");e._ruler=b;e.rulerChanged=!0;e.style.position="relative";var c=c.firstChild.rows[0],f=c.cells.length,c=c.insertCell(void 0===a||0>a||a>f?f:a);c.vAlign="top";c.style.verticalAlign="top";c.style.borderWidth=
"0px";c.style.margin="0px";c.style.padding="0px";c.style.outline="none";c.appendChild(e)}},_createView:function(){if(!this._clientDiv){for(var b=this._parent;b.hasChildNodes();)b.removeChild(b.lastChild);var a=b.ownerDocument,c=d.createElement(a,"div");this._rootDiv=c;c.tabIndex=-1;c.style.position="relative";c.style.overflow="hidden";c.style.width="100%";c.style.height="100%";b.style.overflow="hidden";c.setAttribute("role","application");b.appendChild(c);b=d.createElement(a,"div");b.className="textviewLeftRuler";
this._leftDiv=b;b.tabIndex=-1;b.style.overflow="hidden";b.style.MozUserSelect="none";b.style.WebkitUserSelect="none";b.style.position="absolute";b.style.cursor="default";b.style.display="none";b.setAttribute("aria-hidden","true");var e=d.createElement(a,"table");b.appendChild(e);e.cellPadding="0px";e.cellSpacing="0px";e.border="0px";e.style.borderWidth="0px";e.style.margin="0px";e.style.padding="0px";e.style.outline="none";e.style.lineHeight="normal";e=e.insertRow(0);e.style.borderWidth="0px";e.style.margin=
"0px";e.style.padding="0px";e.style.outline="none";e.style.lineHeight="normal";c.appendChild(b);b=d.createElement(a,"div");b.className="textview";this._viewDiv=b;b.tabIndex=-1;b.style.overflow="auto";b.style.position="absolute";b.style.top="0px";b.style.bottom="0px";b.style.borderWidth="0px";b.style.margin="0px";b.style.outline="none";c.appendChild(b);var f=d.createElement(a,"div");f.className="textviewRightRuler";this._rightDiv=f;f.tabIndex=-1;f.style.display="none";f.style.overflow="hidden";f.style.MozUserSelect=
"none";f.style.WebkitUserSelect="none";f.style.position="absolute";f.style.cursor="default";f.style.right="0px";f.setAttribute("aria-hidden","true");e=d.createElement(a,"table");f.appendChild(e);e.cellPadding="0px";e.cellSpacing="0px";e.border="0px";e.style.borderWidth="0px";e.style.margin="0px";e.style.padding="0px";e.style.outline="none";e.style.lineHeight="normal";e=e.insertRow(0);e.style.borderWidth="0px";e.style.margin="0px";e.style.padding="0px";e.style.outline="none";e.style.lineHeight="normal";
c.appendChild(f);this._scrollDiv=e=d.createElement(a,"div");e.style.margin="0px";e.style.borderWidth="0px";e.style.padding="0px";b.appendChild(e);d.isFirefox&&(this._clipboardDiv=b=d.createElement(a,"div"),b.style.position="fixed",b.style.whiteSpace="pre",b.style.left="-1000px",c.appendChild(b));!d.isIE&&!d.isIOS&&(this._clipDiv=b=d.createElement(a,"div"),b.style.position="absolute",b.style.overflow="hidden",b.style.margin="0px",b.style.borderWidth="0px",b.style.padding="0px",c.appendChild(b),this._clipScrollDiv=
e=d.createElement(a,"div"),e.style.position="absolute",e.style.height="1px",e.style.top="-1000px",b.appendChild(e));this._setFullSelection(this._fullSelection,!0);b=d.createElement(a,"div");b.className="textviewContent";this._clientDiv=b;b.style.position="absolute";b.style.borderWidth="0px";b.style.margin="0px";b.style.padding="0px";b.style.outline="none";b.style.zIndex="1";b.style.WebkitUserSelect="text";b.setAttribute("spellcheck","false");if(d.isIOS||d.isAndroid)b.style.WebkitTapHighlightColor=
"transparent";(this._clipDiv||c).appendChild(b);if(d.isIOS||d.isAndroid)this._vScrollDiv=e=d.createElement(a,"div"),e.style.position="absolute",e.style.borderWidth="1px",e.style.borderColor="white",e.style.borderStyle="solid",e.style.borderRadius="4px",e.style.backgroundColor="black",e.style.opacity="0.5",e.style.margin="0px",e.style.padding="0px",e.style.outline="none",e.style.zIndex="3",e.style.width="8px",e.style.display="none",c.appendChild(e),this._hScrollDiv=e=d.createElement(a,"div"),e.style.position=
"absolute",e.style.borderWidth="1px",e.style.borderColor="white",e.style.borderStyle="solid",e.style.borderRadius="4px",e.style.backgroundColor="black",e.style.opacity="0.5",e.style.margin="0px",e.style.padding="0px",e.style.outline="none",e.style.zIndex="3",e.style.height="8px",e.style.display="none",c.appendChild(e);d.isFirefox&&!b.setCapture&&(this._overlayDiv=e=d.createElement(a,"div"),e.style.position=b.style.position,e.style.borderWidth=b.style.borderWidth,e.style.margin=b.style.margin,e.style.padding=
b.style.padding,e.style.cursor="text",e.style.zIndex="2",(this._clipDiv||c).appendChild(e));b.contentEditable="true";b.setAttribute("role","textbox");b.setAttribute("aria-multiline","true");this._setWrapMode(this._wrapMode,!0);this._setReadOnly(this._readonly);this._setThemeClass(this._themeClass,!0);this._setTabSize(this._tabSize,!0);a.getElementById("_textviewStyle")||(c="",d.isWebkit&&0<this._metrics.scrollWidth&&(c+="\n.textviewContainer ::-webkit-scrollbar-corner {background: #eeeeee;}"),d.isFirefox&&
(d.isMac&&this._highlightRGB&&"Highlight"!==this._highlightRGB)&&(c+="\n.textviewContainer ::-moz-selection {background: "+this._highlightRGB+";}"),c&&(b=d.createElement(a,"style"),b.id="_textviewStyle",e=a.getElementsByTagName("head")[0]||a.documentElement,b.appendChild(a.createTextNode(c)),e.insertBefore(b,e.firstChild)));this._hookEvents();a=this._rulers;for(c=0;c<a.length;c++)this._createRuler(a[c]);this._update()}},_defaultOptions:function(){return{parent:{value:void 0,update:null},model:{value:void 0,
update:this.setModel},readonly:{value:!1,update:this._setReadOnly},fullSelection:{value:!0,update:this._setFullSelection},tabMode:{value:!0,update:null},tabSize:{value:8,update:this._setTabSize},expandTab:{value:!1,update:null},wrapMode:{value:!1,update:this._setWrapMode},themeClass:{value:void 0,update:this._setThemeClass}}},_destroyRuler:function(b){var a="left"===b.getLocation()?this._leftDiv:this._rightDiv;if(a){for(var c=a.firstChild.rows[0],d=c.cells,e=0;e<d.length&&d[e].firstChild._ruler!==
b;e++);e!==d.length&&(c.cells[e]._ruler=void 0,c.deleteCell(e),0===d.length&&(a.style.display="none"))}},_destroyView:function(){if(this._clientDiv){this._setGrab(null);this._unhookEvents();var b=this._getWindow();this._autoScrollTimerID&&(b.clearTimeout(this._autoScrollTimerID),this._autoScrollTimerID=null);this._updateTimer&&(b.clearTimeout(this._updateTimer),this._updateTimer=null);b=this._rootDiv;b.parentNode.removeChild(b);this._hScrollDiv=this._vScrollDiv=this._rightDiv=this._leftDiv=this._overlayDiv=
this._clientDiv=this._clipScrollDiv=this._clipDiv=this._viewDiv=this._scrollDiv=this._rootDiv=this._clipboardDiv=this._selDiv3=this._selDiv2=this._selDiv1=null}},_doAutoScroll:function(b,a,c){this._autoScrollDir=b;this._autoScrollX=a;this._autoScrollY=c;this._autoScrollTimerID||this._autoScrollTimer()},_endAutoScroll:function(){this._autoScrollTimerID&&this._getWindow().clearTimeout(this._autoScrollTimerID);this._autoScrollTimerID=this._autoScrollDir=void 0},_fixCaret:function(){var b=this._clientDiv;
if(b){var a=this._hasFocus;this._ignoreFocus=!0;a&&b.blur();b.contentEditable=!1;b.contentEditable=!0;a&&b.focus();this._ignoreFocus=!1}},_getBaseText:function(b,a){var c=this._model;c.getBaseModel&&(b=c.mapOffset(b),a=c.mapOffset(a),c=c.getBaseModel());return c.getText(b,a)},_getBottomIndex:function(b){var a=this._bottomChild;if(b&&this._getClientHeight()>this._getLineHeight()){b=a.getBoundingClientRect();var c=this._clientDiv.getBoundingClientRect();b.bottom>c.bottom&&(a=this._getLinePrevious(a)||
a)}return a.lineIndex},_getBoundsAtOffset:function(b){var a=this._getLine(this._model.getLineAtOffset(b));b=a.getBoundingClientRect(b);var c=this._getLinePixel(a.lineIndex);b.top+=c;b.bottom+=c;a.destroy();return b},_getClientHeight:function(){var b=this._getViewPadding();return Math.max(0,this._viewDiv.clientHeight-b.top-b.bottom)},_getClientWidth:function(){var b=this._getViewPadding();return Math.max(0,this._viewDiv.clientWidth-b.left-b.right)},_getClipboardText:function(b,a){var c=this._model.getLineDelimiter(),
e,f,h=this._getWindow();if(h.clipboardData)return e=[],f=h.clipboardData.getData("Text"),r(f,function(b){e.push(b)},function(){e.push(c)}),f=e.join(""),a&&a(f),f;if(d.isFirefox){this._ignoreFocus=!0;var k=this._clipboardDiv;k.innerHTML="\x3cpre contenteditable\x3d''\x3e\x3c/pre\x3e";k.firstChild.focus();var m=this,l=function(){var b=m._getTextFromElement(k);k.innerHTML="";e=[];r(b,function(b){e.push(b)},function(){e.push(c)});return e.join("")},w=!1;this._ignorePaste=!0;if(!d.isLinux||2!==this._lastMouseButton)try{w=
k.ownerDocument.execCommand("paste",!1,null)}catch(q){w=1<k.childNodes.length||k.firstChild&&0<k.firstChild.childNodes.length}this._ignorePaste=!1;if(!w){if(b)return h.setTimeout(function(){m.focus();(f=l())&&a&&a(f);m._ignoreFocus=!1},0),null;this.focus();this._ignoreFocus=!1;return""}this.focus();this._ignoreFocus=!1;(f=l())&&a&&a(f);return f}return b&&b.clipboardData?(e=[],f=b.clipboardData.getData("text/plain"),r(f,function(b){e.push(b)},function(){e.push(c)}),(f=e.join(""))&&a&&a(f),f):""},_getDOMText:function(b,
a){for(var c=b.firstChild,d="",e=0;c;){var f;if(c.ignoreChars){f=c.lastChild;for(var h=0,k=[],m=-1;f;){for(var w=f.data,l=w.length-1;0<=l;l--){var q=w.substring(l,l+1);h<c.ignoreChars&&(" "===q||"\u200c"===q||"\ufeff"===q)?h++:k.push("\u00a0"===q?"\t":q)}a===f&&(m=k.length);f=f.previousSibling}k=k.reverse().join("");-1!==m&&(e=d.length+k.length-m);d+=k}else for(f=c.firstChild;f;)a===f&&(e=d.length),d+=f.data,f=f.nextSibling;c=c.nextSibling}return{text:d,offset:e}},_getTextFromElement:function(b){var a=
b.ownerDocument,c=a.defaultView;if(!c.getSelection)return b.innerText||b.textContent;a=a.createRange();a.selectNode(b);b=c.getSelection();var c=[],d;for(d=0;d<b.rangeCount;d++)c.push(b.getRangeAt(d));this._ignoreSelect=!0;b.removeAllRanges();b.addRange(a);a=b.toString();b.removeAllRanges();for(d=0;d<c.length;d++)b.addRange(c[d]);this._ignoreSelect=!1;return a},_getViewPadding:function(){return this._metrics.viewPadding},_getLine:function(b){var a=this._getLineNode(b);return a&&!a.lineChanged&&!a.lineRemoved?
a._line:new h(this,b)},_getLineHeight:function(b,a){if(void 0!==b&&this._lineHeight){var c=this._lineHeight[b];if(c)return c;if(a||void 0===a)return this._lineHeight[b]=this._calculateLineHeight(b)}return this._metrics.lineHeight},_getLineNode:function(b){for(var a=this._clientDiv.firstChild;a;){if(b===a.lineIndex)return a;a=a.nextSibling}},_getLineNext:function(b){for(b=b?b.nextSibling:this._clientDiv.firstChild;b&&-1===b.lineIndex;)b=b.nextSibling;return b},_getLinePrevious:function(b){for(b=b?
b.previousSibling:this._clientDiv.lastChild;b&&-1===b.lineIndex;)b=b.previousSibling;return b},_getLinePixel:function(b){b=Math.min(Math.max(0,b),this._model.getLineCount());if(this._lineHeight){var a=this._getTopIndex(),c=-this._topIndexY+this._getScroll().y;if(b>a)for(;a<b;a++)c+=this._getLineHeight(a);else for(a-=1;a>=b;a--)c-=this._getLineHeight(a);return c}return this._getLineHeight()*b},_getLineIndex:function(b){var a,c=0,d=this._model.getLineCount();if(this._lineHeight){var c=this._getTopIndex(),
e=-this._topIndexY+this._getScroll().y;if(b!==e)if(b<e)for(;b<e&&0<c;)b+=this._getLineHeight(--c);else for(a=this._getLineHeight(c);b-a>=e&&c<d-1;)b-=a,a=this._getLineHeight(++c)}else a=this._getLineHeight(),c=Math.floor(b/a);return Math.max(0,Math.min(d-1,c))},_getScroll:function(){var b=this._viewDiv;return{x:b.scrollLeft,y:b.scrollTop}},_getSelection:function(){return this._selection.clone()},_getTopIndex:function(b){var a=this._topChild;if(b&&this._getClientHeight()>this._getLineHeight()){b=a.getBoundingClientRect();
var c=this._getViewPadding(),d=this._viewDiv.getBoundingClientRect();b.top<d.top+c.top&&(a=this._getLineNext(a)||a)}return a.lineIndex},_hookEvents:function(){var b=this;this._modelListener={onChanging:function(a){b._onModelChanging(a)},onChanged:function(a){b._onModelChanged(a)}};this._model.addEventListener("preChanging",this._modelListener.onChanging);this._model.addEventListener("postChanged",this._modelListener.onChanged);var a=this._handlers=[],c=this._clientDiv,e=this._viewDiv,f=this._rootDiv,
h=this._overlayDiv||c,k=c.ownerDocument,l=this._getWindow(),q=d.isIE?k:l;a.push({target:l,type:"resize",handler:function(a){return b._handleResize(a?a:l.event)}});a.push({target:c,type:"blur",handler:function(a){return b._handleBlur(a?a:l.event)}});a.push({target:c,type:"focus",handler:function(a){return b._handleFocus(a?a:l.event)}});a.push({target:e,type:"focus",handler:function(b){c.focus()}});a.push({target:e,type:"scroll",handler:function(a){return b._handleScroll(a?a:l.event)}});a.push({target:c,
type:"textInput",handler:function(a){return b._handleTextInput(a?a:l.event)}});a.push({target:c,type:"keydown",handler:function(a){return b._handleKeyDown(a?a:l.event)}});a.push({target:c,type:"keypress",handler:function(a){return b._handleKeyPress(a?a:l.event)}});a.push({target:c,type:"keyup",handler:function(a){return b._handleKeyUp(a?a:l.event)}});a.push({target:c,type:"contextmenu",handler:function(a){return b._handleContextMenu(a?a:l.event)}});a.push({target:c,type:"copy",handler:function(a){return b._handleCopy(a?
a:l.event)}});a.push({target:c,type:"cut",handler:function(a){return b._handleCut(a?a:l.event)}});a.push({target:c,type:"paste",handler:function(a){return b._handlePaste(a?a:l.event)}});if(d.isIOS||d.isAndroid)a.push({target:k,type:"selectionchange",handler:function(a){return b._handleSelectionChange(a?a:l.event)}}),a.push({target:c,type:"touchstart",handler:function(a){return b._handleTouchStart(a?a:l.event)}}),a.push({target:c,type:"touchmove",handler:function(a){return b._handleTouchMove(a?a:l.event)}}),
a.push({target:c,type:"touchend",handler:function(a){return b._handleTouchEnd(a?a:l.event)}});else{a.push({target:c,type:"selectstart",handler:function(a){return b._handleSelectStart(a?a:l.event)}});a.push({target:c,type:"mousedown",handler:function(a){return b._handleMouseDown(a?a:l.event)}});a.push({target:c,type:"mouseover",handler:function(a){return b._handleMouseOver(a?a:l.event)}});a.push({target:c,type:"mouseout",handler:function(a){return b._handleMouseOut(a?a:l.event)}});a.push({target:q,
type:"mouseup",handler:function(a){return b._handleMouseUp(a?a:l.event)}});a.push({target:q,type:"mousemove",handler:function(a){return b._handleMouseMove(a?a:l.event)}});a.push({target:f,type:"mousedown",handler:function(a){return b._handleRootMouseDown(a?a:l.event)}});a.push({target:f,type:"mouseup",handler:function(a){return b._handleRootMouseUp(a?a:l.event)}});a.push({target:h,type:"dragstart",handler:function(a){return b._handleDragStart(a?a:l.event)}});a.push({target:h,type:"drag",handler:function(a){return b._handleDrag(a?
a:l.event)}});a.push({target:h,type:"dragend",handler:function(a){return b._handleDragEnd(a?a:l.event)}});a.push({target:h,type:"dragenter",handler:function(a){return b._handleDragEnter(a?a:l.event)}});a.push({target:h,type:"dragover",handler:function(a){return b._handleDragOver(a?a:l.event)}});a.push({target:h,type:"dragleave",handler:function(a){return b._handleDragLeave(a?a:l.event)}});a.push({target:h,type:"drop",handler:function(a){return b._handleDrop(a?a:l.event)}});a.push({target:this._clientDiv,
type:d.isFirefox?"DOMMouseScroll":"mousewheel",handler:function(a){return b._handleMouseWheel(a?a:l.event)}});if(d.isFirefox&&(!d.isWindows||15<=d.isFirefox))(e=l.MutationObserver||l.MozMutationObserver)?(this._mutationObserver=new e(function(a){b._handleDataModified(a)}),this._mutationObserver.observe(c,{subtree:!0,characterData:!0})):a.push({target:this._clientDiv,type:"DOMCharacterDataModified",handler:function(a){return b._handleDataModified(a?a:l.event)}});this._overlayDiv&&(a.push({target:this._overlayDiv,
type:"mousedown",handler:function(a){return b._handleMouseDown(a?a:l.event)}}),a.push({target:this._overlayDiv,type:"mouseover",handler:function(a){return b._handleMouseOver(a?a:l.event)}}),a.push({target:this._overlayDiv,type:"mouseout",handler:function(a){return b._handleMouseOut(a?a:l.event)}}),a.push({target:this._overlayDiv,type:"contextmenu",handler:function(a){return b._handleContextMenu(a?a:l.event)}}));this._isW3CEvents||a.push({target:this._clientDiv,type:"dblclick",handler:function(a){return b._handleDblclick(a?
a:l.event)}})}e=this._leftDiv;f=this._rightDiv;d.isIE&&a.push({target:e,type:"selectstart",handler:function(){return!1}});a.push({target:e,type:d.isFirefox?"DOMMouseScroll":"mousewheel",handler:function(a){return b._handleMouseWheel(a?a:l.event)}});a.push({target:e,type:"click",handler:function(a){b._handleRulerEvent(a?a:l.event)}});a.push({target:e,type:"dblclick",handler:function(a){b._handleRulerEvent(a?a:l.event)}});a.push({target:e,type:"mousemove",handler:function(a){b._handleRulerEvent(a?a:
l.event)}});a.push({target:e,type:"mouseover",handler:function(a){b._handleRulerEvent(a?a:l.event)}});a.push({target:e,type:"mouseout",handler:function(a){b._handleRulerEvent(a?a:l.event)}});d.isIE&&a.push({target:f,type:"selectstart",handler:function(){return!1}});a.push({target:f,type:d.isFirefox?"DOMMouseScroll":"mousewheel",handler:function(a){return b._handleMouseWheel(a?a:l.event)}});a.push({target:f,type:"click",handler:function(a){b._handleRulerEvent(a?a:l.event)}});a.push({target:f,type:"dblclick",
handler:function(a){b._handleRulerEvent(a?a:l.event)}});a.push({target:f,type:"mousemove",handler:function(a){b._handleRulerEvent(a?a:l.event)}});a.push({target:f,type:"mouseover",handler:function(a){b._handleRulerEvent(a?a:l.event)}});a.push({target:f,type:"mouseout",handler:function(a){b._handleRulerEvent(a?a:l.event)}});for(e=0;e<a.length;e++)f=a[e],m(f.target,f.type,f.handler,f.capture)},_getWindow:function(){return this._parent.ownerDocument.defaultView||this._parent.ownerDocument.parentWindow},
_init:function(a){var c=a.parent;"string"===typeof c&&(c=(a.document||document).getElementById(c));if(!c)throw"no parent";a.parent=c;a.model=a.model||new p.TextModel;var f=this._defaultOptions(),h;for(h in f)f.hasOwnProperty(h)&&(this["_"+h]=void 0!==a[h]?a[h]:f[h].value);this._rulers=[];this._selection=new e(0,0,!1);this._linksVisible=!1;this._maxLineWidth=this._redrawCount=0;this._maxLineIndex=-1;this._ignoreSelect=!0;this._hasFocus=this._ignoreFocus=!1;this._dragOffset=this._columnX=-1;this._isRangeRects=
(!d.isIE||9<=d.isIE)&&"function"===typeof c.ownerDocument.createRange().getBoundingClientRect;this._isW3CEvents=c.addEventListener;this._autoScrollTimerID=this._autoScrollY=this._autoScrollX=null;this._AUTO_SCROLL_RATE=50;this._mouseUpClosure=this._moseMoveClosure=this._grabControl=null;this._clickCount=this._lastMouseTime=this._lastMouseY=this._lastMouseX=0;this._clickTime=250;this._clickDist=5;this._isMouseDown=!1;this._doubleClickSelection=null;this._vScroll=this._hScroll=0;this._imeOffset=-1;
this._createActions();this._createView()},_isOverOverlayScroll:function(){if(!d.isMac)return{};var a=this._viewDiv.getBoundingClientRect(),c=this._lastMouseMoveX,e=this._lastMouseMoveY;return{vertical:a.top<=e&&e<a.bottom&&a.right-15<=c&&c<a.right,horizontal:a.bottom-15<=e&&e<a.bottom&&a.left<=c&&c<a.right}},_modifyContent:function(a,c){if(!this._readonly||a._code)if(a.type="Verify",this.onVerify(a),!(null===a.text||void 0===a.text)){var d=this._model;try{a._ignoreDOMSelection&&(this._ignoreDOMSelection=
!0),d.setText(a.text,a.start,a.end)}finally{a._ignoreDOMSelection&&(this._ignoreDOMSelection=!1)}c&&(d=this._getSelection(),d.setCaret(a.start+a.text.length),this._setSelection(d,!0));this.onModify({type:"Modify"})}},_onModelChanged:function(a){a.type="ModelChanged";this.onModelChanged(a);a.type="Changed";var c=a.start,d=a.addedCharCount,e=a.removedCharCount,f=a.addedLineCount,h=a.removedLineCount,k=this._getSelection();k.end>c&&(k.end>c&&k.start<c+e?k.setCaret(c+d):(k.start+=d-e,k.end+=d-e),this._setSelection(k,
!1,!1));c=this._model.getLineAtOffset(c);for(d=this._getLineNext();d;)e=d.lineIndex,c<=e&&e<=c+h&&(c===e&&!d.modelChangedEvent&&!d.lineRemoved?(d.modelChangedEvent=a,d.lineChanged=!0):(d.lineRemoved=!0,d.lineChanged=!1,d.modelChangedEvent=null)),e>c+h&&(d.lineIndex=e+f-h,d._line.lineIndex=d.lineIndex),d=this._getLineNext(d);!this._wrapMode&&(c<=this._maxLineIndex&&this._maxLineIndex<=c+h)&&(this._checkMaxLineIndex=this._maxLineIndex,this._maxLineIndex=-1,this._maxLineWidth=0);this._update()},_onModelChanging:function(a){a.type=
"ModelChanging";this.onModelChanging(a);a.type="Changing"},_queueUpdate:function(){if(!this._updateTimer&&!this._ignoreQueueUpdate){var a=this;this._updateTimer=this._getWindow().setTimeout(function(){a._updateTimer=null;a._update()},0)}},_resetLineHeight:function(a,c){if(this._wrapMode){if(void 0!==a&&void 0!==c)for(var d=a;d<c;d++)this._lineHeight[d]=void 0;else this._lineHeight=Array(this._model.getLineCount());this._calculateLineHeightTimer()}else this._lineHeight=null},_resetLineWidth:function(){var a=
this._clientDiv;if(a)for(a=a.firstChild;a;)a.lineWidth=void 0,a=a.nextSibling},_reset:function(){this._maxLineIndex=-1;this._maxLineWidth=0;this._columnX=-1;this._bottomChild=this._topChild=null;this._topIndexY=0;this._resetLineHeight();this._setSelection(new e(0,0,!1),!1,!1);this._viewDiv&&(this._viewDiv.scrollLeft=0,this._viewDiv.scrollTop=0);var a=this._clientDiv;if(a){for(var c=a.firstChild;c;)c.lineRemoved=!0,c=c.nextSibling;d.isFirefox&&(this._ignoreFocus=!1,(c=this._hasFocus)&&a.blur(),a.contentEditable=
!1,a.contentEditable=!0,c&&a.focus(),this._ignoreFocus=!1)}},_scrollView:function(a,c){this._ensureCaretVisible=!1;var d=this._viewDiv;a&&(d.scrollLeft+=a);c&&(d.scrollTop+=c)},_setClipboardText:function(a,c){var e,f=this._parent.ownerDocument,h=this._getWindow();if(h.clipboardData)return e=[],r(a,function(a){e.push(a)},function(){e.push(d.platformDelimiter)}),h.clipboardData.setData("Text",e.join(""));if(c&&c.clipboardData&&(e=[],r(a,function(a){e.push(a)},function(){e.push(d.platformDelimiter)}),
c.clipboardData.setData("text/plain",e.join(""))))return!0;var k=d.createElement(f,"pre");k.style.position="fixed";k.style.left="-1000px";r(a,function(a){k.appendChild(f.createTextNode(a))},function(){k.appendChild(d.createElement(f,"br"))});k.appendChild(f.createTextNode(" "));this._clientDiv.appendChild(k);var m=f.createRange();m.setStart(k.firstChild,0);m.setEndBefore(k.lastChild);var l=h.getSelection();0<l.rangeCount&&l.removeAllRanges();l.addRange(m);var q=this,m=function(){k&&k.parentNode===
q._clientDiv&&q._clientDiv.removeChild(k);q._updateDOMSelection()},l=!1;this._ignoreCopy=!0;try{l=f.execCommand("copy",!1,null)}catch(s){}this._ignoreCopy=!1;if(!l&&c)return h.setTimeout(m,0),!1;m();return!0},_setDOMSelection:function(a,c,e,f){for(var h,k,m,l,q=0,s=a.firstChild,r,p,t=this._model.getLine(a.lineIndex).length;s;){r=s.firstChild;p=r.length;s.ignoreChars&&(p-=s.ignoreChars);if(q+p>c||q+p>=t){h=r;k=c-q;s.ignoreChars&&(0<p&&k===p)&&(k+=s.ignoreChars);break}q+=p;s=s.nextSibling}for(var q=
0,s=e.firstChild,C=this._model.getLine(e.lineIndex).length;s;){r=s.firstChild;p=r.length;s.ignoreChars&&(p-=s.ignoreChars);if(p+q>f||q+p>=C){m=r;l=f-q;s.ignoreChars&&(0<p&&l===p)&&(l+=s.ignoreChars);break}q+=p;s=s.nextSibling}this._setDOMFullSelection(a,c,t,e,f,C);this._hasFocus&&(c=this._getWindow(),a=this._parent.ownerDocument,c.getSelection?(c=c.getSelection(),c.anchorNode===h&&c.anchorOffset===k&&c.focusNode===m&&c.focusOffset===l||c.anchorNode===m&&c.anchorOffset===l&&c.focusNode===h&&c.focusOffset===
k||(a=a.createRange(),a.setStart(h,k),a.setEnd(m,l),this._ignoreSelect=!1,0<c.rangeCount&&c.removeAllRanges(),c.addRange(a),this._ignoreSelect=!0)):a.selection&&(c=a.body,a=d.createElement(a,"div"),c.appendChild(a),c.removeChild(a),a=c.createTextRange(),a.moveToElementText(h.parentNode),a.moveStart("character",k),h=c.createTextRange(),h.moveToElementText(m.parentNode),h.moveStart("character",l),a.setEndPoint("EndToStart",h),this._ignoreSelect=!1,a.select(),this._ignoreSelect=!0))},_setDOMFullSelection:function(a,
c,d,e,f,k){if(this._selDiv1&&(d=this._selDiv1,d.style.width="0px",d.style.height="0px",d=this._selDiv2,d.style.width="0px",d.style.height="0px",d=this._selDiv3,d.style.width="0px",d.style.height="0px",!(a===e&&c===f))){var m=this._model,l=this._getViewPadding(),q=this._clientDiv.getBoundingClientRect(),s=this._viewDiv.getBoundingClientRect();d=s.left+l.left;k=q.right;var l=s.top+l.top,r=q.bottom,s=q=0;this._clipDiv?(s=this._clipDiv.getBoundingClientRect(),q=s.left-this._clipDiv.scrollLeft):(s=this._rootDiv.getBoundingClientRect(),
q=s.left);s=s.top;this._ignoreDOMSelection=!0;a=(new h(this,a.lineIndex,a)).getBoundingClientRect(m.getLineStart(a.lineIndex)+c,!1);var p=a.left;f=(new h(this,e.lineIndex,e)).getBoundingClientRect(m.getLineStart(e.lineIndex)+f,!1);c=f.left;this._ignoreDOMSelection=!1;var m=this._selDiv1,p=Math.min(k,Math.max(d,p)),t=Math.min(r,Math.max(l,a.top)),C=k;e=Math.min(r,Math.max(l,a.bottom));m.style.left=p-q+"px";m.style.top=t-s+"px";m.style.width=Math.max(0,C-p)+"px";m.style.height=Math.max(0,e-t)+"px";
a.top===f.top?(C=Math.min(c,k),m.style.width=Math.max(0,C-p)+"px"):(a=Math.min(r,Math.max(l,f.top)),c=Math.min(k,Math.max(d,c)),l=Math.min(r,Math.max(l,f.bottom)),r=this._selDiv3,r.style.left=d-q+"px",r.style.top=a-s+"px",r.style.width=Math.max(0,c-d)+"px",r.style.height=Math.max(0,l-a)+"px",0<a-e&&(l=this._selDiv2,l.style.left=d-q+"px",l.style.top=e-s+"px",l.style.width=Math.max(0,k-d)+"px",l.style.height=Math.max(0,a-e)+"px"))}},_setGrab:function(a){a!==this._grabControl&&(a?(a.setCapture&&a.setCapture(),
this._grabControl=a):(this._grabControl.releaseCapture&&this._grabControl.releaseCapture(),this._grabControl=null))},_setLinksVisible:function(a){if(this._linksVisible!==a){this._linksVisible=a;d.isIE&&a&&(this._hadFocus=this._hasFocus);var c=this._clientDiv;c.contentEditable=!a;this._hadFocus&&!a&&c.focus();this._overlayDiv&&(this._overlayDiv.style.zIndex=a?"-1":"1");for(a=this._getLineNext();a;){if(a.hasLink)for(c=a.firstChild;c;){var e=c.nextSibling,f=c.viewStyle;f&&"A"===f.tagName&&a.replaceChild(a._line._createSpan(a,
c.firstChild.data,f),c);c=e}a=this._getLineNext(a)}}},_setSelection:function(a,c,d,e){if(a){this._columnX=-1;void 0===d&&(d=!0);var f=this._selection;this._selection=a;c&&this._showCaret(!1,e);d&&this._updateDOMSelection();if(!f.equals(a))this.onSelection({type:"Selection",oldValue:{start:f.start,end:f.end},newValue:{start:a.start,end:a.end}})}},_setSelectionTo:function(a,c,d,e){var f=this._model,h=this._getSelection();c=this.convert({x:a,y:c},"page","document");a=this._getLineIndex(c.y);if(1===this._clickCount){f=
this._getLine(a);a=f.getOffset(c.x,c.y-this._getLinePixel(a));f.destroy();if(e&&!d&&h.start<=a&&a<h.end)return this._dragOffset=a,!1;h.extend(a);d||h.collapse()}else 0===(this._clickCount&1)?(f=this._getLine(a),a=f.getOffset(c.x,c.y-this._getLinePixel(a)),this._doubleClickSelection?a>=this._doubleClickSelection.start?(d=this._doubleClickSelection.start,e=f.getNextOffset(a,"wordend",1)):(d=f.getNextOffset(a,"word",-1),e=this._doubleClickSelection.end):(d=f.getNextOffset(a,"word",-1),e=f.getNextOffset(d,
"wordend",1)),f.destroy()):this._doubleClickSelection?(e=f.getLineAtOffset(this._doubleClickSelection.start),a>=e?(d=f.getLineStart(e),e=f.getLineEnd(a)):(d=f.getLineStart(a),e=f.getLineEnd(e))):(d=f.getLineStart(a),e=f.getLineEnd(a)),h.setCaret(d),h.extend(e);this._setSelection(h,!0,!0);return!0},_setFullSelection:function(a,c){this._fullSelection=a;d.isWebkit&&(this._fullSelection=!0);var e=this._clipDiv||this._rootDiv;if(e)if(this._fullSelection){if(!this._selDiv1&&this._fullSelection&&!d.isIOS){var f=
e.ownerDocument;this._highlightRGB=d.isWebkit?"transparent":"Highlight";var h=d.createElement(f,"div");this._selDiv1=h;h.style.position="absolute";h.style.borderWidth="0px";h.style.margin="0px";h.style.padding="0px";h.style.outline="none";h.style.background=this._highlightRGB;h.style.width="0px";h.style.height="0px";h.style.zIndex="0";e.appendChild(h);var k=d.createElement(f,"div");this._selDiv2=k;k.style.position="absolute";k.style.borderWidth="0px";k.style.margin="0px";k.style.padding="0px";k.style.outline=
"none";k.style.background=this._highlightRGB;k.style.width="0px";k.style.height="0px";k.style.zIndex="0";e.appendChild(k);this._selDiv3=f=d.createElement(f,"div");f.style.position="absolute";f.style.borderWidth="0px";f.style.margin="0px";f.style.padding="0px";f.style.outline="none";f.style.background=this._highlightRGB;f.style.width="0px";f.style.height="0px";f.style.zIndex="0";e.appendChild(f);if(d.isFirefox&&d.isMac){e=this._getWindow().getComputedStyle(f,null).getPropertyValue("background-color");
switch(e){case "rgb(119, 141, 168)":e="rgb(199, 208, 218)";break;case "rgb(127, 127, 127)":e="rgb(198, 198, 198)";break;case "rgb(255, 193, 31)":e="rgb(250, 236, 115)";break;case "rgb(243, 70, 72)":e="rgb(255, 176, 139)";break;case "rgb(255, 138, 34)":e="rgb(255, 209, 129)";break;case "rgb(102, 197, 71)":e="rgb(194, 249, 144)";break;case "rgb(140, 78, 184)":e="rgb(232, 184, 255)";break;default:e="rgb(180, 213, 255)"}this._highlightRGB=e;h.style.background=e;k.style.background=e;f.style.background=
e}c||this._updateDOMSelection()}}else this._selDiv1&&(e.removeChild(this._selDiv1),this._selDiv1=null),this._selDiv2&&(e.removeChild(this._selDiv2),this._selDiv2=null),this._selDiv3&&(e.removeChild(this._selDiv3),this._selDiv3=null)},_setReadOnly:function(a){this._readonly=a;this._clientDiv.setAttribute("aria-readonly",a?"true":"false")},_setTabSize:function(a,c){this._tabSize=a;this._customTabSize=void 0;var e=this._clientDiv;d.isOpera?e&&(e.style.OTabSize=this._tabSize+""):537.1<=d.isWebkit?e&&
(e.style.tabSize=this._tabSize+""):4<=d.isFirefox?e&&(e.style.MozTabSize=this._tabSize+""):8!==this._tabSize&&(this._customTabSize=this._tabSize);c||(this.redrawLines(),this._resetLineWidth())},_setThemeClass:function(a,c){this._themeClass=a;var d="textviewContainer";this._themeClass&&(d+=" "+this._themeClass);this._rootDiv.className=d;this._updateStyle(c)},_setWrapMode:function(a,c){this._wrapMode=a;var d=this._clientDiv,e=this._viewDiv;a?(d.style.whiteSpace="pre-wrap",d.style.wordWrap="break-word",
e.style.overflowX="hidden",e.style.overflowY="scroll"):(d.style.whiteSpace="pre",d.style.wordWrap="normal",e.style.overflowX="auto",e.style.overflowY="auto");c||(this.redraw(),this._resetLineWidth());this._resetLineHeight()},_showCaret:function(a,c){if(this._clientDiv){var d=this._model,e=this._getSelection(),f=this._getScroll(),h=e.getCaret(),k=e.start,m=e.end,l=d.getLineAtOffset(m),q=Math.max(Math.max(k,d.getLineStart(l)),m-1),d=this._getClientWidth(),l=this._getClientHeight(),s=d/4,r=this._getBoundsAtOffset(h===
k?k:q),p=r.left,t=r.right,u=r.top,I=r.bottom;a&&!e.isEmpty()&&(r=this._getBoundsAtOffset(h===m?k:q),r.top===u?h===k?t=p+Math.min(r.right-p,d):p=t-Math.min(t-r.left,d):h===k?I=u+Math.min(r.bottom-u,l):u=I-Math.min(I-r.top,l));e=0;p<f.x&&(e=Math.min(p-f.x,-s));t>f.x+d&&(e=Math.max(t-f.x-d,s));h=0;u<f.y?h=u-f.y:I>f.y+l&&(h=I-f.y-l);c&&(0<c?0<h&&(h=Math.max(h,c)):0>h&&(h=Math.min(h,c)));return 0!==e||0!==h?(this._scrollView(e,h),l!==this._getClientHeight()||d!==this._getClientWidth()?this._showCaret():
this._ensureCaretVisible=!0,!0):!1}},_startIME:function(){if(-1===this._imeOffset){var a=this._getSelection();a.isEmpty()||this._modifyContent({text:"",start:a.start,end:a.end},!0);this._imeOffset=a.start}},_unhookEvents:function(){this._model.removeEventListener("preChanging",this._modelListener.onChanging);this._model.removeEventListener("postChanged",this._modelListener.onChanged);this._modelListener=null;for(var a=0;a<this._handlers.length;a++){var c=this._handlers[a],d=c.target,e=c.type,c=c.handler;
"function"===typeof d.removeEventListener?d.removeEventListener(e,c,!1):d.detachEvent("on"+e,c)}this._handlers=null;this._mutationObserver&&(this._mutationObserver.disconnect(),this._mutationObserver=null)},_updateDOMSelection:function(){if(!this._ignoreDOMSelection&&this._clientDiv){var a=this._getSelection(),c=this._model,d=c.getLineAtOffset(a.start),e=c.getLineAtOffset(a.end),f=this._getLineNext();if(f){var h=this._getLinePrevious(),k;d<f.lineIndex?(k=f,d=0):d>h.lineIndex?(k=h,d=0):(k=this._getLineNode(d),
d=a.start-c.getLineStart(d));e<f.lineIndex?a=0:e>h.lineIndex?(f=h,a=0):(f=this._getLineNode(e),a=a.end-c.getLineStart(e));this._setDOMSelection(k,d,f,a)}}},_update:function(a){if(!(0<this._redrawCount)){this._updateTimer&&(this._getWindow().clearTimeout(this._updateTimer),this._updateTimer=null,a=!1);var c=this._clientDiv;if(c){this._metrics.invalid&&(this._ignoreQueueUpdate=!0,this._updateStyle(),this._ignoreQueueUpdate=!1);var e=this._model,f=this._getScroll(),k=this._getViewPadding(),m=e.getLineCount(),
l=this._getLineHeight(),q=this._getClientWidth();this._wrapMode&&(c.style.width=q+"px");var s,r,p,t,z=0,u=0;if(this._lineHeight){for(;u<m;){p=this._getLineHeight(u);if(z+p>f.y)break;z+=p;u++}s=u;r=Math.max(0,s-1);p=e=f.y-z;0<s&&(e+=this._getLineHeight(s-1))}else t=Math.max(0,f.y)/l,s=Math.floor(t),r=Math.max(0,s-1),e=Math.round((t-r)*l),p=Math.round((t-s)*l);this._topIndexY=p;t=this._parent;var H=t.clientWidth,I=t.clientHeight;t=this._getClientHeight();if(a){r=0;this._leftDiv&&(s=this._leftDiv.getBoundingClientRect(),
r=s.right-s.left);s=q;for(this._wrapMode||(s=Math.max(this._maxLineWidth,s));u<m;)p=this._getLineHeight(u,!1),z+=p,u++;m=z}else{for(var q=this._viewDiv,f=Math.min(s+Math.floor((t+p)/l),m-1),E=Math.min(f+1,m-1),l=c.firstChild;l;){p=l.lineIndex;var F=l.nextSibling;if(!(r<=p&&p<=E)||l.lineRemoved||-1===l.lineIndex)this._mouseWheelLine===l?(l.style.display="none",l.lineIndex=-1):c.removeChild(l);l=F}var l=this._getLineNext(),F=q.ownerDocument,G=F.createDocumentFragment();for(p=r;p<=E;p++)!l||l.lineIndex>
p?(new h(this,p)).create(G,null):(G.firstChild&&(c.insertBefore(G,l),G=F.createDocumentFragment()),l&&l.lineChanged&&(l=(new h(this,p)).create(G,l),l.lineChanged=!1),l=this._getLineNext(l));G.firstChild&&c.insertBefore(G,l);d.isWebkit&&!this._wrapMode&&(c.style.width="0x7fffffffpx");l=this._getLineNext();p=t+e;for(F=!1;l;)r=l.lineWidth,void 0===r&&(E=l._line.getBoundingClientRect(),r=l.lineWidth=Math.ceil(E.right-E.left),this._lineHeight&&(this._lineHeight[l.lineIndex]=Math.ceil(E.bottom-E.top))),
this._lineHeight&&!F&&(p-=this._lineHeight[l.lineIndex],0>p&&(f=l.lineIndex,F=!0)),this._wrapMode||(r>=this._maxLineWidth&&(this._maxLineWidth=r,this._maxLineIndex=l.lineIndex),this._checkMaxLineIndex===l.lineIndex&&(this._checkMaxLineIndex=-1)),l.lineIndex===s&&(this._topChild=l),l.lineIndex===f&&(this._bottomChild=l),l=this._getLineNext(l);-1!==this._checkMaxLineIndex&&(p=this._checkMaxLineIndex,this._checkMaxLineIndex=-1,0<=p&&p<m&&(l=new h(this,p),E=l.getBoundingClientRect(),r=E.right-E.left,
r>=this._maxLineWidth&&(this._maxLineWidth=r,this._maxLineIndex=p),l.destroy()));for(;u<m;)p=this._getLineHeight(u,u<=f),z+=p,u++;m=z;this._updateRuler(this._leftDiv,s,f);this._updateRuler(this._rightDiv,s,f);r=0;this._leftDiv&&(s=this._leftDiv.getBoundingClientRect(),r=s.right-s.left);f=0;this._rightDiv&&(f=this._rightDiv.getBoundingClientRect(),f=f.right-f.left);q.style.left=r+"px";q.style.right=f+"px";f=this._scrollDiv;f.style.height=m+"px";z=q=this._getClientWidth();this._wrapMode||(z=Math.max(this._maxLineWidth,
z));s=z;if((!d.isIE||9<=d.isIE)&&this._maxLineWidth>q)z+=k.right+k.left;f.style.width=z+"px";this._clipScrollDiv&&(this._clipScrollDiv.style.width=z+"px");f=this._getScroll();z=t+k.top+k.bottom;this._updateRulerSize(this._leftDiv,z);this._updateRulerSize(this._rightDiv,z)}this._vScrollDiv&&(z=t-8,u=Math.max(15,Math.ceil(Math.min(1,z/(m+k.top+k.bottom))*z)),this._vScrollDiv.style.left=r+q-8+"px",this._vScrollDiv.style.top=Math.floor(Math.max(0,f.y*z/m))+"px",this._vScrollDiv.style.height=u+"px");!this._wrapMode&&
this._hScrollDiv&&(z=q-8,u=Math.max(15,Math.ceil(Math.min(1,z/(this._maxLineWidth+k.left+k.right))*z)),this._hScrollDiv.style.left=r+Math.floor(Math.max(0,Math.floor(f.x*z/this._maxLineWidth)))+"px",this._hScrollDiv.style.top=t-9+"px",this._hScrollDiv.style.width=u+"px");E=f.x;p=this._clipDiv;z=this._overlayDiv;p?(p.scrollLeft=E,u=r+k.left,l=k.top,a=q,r=t,E=0,F=-e,0===f.x&&(u-=k.left,a+=k.left,E=k.left),f.x+q===s&&(a+=k.right),0===f.y&&(l-=k.top,r+=k.top,F+=k.top),f.y+t===m&&(r+=k.bottom),p.style.left=
u+"px",p.style.top=l+"px",k=this._isOverOverlayScroll(),p.style.right=H-a-u+(this._overlayScrollTimer&&k.vertical?15:0)+"px",p.style.bottom=I-r-l+(this._overlayScrollTimer&&k.horizontal?15:0)+"px",c.style.left=E+"px",c.style.top=F+"px",c.style.width=s+"px",c.style.height=t+e+"px",z&&(z.style.left=c.style.left,z.style.top=c.style.top,z.style.width=c.style.width,z.style.height=c.style.height)):(u=E,l=e,H=E+q,I=e+t,0===u&&(u-=k.left),0===l&&(l-=k.top),H===s&&(H+=k.right),f.y+t===m&&(I+=k.bottom),c.style.clip=
"rect("+l+"px,"+H+"px,"+I+"px,"+u+"px)",c.style.left=-E+r+k.left+"px",c.style.width=(d.isWebkit?s:q+E)+"px",a||(c.style.top=-e+k.top+"px",c.style.height=t+e+"px"),z&&(z.style.clip=c.style.clip,z.style.left=c.style.left,z.style.width=c.style.width,a||(z.style.top=c.style.top,z.style.height=c.style.height)));this._updateDOMSelection();c=this._ensureCaretVisible;this._ensureCaretVisible=!1;t!==this._getClientHeight()&&(this._update(),c&&this._showCaret())}}},_updateRulerSize:function(a,c){if(a){for(var d=
this._topIndexY,e=this._getLineHeight(),f=a.firstChild.rows[0].cells,h=0;h<f.length;h++){var k=f[h].firstChild,m=e;"page"===k._ruler.getOverview()&&(m+=d);k.style.top=-m+"px";k.style.height=c+m+"px"}a.style.height=c+"px"}},_updateRuler:function(a,c,e){if(a){a=a.firstChild.rows[0].cells;for(var f=this._parent.ownerDocument,h=this._getLineHeight(),k=this._getViewPadding(),m=0;m<a.length;m++){var q=a[m].firstChild,s=q._ruler;q.rulerChanged&&l(s.getRulerStyle(),q);var r,p=q.firstChild;p?(r=p,p=p.nextSibling):
(r=d.createElement(f,"div"),r.style.visibility="hidden",q.appendChild(r));var t,u;if(q.rulerChanged&&r){t=-1;if(u=s.getWidestAnnotation())l(u.style,r),u.html&&(r.innerHTML=u.html);r.lineIndex=t;r.style.height=h+k.top+"px"}var C,H;if("page"===s.getOverview()){for(s=s.getAnnotations(c,e+1);p;)t=p.lineIndex,u=p.nextSibling,(!(c<=t&&t<=e)||p.lineChanged)&&q.removeChild(p),p=u;p=q.firstChild.nextSibling;H=f.createDocumentFragment();for(t=c;t<=e;t++)if(!p||p.lineIndex>t){C=d.createElement(f,"div");if(u=
s[t])l(u.style,C),u.html&&(C.innerHTML=u.html),C.annotation=u;C.lineIndex=t;C.style.height=this._getLineHeight(t)+"px";H.appendChild(C)}else H.firstChild&&(q.insertBefore(H,p),H=f.createDocumentFragment()),p&&(p=p.nextSibling);H.firstChild&&q.insertBefore(H,p)}else{u=this._getClientHeight();t=this._model.getLineCount();p=u+k.top+k.bottom-2*this._metrics.scrollWidth;r=h*t<p?h:p/t;if(q.rulerChanged){for(u=q.childNodes.length;1<u;)q.removeChild(q.lastChild),u--;s=s.getAnnotations(0,t);H=f.createDocumentFragment();
for(var I in s)t=I>>>0,0>t||(C=d.createElement(f,"div"),u=s[I],l(u.style,C),C.style.position="absolute",C.style.top=this._metrics.scrollWidth+h+Math.floor(t*r)+"px",u.html&&(C.innerHTML=u.html),C.annotation=u,C.lineIndex=t,H.appendChild(C));q.appendChild(H)}else if(q._oldTrackHeight!==p)for(C=q.firstChild?q.firstChild.nextSibling:null;C;)C.style.top=this._metrics.scrollWidth+h+Math.floor(C.lineIndex*r)+"px",C=C.nextSibling;q._oldTrackHeight=p}q.rulerChanged=!1}}},_updateStyle:function(a){!a&&d.isIE&&
(this._rootDiv.style.lineHeight="normal");var c=this._metrics=this._calculateMetrics();this._rootDiv.style.lineHeight=d.isIE?c.lineHeight-(c.lineTrim.top+c.lineTrim.bottom)+"px":"normal";a||(this.redraw(),this._resetLineWidth())}};t.EventTarget.addMixin(k.prototype);return{TextView:k}})},"orion/editor/editor":function(){define("orion/editor/editor","i18n!orion/editor/nls/messages orion/editor/keyBinding orion/editor/eventTarget orion/editor/tooltip orion/editor/annotations orion/editor/util".split(" "),
function(p,u,t,d,m,l){function q(a){this._textViewFactory=a.textViewFactory;this._undoStackFactory=a.undoStackFactory;this._textDNDFactory=a.textDNDFactory;this._annotationFactory=a.annotationFactory;this._foldingRulerFactory=a.foldingRulerFactory;this._lineNumberRulerFactory=a.lineNumberRulerFactory;this._contentAssistFactory=a.contentAssistFactory;this._keyBindingFactory=a.keyBindingFactory;this._statusReporter=a.statusReporter;this._domNode=a.domNode;this._foldingRuler=this._overviewRuler=this._lineNumberRuler=
this._annotationRuler=this._annotationModel=this._annotationStyler=null;this._dirty=!1;this._title=this._contentAssist=null;this._keyModes=[]}function s(a){var c=this,d=Array.prototype.slice.call(arguments,1);return d.length?function(){return arguments.length?c.apply(a,d.concat(Array.prototype.slice.call(arguments))):c.apply(a,d)}:function(){return arguments.length?c.apply(a,arguments):c.call(a)}}var r;q.prototype={destroy:function(){this.uninstallTextView();this._textViewFactory=this._undoStackFactory=
this._textDNDFactory=this._annotationFactory=this._foldingRulerFactory=this._lineNumberRulerFactory=this._contentAssistFactory=this._keyBindingFactory=this._statusReporter=this._domNode=null},getAnnotationModel:function(){return this._annotationModel},getAnnotationRuler:function(){return this._annotationRuler},getAnnotationStyler:function(){return this._annotationStyler},getFoldingRuler:function(){return this._foldingRuler},getLineNumberRuler:function(){return this._lineNumberRuler},getModel:function(){var a=
this._textView.getModel();a.getBaseModel&&(a=a.getBaseModel());return a},getOverviewRuler:function(){return this._overviewRuler},getTextView:function(){return this._textView},getTitle:function(){return this._title},getKeyModes:function(){return this._keyModes},isDirty:function(){return this._dirty},setAnnotationRulerVisible:function(a){if(this._annotationRulerVisible!==a&&(this._annotationRulerVisible=a,this._annotationRuler)){var c=this._textView;a?c.addRuler(this._annotationRuler,0):c.removeRuler(this._annotationRuler)}},
setFoldingRulerVisible:function(a){if(this._foldingRulerVisible!==a&&(this._foldingRulerVisible=a,this._foldingRuler)){var c=this._textView;c.getModel().getBaseModel&&(a?c.addRuler(this._foldingRuler,100):c.removeRuler(this._foldingRuler))}},setDirty:function(a){this._dirty!==a&&(this._dirty=a,this.onDirtyChanged({type:"DirtyChanged"}))},setLineNumberRulerVisible:function(a){if(this._lineNumberRulerVisible!==a&&(this._lineNumberRulerVisible=a,this._lineNumberRuler)){var c=this._textView;a?c.addRuler(this._lineNumberRuler,
1):c.removeRuler(this._lineNumberRuler)}},setOverviewRulerVisible:function(a){if(this._overviewRulerVisible!==a&&(this._overviewRulerVisible=a,this._overviewRuler)){var c=this._textView;a?c.addRuler(this._overviewRuler):c.removeRuler(this._overviewRuler)}},mapOffset:function(a,c){var d=this._textView.getModel();d.getBaseModel&&(a=d.mapOffset(a,c));return a},getCaretOffset:function(){return this.mapOffset(this._textView.getCaretOffset())},getSelection:function(){var a=this._textView,c=a.getSelection(),
a=a.getModel();a.getBaseModel&&(c.start=a.mapOffset(c.start),c.end=a.mapOffset(c.end));return c},getText:function(a,c){var d=this._textView.getModel();d.getBaseModel&&(d=d.getBaseModel());return d.getText(a,c)},_expandOffset:function(a){var c=this._textView.getModel(),d=this._annotationModel;if(d&&c.getBaseModel)for(a=d.getAnnotations(a,a+1);a.hasNext();)c=a.next(),c.type===m.AnnotationType.ANNOTATION_FOLDING&&c.expand&&(c.expand(),d.modifyAnnotation(c))},setCaretOffset:function(a){var c=this._textView,
d=c.getModel();d.getBaseModel&&(this._expandOffset(a),a=d.mapOffset(a,!0));c.setCaretOffset(a)},setText:function(a,c,d){var f=this._textView,h=f.getModel();h.getBaseModel&&(void 0!==c&&(this._expandOffset(c),c=h.mapOffset(c,!0)),void 0!==d&&(this._expandOffset(d),d=h.mapOffset(d,!0)));f.setText(a,c,d)},setFoldingEnabled:function(a){this.setFoldingRulerVisible(a)},setSelection:function(a,c,d){var f=this._textView,h=f.getModel();h.getBaseModel&&(this._expandOffset(a),this._expandOffset(c),a=h.mapOffset(a,
!0),c=h.mapOffset(c,!0));f.setSelection(a,c,d)},moveSelection:function(a,c,d,f){var h=this._textView;this.setSelection(a,c||a,!1);c=h.getTopPixel();var k=h.getBottomPixel();a=this.getModel().getLineAtOffset(a);a=h.getLinePixel(a);a<c||a>k?(k=Math.max(0,a-Math.floor((a<c?3:1)*(k-c)/4)),(new r({node:h,duration:300,curve:[c,k],onAnimate:function(a){h.setTopPixel(Math.floor(a))},onEnd:function(){h.showSelection();(void 0===f||f)&&h.focus();d&&d()}})).play()):(h.showSelection(),(void 0===f||f)&&h.focus(),
d&&d())},checkDirty:function(){this.setDirty(!this._undoStack.isClean())},reportStatus:function(a,c,d){this._statusReporter&&this._statusReporter(a,c,d)},_getTooltipInfo:function(a,c){var d=this._textView,f=this.getAnnotationModel();if(!f)return null;var h=this._annotationStyler;if(!h)return null;var k=d.getOffsetAtLocation(a,c);if(-1===k)return null;k=this.mapOffset(k);h=h.getAnnotationsByType(f,k,k+1);f=[];for(k=0;k<h.length;k++)h[k].rangeStyle&&f.push(h[k]);if(0===f.length)return null;d=d.convert({x:a,
y:c},"document","page");return{contents:f,anchor:"left",x:d.x+10,y:d.y+20}},_highlightCurrentLine:function(a,c){var d=this._annotationModel;if(d){var f=this._textView.getModel(),h=c?f.getLineAtOffset(c.start):-1,k=f.getLineAtOffset(a.start),b=a.start===a.end,g=!c||c.start===c.end,l=f.getLineStart(k),q=f.getLineEnd(k);f.getBaseModel&&(l=f.mapOffset(l),q=f.mapOffset(q));f=this._currentLineAnnotation;if(!(h===k&&g&&b&&f&&f.start===l&&f.end===q)){var h=f?[f]:null,s;b&&(f=m.AnnotationType.createAnnotation(m.AnnotationType.ANNOTATION_CURRENT_LINE,
l,q),s=[f]);this._currentLineAnnotation=f;d.replaceAnnotations(h,s)}}},installTextView:function(){this._textView=this._textViewFactory();this._undoStackFactory&&(this._undoStack=this._undoStackFactory.createUndoStack(this));this._textDNDFactory&&(this._textDND=this._textDNDFactory.createTextDND(this,this._undoStack));if(this._contentAssistFactory){var a=this._contentAssistFactory.createContentAssistMode(this);this._keyModes.push(a);this._contentAssist=a.getContentAssist()}var c=this,e=this._textView,
f=this;this._listener={onModelChanged:function(a){f.checkDirty()},onMouseOver:function(a){f._listener.onMouseMove(a)},onMouseMove:function(a){var c=d.Tooltip.getTooltip(e);c&&c.setTarget({x:a.x,y:a.y,getTooltipInfo:function(){return f._getTooltipInfo(this.x,this.y)}})},onMouseOut:function(a,c){var f=d.Tooltip.getTooltip(e);f&&f.setTarget(null)},onSelection:function(a){f._updateCursorStatus();f._highlightCurrentLine(a.newValue,a.oldValue)}};e.addEventListener("ModelChanged",this._listener.onModelChanged);
e.addEventListener("Selection",this._listener.onSelection);e.addEventListener("MouseOver",this._listener.onMouseOver);e.addEventListener("MouseOut",this._listener.onMouseOut);e.addEventListener("MouseMove",this._listener.onMouseMove);this._keyBindingFactory&&this._keyBindingFactory(this,this._keyModes,this._undoStack,this._contentAssist);e.setKeyBinding(new u.KeyBinding(27),"cancelMode");e.setAction("cancelMode",function(){for(var a=!1,c=0;c<this._keyModes.length;c++)this._keyModes[c].isActive()&&
(a=this._keyModes[c].cancel()||a);return a}.bind(this),{name:p.cancelMode});e.setAction("lineUp",function(){for(var a=0;a<this._keyModes.length;a++)if(this._keyModes[a].isActive())return this._keyModes[a].lineUp();return!1}.bind(this));e.setAction("lineDown",function(){for(var a=0;a<this._keyModes.length;a++)if(this._keyModes[a].isActive())return this._keyModes[a].lineDown();return!1}.bind(this));e.setAction("enter",function(){for(var a=0;a<this._keyModes.length;a++)if(this._keyModes[a].isActive())return this._keyModes[a].enter();
return!1}.bind(this));a=function(a,d){if(void 0!==a&&-1!==a){for(var e=this.getView().getModel(),f=this.getAnnotationModel(),h=c.mapOffset(e.getLineStart(a)),e=c.mapOffset(e.getLineEnd(a)),k=f.getAnnotations(h,e),l=null;k.hasNext();){var q=k.next();if(q.type===m.AnnotationType.ANNOTATION_BOOKMARK){l=q;break}}l?f.removeAnnotation(l):(l=m.AnnotationType.createAnnotation(m.AnnotationType.ANNOTATION_BOOKMARK,h,e),l.title=void 0,f.addAnnotation(l))}};if(this._annotationFactory){var h=e.getModel();h.getBaseModel&&
(h=h.getBaseModel());if(this._annotationModel=this._annotationFactory.createAnnotationModel(h))if(h=this._annotationStyler=this._annotationFactory.createAnnotationStyler(e,this._annotationModel))h.addAnnotationType(m.AnnotationType.ANNOTATION_CURRENT_SEARCH),h.addAnnotationType(m.AnnotationType.ANNOTATION_MATCHING_SEARCH),h.addAnnotationType(m.AnnotationType.ANNOTATION_ERROR),h.addAnnotationType(m.AnnotationType.ANNOTATION_WARNING),h.addAnnotationType(m.AnnotationType.ANNOTATION_MATCHING_BRACKET),
h.addAnnotationType(m.AnnotationType.ANNOTATION_CURRENT_BRACKET),h.addAnnotationType(m.AnnotationType.ANNOTATION_CURRENT_LINE),h.addAnnotationType(m.AnnotationType.ANNOTATION_READ_OCCURRENCE),h.addAnnotationType(m.AnnotationType.ANNOTATION_WRITE_OCCURRENCE),h.addAnnotationType("orion.annotation.highlightError");e.annotationModel=this._annotationModel;var h=this._annotationFactory.createAnnotationRulers(this._annotationModel),k=this._annotationRuler=h.annotationRuler;k&&(k.onClick=function(a,d){if(void 0!==
a&&-1!==a)for(var e=this.getView().getModel(),f=this.getAnnotationModel(),h=c.mapOffset(e.getLineStart(a)),e=c.mapOffset(e.getLineEnd(a)),e=f.getAnnotations(h,e);e.hasNext();)if(f=e.next(),this.isAnnotationTypeVisible(f.type)){e=c.getModel();c.onGotoLine(e.getLineAtOffset(h),f.start-h,f.end-h);break}},k.onDblClick=a,k.setMultiAnnotationOverlay({html:"\x3cdiv class\x3d'annotationHTML overlay'\x3e\x3c/div\x3e"}),k.addAnnotationType(m.AnnotationType.ANNOTATION_ERROR),k.addAnnotationType(m.AnnotationType.ANNOTATION_WARNING),
k.addAnnotationType(m.AnnotationType.ANNOTATION_TASK),k.addAnnotationType(m.AnnotationType.ANNOTATION_BOOKMARK));this.setAnnotationRulerVisible(!0);if(k=this._overviewRuler=h.overviewRuler)k.onClick=function(a,d){if(void 0!==a){var f=e.getModel().getLineStart(a);c.moveSelection(c.mapOffset(f))}},k.addAnnotationType(m.AnnotationType.ANNOTATION_CURRENT_SEARCH),k.addAnnotationType(m.AnnotationType.ANNOTATION_MATCHING_SEARCH),k.addAnnotationType(m.AnnotationType.ANNOTATION_ERROR),k.addAnnotationType(m.AnnotationType.ANNOTATION_WARNING),
k.addAnnotationType(m.AnnotationType.ANNOTATION_TASK),k.addAnnotationType(m.AnnotationType.ANNOTATION_BOOKMARK),k.addAnnotationType(m.AnnotationType.ANNOTATION_MATCHING_BRACKET),k.addAnnotationType(m.AnnotationType.ANNOTATION_CURRENT_BRACKET),k.addAnnotationType(m.AnnotationType.ANNOTATION_CURRENT_LINE),k.addAnnotationType(m.AnnotationType.ANNOTATION_READ_OCCURRENCE),k.addAnnotationType(m.AnnotationType.ANNOTATION_WRITE_OCCURRENCE);this.setOverviewRulerVisible(!0)}this._lineNumberRulerFactory&&(this._lineNumberRuler=
this._lineNumberRulerFactory.createLineNumberRuler(this._annotationModel),this._lineNumberRuler.onDblClick=a,this.setLineNumberRulerVisible(!0));this._foldingRulerFactory&&(this._foldingRuler=this._foldingRulerFactory.createFoldingRuler(this._annotationModel),this._foldingRuler.addAnnotationType(m.AnnotationType.ANNOTATION_FOLDING),this.setFoldingRulerVisible(!1));this.dispatchEvent({type:"TextViewInstalled",textView:e})},uninstallTextView:function(){var a=this._textView;a&&(a.destroy(),this._textView=
this._undoStack=this._textDND=this._contentAssist=this._listener=this._annotationModel=this._annotationStyler=this._annotationRuler=this._overviewRuler=this._lineNumberRuler=this._foldingRuler=this._currentLineAnnotation=this._title=null,this._dirty=!1,this._keyModes=[],this.dispatchEvent({type:"TextViewUninstalled",textView:a}))},_updateCursorStatus:function(){for(var a=this.getModel(),c=this.getCaretOffset(),d=a.getLineAtOffset(c),a=a.getLineStart(d),c=c-a,a=0;a<this._keyModes.length;a++){var f=
this._keyModes[a];if(f.isActive()&&f.isStatusActive&&f.isStatusActive())return}this.reportStatus(l.formatMessage(p.lineColumn,d+1,c+1))},showProblems:function(a){var c=this._annotationModel;if(c){for(var d=[],f=[],h=c.getTextModel(),k=c.getAnnotations(0,h.getCharCount()),b;k.hasNext();)b=k.next(),(b.type===m.AnnotationType.ANNOTATION_ERROR||b.type===m.AnnotationType.ANNOTATION_WARNING)&&d.push(b);if(a)for(k=0;k<a.length;k++)if(b=a[k]){var g=b.description.replace(/'/g,"\x26#39;").replace(/"/g,"\x26#34;"),
l=h.getLineStart(b.line-1);b=m.AnnotationType.createAnnotation("error"===b.severity?m.AnnotationType.ANNOTATION_ERROR:m.AnnotationType.ANNOTATION_WARNING,l+b.start-1,l+b.end,g);f.push(b)}c.replaceAnnotations(d,f)}},showOccurrences:function(a){var c=this._annotationModel;if(c){for(var d=[],f=[],h=c.getTextModel(),k=c.getAnnotations(0,h.getCharCount()),b;k.hasNext();)b=k.next(),(b.type===m.AnnotationType.ANNOTATION_READ_OCCURRENCE||b.type===m.AnnotationType.ANNOTATION_WRITE_OCCURRENCE)&&d.push(b);if(a)for(k=
0;k<a.length;k++)if(b=a[k]){var g=h.getLineStart(b.line-1);b=m.AnnotationType.createAnnotation(!0===b.readAccess?m.AnnotationType.ANNOTATION_READ_OCCURRENCE:m.AnnotationType.ANNOTATION_WRITE_OCCURRENCE,g+b.start-1,g+b.end,b.description);f.push(b)}c.replaceAnnotations(d,f)}},showSelection:function(a,c,d,f,h){"number"===typeof a?("number"!==typeof c&&(c=a),this.moveSelection(a,c)):"number"===typeof d&&(a=this.getModel().getLineStart(d-1),"number"===typeof f&&(a+=f),"number"!==typeof h&&(h=0),this.moveSelection(a,
a+h))},setInput:function(a,c,d,f){this._title=a;this._textView&&(f?(this._undoStack.markClean(),this.checkDirty()):(c?this._textView.setText(c):null!==d&&void 0!==d&&(this._textView.setText(d),this._textView.getModel().setLineDelimiter("auto"),this._highlightCurrentLine(this._textView.getSelection())),this._undoStack.reset(),this.checkDirty(),this._textView.focus()));this.onInputChanged({type:"InputChanged",title:a,message:c,contents:d,contentsSaved:f})},onInputChanged:function(a){return this.dispatchEvent(a)},
onGotoLine:function(a,c,d){if(this._textView){var f=this.getModel(),h=f.getLineStart(a),k=0;void 0===d&&(d=0);"string"===typeof c?(a=f.getLine(a).indexOf(c),-1!==a&&(k=a,d=k+c.length)):(k=c,c=f.getLineEnd(a)-h,k=Math.min(k,c),d=Math.min(d,c));this.moveSelection(h+k,h+d)}},onDirtyChanged:function(a){return this.dispatchEvent(a)}};t.EventTarget.addMixin(q.prototype);r=function(){function a(a){this.options=a}a.prototype.play=function(){var a="number"===typeof this.options.duration?this.options.duration:
350,d=this.options.easing||this.defaultEasing,f=this.options.onAnimate||function(){},h=this.options.onEnd||function(){},k=this.options.curve[0],b=this.options.curve[1]-k,g,m,l=-1;m=setInterval(function(){l=-1===l?(new Date).getTime():l;var q=((new Date).getTime()-l)/a;1>q?(q=d(q),g=k+q*b,f(g)):(clearInterval(m),h())},"number"===typeof this.options.rate?this.options.rate:20)};a.prototype.defaultEasing=function(a){return Math.sin(a*(Math.PI/2))};return a}();Function.prototype.bind||(Function.prototype.bind=
s);return{Editor:q,util:{bind:s}}})},"orion/editor/contentAssist":function(){define("orion/editor/contentAssist",["i18n!orion/editor/nls/messages","orion/editor/keyBinding","orion/editor/eventTarget","orion/Deferred","orion/editor/util"],function(p,u,t,d,m){function l(a){this.textView=a;this.state=r.INACTIVE;this.providers=[];var d=this;this.contentAssistListener={onModelChanging:function(a){d.isDeactivatingChange(a)?d.setState(r.INACTIVE):d.state===r.ACTIVE&&d.setState(r.FILTERING)},onScroll:function(a){d.setState(r.INACTIVE)},
onSelection:function(a){a=d.state;if(a===r.ACTIVE||a===r.FILTERING)d.computeProposals(),d.setState(r.FILTERING)}};a.setKeyBinding(m.isMac?new u.KeyBinding(" ",!1,!1,!1,!0):new u.KeyBinding(" ",!0),"contentAssist");a.setAction("contentAssist",function(){d.activate();return!0},{name:p.contentAssist})}function q(a,d){this.contentAssist=a;this.widget=d;this.proposals=[];var f=this;this.contentAssist.addEventListener("ProposalsComputed",function(a){f.proposals=a.data.proposals;f.selectedIndex=f.proposals.length?
0:-1})}function s(a,d){this.contentAssist=a;this.textView=this.contentAssist.getTextView();this.isShowing=this.textViewListenerAdded=!1;var f=this.textView.getOptions("parent").ownerDocument;this.parentNode="string"===typeof d?f.getElementById(d):d;if(!this.parentNode){this.parentNode=m.createElement(f,"div");this.parentNode.className="contentassist";var h=f.getElementsByTagName("body")[0];if(h)h.appendChild(this.parentNode);else throw Error("parentNode is required");}var k=this;this.textViewListener=
{onMouseDown:function(a){a.event.target.parentElement!==k.parentNode&&k.contentAssist.deactivate()}};this.contentAssist.addEventListener("ProposalsComputed",function(a){k.setProposals(a.data.proposals);k.show();k.textViewListenerAdded||(k.textView.addEventListener("MouseDown",k.textViewListener.onMouseDown),k.textViewListenerAdded=!0)});this.contentAssist.addEventListener("Deactivating",function(a){k.setProposals([]);k.hide();k.textViewListenerAdded&&(k.textView.removeEventListener("MouseDown",k.textViewListener.onMouseDown),
k.textViewListenerAdded=!1);k.textViewListenerAdded=!1});this.scrollListener=function(a){k.isShowing&&k.position()};f.addEventListener("scroll",this.scrollListener)}var r={INACTIVE:1,ACTIVE:2,FILTERING:3},a={selected:" selected",hr:"proposal-hr",emphasis:"proposal-emphasis",noemphasis:"proposal-noemphasis",dfault:"proposal-default"};l.prototype={apply:function(a){if(!a)return!1;var d=this.textView.getCaretOffset(),f={proposal:a,start:d,end:d};this.setState(r.INACTIVE);this.textView.setText(a.proposal||
a,d,d);this.dispatchEvent({type:"ProposalApplied",data:f});return!0},activate:function(){this.state===r.INACTIVE&&this.setState(r.ACTIVE)},deactivate:function(){this.setState(r.INACTIVE)},getTextView:function(){return this.textView},isActive:function(){return this.state===r.ACTIVE||this.state===r.FILTERING},isDeactivatingChange:function(a){var d=0<a.removedCharCount&&0===a.addedCharCount,f=this.textView,f=a.start+1<=f.getModel().getCharCount()&&/^\s*$/.test(f.getText(a.start,a.start+1));return 0<
a.removedLineCount||0<a.addedLineCount||d&&f},setState:function(a){var d;a===r.ACTIVE?d="Activating":a===r.INACTIVE&&(d="Deactivating");d&&this.dispatchEvent({type:d});this.state=a;this.onStateChange(a)},onStateChange:function(a){a===r.INACTIVE?this.listenerAdded&&(this.textView.removeEventListener("ModelChanging",this.contentAssistListener.onModelChanging),this.textView.removeEventListener("Scroll",this.contentAssistListener.onScroll),this.textView.removeEventListener("Selection",this.contentAssistListener.onSelection),
this.listenerAdded=!1):a===r.ACTIVE&&(this.listenerAdded||(this.textView.addEventListener("ModelChanging",this.contentAssistListener.onModelChanging),this.textView.addEventListener("Scroll",this.contentAssistListener.onScroll),this.textView.addEventListener("Selection",this.contentAssistListener.onSelection),this.listenerAdded=!0),this.computeProposals())},computeProposals:function(){var a=this,d=this.textView.getCaretOffset();this._computeProposals(d).then(function(d){a.dispatchEvent({type:"ProposalsComputed",
data:{proposals:d}})})},getPrefixStart:function(a){for(;0<a&&/[A-Za-z0-9_]/.test(this.textView.getText(a-1,a));)a--;return a},handleError:function(a){},_computeProposals:function(a){var e=this.providers,f=this.textView,h=f.getModel(),k=f.getText(),b={line:h.getLine(h.getLineAtOffset(a)),prefix:f.getText(this.getPrefixStart(a),a),selection:f.getSelection()},g=this,e=e.map(function(e){var f=e.computeProposals||e.getProposals,h;try{"function"===typeof f&&(h=g.progress?g.progress.progress(f.apply(e,[k,
a,b]),"Generating content assist proposal"):f.apply(e,[k,a,b]))}catch(l){g.handleError(l)}return d.when(h)});return d.all(e,this.handleError).then(function(a){return a.reduce(function(a,b){return b instanceof Array?a.concat(b):a},[])})},setProviders:function(a){this.providers=a.slice(0)},setProgress:function(a){this.progress=a}};t.EventTarget.addMixin(l.prototype);q.prototype={cancel:function(){this.getContentAssist().deactivate()},getContentAssist:function(){return this.contentAssist},isActive:function(){return this.getContentAssist().isActive()},
lineUp:function(){for(var a=0===this.selectedIndex?this.proposals.length-1:this.selectedIndex-1;this.proposals[a].unselectable&&0<a;)a--;this.selectedIndex=a;this.widget&&this.widget.setSelectedIndex(this.selectedIndex);return!0},lineDown:function(){for(var a=this.selectedIndex===this.proposals.length-1?0:this.selectedIndex+1;this.proposals[a].unselectable&&a<this.proposals.length-1;)a++;this.selectedIndex=a;this.widget&&this.widget.setSelectedIndex(this.selectedIndex);return!0},enter:function(){return this.contentAssist.apply(this.proposals[this.selectedIndex]||
null)},tab:function(){return this.widget?(this.widget.createAccessible(this),this.widget.parentNode.focus(),!0):!1}};s.prototype={onClick:function(a){this.contentAssist.apply(this.getProposal(a.target));this.textView.focus()},createDiv:function(a,d,f,h){var k=f.ownerDocument,b=m.createElement(k,"div");b.id="contentoption"+h;b.setAttribute("role","option");"hr"===a.style?a=m.createElement(k,"hr"):(b.className=this.calculateClasses(a.style,d),a=k.createTextNode(this.getDisplayString(a)),d&&this.parentNode.setAttribute("aria-activedescendant",
b.id));b.appendChild(a,b);f.appendChild(b)},createAccessible:function(a){this._isAccessible||this.parentNode.addEventListener("keydown",function(d){d.preventDefault();return 27===d.keyCode?a.cancel():38===d.keyCode?a.lineUp():40===d.keyCode?a.lineDown():13===d.keyCode?a.enter():!1});this._isAccessible=!0},calculateClasses:function(c,d){var f=a[c];f||(f=a.dfault);return d?f+a.selected:f},getDisplayString:function(a){return"string"===typeof a?a:a.description&&"string"===typeof a.description?a.description:
a.proposal},getProposal:function(a){for(var d=0,f=this.parentNode.firstChild;null!==f;f=f.nextSibling){if(f===a)return this.proposals[d]||null;d++}return null},setSelectedIndex:function(a){this.selectedIndex=a;this.selectNode(this.parentNode.childNodes[this.selectedIndex])},selectNode:function(c){for(var d=this.parentNode.childNodes,f=0;f<d.length;f++){var h=d[f],k=h.className.indexOf(a.selected);0<=k&&(h.className=h.className.substring(0,k)+h.className.substring(k+a.selected.length));h===c&&(h.className+=
a.selected,this.parentNode.setAttribute("aria-activedescendant",h.id),h.focus(),h.offsetTop<this.parentNode.scrollTop?h.scrollIntoView(!0):h.offsetTop+h.offsetHeight>this.parentNode.scrollTop+this.parentNode.clientHeight&&h.scrollIntoView(!1))}},setProposals:function(a){this.proposals=a},show:function(){if(0===this.proposals.length)this.hide();else{this.parentNode.innerHTML="";for(var a=0;a<this.proposals.length;a++)this.createDiv(this.proposals[a],0===a,this.parentNode,a);this.position();this.parentNode.onclick=
this.onClick.bind(this);this.isShowing=!0}},hide:function(){this.parentNode.ownerDocument.activeElement===this.parentNode&&this.textView.focus();this.parentNode.style.display="none";this.parentNode.onclick=null;this.isShowing=!1},position:function(){var a=this.textView.getLocationAtOffset(this.textView.getCaretOffset());a.y+=this.textView.getLineHeight();this.textView.convert(a,"document","page");this.parentNode.style.position="fixed";this.parentNode.style.left=a.x+"px";this.parentNode.style.top=
a.y+"px";this.parentNode.style.display="block";this.parentNode.scrollTop=0;var d=this.parentNode.ownerDocument,f=d.documentElement.clientWidth;a.y+this.parentNode.offsetHeight>d.documentElement.clientHeight&&(this.parentNode.style.top=a.y-this.parentNode.offsetHeight-this.textView.getLineHeight()+"px");a.x+this.parentNode.offsetWidth>f&&(this.parentNode.style.left=f-this.parentNode.offsetWidth+"px")}};return{ContentAssist:l,ContentAssistMode:q,ContentAssistWidget:s}})},"orion/editor/annotations":function(){define("orion/editor/annotations",
["i18n!orion/editor/nls/messages","orion/editor/eventTarget"],function(p,u){function t(a,c,d){this.start=a;this.end=c;this._projectionModel=d;this.html=this._expandedHTML;this.style=this._expandedStyle;this.expanded=!0}function d(){}function m(a,c){var e=a.lastIndexOf("."),e=a.substring(e+1),f={title:p[e],style:{styleClass:"annotation "+e},html:"\x3cdiv class\x3d'annotationHTML "+e+"'\x3e\x3c/div\x3e",overviewStyle:{styleClass:"annotationOverview "+e}};c?f.lineStyle={styleClass:"annotationLine "+
e}:f.rangeStyle={styleClass:"annotationRange "+e};d.registerType(a,f)}function l(){}function q(a){this._annotations=[];var c=this;this._listener={onChanged:function(a){c._onChanged(a)}};this.setTextModel(a)}function s(a,c){this._view=a;this._annotationModel=c;var d=this;this._listener={onDestroy:function(a){d._onDestroy(a)},onLineStyle:function(a){d._onLineStyle(a)},onChanged:function(a){d._onAnnotationModelChanged(a)}};a.addEventListener("Destroy",this._listener.onDestroy);a.addEventListener("postLineStyle",
this._listener.onLineStyle);c.addEventListener("Changed",this._listener.onChanged)}t.prototype={_expandedHTML:"\x3cdiv class\x3d'annotationHTML expanded'\x3e\x3c/div\x3e",_expandedStyle:{styleClass:"annotation expanded"},_collapsedHTML:"\x3cdiv class\x3d'annotationHTML collapsed'\x3e\x3c/div\x3e",_collapsedStyle:{styleClass:"annotation collapsed"},collapse:function(){if(this.expanded){this.expanded=!1;this.html=this._collapsedHTML;this.style=this._collapsedStyle;var a=this._projectionModel,c=a.getBaseModel();
this._projection={start:c.getLineStart(c.getLineAtOffset(this.start)+1),end:c.getLineEnd(c.getLineAtOffset(this.end),!0)};a.addProjection(this._projection)}},expand:function(){this.expanded||(this.expanded=!0,this.html=this._expandedHTML,this.style=this._expandedStyle,this._projectionModel.removeProjection(this._projection))}};d.ANNOTATION_ERROR="orion.annotation.error";d.ANNOTATION_WARNING="orion.annotation.warning";d.ANNOTATION_TASK="orion.annotation.task";d.ANNOTATION_BREAKPOINT="orion.annotation.breakpoint";
d.ANNOTATION_BOOKMARK="orion.annotation.bookmark";d.ANNOTATION_FOLDING="orion.annotation.folding";d.ANNOTATION_CURRENT_BRACKET="orion.annotation.currentBracket";d.ANNOTATION_MATCHING_BRACKET="orion.annotation.matchingBracket";d.ANNOTATION_CURRENT_LINE="orion.annotation.currentLine";d.ANNOTATION_CURRENT_SEARCH="orion.annotation.currentSearch";d.ANNOTATION_MATCHING_SEARCH="orion.annotation.matchingSearch";d.ANNOTATION_READ_OCCURRENCE="orion.annotation.readOccurrence";d.ANNOTATION_WRITE_OCCURRENCE="orion.annotation.writeOccurrence";
var r={};d.registerType=function(a,c){var d=c;"function"!==typeof d&&(d=function(a,c,d){this.start=a;this.end=c;d&&(this.title=d)},d.prototype=c);d.prototype.type=a;r[a]=d;return a};d.createAnnotation=function(a,c,d,f){return new (this.getType(a))(c,d,f)};d.getType=function(a){return r[a]};m(d.ANNOTATION_ERROR);m(d.ANNOTATION_WARNING);m(d.ANNOTATION_TASK);m(d.ANNOTATION_BREAKPOINT);m(d.ANNOTATION_BOOKMARK);m(d.ANNOTATION_CURRENT_BRACKET);m(d.ANNOTATION_MATCHING_BRACKET);m(d.ANNOTATION_CURRENT_SEARCH);
m(d.ANNOTATION_MATCHING_SEARCH);m(d.ANNOTATION_READ_OCCURRENCE);m(d.ANNOTATION_WRITE_OCCURRENCE);m(d.ANNOTATION_CURRENT_LINE,!0);d.registerType(d.ANNOTATION_FOLDING,t);l.addMixin=function(a){var c=l.prototype,d;for(d in c)c.hasOwnProperty(d)&&(a[d]=c[d])};l.prototype={addAnnotationType:function(a){this._annotationTypes||(this._annotationTypes=[]);this._annotationTypes.push(a)},getAnnotationTypePriority:function(a){if(this._annotationTypes)for(var c=0;c<this._annotationTypes.length;c++)if(this._annotationTypes[c]===
a)return c+1;return 0},getAnnotationsByType:function(a,c,d){a=a.getAnnotations(c,d);for(d=[];a.hasNext();)c=a.next(),0!==this.getAnnotationTypePriority(c.type)&&d.push(c);var f=this;d.sort(function(a,c){return f.getAnnotationTypePriority(a.type)-f.getAnnotationTypePriority(c.type)});return d},isAnnotationTypeVisible:function(a){return 0!==this.getAnnotationTypePriority(a)},removeAnnotationType:function(a){if(this._annotationTypes)for(var c=0;c<this._annotationTypes.length;c++)if(this._annotationTypes[c]===
a){this._annotationTypes.splice(c,1);break}}};q.prototype={addAnnotation:function(a){if(a){var c=this._annotations,d=this._binarySearch(c,a.start);c.splice(d,0,a);this.onChanged({type:"Changed",added:[a],removed:[],changed:[]})}},getTextModel:function(){return this._model},getAnnotations:function(a,c){var d=this._annotations,f,h=0,k=function(){for(;h<d.length;){var b=d[h++];if(a===b.start||(a>b.start?a<b.end:b.start<c))return b;if(b.start>=c)break}return null};f=k();return{next:function(){var a=f;
a&&(f=k());return a},hasNext:function(){return null!==f}}},modifyAnnotation:function(a){if(a&&!(0>this._getAnnotationIndex(a)))this.onChanged({type:"Changed",added:[],removed:[],changed:[a]})},onChanged:function(a){return this.dispatchEvent(a)},removeAnnotations:function(a){var c=this._annotations,d,f;if(a){d=[];for(f=c.length-1;0<=f;f--){var h=c[f];h.type===a&&c.splice(f,1);d.splice(0,0,h)}}else d=c;this.onChanged({type:"Changed",removed:d,added:[],changed:[]})},removeAnnotation:function(a){a&&(a=
this._getAnnotationIndex(a),0>a||(a={type:"Changed",removed:this._annotations.splice(a,1),added:[],changed:[]},this.onChanged(a)))},replaceAnnotations:function(a,c){var d=this._annotations,f,h,k,b=[];if(a)for(f=a.length-1;0<=f;f--)k=a[f],h=this._getAnnotationIndex(k),0>h||(d.splice(h,1),b.splice(0,0,k));c||(c=[]);for(f=0;f<c.length;f++)k=c[f],h=this._binarySearch(d,k.start),d.splice(h,0,k);this.onChanged({type:"Changed",removed:b,added:c,changed:[]})},setTextModel:function(a){this._model&&this._model.removeEventListener("Changed",
this._listener.onChanged);(this._model=a)&&this._model.addEventListener("Changed",this._listener.onChanged)},_binarySearch:function(a,c){for(var d=a.length,f=-1,h;1<d-f;)h=Math.floor((d+f)/2),c<=a[h].start?d=h:f=h;return d},_getAnnotationIndex:function(a){for(var c=this._annotations,d=this._binarySearch(c,a.start);d<c.length&&c[d].start===a.start;){if(c[d]===a)return d;d++}return-1},_onChanged:function(a){var c=a.start,d=a.addedCharCount,f=a.removedCharCount,h=this._annotations,k=c+f;if(0<h.length){a=
{type:"Changed",added:[],removed:[],changed:[],textModelChangedEvent:a};d-=f;for(f=0;f<h.length;f++){var b=h[f];b.start>=k?(b.start+=d,b.end+=d,a.changed.push(b)):b.end<=c||(b.start<c&&k<b.end?(b.end+=d,a.changed.push(b)):(h.splice(f,1),a.removed.push(b),f--))}if(0<a.added.length||0<a.removed.length||0<a.changed.length)this.onChanged(a)}}};u.EventTarget.addMixin(q.prototype);s.prototype={destroy:function(){var a=this._view;a&&(a.removeEventListener("Destroy",this._listener.onDestroy),a.removeEventListener("LineStyle",
this._listener.onLineStyle),this.view=null);(a=this._annotationModel)&&a.removeEventListener("Changed",this._listener.onChanged)},_mergeStyle:function(a,c){if(c){a||(a={});a.styleClass=a.styleClass&&c.styleClass&&a.styleClass!==c.styleClass?a.styleClass+(" "+c.styleClass):c.styleClass;var d;if(c.style)for(d in a.style||(a.style={}),c.style)a.style[d]||(a.style[d]=c.style[d]);if(c.attributes)for(d in a.attributes||(a.attributes={}),c.attributes)a.attributes[d]||(a.attributes[d]=c.attributes[d])}return a},
_mergeStyleRanges:function(a,c){a||(a=[]);var d,f;for(f=0;f<a.length&&c;f++){var h=a[f];if(c.end<=h.start)break;if(!(c.start>=h.end)){d=this._mergeStyle({},h.style);d=this._mergeStyle(d,c.style);var k=[];k.push(f,1);c.start<h.start&&k.push({start:c.start,end:h.start,style:c.style});c.start>h.start&&k.push({start:h.start,end:c.start,style:h.style});k.push({start:Math.max(h.start,c.start),end:Math.min(h.end,c.end),style:d});c.end<h.end&&k.push({start:c.end,end:h.end,style:h.style});c=c.end>h.end?{start:h.end,
end:c.end,style:c.style}:null;Array.prototype.splice.apply(a,k)}}c&&(d=this._mergeStyle({},c.style),a.splice(f,0,{start:c.start,end:c.end,style:d}));return a},_onAnnotationModelChanged:function(a){function c(a){for(var b=0;b<a.length;b++)if(f.isAnnotationTypeVisible(a[b].type)){var c=a[b].start,l=a[b].end;h.getBaseModel&&(c=h.mapOffset(c,!0),l=h.mapOffset(l,!0));-1!==c&&-1!==l&&d.redrawRange(c,l)}}if(!a.textModelChangedEvent){var d=this._view;if(d){var f=this,h=d.getModel();c(a.added);c(a.removed);
c(a.changed)}}},_onDestroy:function(a){this.destroy()},_onLineStyle:function(a){var c=this._annotationModel,d=a.textView.getModel(),f=c.getTextModel(),h=a.lineStart,k=a.lineStart+a.lineText.length;f!==d&&(h=d.mapOffset(h),k=d.mapOffset(k));for(c=c.getAnnotations(h,k);c.hasNext();)if(h=c.next(),this.isAnnotationTypeVisible(h.type)){if(h.rangeStyle){var k=h.start,b=h.end;f!==d&&(k=d.mapOffset(k,!0),b=d.mapOffset(b,!0));a.ranges=this._mergeStyleRanges(a.ranges,{start:k,end:b,style:h.rangeStyle})}h.lineStyle&&
(a.style=this._mergeStyle({},a.style),a.style=this._mergeStyle(a.style,h.lineStyle))}}};l.addMixin(s.prototype);return{FoldingAnnotation:t,AnnotationType:d,AnnotationTypeList:l,AnnotationModel:q,AnnotationStyler:s}})},"orion/editor/tooltip":function(){define("orion/editor/tooltip",["i18n!orion/editor/nls/messages","orion/editor/textView","orion/editor/textModel","orion/editor/projectionTextModel","orion/editor/util"],function(p,u,t,d,m){function l(d){this._view=d;this._create(d.getOptions("parent").ownerDocument);
d.addEventListener("Destroy",this,this.destroy)}l.getTooltip=function(d){d._tooltip||(d._tooltip=new l(d));return d._tooltip};l.prototype={_create:function(d){if(!this._tooltipDiv){var l=this._tooltipDiv=m.createElement(d,"div");l.className="textviewTooltip";l.setAttribute("aria-live","assertive");l.setAttribute("aria-atomic","true");var p=this._tooltipContents=m.createElement(d,"div");l.appendChild(p);d.body.appendChild(l);this.hide()}},_getWindow:function(){var d=this._tooltipDiv.ownerDocument;
return d.defaultView||d.parentWindow},destroy:function(){if(this._tooltipDiv){this.hide();var d=this._tooltipDiv.parentNode;d&&d.removeChild(this._tooltipDiv);this._tooltipDiv=null}},hide:function(){this._contentsView&&(this._contentsView.destroy(),this._contentsView=null);this._tooltipContents&&(this._tooltipContents.innerHTML="");this._tooltipDiv&&(this._tooltipDiv.style.visibility="hidden");var d=this._getWindow();this._showTimeout&&(d.clearTimeout(this._showTimeout),this._showTimeout=null);this._hideTimeout&&
(d.clearTimeout(this._hideTimeout),this._hideTimeout=null);this._fadeTimeout&&(d.clearInterval(this._fadeTimeout),this._fadeTimeout=null)},isVisible:function(){return this._tooltipDiv&&"visible"===this._tooltipDiv.style.visibility},setTarget:function(d,l){if(this.target!==d&&(this._target=d,this.hide(),d)){var m=this;if(0===l)m.show(!0);else{var a=this._getWindow();m._showTimeout=a.setTimeout(function(){m.show(!0)},l?l:500)}}},show:function(l){if(this._target){var m=this._target.getTooltipInfo();
if(m){var p=this._tooltipDiv,a=this._tooltipContents;p.style.left=p.style.right=p.style.width=p.style.height=a.style.width=a.style.height="auto";var c=m.contents;c instanceof Array&&(c=this._getAnnotationContents(c));if("string"===typeof c)a.innerHTML=c;else if(this._isNode(c))a.appendChild(c);else if(c instanceof d.ProjectionTextModel){var e=this._view,f=e.getOptions();f.wrapMode=!1;f.parent=a;var h=f.themeClass;h?((h=h.replace("tooltip",""))&&(h=" "+h),h="tooltip"+h):h="tooltip";f.themeClass=h;
f=this._contentsView=new u.TextView(f);f._clientDiv.contentEditable=!1;f.addEventListener("LineStyle",function(a){e.onLineStyle(a)});f.setModel(c);c=f.computeSize();a.style.width=c.width+20+"px";a.style.height=c.height+"px";f.resize()}else return;a=p.ownerDocument.documentElement;"right"===m.anchor?(c=a.clientWidth-m.x,p.style.right=c+"px"):(c=parseInt(this._getNodeStyle(p,"padding-left","0"),10),c+=parseInt(this._getNodeStyle(p,"border-left-width","0"),10),c=m.x-c,p.style.left=c+"px");p.style.maxWidth=
a.clientWidth-c-10+"px";c=parseInt(this._getNodeStyle(p,"padding-top","0"),10);c+=parseInt(this._getNodeStyle(p,"border-top-width","0"),10);c=m.y-c;p.style.top=c+"px";p.style.maxHeight=a.clientHeight-c-10+"px";p.style.opacity="1";p.style.visibility="visible";if(l){var k=this,b=this._getWindow();k._hideTimeout=b.setTimeout(function(){var a=parseFloat(k._getNodeStyle(p,"opacity","1"));k._fadeTimeout=b.setInterval(function(){"visible"===p.style.visibility&&0<a?(a-=0.1,p.style.opacity=a):k.hide()},50)},
5E3)}}}},_getAnnotationContents:function(l){function m(c){var d=c.title;if(""===d)return null;var e="\x3cdiv\x3e";c.html&&(e+=c.html+"\x26nbsp;");d||(d=c.end,c=a.getLineStart(a.getLineAtOffset(c.start)),d=a.getLineEnd(a.getLineAtOffset(d),!0),d=a.getText(c,d));d=d.replace(/</g,"\x26lt;").replace(/>/g,"\x26gt;");return e+("\x3cspan style\x3d'vertical-align:middle;'\x3e"+d+"\x3c/span\x3e\x3cdiv\x3e")}if(0===l.length)return null;var r=this._view.getModel(),a=r.getBaseModel?r.getBaseModel():r;if(1===
l.length){r=l[0];if(void 0!==r.title)return m(r);l=new d.ProjectionTextModel(a);var c=a.getLineStart(a.getLineAtOffset(r.start)),e=a.getCharCount();r.end!==e&&l.addProjection({start:r.end,end:e});0<c&&l.addProjection({start:0,end:c});return l}c="\x3cdiv\x3e\x3cem\x3e"+p.multipleAnnotations+"\x3c/em\x3e\x3c/div\x3e";for(e=0;e<l.length;e++)r=l[e],(r=m(r))&&(c+=r);return c},_getNodeStyle:function(d,l,m){var a;if(d&&(a=d.style[l],!a))if(d.currentStyle){for(a=0;-1!==(a=l.indexOf("-",a));)l=l.substring(0,
a)+l.substring(a+1,a+2).toUpperCase()+l.substring(a+2);a=d.currentStyle[l]}else a=(d=d.ownerDocument.defaultView.getComputedStyle(d,null))?d.getPropertyValue(l):null;return a||m},_isNode:function(d){return"object"===typeof Node?d instanceof Node:d&&"object"===typeof d&&"number"===typeof d.nodeType&&"string"===typeof d.nodeName}};return{Tooltip:l}})},"orion/editor/textModel":function(){define("orion/editor/textModel",["orion/editor/eventTarget","orion/editor/util"],function(p,u){function t(d,m){this._lastLineIndex=
-1;this._text=[""];this._lineOffsets=[0];this.setText(d);this.setLineDelimiter(m)}t.prototype={find:function(d){1<this._text.length&&(this._text=[this._text.join("")]);var m=d.string,l=m;!d.regex&&m&&(l=m.replace(/([\\$\^*\/+?\.\(\)|{}\[\]])/g,"\\$\x26"));var q=null,p;if(l){var m=d.reverse,r=d.wrap,a=d.wholeWord,c=d.caseInsensitive,e=d.start||0,f=d.end;d=void 0!==d.end;var h="";-1===h.indexOf("g")&&(h+="g");c&&-1===h.indexOf("i")&&(h+="i");a&&(l="\\b"+l+"\\b");var k=this._text[0],b,g,n=0;d&&(k=k.substring(e,
f),n=e);var t=RegExp(l,h);m?p=function(){var a=null;for(t.lastIndex=0;;){g=t.lastIndex;b=t.exec(k);if(g===t.lastIndex)return null;if(b){if(!(b.index<e)){if(!r||a)break;e=k.length}a={start:b.index+n,end:t.lastIndex+n}}else break}a&&(e=a.start);return a}:(d||(t.lastIndex=e),p=function(){for(;;){g=t.lastIndex;b=t.exec(k);if(g===t.lastIndex)break;if(b)return{start:b.index+n,end:t.lastIndex+n};if(!(0!==g&&r))break}return null});q=p()}return{next:function(){var a=q;a&&(q=p());return a},hasNext:function(){return null!==
q}}},getCharCount:function(){for(var d=0,m=0;m<this._text.length;m++)d+=this._text[m].length;return d},getLine:function(d,m){var l=this.getLineCount();if(!(0<=d&&d<l))return null;var q=this._lineOffsets[d];if(d+1<l){l=this.getText(q,this._lineOffsets[d+1]);if(m)return l;for(var q=l.length,p;10===(p=l.charCodeAt(q-1))||13===p;)q--;return l.substring(0,q)}return this.getText(q)},getLineAtOffset:function(d){var m=this.getCharCount();if(!(0<=d&&d<=m))return-1;var l=this.getLineCount();if(d===m)return l-
1;var q,p,r=this._lastLineIndex;if(0<=r&&r<l&&(q=this._lineOffsets[r],p=r+1<l?this._lineOffsets[r+1]:m,q<=d&&d<p))return r;for(var a=l,c=-1;1<a-c;)if(r=Math.floor((a+c)/2),q=this._lineOffsets[r],p=r+1<l?this._lineOffsets[r+1]:m,d<=q)a=r;else if(d<p){a=r;break}else c=r;return this._lastLineIndex=a},getLineCount:function(){return this._lineOffsets.length},getLineDelimiter:function(){return this._lineDelimiter},getLineEnd:function(d,m){var l=this.getLineCount();if(!(0<=d&&d<l))return-1;if(d+1<l){l=this._lineOffsets[d+
1];if(m)return l;for(var q=this.getText(Math.max(this._lineOffsets[d],l-2),l),p=q.length,r;10===(r=q.charCodeAt(p-1))||13===r;)p--;return l-(q.length-p)}return this.getCharCount()},getLineStart:function(d){return!(0<=d&&d<this.getLineCount())?-1:this._lineOffsets[d]},getText:function(d,m){void 0===d&&(d=0);void 0===m&&(m=this.getCharCount());if(d===m)return"";for(var l=0,p=0,s;p<this._text.length;){s=this._text[p].length;if(d<=l+s)break;l+=s;p++}for(var r=l,a=p;p<this._text.length;){s=this._text[p].length;
if(m<=l+s)break;l+=s;p++}if(a===p)return this._text[a].substring(d-r,m-l);r=this._text[a].substring(d-r);l=this._text[p].substring(0,m-l);return r+this._text.slice(a+1,p).join("")+l},onChanging:function(d){return this.dispatchEvent(d)},onChanged:function(d){return this.dispatchEvent(d)},setLineDelimiter:function(d,m){"auto"===d&&(d=void 0,1<this.getLineCount()&&(d=this.getText(this.getLineEnd(0),this.getLineEnd(0,!0))));this._lineDelimiter=d?d:u.platformDelimiter;if(m){var l=this.getLineCount();if(1<
l){for(var p=Array(l),s=0;s<l;s++)p[s]=this.getLine(s);this.setText(p.join(this._lineDelimiter))}}},setText:function(d,m,l){void 0===d&&(d="");void 0===m&&(m=0);void 0===l&&(l=this.getCharCount());if(!(m===l&&""===d)){for(var p=this.getLineAtOffset(m),s=this.getLineAtOffset(l),r=m,a=l-m,c=s-p,e=d.length,f=0,h=this.getLineCount(),k=0,b=0,g=0,n=[];;){-1!==k&&k<=g&&(k=d.indexOf("\r",g));-1!==b&&b<=g&&(b=d.indexOf("\n",g));if(-1===b&&-1===k)break;g=-1!==k&&-1!==b?k+1===b?b+1:(k<b?k:b)+1:-1!==k?k+1:b+
1;n.push(m+g);f++}this.onChanging({type:"Changing",text:d,start:r,removedCharCount:a,addedCharCount:e,removedLineCount:c,addedLineCount:f});0===n.length&&(k=this.getLineStart(p),s=s+1<h?this.getLineStart(s+1):this.getCharCount(),m!==k&&(d=this.getText(k,m)+d,m=k),l!==s&&(d+=this.getText(l,s),l=s));s=e-a;for(k=p+c+1;k<h;k++)this._lineOffsets[k]+=s;p=[p+1,c].concat(n);Array.prototype.splice.apply(this._lineOffsets,p);for(s=n=0;s<this._text.length;){k=this._text[s].length;if(m<=n+k)break;n+=k;s++}h=
n;for(p=s;s<this._text.length;){k=this._text[s].length;if(l<=n+k)break;n+=k;s++}k=this._text[s];m=this._text[p].substring(0,m-h);l=k.substring(l-n);p=[p,s-p+1];m&&p.push(m);d&&p.push(d);l&&p.push(l);Array.prototype.splice.apply(this._text,p);0===this._text.length&&(this._text=[""]);this.onChanged({type:"Changed",start:r,removedCharCount:a,addedCharCount:e,removedLineCount:c,addedLineCount:f})}}};p.EventTarget.addMixin(t.prototype);return{TextModel:t}})}}});define("orion/orion",[],1);
//# sourceMappingURL=orion.js.map